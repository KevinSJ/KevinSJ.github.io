<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="9g-E_K0GEppNWOItj0YYJV_1UbSLdVFrKOhHSPLkJcM">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"jiangsc.me","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.23.2","exturl":true,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="Recently, I&#39;ve done something with the DNS setup in my local networking. I learnt quite a lot along the way and have decided to write it down for my reference, and for other people who might find">
<meta property="og:type" content="blog">
<meta property="og:title" content="DNS for self hosted apps in homelab">
<meta property="og:url" content="https://jiangsc.me/2025/02/08/dns-for-selfhosted-homelab/index.html">
<meta property="og:site_name" content="Kevin Jiang&#39;s Technical Blog">
<meta property="og:description" content="Recently, I&#39;ve done something with the DNS setup in my local networking. I learnt quite a lot along the way and have decided to write it down for my reference, and for other people who might find">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-02-08T00:34:14.000Z">
<meta property="article:modified_time" content="2025-07-22T04:59:07.505Z">
<meta property="article:author" content="Kevin Jiang">
<meta property="article:tag" content="Traefik">
<meta property="article:tag" content="Self-hosting">
<meta property="article:tag" content="DNS">
<meta property="article:tag" content="Unbound">
<meta property="article:tag" content="Knot">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://jiangsc.me/2025/02/08/dns-for-selfhosted-homelab/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://jiangsc.me/2025/02/08/dns-for-selfhosted-homelab/","path":"2025/02/08/dns-for-selfhosted-homelab/","title":"DNS for self hosted apps in homelab"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>DNS for self hosted apps in homelab | Kevin Jiang's Technical Blog</title>
  






  <script async defer data-website-id="c4ed80eb-6e46-4603-a114-34b3a0f3eb10" src="https://u-a.jiangsc.me/script.js"></script>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  
  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js" defer></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.7.0/mermaid.min.js","integrity":"sha256-4+IKDqhZ/sXjc8Wtl2/MsxI4e0s1KpEVdbEP7V/Lz8U="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/11.9.1/firebase-app-compat.js" integrity="sha256-zPqldYNywFdZIHnjkQ3WS/s4ZZ4B3/JMn1Wl22YHUkA=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/11.9.1/firebase-firestore-compat.js" integrity="sha256-3fIzszWg3JdQOZPBodEwpCD7m+vb4i7mP+iSaykRWI4=" crossorigin="anonymous" defer></script>
  <script class="next-config" data-name="firestore" type="application/json">{"enable":true,"collection":"blog_view","apiKey":"AIzaSyAwkI10aTDM2430EyQhtAz5X04hk16ozRc","projectId":"blog-269be"}</script>
  <script src="/js/third-party/statistics/firestore.js" defer></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Kevin Jiang's Technical Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Kevin Jiang's Technical Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-gallery"><a href="/gallery/" rel="section"><i class="fa fa-image fa-fw"></i>Gallery</a></li><li class="menu-item menu-item-notes"><a href="/notes/" rel="section"><i class="fa fa-book fa-fw"></i>Notes</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Background"><span class="nav-number">1.</span> <span class="nav-text">Background</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Motivation"><span class="nav-number">2.</span> <span class="nav-text">Motivation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Naive-Solution-Modify-hosts-file-on-one-device"><span class="nav-number">3.</span> <span class="nav-text">Naive Solution: Modify hosts file on one device</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Improved-Solution-Modify-Local-DNS"><span class="nav-number">4.</span> <span class="nav-text">Improved Solution: Modify Local DNS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Final-solution-Unbound-with-Knot"><span class="nav-number">5.</span> <span class="nav-text">Final solution: Unbound with Knot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Setting-up-the-zone-file-and-Knot-as-authoritative-server"><span class="nav-number">5.1.</span> <span class="nav-text">Setting up the zone file and Knot as authoritative server</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Raspberry-Pi-setup-Knot-with-DNS-Zone"><span class="nav-number">5.1.1.</span> <span class="nav-text">Raspberry Pi setup (Knot with DNS Zone)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Unbound-setup"><span class="nav-number">5.1.2.</span> <span class="nav-text">Unbound setup</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion-and-Learnings"><span class="nav-number">6.</span> <span class="nav-text">Conclusion and Learnings</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Kevin Jiang</p>
  <div class="site-description" itemprop="description">A blog about all things tech.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">123</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tldmluc2o=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kevinsj"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL2tldnNq" title="LinkedIn → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;kevsj"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRsYWIuY29tL2tldmluc2o=" title="GitLab → https:&#x2F;&#x2F;gitlab.com&#x2F;kevinsj"><i class="fab fa-gitlab fa-fw"></i>GitLab</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jiangsc.me/2025/02/08/dns-for-selfhosted-homelab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Kevin Jiang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kevin Jiang's Technical Blog">
      <meta itemprop="description" content="A blog about all things tech.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="DNS for self hosted apps in homelab | Kevin Jiang's Technical Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          DNS for self hosted apps in homelab
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 02-08-2025 13:34:14" itemprop="dateCreated datePublished" datetime="2025-02-08T13:34:14+13:00">02-08-2025</time>
    </span>

  
    <span class="post-meta-item" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="firestore-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>Recently, I&#39;ve done something with the DNS setup in my local networking. I learnt quite a lot along the way and have decided to write it down for my reference, and for other people who might find this useful.</p>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>I have a quite simple home network setup. My main router is a Linksys WRT1200AC which is running OpenWrt 24.10 branch. I have installed Adblock, Unbound, Stubby, and many other software on this router and even after 10 years, it is still performing well.</p>
<p>My main homelab server is a Raspberry Pi 5 (8 GB) which I bought recently to replace my Rapsberry Pi 3. As I have mentioned in my previous articles <a href="/2023/07/14/Easy-Self-Hosting-with-Traefik-Proxy">on self hosting</a> and <a href="/2023/12/08/self-hosting-nebula-traefik/">nebula</a>, this Raspberry Pi has been running quite a lot of containers along with the Traefik proxy for quite a while now.</p>
<h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><p>I often need to setup private domains within my homelab, mainly to experiment with new software. What I want to achieve is within my local LAN network, every device can resolve these private domains and whenever a new private domain is added, it will take effect automatically without my manual intervention.</p>
<p>For example, in my local network, <code>wallabag.raspberrypi.lan</code> would take me to the wallabag container and <code>static.raspberry.lan</code> would take me to the Nginx container, they are both running on my Raspberry Pi. And <code>lab.raspberrypi.lan</code> would also resolve to the IP of my Raspberry Pi without any intervention.</p>
<p>The rest of this article will focus on how I achieved the solution that solved both of this problem.</p>
<span id="more"></span>

<p>(Note: you might need to flush your DNS cache with <code>sudo systemd-resolve --flush-caches</code>)</p>
<h2 id="Naive-Solution-Modify-hosts-file-on-one-device"><a href="#Naive-Solution-Modify-hosts-file-on-one-device" class="headerlink" title="Naive Solution: Modify hosts file on one device"></a>Naive Solution: Modify hosts file on one device</h2><p>While this may not be what the readers are expecting, it is a solution most people would attempt first. Hosts files are mappings between the host name and IP addresses <span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSG9zdHNfKGZpbGUp">^1<i class="fa fa-external-link-alt"></i></span>. To access <code>wallabag.raspberrypi.lan</code> from a particular device, you can simply add the domain and IP to the hosts file of that device.</p>
<p>As an example, on Linux, if you add <code>wallabag.raspberrypi.lan 192.168.1.134</code> to a device&#39;s hosts file (located at <code>/etc/hosts</code>), the domain <code>wallabag.raspberrypi.lan</code> will resolve to <code>192.168.1.134</code> <strong>on this device</strong>.</p>
<p>Obviously, this is not a great solution -- it doesn&#39;t achieve what I want. You won&#39;t be able to modify the hosts file on your mobile device running iOS or Android easily. And each time you want to experiment with a new domain, you will have to manually add them to your hosts file which will be less than ideal.</p>
<h2 id="Improved-Solution-Modify-Local-DNS"><a href="#Improved-Solution-Modify-Local-DNS" class="headerlink" title="Improved Solution: Modify Local DNS"></a>Improved Solution: Modify Local DNS</h2><p>This second solution is quite similar to the previous one, but it will work for all the devices in the same network once setup properly.</p>
<p>The idea for this solution is to modify the local DNS server so it knows how to resolve those private domains.</p>
<p>For example, if your homelab DNS is using Unbound, you could add the following as part of your Unbound config:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">local-data: &quot;static.raspberrypi.lan. 3600 IN A 192.168.1.134&quot;</span><br><span class="line">local-data: &quot;wallabag.raspberrypi.lan. 3600 IN A 192.168.1.134&quot;</span><br></pre></td></tr></table></figure>

<p>This solution works for every device in the LAN, however, you would still need to keep manually adding all the domains, which is something I would like to avoid.</p>
<h2 id="Final-solution-Unbound-with-Knot"><a href="#Final-solution-Unbound-with-Knot" class="headerlink" title="Final solution: Unbound with Knot"></a>Final solution: Unbound with Knot</h2><p>This final solution is a bit more complicated, but I think it is worth the time I spent on getting to it.</p>
<p>Before we get to the details of the solution, we need to understand the concept of DNS zone and authoritative server in DNS. According to Akamai <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWthbWFpLmNvbS9nbG9zc2FyeS93aGF0LWlzLWF1dGhvcml0YXRpdmUtZG5z">^2<i class="fa fa-external-link-alt"></i></span>:</p>
<blockquote>
<p>Authoritative DNS is the system that keeps official records corresponding to domain names such as IP addresses.</p>
</blockquote>
<p>For DNS Zone, Cloudflare had a great explanation <span class="exturl" data-url="aHR0cHM6Ly93d3cuY2xvdWRmbGFyZS5jb20vbGVhcm5pbmcvZG5zL2dsb3NzYXJ5L2Rucy16b25lLw==">^3<i class="fa fa-external-link-alt"></i></span>:</p>
<blockquote>
<p>A DNS zone is a portion of the DNS namespace that is managed by a specific organization or administrator. A DNS zone is an administrative space which allows for more granular control of DNS components, such as authoritative nameservers.</p>
</blockquote>
<p>The authoritative DNS for a DNS zone is also part of its DNS SOA record, so you can find the authoritative DNS server for <code>google.com</code> easily by issuing the following command:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dig</span> google.<span class="keyword">com</span> SOA</span><br></pre></td></tr></table></figure>

<p>And you will get the following response back:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">dig</span> <span class="string">google.com</span> <span class="string">SOA</span></span><br><span class="line"></span><br><span class="line"><span class="string">;</span> <span class="string">&lt;&lt;&gt;&gt;</span> <span class="string">DiG</span> <span class="number">9.20</span><span class="number">.5</span> <span class="string">&lt;&lt;&gt;&gt;</span> <span class="string">google.com</span> <span class="string">SOA</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">global options:</span> <span class="string">+cmd</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">Got answer:</span></span><br><span class="line"><span class="string">;;</span> <span class="string">-&gt;&gt;HEADER&lt;&lt;-</span> <span class="attr">opcode:</span> <span class="string">QUERY,</span> <span class="attr">status:</span> <span class="string">NOERROR,</span> <span class="attr">id:</span> <span class="number">6457</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">flags:</span> <span class="string">qr</span> <span class="string">rd</span> <span class="string">ra;</span> <span class="attr">QUERY:</span> <span class="number">1</span><span class="string">,</span> <span class="attr">ANSWER:</span> <span class="number">1</span><span class="string">,</span> <span class="attr">AUTHORITY:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">ADDITIONAL:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="string">;;</span> <span class="attr">OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">;</span> <span class="attr">EDNS: version:</span> <span class="number">0</span><span class="string">,</span> <span class="string">flags:;</span> <span class="attr">udp:</span> <span class="number">4095</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">QUESTION SECTION:</span></span><br><span class="line"><span class="string">;google.com.</span>			<span class="string">IN</span>	<span class="string">SOA</span></span><br><span class="line"></span><br><span class="line"><span class="string">;;</span> <span class="attr">ANSWER SECTION:</span></span><br><span class="line"><span class="string">google.com.</span>		<span class="number">3596	</span><span class="string">IN</span>	<span class="string">SOA</span>	<span class="string">ns1.google.com.</span> <span class="string">dns-admin.google.com.</span> <span class="number">724327803</span> <span class="number">900</span> <span class="number">900</span> <span class="number">1800 </span><span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="string">;;</span> <span class="attr">Query time:</span> <span class="number">2</span> <span class="string">msec</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">SERVER:</span> <span class="number">100.100</span><span class="number">.100</span><span class="number">.100</span><span class="comment">#53(100.100.100.100) (UDP)</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">WHEN:</span> <span class="string">Sat</span> <span class="string">Feb</span> <span class="number">08</span> <span class="number">16</span><span class="string">:01:42</span> <span class="string">NZDT</span> <span class="number">2025</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">MSG SIZE  rcvd:</span> <span class="number">89</span></span><br></pre></td></tr></table></figure>

<p>We can see the authoritative DNS server for <code>google.com</code> zone is <code>ns1.google.com</code></p>
<p>In the case of resolving <code>.lan</code> zone, the authoritative server is the router or the LAN DNS server itself. This can be verified through the following command:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">kdig lan SOA</span><br><span class="line">;; -&gt;&gt;<span class="selector-tag">HEADER</span>&lt;&lt;- opcode: QUERY; status: NOERROR; id: <span class="number">17390</span></span><br><span class="line">;; Flags: qr aa rd ra; QUERY: <span class="number">1</span>; ANSWER: <span class="number">1</span>; AUTHORITY: <span class="number">0</span>; ADDITIONAL: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">;; EDNS PSEUDOSECTION:</span><br><span class="line">;; Version: <span class="number">0</span>; flags: ; UDP size: <span class="number">4096</span> B; ext-rcode: NOERROR</span><br><span class="line"></span><br><span class="line">;; QUESTION <span class="selector-tag">SECTION</span>:</span><br><span class="line">;; lan.                		IN	SOA</span><br><span class="line"></span><br><span class="line">;; ANSWER <span class="selector-tag">SECTION</span>:</span><br><span class="line">lan.                	<span class="number">7200</span>	IN	SOA	localhost. nobody.invalid. <span class="number">28982999</span> <span class="number">3600</span> <span class="number">1200</span> <span class="number">9600</span> <span class="number">300</span></span><br><span class="line"></span><br><span class="line">;; Received <span class="number">91</span> <span class="selector-tag">B</span></span><br><span class="line">;; <span class="selector-tag">Time</span> <span class="number">2025</span>-<span class="number">02</span>-<span class="number">08</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">07</span> NZDT</span><br><span class="line">;; <span class="selector-tag">From</span> <span class="number">127.0</span>.<span class="number">0.1</span><span class="keyword">@53</span>(UDP) in <span class="number">0.5</span> ms</span><br></pre></td></tr></table></figure>

<p>Similarly, you will find the current authoritative server for <code>raspberrypi.lan</code> zone is also the router itself, because <code>raspberrypi.lan</code> currently belongs to the <code>lan</code> zone.</p>
<p>The solution I am going to present involves creating a zone file for <code>raspberrypi.lan</code> zone and have a DNS server act as authoritative server for that specific zone, and finally change my local Unbound instance so it knows to query for that server for the <code>raspberrypi.lan</code> zone.</p>
<h3 id="Setting-up-the-zone-file-and-Knot-as-authoritative-server"><a href="#Setting-up-the-zone-file-and-Knot-as-authoritative-server" class="headerlink" title="Setting up the zone file and Knot as authoritative server"></a>Setting up the zone file and Knot as authoritative server</h3><h4 id="Raspberry-Pi-setup-Knot-with-DNS-Zone"><a href="#Raspberry-Pi-setup-Knot-with-DNS-Zone" class="headerlink" title="Raspberry Pi setup (Knot with DNS Zone)"></a>Raspberry Pi setup (Knot with DNS Zone)</h4><p>Before we create the zone file, we need to install the Knot DNS server first. I have chosen to install this on the Raspberry Pi. Once the Knot server is installed successfully, you will need to disable the systemd-resolved and enable the Knot service:<br><code>systemctl disable systemd-resolvd.service &amp;&amp; systemctl enable --now knot</code><br>You will next need to create a <code>resolve.conf</code> file with the following content:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nameserver</span> <span class="number">192.168.1.1</span></span><br><span class="line"><span class="attribute">nameserver</span> fdd0:<span class="number">7</span>ed0:<span class="number">428</span>e::<span class="number">1</span></span><br><span class="line"><span class="attribute">search</span> .</span><br></pre></td></tr></table></figure>

<p>And link this file to <code>/etc/resolv.conf</code></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -sf <span class="constructor">$(<span class="params">realpath</span> <span class="params">resolv</span>.<span class="params">conf</span>)</span> /etc/resolv.conf</span><br></pre></td></tr></table></figure>

<p>This makes sure the Pi can have proper DNS setup after reboot.<br>The zone file for the <code>raspberrypi.lan</code> zone will look like this:</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$ORIGIN</span> raspberrypi.lan.</span><br><span class="line"><span class="meta">$TTL</span> <span class="number">86400</span></span><br><span class="line">raspberrypi.lan. <span class="number">7200</span> <span class="keyword">IN</span> <span class="keyword">SOA</span> ns.raspberrypi.lan. admin.raspberrypi.lan. <span class="number">2025011001</span> <span class="number">3600 1200</span> <span class="number">9600 300</span></span><br><span class="line"></span><br><span class="line">raspberrypi.lan. <span class="number">7200</span> <span class="keyword">IN</span> <span class="keyword">NS</span> ns.raspberrypi.lan.</span><br><span class="line"><span class="comment">; A Records</span></span><br><span class="line">@   <span class="number">600</span>  <span class="keyword">IN</span>     <span class="keyword">A</span>   <span class="number">192.168.1.101</span></span><br><span class="line">ns <span class="number">10800</span> <span class="keyword">IN</span> <span class="keyword">A</span> <span class="number">192.168.1.101</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; Optional Wildcard</span></span><br><span class="line">*.raspberrypi.lan. <span class="number">1800</span> <span class="keyword">IN</span> <span class="keyword">A</span> <span class="number">192.168.1.101</span></span><br></pre></td></tr></table></figure>

<p>You will need to put this file at <code>/var/lib/knot/raspberrypi.lan.zone</code>.</p>
<h4 id="Unbound-setup"><a href="#Unbound-setup" class="headerlink" title="Unbound setup"></a>Unbound setup</h4><p>For the Unbound server, we will need to make use of stub-zone and local-zone. According to Unbound <span class="exturl" data-url="aHR0cHM6Ly9ubG5ldGxhYnMubmwvZG9jdW1lbnRhdGlvbi91bmJvdW5kL3VuYm91bmQuY29uZi8=">^4<i class="fa fa-external-link-alt"></i></span>:</p>
<blockquote>
<p>The stub zone can be used to configure authoritative data to be used by the resolver that cannot be accessed using the public internet servers. This is useful for company-local data or private zones. Setup an authoritative server on a different host (or different port). Enter a config entry for Unbound with stub-addr: &lt;ip address of host[@port]&gt;. The Unbound resolver can then access the data, without referring to the public internet for it.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stub-zone:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">raspberrypi.lan.</span></span><br><span class="line">  <span class="attr">stub-addr:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span></span><br><span class="line">  <span class="attr">stub-first:</span> <span class="literal">no</span></span><br></pre></td></tr></table></figure>

<p>And also add the following local-zone and local-data:</p>
<figure class="highlight wasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span>-zone: <span class="string">&quot;raspberrypi.lan.&quot;</span> transparent</span><br><span class="line"><span class="keyword">local</span>-<span class="keyword">data</span>: <span class="string">&quot;raspberrypi.lan. 7200 IN SOA ns.raspberrypi.lan. admin.raspberrypi.lan. 2025011001 3600 1200 9600 300&quot;</span></span><br><span class="line"><span class="keyword">local</span>-<span class="keyword">data</span>: <span class="string">&quot;raspberrypi.lan. 7200 IN NS ns.raspberrypi.lan.&quot;</span></span><br></pre></td></tr></table></figure>

<p>The above will be needed to allow override the <code>lan.</code> zone that was setup in OpenWrt, it may not be needed if you use Unbound server as standalone.</p>
<p>You can find more about the unbound config <span class="exturl" data-url="aHR0cHM6Ly9ubG5ldGxhYnMubmwvZG9jdW1lbnRhdGlvbi91bmJvdW5kL3VuYm91bmQuY29uZi8=">here<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="Conclusion-and-Learnings"><a href="#Conclusion-and-Learnings" class="headerlink" title="Conclusion and Learnings"></a>Conclusion and Learnings</h2><p>Private zones are essential for homelab, by using Unbound and Knot along with the appropriate zone file, you will be able to get the private domains up and running in you LAN easily.</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Kevin Jiang
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://jiangsc.me/2025/02/08/dns-for-selfhosted-homelab/" title="DNS for self hosted apps in homelab">https://jiangsc.me/2025/02/08/dns-for-selfhosted-homelab/</a>
  </li>
  <li class="post-copyright-license">
      <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Traefik/" rel="tag"># Traefik</a>
              <a href="/tags/Self-hosting/" rel="tag"># Self-hosting</a>
              <a href="/tags/DNS/" rel="tag"># DNS</a>
              <a href="/tags/Unbound/" rel="tag"># Unbound</a>
              <a href="/tags/Knot/" rel="tag"># Knot</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/12/18/2024-year-review/" rel="prev" title="2024 Year in Review">
                  <i class="fa fa-angle-left"></i> 2024 Year in Review
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/02/08/mobile-dev-cli-tips-2/" rel="next" title="Building and Deploying Apps From CLI">
                  Building and Deploying Apps From CLI <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Kevin Jiang</span>
  </div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZw==">NexT.Gemini</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0tldmluU0o=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

<script src="https://unpkg.com/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false}});</script></body>
</html>
