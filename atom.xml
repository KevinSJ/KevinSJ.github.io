<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kevin Jiang&#39;s Technical Blog</title>
  
  
  <link href="https://jiangsc.me/atom.xml" rel="self"/>
  
  <link href="https://jiangsc.me/"/>
  <updated>2022-08-28T04:14:29.066Z</updated>
  <id>https://jiangsc.me/</id>
  
  <author>
    <name>KevinSJ</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Linux user notes -- dual monitor hot plug</title>
    <link href="https://jiangsc.me/2022/07/22/linux-user-notes-1/"/>
    <id>https://jiangsc.me/2022/07/22/linux-user-notes-1/</id>
    <published>2022-07-22T22:04:07.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>As a long time Linux user, I have to admit sometimes it is not easy to achieve some of the things that can be easily done in other OS (like macOS or Windows), but that one of the things I enjoy about Linux as well -- you need to force yourself to learn something, and once you&#39;ve achieved it, you will learn from it and then realize how powerful Linux is. Anyway, for me, this had been one of the problems that had me troubled for a while -- using dual monitors, and have Linux automatically detect and extend desktops automatically.</p><h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><p>I use bspwm as my tiling window manager, and polybar as the &#39;bar&#39;. The problem I&#39;m trying to solve here is to have the laptop automatically detect monitor hot-plug and then extend the bars with different layout to the new monitor. And when I unplugged the external monitor, the system revert back to single monitor layout.</p><span id="more"></span><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>The easiest way to achieve this is using <a href="https://wiki.archlinux.org/title/udev">udev</a>. Based on my understanding, udev is similar to device manager in Windows. To solve this problem with udev, all you need to do is to create a new udev rule.</p><p>The first step is to find out which events are being triggered when the monitors are plugged&#x2F;unplugged. To achieve this, you can use the udev monitor: <code>udevadm monitor --environment --udev</code>. Plugin your monitor, and you will be able to see the events that are being triggered, as an example, here&#39;s what I got, when I plugged in my external monitor: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">UDEV  [5012.844939] change   /devices/pci0000:00/0000:00:02.0/drm/card0 (drm)</span><br><span class="line">ACTION=change</span><br><span class="line">DEVPATH=/devices/pci0000:00/0000:00:02.0/drm/card0</span><br><span class="line">SUBSYSTEM=drm</span><br><span class="line">HOTPLUG=1</span><br><span class="line">DEVNAME=/dev/dri/card0</span><br><span class="line">DEVTYPE=drm_minor</span><br><span class="line">SEQNUM=4288</span><br><span class="line">USEC_INITIALIZED=184807912</span><br><span class="line">ID_PATH=pci-0000:00:02.0</span><br><span class="line">ID_PATH_TAG=pci-0000_00_02_0</span><br><span class="line">ID_FOR_SEAT=drm-pci-0000_00_02_0</span><br><span class="line">DISPLAY=:0</span><br><span class="line">XAUTHORITY=/home/user/.Xauthority</span><br><span class="line">MAJOR=226</span><br><span class="line">MINOR=0</span><br><span class="line">DEVLINKS=/dev/dri/by-path/pci-0000:00:02.0-card</span><br><span class="line">TAGS=:master-of-seat:seat:uaccess:mutter-device-disable-kms-modifiers:</span><br><span class="line">CURRENT_TAGS=:master-of-seat:seat:uaccess:mutter-device-disable-kms-modifiers:</span><br></pre></td></tr></table></figure><p>Next, we are going to create the rules for this udev event. So we create a new file under <code>/etc/udev/rules.d</code> folder, in this case I will call this file <code>/etc/udev/rules.d/95-hdmi-plug.rules</code>, and here&#39;s the content of the file</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ACTION==&quot;change&quot;, SUBSYSTEM==&quot;drm&quot;, KERNEL==&quot;card0&quot; ENV&#123;DISPLAY&#125;=&quot;:0&quot;, ENV&#123;XAUTHORITY&#125;=&quot;/home/kevin/.Xauthority&quot;, RUN+=&quot;/home/user/.monitor-hot-plug.sh&quot;</span><br></pre></td></tr></table></figure><p>Notice how I matched the event: I used <code>ACTION==&quot;change&quot;, SUBSYSTEM==&quot;drm&quot;, KERNEL==&quot;card0&quot;</code>, this is what comes directly from the monitoring after plugging in the external monitor. The ENV part is just setting some environment variables, which is necessary for X11. For the run part, I put in a script that is tailored to my need, it is quite short and simple, just telling xrandr to set the monitor positioning (probably not a best practice to hard code the positioning though): </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /usr/bin/bash</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">connect</span></span>()&#123;</span><br><span class="line">  xrandr --output eDP1 --mode 1920x1080 --pos 0x1080 --rotate normal --output HDMI1 --primary --mode 1920x1080 --pos 0x0 --rotate normal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">disconnect</span></span>()&#123;</span><br><span class="line">  xrandr --output HDMI1 --off</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">xrandr | grep <span class="string">&quot;HDMI1 connected&quot;</span> &amp;&gt; /dev/null &amp;&amp; connect || disconnect</span><br><span class="line"></span><br><span class="line">/bin/bspc wm -r &amp; <span class="built_in">disown</span></span><br></pre></td></tr></table></figure><p>At this point, we can start testing. You can definitely plug and remove the HDMI cable multiple times to test if it works, but that is a bit time consuming. We can use <code>sudo udevadm test /sys/class/drm/card0</code> to see if the config file is correct.</p><p>Once you have done the necessary testing, it is important to reload the udev rules into the running system <code>sudo udevadm control --reload-rules</code></p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>This article explore how udev rules can be utilized to manage hot plug of external monitors. There are also some other different uses for this tool, such as detecting external mouse, external video cam etc. Use the references below to know more.</p><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><ul><li><a href="https://wiki.archlinux.org/title/udev">Arch Linux Wiki on Udev</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;As a long time Linux user, I have to admit sometimes it is not easy to achieve some of the things that can be easily done in other OS (like macOS or Windows), but that one of the things I enjoy about Linux as well -- you need to force yourself to learn something, and once you&amp;#39;ve achieved it, you will learn from it and then realize how powerful Linux is. Anyway, for me, this had been one of the problems that had me troubled for a while -- using dual monitors, and have Linux automatically detect and extend desktops automatically.&lt;/p&gt;
&lt;h3 id=&quot;Problem&quot;&gt;&lt;a href=&quot;#Problem&quot; class=&quot;headerlink&quot; title=&quot;Problem&quot;&gt;&lt;/a&gt;Problem&lt;/h3&gt;&lt;p&gt;I use bspwm as my tiling window manager, and polybar as the &amp;#39;bar&amp;#39;. The problem I&amp;#39;m trying to solve here is to have the laptop automatically detect monitor hot-plug and then extend the bars with different layout to the new monitor. And when I unplugged the external monitor, the system revert back to single monitor layout.&lt;/p&gt;</summary>
    
    
    
    
    <category term="Notes" scheme="https://jiangsc.me/tags/Notes/"/>
    
    <category term="Linux" scheme="https://jiangsc.me/tags/Linux/"/>
    
    <category term="Manjaro Linux" scheme="https://jiangsc.me/tags/Manjaro-Linux/"/>
    
    <category term="Dual monitor" scheme="https://jiangsc.me/tags/Dual-monitor/"/>
    
    <category term="systemd" scheme="https://jiangsc.me/tags/systemd/"/>
    
    <category term="udev" scheme="https://jiangsc.me/tags/udev/"/>
    
  </entry>
  
  <entry>
    <title>Tips for using NeoVim as devtool - 1</title>
    <link href="https://jiangsc.me/2022/05/21/neovim-tricks-1/"/>
    <id>https://jiangsc.me/2022/05/21/neovim-tricks-1/</id>
    <published>2022-05-21T03:14:02.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>As a developer, one of the most important things is to find the right tool to write code with. To me, that means this tool needs to be lightweight, portable, and most importantly reliable.</p><h3 id="Why-VSCode-is-not-for-me"><a href="#Why-VSCode-is-not-for-me" class="headerlink" title="Why VSCode is not for me"></a>Why VSCode is not for me</h3><p>VSCode, aka Visual Studio Code, is a code editor developed by Microsoft. It is based on top of the Atom editor that was previously developed by GitHub. As a full stack developer whose main language is JavaScript&#x2F;TypeScript, I was told to use VSCode when I joined the company. However, as a long-time vim user, I still use the vim mappings when I am using VSCode. This is all done through plugin&#x2F;extensions. This seems to be okay at first, but over time, I really find VSCode annoying to use and I simply can&#39;t tolerate it.</p><p>The first thing is that contrary to most popular belief, VSCode is <strong>NOT</strong> an open source product. Yes, part of the source of VSCode <strong>is</strong> open-sourced, but the VSCode you downloaded from Microsoft website is not. They have put some proprietary stuff into the end product and I&#39;m not a big fan of that. There are ways to get around this, namely, there are several truly open source edition of VSCode, the one I used to use is called VSCodium, but then you will lose access to the extensions market provided by Microsoft.</p><p>Another thing that annoys me is that VSCode or any product that based on VSCode is just too slow and resource intensive -- they are just an electron app running on another Chromium based browser. Having one Chrome is enough for me, so thank you Microsoft (I tried to avoid electron based apps as much as possible, for example, I use web version of Teams, rather than the app one)</p><span id="more"></span><h3 id="How-NeoVim-x2F-Vim-fits-in"><a href="#How-NeoVim-x2F-Vim-fits-in" class="headerlink" title="How NeoVim&#x2F;Vim fits in"></a>How NeoVim&#x2F;Vim fits in</h3><p>I had been a long-time vim user, I first began using vim when I was studying computer science at the university. But I had never tried to use vim as my daily tool for software development before 2021. In February of 2021, we had a new dev joining my team. To my surprise, he was using vim (more precisely NeoVim) as his daily driver. This inspired me, and I started to explore ways to use VIM as well. At the time of this writing, I have been using NeoVim as my daily driver for more than a year now. To me, the experience has never been more pleasant. So I would just like to share a few tips on how I use it daily.</p><h3 id="Run-tests-without-leaving-vim"><a href="#Run-tests-without-leaving-vim" class="headerlink" title="Run tests without leaving vim"></a>Run tests without leaving vim</h3><p>Suppose you currently have a test file opened in you vim, and you would like to run all the tests within this file, what would you do?</p><div class="tabs" id="solutions"><ul class="nav-tabs"><li class="tab active"><a href="#solutions-1">Solution 1: Open a new terminal</a></li><li class="tab"><a href="#solutions-2">Solution 2: Run the command within vim itself</a></li><li class="tab"><a href="#solutions-3">Solution 3: Using Vim's terminal mode/Vim shortcut</a></li><li class="tab"><a href="#solutions-4">Final Solution</a></li></ul><div class="tab-content"><div class="tab-pane active" id="solutions-1"><p>I think most people would open a new window or a new split in Tmux and start the command <code>yarn test filename</code>. At least that was what I was doing when I first encountered this problem. Well, obviously, this is not the ideal solution, because this would be really interruptive, you would have to switch between either a different terminal or a Tmux window.</p></div><div class="tab-pane" id="solutions-2"><p>After several days of using solution 1, I was really tired of it. Switching between different terminal is just too slow and interruptive. So this is when I come to the second solution: in normal mode, use <code>:!yarn test %</code>. Okay, this works, I don&#39;t have to leave VIM each time I want to run the test. But now the problem is that running this command is blocking, meaning you can&#39;t edit the file while the test is running. This is fine if the test is not long or you are just running a single test using <code>it.only</code> or something like that. But if the text is long enough, it might be 2 or 3 minutes before you can do anything again, which is quite annoying to me.</p></div><div class="tab-pane" id="solutions-3"><p>Starting from Vim 8.0, Vim adds a built-in terminal mode, which is quite handy to use. Once I found this out, I started to use <code>:sp term://yarn test %</code>, this will create a new <strong>horizontal</strong> split and start a terminal that runs <code>yarn test %</code>, while the tests are running, you can still do whatever you want to do and will not be blocked by the testing itself.<br>Once the command is finished, you will see the command exit in that window.</p><p>This solution is almost perfect, except I use this command too frequently that typing this whole command becomes a pain. So I had to find some way to improve my experience. And this all comes down to mapping this command to something shorter (at least that was what I was thinking at first). So I added the following to my vimrc file <code>cmap rt!! !yarn test % &lt;CR&gt;</code> this saves lots of keystrokes, but still, I need to type it every single time I want to use it. I still feel there&#39;s space for improvements. </p></div><div class="tab-pane" id="solutions-4"><h3 id="Final-Solution-Key-mapping"><a href="#Final-Solution-Key-mapping" class="headerlink" title="Final Solution: Key mapping"></a>Final Solution: Key mapping</h3><p>Based on function 3.1, I started to think if I can map the command to a leader key, it turned out I definitely can, with this <code>map &lt;buffer&gt; &lt;silent&gt; &lt;nowait&gt; &lt;Leader&gt;rt :execute &#39;sp term://yarn test %&#39;&lt;CR&gt;</code></p></div></div></div><h3 id="Afterthoughts"><a href="#Afterthoughts" class="headerlink" title="Afterthoughts"></a>Afterthoughts</h3><p>There are several caveats with the above solution.<br>First, this mapping will exist in every file type which is not ideal, cause you don&#39;t want to use yarn to test a GO file for example. Therefore, I moved this command to a separate file under the <code>ftplugin</code> folder and call it <code>typescript_mappings.vim</code>.<br>Second, you will always have to locate the test file before you can run the test. This is not a deal breaker, but it is still not perfect. Usually you would refactor a simple function within a file and all you care about is whether the corresponding tests passes, you don&#39;t necessarily need to edit the file or care about where the file is. This prompts me to turn this whole thing into a vimscript function<br>Here goes the function I created: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">map &lt;leader&gt;T :Ft&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">if exists(&#x27;*FindTest&#x27;)</span><br><span class="line">    finish</span><br><span class="line">endif</span><br><span class="line">command! -nargs=? Ft call FindTest(&lt;q-args&gt;)</span><br><span class="line">fun! FindTest(...)</span><br><span class="line">  set path+=**</span><br><span class="line"></span><br><span class="line">  let fileName = expand(&#x27;%:t:r&#x27;) . &#x27;.test.ts&#x27;</span><br><span class="line">  execute &#x27;tabnew &#x27;</span><br><span class="line">  execute &#x27;find &#x27;. fileName</span><br><span class="line">  execute &#x27;split term://yarn test &#x27;. fileName . &#x27; --watch&#x27;</span><br><span class="line">endfun</span><br></pre></td></tr></table></figure><p>This function first set the look path to all the directories recursively, then it expand to the filename excluding the extension, then add .test.ts to it. After that, it opens a new tab, open the test file and then create a terminal, yarn test that file in watch mode.</p><p>I put this file under the ftplugin again, but one issue is that because the both the file found and the current file are of the same file type, this means the script will be sourced twice. So I had to put the <code>if exists</code> check. I map this command to <leader> T but you can tailor that to your liking.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;As a developer, one of the most important things is to find the right tool to write code with. To me, that means this tool needs to be lightweight, portable, and most importantly reliable.&lt;/p&gt;
&lt;h3 id=&quot;Why-VSCode-is-not-for-me&quot;&gt;&lt;a href=&quot;#Why-VSCode-is-not-for-me&quot; class=&quot;headerlink&quot; title=&quot;Why VSCode is not for me&quot;&gt;&lt;/a&gt;Why VSCode is not for me&lt;/h3&gt;&lt;p&gt;VSCode, aka Visual Studio Code, is a code editor developed by Microsoft. It is based on top of the Atom editor that was previously developed by GitHub. As a full stack developer whose main language is JavaScript&amp;#x2F;TypeScript, I was told to use VSCode when I joined the company. However, as a long-time vim user, I still use the vim mappings when I am using VSCode. This is all done through plugin&amp;#x2F;extensions. This seems to be okay at first, but over time, I really find VSCode annoying to use and I simply can&amp;#39;t tolerate it.&lt;/p&gt;
&lt;p&gt;The first thing is that contrary to most popular belief, VSCode is &lt;strong&gt;NOT&lt;/strong&gt; an open source product. Yes, part of the source of VSCode &lt;strong&gt;is&lt;/strong&gt; open-sourced, but the VSCode you downloaded from Microsoft website is not. They have put some proprietary stuff into the end product and I&amp;#39;m not a big fan of that. There are ways to get around this, namely, there are several truly open source edition of VSCode, the one I used to use is called VSCodium, but then you will lose access to the extensions market provided by Microsoft.&lt;/p&gt;
&lt;p&gt;Another thing that annoys me is that VSCode or any product that based on VSCode is just too slow and resource intensive -- they are just an electron app running on another Chromium based browser. Having one Chrome is enough for me, so thank you Microsoft (I tried to avoid electron based apps as much as possible, for example, I use web version of Teams, rather than the app one)&lt;/p&gt;</summary>
    
    
    
    
    <category term="Vim" scheme="https://jiangsc.me/tags/Vim/"/>
    
    <category term="Tips" scheme="https://jiangsc.me/tags/Tips/"/>
    
    <category term="nvim" scheme="https://jiangsc.me/tags/nvim/"/>
    
    <category term="NeoVim" scheme="https://jiangsc.me/tags/NeoVim/"/>
    
  </entry>
  
  <entry>
    <title>Hide Phone Number when making calls</title>
    <link href="https://jiangsc.me/2022/03/06/hide-phone-number-when-making-calls/"/>
    <id>https://jiangsc.me/2022/03/06/hide-phone-number-when-making-calls/</id>
    <published>2022-03-06T04:43:57.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<div class="note danger"><h4 id="Warning"><a href="#Warning" class="headerlink" title="Warning"></a>Warning</h4><p>⚠ Hiding phone numbers may not be legal in some places, and even if you hide your number, you mobile operator <strong>WILL</strong> (of course) see your number. Use the method described in this article at your own risk!</p></div><span id="more"></span><p>In Android&#x2F;iOS, there is a way to hide your phone numbers on outgoing phone calls.</p><ul><li>For most Android phones, this setting is somewhere under <strong>Call Settings</strong> -&gt; <strong>Additional settings</strong> in the phone app. </li><li>In most countries, it is by law that the mobile network operator provide an option to hide your number. if you choose the <strong>Hide number</strong> options, you number will always be hidden. <em><strong>This is a setting at the operator level, meaning even people who have your info in their contacts will not be able to identify who you are.</strong></em></li><li>To most people, you would not want to hide your mobile number when calling someone you know. But you <strong>do</strong> want to do so, if you are calling someone you are not familiar with, a business for example.</li><li>Luckily, there is a way to hide your phone numbers temporarily, if you wish to do so. It differs by country though:<ul><li>In the U.S, if you want to hide your number, you can add <code>*67</code> before the number you are calling.</li><li>In New Zealand, you can use<ul><li>when <code>*31#</code> is added to the number you are trying to call, you number will be shown, disregarding the setting.</li><li>when <code>#31#</code> is added to the number you are trying to call, you number will be hidden, disregarding the setting</li></ul></li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;note danger&quot;&gt;&lt;h4 id=&quot;Warning&quot;&gt;&lt;a href=&quot;#Warning&quot; class=&quot;headerlink&quot; title=&quot;Warning&quot;&gt;&lt;/a&gt;Warning&lt;/h4&gt;&lt;p&gt;⚠ Hiding phone numbers may not be legal in some places, and even if you hide your number, you mobile operator &lt;strong&gt;WILL&lt;/strong&gt; (of course) see your number. Use the method described in this article at your own risk!&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    
    <category term="tips" scheme="https://jiangsc.me/tags/tips/"/>
    
  </entry>
  
  <entry>
    <title>Fixing issue on Xorg and VNC</title>
    <link href="https://jiangsc.me/2021/12/02/Fixing-issue-on-Xorg-and-VNC/"/>
    <id>https://jiangsc.me/2021/12/02/Fixing-issue-on-Xorg-and-VNC/</id>
    <published>2021-12-02T09:48:35.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>Yesterday morning, when I woke up, I faced a serious issue on my laptop which has Manjaro Linux installed -- the X server can not be started.</p><h3 id="Locating-the-problem"><a href="#Locating-the-problem" class="headerlink" title="Locating the problem"></a>Locating the problem</h3><p>It took me some time to get my head around and locate the root cause. The first thing I tried is obviously force reboot several times, it turned out this did not help at all! Reboot will not solve everything.™<br>The next thing I tried was the fallback initramfs mode. I don&#39;t really understand what it does, but tried it anyway. And unfortunately, that does not work either.<br>At this point,the only option left for me to try is recovery mode. And it turned out to be working correctly. As root user in the recovery mode, I issued the following command <code>systemctl set-default multi-user.target</code>, this makes the tty the default target rather than the graphical interface. Another reboot, and I got into the terminal.<br>Once in terminal, I immediately tried <code>startx</code>, this failed due to some wired permission issue, and with <code>sudo startx</code>, the command failed as well. Looking at the Xorg log, I noticed that the start process stops at: <code>(II) Initializing extension VNC</code>.</p><span id="more"></span><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>The obvious solution at this point is to uninstall the VNC module that is causing the issue, so <code>sudo pacman --remove --recursive tigervnc</code> was the way to go. And it did fix the issue. So what I had to do was reset it back to graphical interface start with <code>systemctl set-default graphical.target</code>.</p><h3 id="Findings-and-thoughts"><a href="#Findings-and-thoughts" class="headerlink" title="Findings and thoughts"></a>Findings and thoughts</h3><p>By doing some more research online, I have found that this issue was actually solved by TigerVNC as can be seen from <a href="https://github.com/TigerVNC/tigervnc/issues/1373">this</a> closed issue. The issue that most likely to have happened here is that Arch Linux package builder did not provide the up-to-date build for the package which resulted in the package does not included the updated dependencies from the X server.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Yesterday morning, when I woke up, I faced a serious issue on my laptop which has Manjaro Linux installed -- the X server can not be started.&lt;/p&gt;
&lt;h3 id=&quot;Locating-the-problem&quot;&gt;&lt;a href=&quot;#Locating-the-problem&quot; class=&quot;headerlink&quot; title=&quot;Locating the problem&quot;&gt;&lt;/a&gt;Locating the problem&lt;/h3&gt;&lt;p&gt;It took me some time to get my head around and locate the root cause. The first thing I tried is obviously force reboot several times, it turned out this did not help at all! Reboot will not solve everything.™&lt;br&gt;The next thing I tried was the fallback initramfs mode. I don&amp;#39;t really understand what it does, but tried it anyway. And unfortunately, that does not work either.&lt;br&gt;At this point,the only option left for me to try is recovery mode. And it turned out to be working correctly. As root user in the recovery mode, I issued the following command &lt;code&gt;systemctl set-default multi-user.target&lt;/code&gt;, this makes the tty the default target rather than the graphical interface. Another reboot, and I got into the terminal.&lt;br&gt;Once in terminal, I immediately tried &lt;code&gt;startx&lt;/code&gt;, this failed due to some wired permission issue, and with &lt;code&gt;sudo startx&lt;/code&gt;, the command failed as well. Looking at the Xorg log, I noticed that the start process stops at: &lt;code&gt;(II) Initializing extension VNC&lt;/code&gt;.&lt;/p&gt;</summary>
    
    
    
    
    <category term="Linux" scheme="https://jiangsc.me/tags/Linux/"/>
    
    <category term="Arch Linux" scheme="https://jiangsc.me/tags/Arch-Linux/"/>
    
    <category term="Xorg" scheme="https://jiangsc.me/tags/Xorg/"/>
    
    <category term="TigerVNC" scheme="https://jiangsc.me/tags/TigerVNC/"/>
    
  </entry>
  
  <entry>
    <title>OpenType Font and Font Family</title>
    <link href="https://jiangsc.me/2021/08/14/OpenType-Font-and-Font-Family/"/>
    <id>https://jiangsc.me/2021/08/14/OpenType-Font-and-Font-Family/</id>
    <published>2021-08-14T01:31:56.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<details class="note primary"><summary><p>TL;DR</p></summary><p>Font family name (Name Id 1 in name table of the font) in a OpenType font file should not be used as the font-family property in CSS if the font is not one of regular, italic, bold, and bold italic style. Instead, the Typographic Family Name or Preferred Font Family (Name ID 16 in name table of the font) should be used if including them in CSS.</p></details><h3 id="Background-and-Problem"><a href="#Background-and-Problem" class="headerlink" title="Background and Problem"></a>Background and Problem</h3><p>Recently, I was tasked to investigate an interesting problem found in our custom font implementation. Font is something I have no prior knowledge about and this investigation really helped me learn a lot more about font and by writing it down, I hope I can help developers who may face similar problems.</p><p>Our system allows user to upload any font as long as they have the permission to use the font commercially. Recently, we realized that some of the fonts uploaded by user were not displayed correctly. More specifically the <code>font-family</code> attribute of these said fonts were incorrectly extracted.</p><p>As an example, an user uploaded a font called <code>fontA-SemiBold</code>, the extracted font-family name from the font was <code>fontA-SemiBold</code> whereas the correct name of for the font-family should be <code>fontA</code>. And in this case. The incorrect font name resulted in incorrect rendering in the front-end as the CSS rendering is suppose to have the correct font-family name.</p><span id="more"></span><h3 id="Investigation"><a href="#Investigation" class="headerlink" title="Investigation"></a>Investigation</h3><p>After looking at several of the uploaded fonts and going through the code, I decided it is necessary to create a small POC using the library we chose in our application. I was able to reproduce the issue that we face with the user uploaded font -- the library yield an incorrect font-family name. This leads me to think whether the problem lies within the library itself. So I immediately used another font I found online. To my surprise, this time the library was able to extract the correct font-family.</p><p>Having done the POC, and finished this small experiment, I&#39;m a bit at lost. <strong>How come the library sometimes work and sometimes failed to work?</strong></p><p><strong>Later, I realized this is because the font I chose happen to be <code>Roboto-Bold</code>.</strong></p><h3 id="Findings-and-learnings"><a href="#Findings-and-learnings" class="headerlink" title="Findings and learnings"></a>Findings and learnings</h3><p>To dig deeper into this, I went through the OpenType font specification on Microsoft website. The relevant part for the documentation is the <code>name</code> table for a font, so I read through all of it and here&#39;s what I found and learnt: </p><ul><li>A font file contains a <em><strong>name</strong></em> table that stores the information about the font, this might include license for the font, font family name, urls etc. The library we used use this specific table to extract information about a font.</li><li>A font family name (name ID 1 in the name table) for a font can only be shared among at most four basic styles of font faces -- they are regular, italic, bold, and bold italic. That is why the library returns the correct font family name for the <code>Roboto-Bold</code> I chose. </li><li>For styles that fall outside of these four styles, such as Semi-Bold or Black, they are treated as a separate font family and will have a separate font family name. For example, the font family name for <code>Roboto-Black</code> will be <code>Roboto-Black</code> rather than <code>Roboto</code>. </li><li>A Typographic Family Name (or Preferred Family) -- Name Id 16 in the name table has no constraints in the number of font faces, but is only present when the font face falls outside of the basic four styles.</li><li>In CSS, the <code>font-family</code> property is expected to be the shared font name. For example, if using <code>Roboto-Black</code> font in CSS, the font-family property should be <code>Roboto</code> rather than <code>Roboto-Black</code></li><li>The difference between the font family name definition between CSS and the OpenType means that it is best to always use the <em><strong>Typographic Family Name</strong></em> if it presents rather than the <em><strong>Font Family name</strong></em> if the HTML&#x2F;CSS is generated on the fly.</li></ul><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>As we have a better understanding on the font family specification now, we need to find ways to retrieve it from the font table. </p><p>Fontkit was the library of choice and therefore I will only discuss how to get the correct font family name in fontkit. Unfortunately, fontkit does not have a direct way of accessing the Typographic Family Name. Through reading its source code, I found the way to go is to use an undocumented API -- <code>font.getName(&#39;preferredName&#39;)</code>, note that the <code>preferredName</code> is the same as Typographic Family Name, and it corresponds to name ID 16 in the font name table.</p><h3 id="Bonus-Using-fonttools-to-dump-and-inspect-font-tables"><a href="#Bonus-Using-fonttools-to-dump-and-inspect-font-tables" class="headerlink" title="Bonus: Using fonttools to dump and inspect font tables"></a>Bonus: Using fonttools to dump and inspect font tables</h3><p>Out of curiosity, and to verify Microsoft&#39;s documentation I found a tool called fonttools which can be used to dump tables in a ttf&#x2F;otf file to ttx format. This format is essentially an XML, you can open it with any text editor and inspect the content.</p><p>Installation of this tool can be done through pip: <code>pip install --user fonttools</code></p><p>Once installation&#39;s finished, you can dump all the tables for a font file using <code>ttx &lt;fontfileName&gt;</code>. Note that this will result in an very large XML -- roughly 120k lines. </p><p>As we are only interested in the name table, the following command can be used to dump that table only: <code>ttx -t name &lt;fontFileName&gt;</code></p><p>Here&#39;s an example of the dump: </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ttFont</span> <span class="attr">sfntVersion</span>=<span class="string">&quot;\x00\x01\x00\x00&quot;</span> <span class="attr">ttLibVersion</span>=<span class="string">&quot;4.26&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;0&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Copyright 2011 Google Inc. All Rights Reserved.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Roboto Black</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;2&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Regular</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Roboto Black</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;4&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Roboto Black</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;5&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Version 2.137; 2017</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;6&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Roboto-Black</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;7&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Roboto is a trademark of Google.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;9&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Google</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;11&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Google.com</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;12&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Christian Robertson</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;13&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Licensed under the Apache License, Version 2.0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;14&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;16&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Roboto</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">namerecord</span> <span class="attr">nameID</span>=<span class="string">&quot;17&quot;</span> <span class="attr">platformID</span>=<span class="string">&quot;3&quot;</span> <span class="attr">platEncID</span>=<span class="string">&quot;1&quot;</span> <span class="attr">langID</span>=<span class="string">&quot;0x409&quot;</span>&gt;</span></span><br><span class="line">      Black</span><br><span class="line">    <span class="tag">&lt;/<span class="name">namerecord</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ttFont</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="References-and-further-readings"><a href="#References-and-further-readings" class="headerlink" title="References and further readings"></a>References and further readings</h3><p><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/name">https://docs.microsoft.com/en-us/typography/opentype/spec/name</a><br><a href="https://github.com/foliojs/fontkit">https://github.com/foliojs/fontkit</a><br><a href="https://github.com/fonttools/fonttools">https://github.com/fonttools/fonttools</a></p>]]></content>
    
    
    <summary type="html">&lt;details class=&quot;note primary&quot;&gt;&lt;summary&gt;&lt;p&gt;TL;DR&lt;/p&gt;
&lt;/summary&gt;
&lt;p&gt;Font family name (Name Id 1 in name table of the font) in a OpenType font file should not be used as the font-family property in CSS if the font is not one of regular, italic, bold, and bold italic style. Instead, the Typographic Family Name or Preferred Font Family (Name ID 16 in name table of the font) should be used if including them in CSS.&lt;/p&gt;

&lt;/details&gt;


&lt;h3 id=&quot;Background-and-Problem&quot;&gt;&lt;a href=&quot;#Background-and-Problem&quot; class=&quot;headerlink&quot; title=&quot;Background and Problem&quot;&gt;&lt;/a&gt;Background and Problem&lt;/h3&gt;&lt;p&gt;Recently, I was tasked to investigate an interesting problem found in our custom font implementation. Font is something I have no prior knowledge about and this investigation really helped me learn a lot more about font and by writing it down, I hope I can help developers who may face similar problems.&lt;/p&gt;
&lt;p&gt;Our system allows user to upload any font as long as they have the permission to use the font commercially. Recently, we realized that some of the fonts uploaded by user were not displayed correctly. More specifically the &lt;code&gt;font-family&lt;/code&gt; attribute of these said fonts were incorrectly extracted.&lt;/p&gt;
&lt;p&gt;As an example, an user uploaded a font called &lt;code&gt;fontA-SemiBold&lt;/code&gt;, the extracted font-family name from the font was &lt;code&gt;fontA-SemiBold&lt;/code&gt; whereas the correct name of for the font-family should be &lt;code&gt;fontA&lt;/code&gt;. And in this case. The incorrect font name resulted in incorrect rendering in the front-end as the CSS rendering is suppose to have the correct font-family name.&lt;/p&gt;</summary>
    
    
    
    
    <category term="OpenType font" scheme="https://jiangsc.me/tags/OpenType-font/"/>
    
    <category term="Font" scheme="https://jiangsc.me/tags/Font/"/>
    
    <category term="CSS" scheme="https://jiangsc.me/tags/CSS/"/>
    
    <category term="font-family" scheme="https://jiangsc.me/tags/font-family/"/>
    
    <category term="NodeJS" scheme="https://jiangsc.me/tags/NodeJS/"/>
    
  </entry>
  
  <entry>
    <title>Advanced VirtualBox: Auto start virtual machine on Windows</title>
    <link href="https://jiangsc.me/2021/07/10/Advanced-VirtualBox-Auto-start-virtualbox-on-Windows/"/>
    <id>https://jiangsc.me/2021/07/10/Advanced-VirtualBox-Auto-start-virtualbox-on-Windows/</id>
    <published>2021-07-10T00:18:14.000Z</published>
    <updated>2022-08-28T04:14:29.062Z</updated>
    
    <content type="html"><![CDATA[<p>I&#39;ve always considered myself to be an advanced computer user, but I&#39;m not a Windows person, at least not when I&#39;m coding. So when I got a Windows 10 laptop as a daily work machine, I&#39;m beyond disappointed. Luckily, there&#39;s always a way around -- VirtualBox it is. The laptop I got was powerful enough that I was able to allocate 16GB of memory as well as 3 cores of the host machine to the virtual machine.</p><p>Once I had my vm setup, I always use Windows Terminal and SSH into the machine for development. One day, it occurs to me I can (and should) automate all of this. </p><h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><p>Automatically start the selected VirtualBox virtual machine in <strong>headless</strong> mode (this can save a bit of resources), wait for the machine to boot, and then SSH into the VM using Windows Terminal with selected port forwarding on the host and virtual machine.</p><span id="more"></span><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>This is not something that can be achieved in one go, therefore I&#39;m going to breakdown by components: </p><ul><li>Virtual machine -- Assuming Systemd based Linux distro<ul><li>We need to disable the graphical login interface for the VM. To achieve this, we can do <code>systemctl set-default multi-user.target </code>. If we need to revert back to graphical login, we can do <code>systemctl set-default graphical.target</code>. The multi-user.target and graphical.target are equivalent to what was traditionally known as run levels in SystemV.</li><li>We also need to setup the necessary SSH access from the Windows 10 host machine to the virtual machine. I won&#39;t cover that here. Only thing to keep in mind is to open the necessary ports.</li></ul></li><li>Host machine -- need to setup batch script, Windows Terminal profile and Window startup <ul><li>Batch script<ul><li>What we need to achieve in the batch script is start the machine and wait for it to boot. Fortunately, virtualbox installation comes with something that can achieve this, it is called VBoxmanage.exe and is in the VirtualBox installation folder</li><li>To start the virtual machine, the command will be <code>&quot;C:\Program Files\VirtualBox\VboxManage.exe&quot; startvm [VM name] --type headless</code>. Change the command with your VM name, the <code>--type headless</code> means that no GUI of the virtual machine will be started at all.</li><li>Next step is to wait for the machine to start up, the command for this will be <code>&quot;C:\Program Files\VirtualBox\VboxManage.exe&quot; wait &quot;[VM name]&quot; &quot;/VirtualBox/GuestInfo/OS/NoLoggedInUsers&quot;</code></li><li>Last step for the batch script will be <code>wt</code>, which represents windows terminal.</li><li>To put it together, the batch script will be   <figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">&quot;C:\Program Files\VirtualBox\VboxManage.exe&quot; startvm [VM name] --<span class="built_in">type</span> headless</span><br><span class="line">&quot;C:\Program Files\VirtualBox\VboxManage.exe&quot; wait &quot;[VM name]&quot; &quot;/VirtualBox/GuestInfo/OS/NoLoggedInUsers&quot;</span><br><span class="line">wt</span><br></pre></td></tr></table></figure></li></ul></li><li>Windows terminal profile<ul><li>Create a profile in Windows terminal, this can be done from either the UI or the json setting file.</li><li>Here, I will present the profile I use personally:   <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bellStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;visual&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;colorScheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Tango Dark&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;commandline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ssh -R 5432:localhost:5432 -L 8080:[::1]:8080 -L 3000:[::1]:3000 -t username@vm_ip_address &quot;</span>exec zsh -l<span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;VM&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scrollbarState&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hidden&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li>It is obvious the commandline part is a bit bloated cause I was trying to do a bit too much in one go. Actually, it is a lot cleaner to put the command in a batch file and this line can be replaced by the path to that specific batch file as well.</li></ul></li><li>Windows Auto Start<ul><li>Press Windows+R and type <code>shell:startup</code>, this will bring up a folder called &quot;StartUp&quot; where you can put a bunch of things that you want to auto start when Windows starts.</li><li>Drag the Batch script created into this folder to create a shortcut.</li></ul></li></ul></li></ul><p>After these setup, Windows will now start the virtual machine every time you start your computer.</p><h3 id="Bonus-shutdown-VM-in-one-click"><a href="#Bonus-shutdown-VM-in-one-click" class="headerlink" title="Bonus: shutdown VM in one click"></a>Bonus: shutdown VM in one click</h3><p>The same aforementioned VboxManage.exe can be used to poweroff the virtual machine as well. You can achieve that by creating a batch file with the following content: </p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">&quot;C:\Program Files\Oracle\VirtualBox\VBoxManage.exe&quot; controlvm DEV_MACHINE poweroff</span><br></pre></td></tr></table></figure><p>You can also halt or save the state of the VM rather than poweroff. More information on this can be found in the virtualbox manual.</p><h3 id="Further-readings"><a href="#Further-readings" class="headerlink" title="Further readings"></a>Further readings</h3><p><a href="https://www.virtualbox.org/manual/ch08.html">VirualBox manual on VboxManage</a><br><a href="https://www.freedesktop.org/software/systemd/man/systemd.special.html">Systemd manual on special units</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;I&amp;#39;ve always considered myself to be an advanced computer user, but I&amp;#39;m not a Windows person, at least not when I&amp;#39;m coding. So when I got a Windows 10 laptop as a daily work machine, I&amp;#39;m beyond disappointed. Luckily, there&amp;#39;s always a way around -- VirtualBox it is. The laptop I got was powerful enough that I was able to allocate 16GB of memory as well as 3 cores of the host machine to the virtual machine.&lt;/p&gt;
&lt;p&gt;Once I had my vm setup, I always use Windows Terminal and SSH into the machine for development. One day, it occurs to me I can (and should) automate all of this. &lt;/p&gt;
&lt;h3 id=&quot;Problem&quot;&gt;&lt;a href=&quot;#Problem&quot; class=&quot;headerlink&quot; title=&quot;Problem&quot;&gt;&lt;/a&gt;Problem&lt;/h3&gt;&lt;p&gt;Automatically start the selected VirtualBox virtual machine in &lt;strong&gt;headless&lt;/strong&gt; mode (this can save a bit of resources), wait for the machine to boot, and then SSH into the VM using Windows Terminal with selected port forwarding on the host and virtual machine.&lt;/p&gt;</summary>
    
    
    
    
    <category term="Automation" scheme="https://jiangsc.me/tags/Automation/"/>
    
    <category term="virtualbox" scheme="https://jiangsc.me/tags/virtualbox/"/>
    
    <category term="Windows" scheme="https://jiangsc.me/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>IELTS exam and experience</title>
    <link href="https://jiangsc.me/2021/06/30/IELTS-exam-and-experience/"/>
    <id>https://jiangsc.me/2021/06/30/IELTS-exam-and-experience/</id>
    <published>2021-06-30T09:13:50.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>Though this is technically a tech blog where I usually put my thoughts and learnings regarding technologies, I still would like to share some of my experience with taking the IELTS exam which is about a month ago. </p><p><strong>Please note that the author is in no way affiliate with the websites and&#x2F;or services mentioned below, use of these software and&#x2F;or services is at the sole discretion of the reader</strong></p><h3 id="Why-I-choose-to-take-IELTS"><a href="#Why-I-choose-to-take-IELTS" class="headerlink" title="Why I choose to take IELTS"></a>Why I choose to take IELTS</h3><p>To be honest, my current status does not require me to take the IELTS exam. Though after some consideration, I have decided to take the exam and see if I can benefit from extra immigration points by taking the IELTS exam. My goal is reaching 8 in listening and 7 in all other sections. I made the decision to take the exam on the night of May 22nd, 2021. I took the exam on June 13th, 2021. The preparation time is around 21 days.</p><span id="more"></span><h3 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h3><p>I have a day job, so my preparation time on working days was quite limited. I usually get home at around 6pm. My dinner and routine exercise finishes at 8pm. So my preparation for IELTS starts at 8:15pm to 8:30pm. </p><p>The list of tools and&#x2F;or books I used are listed below: </p><ul><li><p>Road to IELTS<br>  This is an comprehensive tool that can be used to prepare for both the academic and the general training version of the exam. It was offered for free at my local public library. I&#39;m very greatful to my local library for offering such an invaluable service, it helped me quite a lot.<br>  As for using this tool, different people may have different ideas. I used this mainly as a training tool to familiarize myself with the listening and reading part on computer-based IELTS exam. In this system, there are 10 mock exams for each part of the IELTS exam which is what I used most for listening and reading. I alternate between Reading and Listening on each working day, spending around 1 to 1.5 hours on this.<br>  There are mini practice sections for each parts as well, this was mainly to educate test takers on different kind of formats for the listening and speaking test. As this is not my first time taking the IELTS exam, I skip most of them. But I can see how they are helpful for those who are taking IELTS for the first time.<br>  The difficulty level on the mock exams are actually a bit higher than the actual exam, it could be because the mocked test delivery system is not smart enough and misses out correct answer sometimes. As a reference, I usually get around 33 correct in the Listening section, which translates to about 6.5. I got 9 in the actual IELTS exam for the listening. For the reading part, I usually get around 32 correct which is also 6.5, while in my actual IELTS test, I got 8.5.<br>  For writing and speaking, it is also practical to use the mocked exams, the only caveate is that no one will grade thsoe. I would suggest at least read through the sample exam essays provided, and try to follow the structure and learn some good words from the essay. For speaking, I don&#39;t feel like you can improve your speaking skills in a short time, but the mock exams offered is still helpful.</p></li><li><p>Writing 9<br>  This is a paid service that&#39;s offered at 12 USD per month. I found it quite helpful, cause you can actually mock a writing exam with it. I did around 3 to 4 essays on it and get around 6.5 each. The thing I like about this tool is that it can spot your spelling mistakes among other things.</p></li><li><p>Simon&#39;s writing course<br>  This is one of the courses that I definitely recommend watching. This course had helped me a lot in achieving the score of 7 on writing. To summarize on what I had learnt from this course: IELTS writing is not only about good use of words, but also about organizing the structure of the essay logically. I do think the latter what I used to ignore. In my first IELTS exam taken at 2011 (at that time, I took the Acacdemic version) I only got 5.5 in IELTS writing, and 10 years later, I got 7 for the general training version.</p></li><li><p>IELTS Band 9 Vocab Secrets by Caambridge Consultants<br>  This book contains loads of good examples about usage of good words in either reading and writing. I highly recommend reading through the whole book at least once and practice using the word examples given in the book.</p></li></ul><h3 id="Exam-tips"><a href="#Exam-tips" class="headerlink" title="Exam tips"></a>Exam tips</h3><p>For me, this is my first time taking the computer-based IELTS exam. I would like to share some tips that I think other candidates may find useful: </p><ul><li>Listening<ul><li>From my experience on taking both the mocked and the actual exam, Computer-based listening test is a bit more difficult than paper-based ones. There are several reasons for this: <ul><li>In computer based exam, you will not be given time to transfer your answers from the exam paper to the answer sheet. Instead, you will only be given 2 minutes to check for all the answers at the end of the listening test. This means that you may not have enough time to check for some easily identifiable mistakes like typos, singular&#x2F;plural forms or tense problems. So when you practice, keep this in mind, and try to avoid them as much as possible.</li><li>You will have to type and listen and the same time in computer based exam. I guess this is quite obvious, it might not be a big problem but keep in mind that in the IELTS exam, you are under considerable stress, for non-native speakers, it may be a bit difficult.</li></ul></li><li>Highlighting is important in listening test. For me, this is how I achieved Band 9 in listening -- I highlight things I think are important. In computer based exams, highlighting will help you focus on the keywords and in my experience, I feel more confident when I highlight things.</li></ul></li><li>Reading: <ul><li>Highlighting, again. Highlighting is also important in reading. I&#39;m glad that the testing system provides a way to highlight in reading, it is really helpful and mimics the paper exam well.</li><li>Try to use the color settings to avoid eye strain. The computer delivered IELTS exam have settings to change the background color of the exam. To me, this is really helpful. I changed the background color from white to a bit more yellowish. This causes less eye strain and helped me focus on the exam better.</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;Though this is technically a tech blog where I usually put my thoughts and learnings regarding technologies, I still would like to share some of my experience with taking the IELTS exam which is about a month ago. &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Please note that the author is in no way affiliate with the websites and&amp;#x2F;or services mentioned below, use of these software and&amp;#x2F;or services is at the sole discretion of the reader&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Why-I-choose-to-take-IELTS&quot;&gt;&lt;a href=&quot;#Why-I-choose-to-take-IELTS&quot; class=&quot;headerlink&quot; title=&quot;Why I choose to take IELTS&quot;&gt;&lt;/a&gt;Why I choose to take IELTS&lt;/h3&gt;&lt;p&gt;To be honest, my current status does not require me to take the IELTS exam. Though after some consideration, I have decided to take the exam and see if I can benefit from extra immigration points by taking the IELTS exam. My goal is reaching 8 in listening and 7 in all other sections. I made the decision to take the exam on the night of May 22nd, 2021. I took the exam on June 13th, 2021. The preparation time is around 21 days.&lt;/p&gt;</summary>
    
    
    
    
    <category term="IELTS" scheme="https://jiangsc.me/tags/IELTS/"/>
    
    <category term="Preparation" scheme="https://jiangsc.me/tags/Preparation/"/>
    
  </entry>
  
  <entry>
    <title>Postgres, JavaScript and sorting</title>
    <link href="https://jiangsc.me/2021/05/09/Postgres-JavaScript-and-sorting/"/>
    <id>https://jiangsc.me/2021/05/09/Postgres-JavaScript-and-sorting/</id>
    <published>2021-05-09T01:00:12.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>This week, while setting up local project for work, I encountered some weired issue during the unit test and this has something to do with postgres and its default settings under Windows and other OS.</p><h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><p>As an example, consider the following array: <code>[ &#39;D&#39;, &#39;d&#39;, &#39;a&#39;, &#39;A&#39;, &#39;c&#39;, &#39;b&#39;, &#39;CD&#39;, &#39;Capacitor&#39; ]</code></p><p>Sorting this in JavaScript results in case sensitive result, where upper case always come first: </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; [ <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;CD&#x27;</span>, <span class="string">&#x27;Capacitor&#x27;</span> ].<span class="title function_">sort</span>()</span><br><span class="line">[ <span class="string">&quot;A&quot;</span>, <span class="string">&quot;CD&quot;</span>, <span class="string">&quot;Capacitor&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span> ]</span><br></pre></td></tr></table></figure><p>Sorting this in Postgres SQL with default installation will yield a case insensitive sorting where upper and lower case are mixed:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> regexp_split_to_table(<span class="string">&#x27;D d a A c b CD Capacitor&#x27;</span>, <span class="string">&#x27; &#x27;</span>) <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"> regexp_split_to_table </span><br><span class="line"><span class="comment">-----------------------</span></span><br><span class="line"> a</span><br><span class="line"> A</span><br><span class="line"> b</span><br><span class="line"> c</span><br><span class="line"> Capacitor</span><br><span class="line"> CD</span><br><span class="line"> d</span><br><span class="line"> D</span><br></pre></td></tr></table></figure><p>The goal here is to make sorting consistent, so we can either fix the Postgres side or fix the JavaScript side.</p><span id="more"></span><h3 id="Investigation"><a href="#Investigation" class="headerlink" title="Investigation"></a>Investigation</h3><p>Looking carefully at each of these results, it is not difficult to realize that the sorting in JavaScript is based on ASCII, i.e. character <code>A</code> has an ASCII code of 32 where as <code>a</code> has ASCII code of 97, so <code>A</code> comes first. This <strong>IS NOT</strong> the proper way to do string sorting in JavaScript.</p><p>For the result that Postgres gave, it is a bit more complex. Postgres uses <code>LC_COLLATE</code> to determine the sort order of the array.This variable comes from the system and different OS have different implementation, when using locale <code>C</code> or <code>POSIX</code>, strings are sorted according to their ASCII value, any other locales will result in a case insensitive result.</p><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>Here comes the solution part, as mentioned earlier, we can either fix the JavaScript or fix the Postgres, so I&#39;ll present the solutions separately.</p><p>There are several ways to make the sorting case insensitive in JavaScript: </p><ul><li><p><code>[ &#39;D&#39;, &#39;d&#39;, &#39;a&#39;, &#39;A&#39;, &#39;c&#39;, &#39;b&#39;, &#39;CD&#39;, &#39;Capacitor&#39; ].sort((a,b) =&gt; a.localeCompare(b))</code><br>This uses localeCompare from string prototype which have some performance implication on larger array.</p></li><li><p><code>[ &#39;D&#39;, &#39;d&#39;, &#39;a&#39;, &#39;A&#39;, &#39;c&#39;, &#39;b&#39;, &#39;CD&#39;, &#39;Capacitor&#39; ].sort(new Intl.Collator(&#39;en_us&#39;).compare)</code><br>This is the recommended by MDN to sort larger arrays.</p></li></ul><p>For Postgres, the first thing that needs to be noted is that Postgres recommends against using locales if it can be avoided, from their documentation: </p><blockquote><p>The drawback of using locales other than C or POSIX in PostgreSQL is its performance impact. It slows character handling and prevents ordinary indexes from being used by LIKE. For this reason use locales only if you actually need them. </p></blockquote><p>The one-off way to fix the sorting is by specifiying the <code>LC_COLLATE</code> value when creating the database, for example: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE db </span><br><span class="line">    <span class="keyword">WITH</span> TEMPLATE <span class="operator">=</span> template0 </span><br><span class="line">    ENCODING <span class="operator">=</span> <span class="string">&#x27;UTF8&#x27;</span> </span><br><span class="line">    LC_COLLATE <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span> </span><br><span class="line">    LC_CTYPE <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span>;</span><br></pre></td></tr></table></figure><p>The created database (db in this case) will use <code>C</code> as <code>LC_COLLATE</code> overriding the default <code>LC_COLLATE</code> value from the OS. With the new database created, you easily verify it will sort in a case sensitive way by the ASCII value once you connect to the database and run the query presented previously.</p><p>This one-off way is good enough only if you care about creating such database once. Imaging next time you create a new database, you will still have to manually override the <code>LC_COLLATE</code> value. So the way to go is to modify the template database, because <code>LC_COLLATE</code> can&#39;t be changed once the database has been created, we will have to create a new database and set it as template. </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">--- Unset template1 as template before dropping</span></span><br><span class="line"><span class="keyword">UPDATE</span> pg_database </span><br><span class="line">    <span class="keyword">SET</span> datistemplate<span class="operator">=</span><span class="string">&#x27;false&#x27;</span> </span><br><span class="line">    <span class="keyword">WHERE</span> datname<span class="operator">=</span><span class="string">&#x27;template1&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--- Create a new database that uses C as locale</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE template1 </span><br><span class="line">    IS_TEMPLATE <span class="literal">true</span> </span><br><span class="line">    ENCODING <span class="operator">=</span> <span class="string">&#x27;UTF8&#x27;</span> </span><br><span class="line">    LC_COLLATE <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span> </span><br><span class="line">    LC_CTYPE <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span> </span><br><span class="line">    CONNECTION LIMIT <span class="operator">=</span> <span class="number">-1</span> </span><br><span class="line">    TEMPLATE template0;</span><br><span class="line"></span><br><span class="line"><span class="comment">--- Create a new databse now should have C as locale.</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE db3;</span><br><span class="line"></span><br><span class="line"><span class="comment">--- Should return C </span></span><br><span class="line"><span class="keyword">SHOW</span> lc_collate;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Another way to do this, is to initialize the database cluster with C locale as below: </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -R postgres:postgres /var/lib/postgres/</span><br><span class="line">su - postgres -c &quot;initdb --locale C -D &#x27;/var/lib/postgres/data&#x27;&quot;</span><br></pre></td></tr></table></figure><p>this will create template database with C locale.</p><h3 id="Takeaways"><a href="#Takeaways" class="headerlink" title="Takeaways"></a>Takeaways</h3><p>String sorting with the default method in JavaScript and most other languages is merely a comparsion based on the ASCII code, this results in upper case letters always comes first.</p><p>String sorting in PostgreSQL depends on the <code>LC_COLLATE</code> setting of the table which depends on the setting of the operating system, default sorting will yield results that mixes upper case and lower case, in other words, sorting is <strong>not</strong> case sensitive. There are many ways to get case sensitive sorting, but the most reliable way should be specifiying the <code>LC_COLLATE</code> when creating the database.</p><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><ul><li><a href="https://www.postgresql.org/docs/13/locale.html">https://www.postgresql.org/docs/13/locale.html</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare</a></li><li><a href="https://dba.stackexchange.com/questions/106964/why-is-my-postgresql-order-by-case-insensitive">Stackexchange question</a></li><li><a href="https://wiki.postgresql.org/wiki/FAQ#Why_do_my_strings_sort_incorrectly.3F">Postgres FAQ</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;This week, while setting up local project for work, I encountered some weired issue during the unit test and this has something to do with postgres and its default settings under Windows and other OS.&lt;/p&gt;
&lt;h3 id=&quot;Problem&quot;&gt;&lt;a href=&quot;#Problem&quot; class=&quot;headerlink&quot; title=&quot;Problem&quot;&gt;&lt;/a&gt;Problem&lt;/h3&gt;&lt;p&gt;As an example, consider the following array: &lt;code&gt;[ &amp;#39;D&amp;#39;, &amp;#39;d&amp;#39;, &amp;#39;a&amp;#39;, &amp;#39;A&amp;#39;, &amp;#39;c&amp;#39;, &amp;#39;b&amp;#39;, &amp;#39;CD&amp;#39;, &amp;#39;Capacitor&amp;#39; ]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Sorting this in JavaScript results in case sensitive result, where upper case always come first: &lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt; [ &lt;span class=&quot;string&quot;&gt;&amp;#x27;D&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;d&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;A&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;c&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;b&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;CD&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;Capacitor&amp;#x27;&lt;/span&gt; ].&lt;span class=&quot;title function_&quot;&gt;sort&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[ &lt;span class=&quot;string&quot;&gt;&amp;quot;A&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;CD&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;Capacitor&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;D&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;a&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;b&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;c&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;d&amp;quot;&lt;/span&gt; ]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Sorting this in Postgres SQL with default installation will yield a case insensitive sorting where upper and lower case are mixed:&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; regexp_split_to_table(&lt;span class=&quot;string&quot;&gt;&amp;#x27;D d a A c b CD Capacitor&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27; &amp;#x27;&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; regexp_split_to_table &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;-----------------------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; A&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; c&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Capacitor&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; CD&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; d&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; D&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;The goal here is to make sorting consistent, so we can either fix the Postgres side or fix the JavaScript side.&lt;/p&gt;</summary>
    
    
    
    
    <category term="JavaScript" scheme="https://jiangsc.me/tags/JavaScript/"/>
    
    <category term="Postgres" scheme="https://jiangsc.me/tags/Postgres/"/>
    
    <category term="Sorting" scheme="https://jiangsc.me/tags/Sorting/"/>
    
  </entry>
  
  <entry>
    <title>Android ADB and user management</title>
    <link href="https://jiangsc.me/2021/04/17/Android-ADB-and-user-management/"/>
    <id>https://jiangsc.me/2021/04/17/Android-ADB-and-user-management/</id>
    <published>2021-04-17T04:24:17.000Z</published>
    <updated>2022-08-28T04:14:29.062Z</updated>
    
    <content type="html"><![CDATA[<p>⚠ This article requires Rooted Android phones, please follow the instructions with caution.</p><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>Since Android 5, the Android system have added the capability of multi-user, the aim is most likely to make sharing devices easier between different users in the family. Later on, Google added again something called profile, this allows enterprise to manage devices their employers use. In this article, I am going to explore some other possibilities enabled by multiuser&#x2F;profile functionality. More specifically I&#39;m going to focus on the restricted user profile. </p><h3 id="Problem-to-Solve"><a href="#Problem-to-Solve" class="headerlink" title="Problem to Solve"></a>Problem to Solve</h3><p>There are several problems I&#39;m aiming to solve with the restricted profile: </p><ul><li>I want to focus on things that actually matter rather than spending too much time on my phone, I would like my phone to be without any apps that can disturb or distract me when I want to focus. But I don&#39;t want to uninstall certain apps, as they are necessary in order to keep in touch with my family and friends.</li><li>I want to install certain apps that can track me into a separate space, a space where it is impossible for them to track me using the microphone, camera, or location.<span id="more"></span><h3 id="Solutions"><a href="#Solutions" class="headerlink" title="Solutions"></a>Solutions</h3>Well, as an Android user that also owns an iOS device, I have to say Apple have done a good job in many of the things I mentioned above. For example, my first problem can be solved in the iOS setting natively. Android does have something similar called digital wellbeing, but since it is from Google, I&#39;m not that comfortable installing it on to my phone.</li></ul><p>Anyway, I feel like the restricted profile is still a good solution to my problem on Android.</p><h3 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h3><p>So in Android shell, there&#39;s something called pm. This command can be used to create a new user.<br>Here is part of the help doc that I&#39;m interested in:</p><p><code>create-user [--profileOf USER_ID] [--managed] [--restricted] [--ephemeral] [--guest] USER_NAME         Create a new user with the given USER_NAME, printing the new user identifier of the user.</code></p><p>That is, command <code>pm create-user</code> can be used to create user on your Android phone. Assuming you have access to Android adb, issuing<br><code>adb shell pm create-user --restricted test</code> will create a user named test with restricted profile, the command will show the userid of the newly created user, will be referenced as <code>$userId</code> in the following.</p><p>Once the user has been created, you can manage the list of the users it will have access to in the settings, this is in Settings&#x2F;Multi-user. </p><p>To me, I want impose more restrictions on the user, there is indeed a way to do so:</p><p><code>adb shell su -c &#39;pm set-user-restriction --user USER_ID no_install_apps 1&#39;</code> -- this will disallow install apps for the newly created profile, in this case <strong>no_install_apps</strong> is the name of the restriction, while the ** 1** immidiately follow is a boolean representing whether the restriction is enabled. (This command assumes you use Magsik as su)</p><p>You can find a list of restrictions available from Google&#39;s official <a href="https://developer.android.com/reference/android/os/UserManager#constants_1">document</a>. Take note of the <code>Constant Value</code> in the document, that&#39;s the restriction value you need to use.</p><p>If you want to see what restriction you&#39;ve added, you can issue <code>adb shell dumpsys user</code>, this command will dump all the users on the current device and the restrictions if any.</p><p>To switch to a different user, you can use <code>am switch-user USER_ID</code> or do so from the UI.</p><p>The easiest way to delete an user is through the settings menu. Though you can also do so through the command: <code>pm remove-user USER_ID</code></p><h3 id="Caveat"><a href="#Caveat" class="headerlink" title="Caveat"></a>Caveat</h3><p>There are several issues that need to be taken into consideration when using a restricted profile: </p><ol><li>You will not have access to any of the files in the primary account, this is a big issue if you have social media apps installed on this account and want to upload image from the primary account.</li><li>You will not have Google account access or root access. Most people will be okay with this, but it is a bit troublesome at times.</li><li>Remember to switch the profile back, when you no longer need to be in the restricted one. For example, if you leave your restricted profile on overnight, you will not have an alarm clock if you don&#39;t set it up correctly.</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;⚠ This article requires Rooted Android phones, please follow the instructions with caution.&lt;/p&gt;
&lt;h3 id=&quot;Background&quot;&gt;&lt;a href=&quot;#Background&quot; class=&quot;headerlink&quot; title=&quot;Background&quot;&gt;&lt;/a&gt;Background&lt;/h3&gt;&lt;p&gt;Since Android 5, the Android system have added the capability of multi-user, the aim is most likely to make sharing devices easier between different users in the family. Later on, Google added again something called profile, this allows enterprise to manage devices their employers use. In this article, I am going to explore some other possibilities enabled by multiuser&amp;#x2F;profile functionality. More specifically I&amp;#39;m going to focus on the restricted user profile. &lt;/p&gt;
&lt;h3 id=&quot;Problem-to-Solve&quot;&gt;&lt;a href=&quot;#Problem-to-Solve&quot; class=&quot;headerlink&quot; title=&quot;Problem to Solve&quot;&gt;&lt;/a&gt;Problem to Solve&lt;/h3&gt;&lt;p&gt;There are several problems I&amp;#39;m aiming to solve with the restricted profile: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I want to focus on things that actually matter rather than spending too much time on my phone, I would like my phone to be without any apps that can disturb or distract me when I want to focus. But I don&amp;#39;t want to uninstall certain apps, as they are necessary in order to keep in touch with my family and friends.&lt;/li&gt;
&lt;li&gt;I want to install certain apps that can track me into a separate space, a space where it is impossible for them to track me using the microphone, camera, or location.</summary>
    
    
    
    
    <category term="Android" scheme="https://jiangsc.me/tags/Android/"/>
    
    <category term="ADB" scheme="https://jiangsc.me/tags/ADB/"/>
    
  </entry>
  
  <entry>
    <title>Terraform, Version Constraint and Debugging</title>
    <link href="https://jiangsc.me/2021/02/27/Terraform-version-constraint-and-debugging/"/>
    <id>https://jiangsc.me/2021/02/27/Terraform-version-constraint-and-debugging/</id>
    <published>2021-02-27T21:08:59.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>This week I encountered some issues with Terraform (and, well, Kubernetes) again. This time, the problem was way more interesting than I thought.</p><span id="more"></span><h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><p>When deploying to Kubernetes, I got <code>dial tcp 127.0.0.1:80: connect: connection refused, connection reset error.</code></p><p>The more specific error message I got is </p><blockquote><p>Error: Get &quot;<a href="http://localhost/apis/apps/v1/namespaces/default/deployments/xxx&quot;">http://localhost/apis/apps/v1/namespaces/default/deployments/xxx&quot;</a>: dial tcp 127.0.0.1:80: connect: connection refused</p></blockquote><p>As this error happened in our deployment pipeline (we use Terraform to deploy stuff to Kubernetes), my natural thought was that this can be solved easily with a retry. So I retried the deployment right away, and it still failed. </p><p>When I finally stopped what I was working on and start to examine the message carefully, I realized it is quite strange: how come the pipeline (or the Kubectl for that matter) trying to connect to localhost when it is meant to connect to a Kubernetes cluster located somewhere else? </p><p>As you will see from my solution, this message was <strong>not</strong> helpful at all and in some sense quite misleading to someone who is trying to debug.</p><p>After comparing the log from a previous successful deployment and the said failed deployment. I realized the issue was with the Kubernetes provider for Terraform: while in the successful build, the <code>terraform init</code> command yield something like <code>Installing hashicorp/kubernetes v1.13.3...</code>, in the failed build the same command yield something like <code>Installing hashicorp/kubernetes v2.0.2...</code>. </p><p>It is quite obvious that this issue was caused by breaking changes in the Terraform provider. According to their <a href="https://github.com/hashicorp/terraform-provider-kubernetes/blob/master/CHANGELOG.md#200-january-21-2021">changelog</a>, there were several breaking changes in the 2.0.0 version, among them were these two:</p><blockquote><p>Remove load_config_file attribute from provider block (#1052)<br>Remove default of ~&#x2F;.kube&#x2F;config for config_path (#1052)</p></blockquote><p>In our deployment Terraform, we set <code>load_config_file</code> to <code>true</code> to load the <code>kube_config</code> file from the default config_path of <code>~/.kube/config</code>. Due to the breaking changes quoted above, neither the <code>load_config_file</code> nor the default config_path existed any more, and when Kubernetes can not find these two files, it will try to connect to the 127.0.0.1 (aka localhost) as a fallback which caused the connection refused error.</p><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>There are two kind of solutions to this issue: </p><ul><li>Updating the Terraform code so it is compatible with the 2.0.0 version of the Kubernetes provider<br>  OR</li><li>Downgrade to the last working version of the Kubernetes provider and keep the existing Terraform code</li></ul><p>Due to the urgency of getting the pipeline and deployment back online, I chose the downgrading route. Essentially, I&#39;m adding the version constraint to the Kubernetes provider that was previously missing:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubernetes = &#123;</span><br><span class="line">  source  = &quot;registry.terraform.io/hashicorp/kubernetes&quot;</span><br><span class="line">  version = &quot;~&gt; 1.0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Adding in the version constraint means that Terraform will only increase the <em><strong>rightmost</strong></em> version number, therefore it will not be able to upgrade to version 2.0.0 automatically and can avoid this specific problem that was caused by breaking changes.</p><h3 id="Takeaways"><a href="#Takeaways" class="headerlink" title="Takeaways"></a>Takeaways</h3><p>On debugging:</p><ul><li>Generally speaking, if you found your Terraform changed behavior without you making any changes, you could be making the same mistake as I did: not specifying the version constraint for the provider. You can find some clues in your <code>terraform init</code> command, for example, by comparing if the same provider version was used on the two builds where one was successful, the other failed.</li><li>Personally, I was never familiar enough with Kubernetes to know that the default behavior of Kubectl is to use 127.0.0.1 when there&#39;s no config file present. Now that I came across this gotcha, I do realize this kind of behavior was not that uncommon per se: Knex which is the library we used for node.js also have similar behavior, and I will keep this in mind if I encounter something similar in the future.</li></ul><p>On Terraform:</p><ul><li>When there&#39;s no version constraint specified, Terraform will always use the latest provider version. Therefore, it is important to specify the version constraint. It is recommended by Terraform to always use a specific version when using third party modules. For more information on specifying the version constraint, read the <a href="https://www.terraform.io/docs/language/expressions/version-constraints.html">documentation</a> from their website.</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;This week I encountered some issues with Terraform (and, well, Kubernetes) again. This time, the problem was way more interesting than I thought.&lt;/p&gt;</summary>
    
    
    
    
    <category term="Terraform" scheme="https://jiangsc.me/tags/Terraform/"/>
    
    <category term="Kubernetes" scheme="https://jiangsc.me/tags/Kubernetes/"/>
    
    <category term="Version constraint" scheme="https://jiangsc.me/tags/Version-constraint/"/>
    
    <category term="debug" scheme="https://jiangsc.me/tags/debug/"/>
    
  </entry>
  
  <entry>
    <title>Lessons Learnt On Deploying GO Lambda Application on AWS - Part I</title>
    <link href="https://jiangsc.me/2021/01/24/Lessons-Learnt-On-Deploying-GO-Lambda-Application-on-AWS/"/>
    <id>https://jiangsc.me/2021/01/24/Lessons-Learnt-On-Deploying-GO-Lambda-Application-on-AWS/</id>
    <published>2021-01-24T06:06:00.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>Recently, I started to build an application with Go, it is a quite simple application that does something very basic and then sends an notification to a telegram bot. It&#39;s quite obvious to me this kind of application is quite suitable to run as Lambda, and that&#39;s where I decided to deploy my application to once it is working well locally. It turned out that I had to solve several issues I encountered. Here I share how I solved those issues, so you don&#39;t have to scratch your head when encounter them.</p><span id="more"></span><h3 id="Attempt-1-Deploy-the-application-through-the-web-interface"><a href="#Attempt-1-Deploy-the-application-through-the-web-interface" class="headerlink" title="Attempt 1: Deploy the application through the web interface."></a>Attempt 1: Deploy the application through the web interface.</h3><p>For my first attempt on deploying the application, my goal is to make things as simple as possible.<br>Therefore, I chose to use the web interface. From the web interface, there&#39;s an option to upload zip file and that&#39;s where I began.</p><h5 id="Problem-Compile-GO-in-an-static-way"><a href="#Problem-Compile-GO-in-an-static-way" class="headerlink" title="Problem: Compile GO in an static way"></a>Problem: Compile GO in an static way</h5><p>This problem happens quite often from what I see on the internet. The main issue with here is that, some of the libraries in GO uses a feature called <a href="https://golang.org/cmd/cgo/">CGO</a> which means using C code in GO, and when this feature is in use, GO compiler will try to create dynamic binary.</p><p>To solve this problem, it is often as simple as compiled the code to a statically linked binary. Do note that, some of the code that&#39;s compiling use GCC was not working, this is because often times the GLIBC library is higher than the ones used in AWS lambda environment, at least that was the case for me (I am on an Linux laptop with Manjaro Linux).</p><p>I was able to find something called <a href="https://www.musl-libc.org/intro.html">musl-gcc</a> and then used it in my compilation </p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">build:</span></span><br><span class="line">CC=<span class="string">&quot;musl-gcc&quot;</span> go build --ldflags &#x27;-linkmode external -extldflags <span class="string">&quot;-static&quot;</span>&#x27; ./main.go</span><br></pre></td></tr></table></figure><p>This proves to be working fine, once I complied the binary, zip and upload it to lambda through the interface, everything seems to be working.</p><h3 id="Attempt-2-Deploy-the-application-through-AWS-SAM"><a href="#Attempt-2-Deploy-the-application-through-AWS-SAM" class="headerlink" title="Attempt 2: Deploy the application through AWS SAM"></a>Attempt 2: Deploy the application through AWS SAM</h3><p>Often, it is not efficient to manually upload the code using a zip file through every time, that&#39;s why I started to thinking about introducing <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html">SAM</a> as a tool to simplified the process of deployment. This was when I encountered the second issue.</p><h4 id="Problem-Asking-SAM-to-compile-the-GO-program-in-an-static-way"><a href="#Problem-Asking-SAM-to-compile-the-GO-program-in-an-static-way" class="headerlink" title="Problem: Asking SAM to compile the GO program in an static way."></a>Problem: Asking SAM to compile the GO program in an static way.</h4><p>As the line above says, SAM always compiled the code in a dynamic way which is why the binary fails to work again even locally using the command <code>sam invoke local</code>.</p><p>Now it&#39;s the time to tell SAM I don&#39;t want dynamically linked binaries. As a matter of fact, none of the article available online has a direct answer to my question, fortunately, I did find an AWS documentation on <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/building-custom-runtimes.html">using custom runtime</a>. Based on this article, a GO program that wants to utilize static linking can have the following template:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Resources:</span></span><br><span class="line">  <span class="attr">HelloGOFunction:</span></span><br><span class="line">    <span class="attr">Type:</span> <span class="string">AWS::Serverless::Function</span></span><br><span class="line">    <span class="attr">Properties:</span></span><br><span class="line">      <span class="attr">FunctionName:</span> <span class="string">HelloGO</span></span><br><span class="line">      <span class="attr">Handler:</span> <span class="string">main</span></span><br><span class="line">      <span class="attr">Runtime:</span> <span class="string">go1.x</span></span><br><span class="line">      <span class="attr">MemorySize:</span> <span class="number">512</span></span><br><span class="line">      <span class="attr">CodeUri:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">Metadata:</span></span><br><span class="line">      <span class="attr">BuildMethod:</span> <span class="string">makefile</span></span><br></pre></td></tr></table></figure><p>And in the MakeFile, the following corresponding entries need to be added:</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">build-HelloGOFunction:</span></span><br><span class="line">  CC=<span class="string">&quot;musl-gcc&quot;</span> go build --ldflags &#x27;-linkmode external -extldflags <span class="string">&quot;-static&quot;</span>&#x27; ./main.go</span><br><span class="line">  cp ./main <span class="variable">$(ARTIFACTS_DIR)</span></span><br></pre></td></tr></table></figure><p>Doing so will make sure compiled binary are statically linked and works on lambda when bundle and uploaded.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Recently, I started to build an application with Go, it is a quite simple application that does something very basic and then sends an notification to a telegram bot. It&amp;#39;s quite obvious to me this kind of application is quite suitable to run as Lambda, and that&amp;#39;s where I decided to deploy my application to once it is working well locally. It turned out that I had to solve several issues I encountered. Here I share how I solved those issues, so you don&amp;#39;t have to scratch your head when encounter them.&lt;/p&gt;</summary>
    
    
    
    
    <category term="Lambda" scheme="https://jiangsc.me/tags/Lambda/"/>
    
    <category term="AWS" scheme="https://jiangsc.me/tags/AWS/"/>
    
    <category term="Go" scheme="https://jiangsc.me/tags/Go/"/>
    
    <category term="Deployment" scheme="https://jiangsc.me/tags/Deployment/"/>
    
  </entry>
  
  <entry>
    <title>Upgrade openwrt on Linksys WRT1200AC with extroot</title>
    <link href="https://jiangsc.me/2021/01/24/Upgrade-openwrt-on-Linksys-WRT1200AC-with-extroot/"/>
    <id>https://jiangsc.me/2021/01/24/Upgrade-openwrt-on-Linksys-WRT1200AC-with-extroot/</id>
    <published>2021-01-24T01:29:55.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<div class="note "><h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes:"></a>Notes:</h3><ul><li>WRT1200AC (this router) contains 2 partitions</li><li>Flashing the firmware through the Luci interface actually flashes the new firmware to the inactive partition</li></ul></div><h3 id="Steps"><a href="#Steps" class="headerlink" title="Steps:"></a>Steps:</h3><ul><li>Download the bin file needed to upgrade the package</li><li>Create a list of all the installed packages on current version using <code>opkg list-installed | cut -f 1 -d &#39; &#39; &gt; /root/installed_packages.txt</code></li><li>Choose one of the following methods to flash:<ul><li>Flash the file from the Luci interface<br>  OR</li><li>Download the file to the &#x2F;tmp and then flash using sysupgrade &#x2F;tmp&#x2F;*.bin<span id="more"></span></li></ul></li><li>After the flash and reboot, you will be in the partition that you wasn&#39;t on before the flash, it will have all of your previous configs, but the extroot will not be there.</li><li>Hopefully, you will already have internet access at this point, if not, go ahead and setup internet.</li><li>Once your internet is up, you will need to run some commands to install packages needed to setup:<ul><li>First, install packages that are necessary to setup extroot:<br>  <code>opkg update &amp;&amp; opkg install block-mount kmod-fs-ext4 kmod-usb-storage e2fsprogs kmod-usb-ohci kmod-usb-uhci fdisk</code></li><li>In my case I use f2fs for my extroot, which means I need extra packages, like mkf2fs to format the flash.</li><li>Now, format the device you plan to use for extroot, in my case, I ran <code>mkf2fs /dev/sda1</code> cause the sda2 was used as swap.</li><li>At this point, copy the overlay to the newly formatted drive  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /tmp/introot</span><br><span class="line"><span class="built_in">mkdir</span> -p /tmp/extroot</span><br><span class="line">mount --<span class="built_in">bind</span> / /tmp/introot</span><br><span class="line">mount /dev/sda1 /tmp/extroot</span><br><span class="line">tar -C /tmp/introot -cvf - . | tar -C /tmp/extroot -xf -</span><br><span class="line">umount /tmp/introot</span><br><span class="line">umount /tmp/extroot</span><br></pre></td></tr></table></figure></li><li>Regenerate fstab using <code>block detect &gt; /etc/config/fstab;</code></li><li>Reboot</li><li>You should have a working Openwrt with extroot now. Change opkg&#x2F;distfeeds.conf to the corresponding upgraded version.</li><li>Now run <code>opkg upgrade $(opkg list-upgradable | awk &#39;($1 !~ &quot;^kmod|Multiple&quot;) &#123;print $1&#125;&#39;)</code> to keep base packages up-to-date.</li><li>And install all your backed up packages using <code>cat /root/installed_packages.txt|xargs opkg install</code><br>Because I don&#39;t use dnsmasq, this means once the steps above finishes, I will need to do some extra post installation steps</li></ul></li></ul><h3 id="Post-installation-More-as-a-personal-note"><a href="#Post-installation-More-as-a-personal-note" class="headerlink" title="Post installation (More as a personal note):"></a>Post installation (More as a personal note):</h3><ul><li>Remove odhcpd-ipv6only package and install odhcpd, this will ensure IPv4 dhcp functionality, otherwise, there will only be ipv6 addresses allocated.</li></ul><h3 id="November-2021-Update-Updating-to-Openwrt-21-02"><a href="#November-2021-Update-Updating-to-Openwrt-21-02" class="headerlink" title="November 2021 Update: Updating to Openwrt 21.02"></a>November 2021 Update: Updating to Openwrt 21.02</h3><p>I upgraded Openwrt version 21.02 branch in September of this year. It wasn&#39;t as easy as I had thought, but I had the problem solved after all. In release 21.02, Openwrt introduced what&#39;s called <a href="https://www.kernel.org/doc/html/latest/networking/dsa/dsa.html">DSA</a> or Distributed Switch Architecture for this WRT1200AC device. To be honest, it is counter-intuitive to setup but it seems to be a more standard way when compared to the previous configuration.</p><p>The part that I have problem with is mostly the VLAN tagging. My network ISP requires tagged VLAN to be able to use the network, so for Openwrt, I will have to tag the WAN port with the VLAN id. I was able to get around it with the following block: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">config device</span><br><span class="line">        option name &#x27;wan&#x27;</span><br><span class="line">        option macaddr &#x27;&lt;MAC_ADDRESS&gt;&#x27;</span><br><span class="line">config interface &#x27;wan&#x27;</span><br><span class="line">        option device &#x27;wan.10&#x27;</span><br><span class="line">        option proto &#x27;pppoe&#x27;</span><br><span class="line">        option username &#x27;&lt;PPPOE_USERNAME&gt;&#x27;</span><br><span class="line">        option ipv6 &#x27;1&#x27;</span><br><span class="line">        option peerdns &#x27;0&#x27;</span><br><span class="line">        option password &#x27;&lt;PPPOE_PASSWORD&gt;&#x27;</span><br><span class="line">        list dns &#x27;127.0.0.1&#x27;</span><br><span class="line">config interface &#x27;wan6&#x27;</span><br><span class="line">        option proto &#x27;dhcpv6&#x27;</span><br><span class="line">        option reqaddress &#x27;try&#x27;</span><br><span class="line">        option reqprefix &#x27;auto&#x27;</span><br><span class="line">        option peerdns &#x27;0&#x27;</span><br><span class="line">        list dns &#x27;::1&#x27;</span><br><span class="line">        option device &#x27;@wan</span><br></pre></td></tr></table></figure><p>It actually is quite straightforward once you get the idea of configuration. For example, in the above shared config, a <code>device</code> is a layer 2 in the networking stack while an <code>interface</code> is at layer 3. Here is Openwrt wiki&#39;s explanation: </p><blockquote><p>Devices are physical connections that convey bits&#x2F;frames to other computers. They operate at layer 2 in the protocol stack, have a MAC address along with several other configurable parameters.<br>Network devices identify and configure hardware components of the device: individual Ethernet switch ports, wireless radios, USB networking devices, VLANs, or virtual ethernets.<br>Alternatively, bridge devices group several network devices together so they can be treated as a single entity. A bridge device functions like a separate unmanaged (hardware) switch, forwarding traffic between member ports as needed at the hardware level to maintain performance. Each physical port can be a member of only a single bridge device.<br>Interfaces route IP packets and operate at layer 3 in the protocol stack. An interface is associated with a single device that sends&#x2F;receives its packets. Interfaces get their IP address parameters by the choice of protocol: Static, DHCP, PPP, 6in4, Wireguard, OpenVPN, etc.</p></blockquote><hr><p>References: </p><ul><li><a href="https://openwrt.org/docs/guide-user/network/dsa/dsa-mini-tutorial">https://openwrt.org/docs/guide-user/network/dsa/dsa-mini-tutorial</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;note &quot;&gt;&lt;h3 id=&quot;Notes&quot;&gt;&lt;a href=&quot;#Notes&quot; class=&quot;headerlink&quot; title=&quot;Notes:&quot;&gt;&lt;/a&gt;Notes:&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;WRT1200AC (this router) contains 2 partitions&lt;/li&gt;
&lt;li&gt;Flashing the firmware through the Luci interface actually flashes the new firmware to the inactive partition&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;

&lt;h3 id=&quot;Steps&quot;&gt;&lt;a href=&quot;#Steps&quot; class=&quot;headerlink&quot; title=&quot;Steps:&quot;&gt;&lt;/a&gt;Steps:&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Download the bin file needed to upgrade the package&lt;/li&gt;
&lt;li&gt;Create a list of all the installed packages on current version using &lt;code&gt;opkg list-installed | cut -f 1 -d &amp;#39; &amp;#39; &amp;gt; /root/installed_packages.txt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Choose one of the following methods to flash:&lt;ul&gt;
&lt;li&gt;Flash the file from the Luci interface&lt;br&gt;  OR&lt;/li&gt;
&lt;li&gt;Download the file to the &amp;#x2F;tmp and then flash using sysupgrade &amp;#x2F;tmp&amp;#x2F;*.bin</summary>
    
    
    
    
    <category term="Notes" scheme="https://jiangsc.me/tags/Notes/"/>
    
    <category term="Openwrt" scheme="https://jiangsc.me/tags/Openwrt/"/>
    
    <category term="Upgrade" scheme="https://jiangsc.me/tags/Upgrade/"/>
    
    <category term="Linksys" scheme="https://jiangsc.me/tags/Linksys/"/>
    
    <category term="WRT1200AC" scheme="https://jiangsc.me/tags/WRT1200AC/"/>
    
    <category term="Linux" scheme="https://jiangsc.me/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Automating Zoom with Alfred and Apple Scripts</title>
    <link href="https://jiangsc.me/2020/12/26/Automating-Zoom-with-Alfred-and-Apple-Scripts/"/>
    <id>https://jiangsc.me/2020/12/26/Automating-Zoom-with-Alfred-and-Apple-Scripts/</id>
    <published>2020-12-26T09:55:59.000Z</published>
    <updated>2022-08-28T04:14:29.062Z</updated>
    
    <content type="html"><![CDATA[<p>Like it or not, 2020 has been a year where video conference are used a lot. For me, most of the meetings happens in Zoom. Finding the link to the meeting in the calendar and then clicking on it to join the meeting had gradually become a new norm and something I really don&#39;t like (the fact that after clicking on the Zoom link brings up your browser instead of Zoom itself, and prompting you to click again to open Zoom is really a pain). As someone who would like to automate things as much as possible, I did eventually find a solution that works for me albeit several third party tools are required.</p><h3 id="Problem-Statement-Automatically-join-a-Zoom-call-for-a-meeting-scheduled-in-calendar-without-user-interaction-on-MacOS-X"><a href="#Problem-Statement-Automatically-join-a-Zoom-call-for-a-meeting-scheduled-in-calendar-without-user-interaction-on-MacOS-X" class="headerlink" title="Problem Statement: Automatically join a Zoom call for a meeting scheduled in calendar without user interaction (on MacOS X)."></a>Problem Statement: Automatically join a Zoom call for a meeting scheduled in calendar without user interaction (on MacOS X).</h3><h3 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite:"></a>Prerequisite:</h3><ul><li><a href="https://www.alfredapp.com/">Alfred</a><br>  (Unclear if you need to be a paid user to create custom workflows, the author is a paid user)</li><li><a href="https://github.com/zerowidth/zoom-calendar.alfredworkflow">zoom-calendar.alfredworkflow</a><br>  (Yep, I found this alfred workflow by chance and based my work and this blog on this workflow, it is very handy and I would really like thank the author for creating this.)</li><li>Automator<br>  (The builtin automation app in MacOS from Apple)<span id="more"></span><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution:"></a>Solution:</h3>Assume you have already installed the Alfred App, you will need to go to <a href="https://github.com/zerowidth/zoom-calendar.alfredworkflow">this</a> Github Repo, follow the instructions given and install the Alfred workflow.</li></ul><p>Once the workflow has been installed, we need to do some tweaking. Add an external trigger to this workflow and give it an id of &#39;Automator&#39;</p><p>Now, open up Automator, choose the Calendar Alarm workflow as shown in the screenshot below:<br><img data-src="/2020/12/26/Automating-Zoom-with-Alfred-and-Apple-Scripts/automator-1.png"></p><p>Copy and paste the following code to the calendar alarm:</p><script src="https://gist.github.com/KevinSJ/bd11057c5d6f0fddc7abb38bdf7844b3.js"></script><p>Now comes tricky part. You would first need to export your calendar from the cloud, export from Google Calendar Website or whatever calendar you are using. </p><p>Then open up your Calendar app, and create a new local calendar, give it whatever name you want, in my case, I simply named it Automator. At this point, you can import the ical file exported from above.</p><p>These two steps are necessary if you want to use the automation for most of your events. If there are only a few events that you would like to add the automation on, you can just use the copy function in the Calendar app and paste to the local calendar. In any case, a new local calendar is necessary otherwise the alarm trigger would not work.</p><p>Once you completed setting up your local calendars, you can start adding the file trigger which will help you open up the Zoom. To do this, you need to modify the event of your choice and then change the alert settings, change it to custom and choose &#39;Open file&#39; option, and then change the dropdown from &#39;Calendar&#39; to &#39;Other...&#39;.</p><p><img data-src="/2020/12/26/Automating-Zoom-with-Alfred-and-Apple-Scripts/calendar-1.png"></p><p>Normally, the file you created with the Calendar alarm will be saved to <code>~/Library/Workflows/Applications/Calendar</code> so go ahead to find that folder and choose that file.</p><p><img data-src="/2020/12/26/Automating-Zoom-with-Alfred-and-Apple-Scripts/calendar-2.png"></p><p>At this point, you will have a working version of the calendar automation for this event, if you want it on more events, you will need to repeat the steps of changing alerts for each of the other events.</p><h3 id="Future-improvements-amp-Alternatives"><a href="#Future-improvements-amp-Alternatives" class="headerlink" title="Future improvements &amp; Alternatives"></a>Future improvements &amp; Alternatives</h3><p>I have to admit the solution I described above is not perfect, and it requires some steps to setup, still once I set it up, everything works fine for me, and I would never need to remember to join a Zoom meeting because of this automation.</p><p>Some future improvement and&#x2F;or caveats that I found about this method is that: </p><ul><li>The events must have the zoom link somewhere (either description or location) for this automation to work.</li><li>If there were two back-to-back meetings, the automation will fail, this is because the previous meeting hasn&#39;t finished yet, and the given Alfred workflow will still list it at the top. I haven&#39;t found a good solution to this.</li></ul><p>There are several alternative ways I can think of:</p><ul><li><p>Use Zoom itself, if you are logged into Zoom and allow them to access your calendar, they will provide a join button in their app to allow you to join the meeting without more button clicks.</p></li><li><p>Bookmark the Zoom url schemes and click on it. This is basically how the workflow works behind the scene: converting the url from http to zoom url scheme and then open it. I won&#39;t go in depth on how to create a bookmark and convert the links to url schemes, but Zoom provide a great doc on their schemes <a href="https://marketplace.zoomgov.com/docs/guides/guides/client-url-schemes">here</a>.</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;Like it or not, 2020 has been a year where video conference are used a lot. For me, most of the meetings happens in Zoom. Finding the link to the meeting in the calendar and then clicking on it to join the meeting had gradually become a new norm and something I really don&amp;#39;t like (the fact that after clicking on the Zoom link brings up your browser instead of Zoom itself, and prompting you to click again to open Zoom is really a pain). As someone who would like to automate things as much as possible, I did eventually find a solution that works for me albeit several third party tools are required.&lt;/p&gt;
&lt;h3 id=&quot;Problem-Statement-Automatically-join-a-Zoom-call-for-a-meeting-scheduled-in-calendar-without-user-interaction-on-MacOS-X&quot;&gt;&lt;a href=&quot;#Problem-Statement-Automatically-join-a-Zoom-call-for-a-meeting-scheduled-in-calendar-without-user-interaction-on-MacOS-X&quot; class=&quot;headerlink&quot; title=&quot;Problem Statement: Automatically join a Zoom call for a meeting scheduled in calendar without user interaction (on MacOS X).&quot;&gt;&lt;/a&gt;Problem Statement: Automatically join a Zoom call for a meeting scheduled in calendar without user interaction (on MacOS X).&lt;/h3&gt;&lt;h3 id=&quot;Prerequisite&quot;&gt;&lt;a href=&quot;#Prerequisite&quot; class=&quot;headerlink&quot; title=&quot;Prerequisite:&quot;&gt;&lt;/a&gt;Prerequisite:&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.alfredapp.com/&quot;&gt;Alfred&lt;/a&gt;&lt;br&gt;  (Unclear if you need to be a paid user to create custom workflows, the author is a paid user)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/zerowidth/zoom-calendar.alfredworkflow&quot;&gt;zoom-calendar.alfredworkflow&lt;/a&gt;&lt;br&gt;  (Yep, I found this alfred workflow by chance and based my work and this blog on this workflow, it is very handy and I would really like thank the author for creating this.)&lt;/li&gt;
&lt;li&gt;Automator&lt;br&gt;  (The builtin automation app in MacOS from Apple)</summary>
    
    
    
    
    <category term="Automation" scheme="https://jiangsc.me/tags/Automation/"/>
    
    <category term="Zoom" scheme="https://jiangsc.me/tags/Zoom/"/>
    
    <category term="Alfred" scheme="https://jiangsc.me/tags/Alfred/"/>
    
    <category term="OS X" scheme="https://jiangsc.me/tags/OS-X/"/>
    
  </entry>
  
  <entry>
    <title>Solving practical problems with jq</title>
    <link href="https://jiangsc.me/2020/11/26/Solving-practical-problems-with-Jq-2020-11-26/"/>
    <id>https://jiangsc.me/2020/11/26/Solving-practical-problems-with-Jq-2020-11-26/</id>
    <published>2020-11-26T08:37:32.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>As a developer, you will sometimes face weird problems, it is important to come up with reliable and repeatable ways to solve this problems, so when such problems come up again, you would be able to find a solution easier. As for myself, one of the tools that I found most useful on Unix-like system is jq, which is a tool to process json files. Let me demonstrate how I use this tool to solve some problems I encountered during work.</p><span id="more"></span><h3 id="Problem-Convert-a-JSON-file-to-CSV"><a href="#Problem-Convert-a-JSON-file-to-CSV" class="headerlink" title="Problem: Convert a JSON file to CSV"></a>Problem: Convert a JSON file to CSV</h3><p>Example JSON</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is a song&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;artist&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is an artist&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;album&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is an album&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="number">1989</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is a song&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;artist&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is an artist&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;album&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is an album&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="number">1989</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is a song&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;artist&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is an artist&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;album&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is an album&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="number">1989</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>JQ code to generate csv:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq -r <span class="string">&#x27;(.[0] | keys_unsorted) as $keys | ([$keys] + map([.[ $keys[] ]])) [] | @csv&#x27;</span></span><br></pre></td></tr></table></figure><p>Resulting CSV:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;title&quot;,&quot;artist&quot;,&quot;album&quot;,&quot;year&quot;</span><br><span class="line">&quot;This is a song&quot;,&quot;This is an artist&quot;,&quot;This is an album&quot;,1989</span><br><span class="line">&quot;This is a song&quot;,&quot;This is an artist&quot;,&quot;This is an album&quot;,1989</span><br><span class="line">&quot;This is a song&quot;,&quot;This is an artist&quot;,&quot;This is an album&quot;,1989</span><br></pre></td></tr></table></figure><h3 id="Problem-Aggregate-JSON-object"><a href="#Problem-Aggregate-JSON-object" class="headerlink" title="Problem: Aggregate JSON object."></a>Problem: Aggregate JSON object.</h3><p>Example JSON:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;A&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A1&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A2&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;B&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;B1&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;B2&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;C&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>The goal is to produce something like below:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;A&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;A1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;A2&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="attr">&quot;B&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;B1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;B2&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="attr">&quot;C&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;C&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>It transform the object and aggregate (or compress?) them by “Name” property, I know this can be easily done with JavaScript, but jq and bash seems like more widely used and will come in handy when JavaScript is not available.</p><p>The jq code I came up with is as follows:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq <span class="string">&#x27;[keys_unsorted[] as $k|&#123;($k): [.[$k][]|.Name]&#125;]|add&#x27;</span></span><br></pre></td></tr></table></figure><p>References:</p><ul><li><a href="https://stackoverflow.com/a/32967407">https://stackoverflow.com/a/32967407</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;As a developer, you will sometimes face weird problems, it is important to come up with reliable and repeatable ways to solve this problems, so when such problems come up again, you would be able to find a solution easier. As for myself, one of the tools that I found most useful on Unix-like system is jq, which is a tool to process json files. Let me demonstrate how I use this tool to solve some problems I encountered during work.&lt;/p&gt;</summary>
    
    
    
    
    <category term="jq" scheme="https://jiangsc.me/tags/jq/"/>
    
    <category term="problem solving" scheme="https://jiangsc.me/tags/problem-solving/"/>
    
    <category term="json" scheme="https://jiangsc.me/tags/json/"/>
    
  </entry>
  
  <entry>
    <title>Practice With Vim (I)</title>
    <link href="https://jiangsc.me/2020/11/15/practice-with-vim-I/"/>
    <id>https://jiangsc.me/2020/11/15/practice-with-vim-I/</id>
    <published>2020-11-15T00:54:30.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>What would be the easiest way to remove all but one word from the end of each line in Vim?</p><p>Today, I found a challenge on vimgolf and thought it might be interesting to share my solutions.</p><p>Here is the original file</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">abcd 1 erfg 7721231</span><br><span class="line">acd 2 erfgasd 324321</span><br><span class="line">acd 3 erfgsdasd 23432</span><br><span class="line">abcd 5 erfgdsad 123556</span><br></pre></td></tr></table></figure><p>Here is the desired result:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">7721231</span><br><span class="line">324321</span><br><span class="line">23432</span><br><span class="line">123556</span><br></pre></td></tr></table></figure><p>The challenge is quite straightforward, delete all but the last characters in the file. I found several ways to tackle this challenge, so let me show you all:</p><span id="more"></span><h4 id="Take-1-Use-macro-only"><a href="#Take-1-Use-macro-only" class="headerlink" title="Take 1: Use macro only"></a>Take 1: Use macro only</h4><p>Record a macro, and play it back, so the keystrokes would be</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">qa $bd0j q 4@a &lt;cr&gt;</span><br><span class="line"></span><br><span class="line">qa starts recording macro to register a</span><br><span class="line">$ move cursor to the end of the line</span><br><span class="line">d0 means *d*elete to the beginning of the line</span><br><span class="line">j move cursor down</span><br><span class="line">q finish macro</span><br><span class="line">4@a repeat the macro in register a 4 times</span><br></pre></td></tr></table></figure><h4 id="Take-2-Use-regex-and-norm"><a href="#Take-2-Use-regex-and-norm" class="headerlink" title="Take 2: Use regex and %norm"></a>Take 2: Use regex and %norm</h4><p>It&#39;s quite obvious that all we want to keep from the original files are the numbers. So the regex would be simple to come up with, like something as simple as <code>/\d\+$&lt;cr&gt;</code> will do. Once you type this into vim, all the numbers at the end of the line will be highlighted. Next you can do: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:%norm dn &lt;cr&gt;</span><br><span class="line"></span><br><span class="line">% means applying to the whole file,</span><br><span class="line">norm means in execute following command in normal mode</span><br><span class="line">dn means *d*elete to *n*ext match</span><br></pre></td></tr></table></figure><h4 id="Take-3-No-regex-pure-norm"><a href="#Take-3-No-regex-pure-norm" class="headerlink" title="Take 3: No regex pure %norm"></a>Take 3: No regex pure %norm</h4><p>This is the fastest way I can come up with, still, not as fast as the top answers on Vimgolf but it is decent in my opinion. Being slightly different from the option above, it is still using <code>%norm</code> though:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%norm $bd0 &lt;cr&gt;  </span><br><span class="line"></span><br><span class="line">% means applying to the whole file,</span><br><span class="line">$ move cursor to the end of the line</span><br><span class="line">d0 means *d*elete to the beginning of the line</span><br></pre></td></tr></table></figure><hr><h3 id="Takeaways"><a href="#Takeaways" class="headerlink" title="Takeaways:"></a>Takeaways:</h3><ul><li><code>norm</code> is a quite powerful, and can be used to achieve complex stuff that can be otherwise achieved through a macro.</li><li><code>d</code> the delete command is useful in many unexpected ways, besides <code>dn</code> and <code>d0</code> command mentioned above which deletes to the next match and deletes to the beginning of the line respectively. An additional useful variation of <code>d</code> command is <code>d4/x</code> where <code>4/x</code> meaning 4th occurrence of x.</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;What would be the easiest way to remove all but one word from the end of each line in Vim?&lt;/p&gt;
&lt;p&gt;Today, I found a challenge on vimgolf and thought it might be interesting to share my solutions.&lt;/p&gt;
&lt;p&gt;Here is the original file&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;abcd 1 erfg 7721231&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;acd 2 erfgasd 324321&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;acd 3 erfgsdasd 23432&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;abcd 5 erfgdsad 123556&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Here is the desired result:&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;7721231&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;324321&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23432&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123556&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;The challenge is quite straightforward, delete all but the last characters in the file. I found several ways to tackle this challenge, so let me show you all:&lt;/p&gt;</summary>
    
    
    
    
    <category term="Notes" scheme="https://jiangsc.me/tags/Notes/"/>
    
    <category term="Vim" scheme="https://jiangsc.me/tags/Vim/"/>
    
    <category term="Practice" scheme="https://jiangsc.me/tags/Practice/"/>
    
  </entry>
  
  <entry>
    <title>Pitfall of jsonencode in Terraform</title>
    <link href="https://jiangsc.me/2020/09/14/pitfall-of-jsonencode-in-terraform/"/>
    <id>https://jiangsc.me/2020/09/14/pitfall-of-jsonencode-in-terraform/</id>
    <published>2020-09-14T09:39:11.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>This week, I was tasked with creating basic infrastructure for one of our newwebsites.  We use Fastly for our CDN and New Relic as a log aggregation tool, most of our infrastructure is setup using Terraform, which is a popular infrastructure as code (IaC) platform. Terraform supports Fastly through a custom plugin, which also has the capability of New Relic. We need to customize the format of New Relic so that we can find the logs easily in New Relic. As expected, the plugin actually provide a pretty straight forward to accomplish this -- what you need to do is to come up with a proper json string that align with the format that Fastly provided in their document. This seemingly straightforward task ended up took me some time to debug.</p><span id="more"></span><p>In terraform, you can create objects, and an object can be converted to string by using jsonencode function. This is where the pitfall comes in: Fastly&#39;s formatting document said they have a option called &quot;%&gt;s&quot; which represents the final status of the fastly request. From my perspective, it would definitely be helpful if we can include this when we send the log to Fastly. So I added this to my formatting object, and then jsonencode the object. To my suprise, I get an error saying that Fastly failed to parse the formatting option I created, which is quite strange. I then started to debug, I export TF_LOG&#x3D;&quot;DEBUG&quot;, which asked Terraform to give me all the debug logs. To my suprise, I found that the &quot;%&gt;s&quot; was jsonencode to &quot;%\u003es&quot; by terraform, and thus causing the error.  <strong>How come &quot;&gt;&quot; sign is encoded in Terraform? It turned out it&#39;s for backward compatibility with ealier edition of Terraform.</strong> And according to their documentation </p><blockquote><p>When encoding strings, this function escapes some characters using Unicode escape sequences: replacing &lt;, &gt;, &amp;, U+2028, and U+2029 with \u003c, \u003e, \u0026, \u2028, and \u2029. This is to preserve compatibility with Terraform 0.11 behavior. </p></blockquote><p>they encode much more characters <strong>for you</strong> without you realizing it. I really hope they can provide a way to opt-out of this feature or make this an opt-in, it will make things way easier for developers.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;This week, I was tasked with creating basic infrastructure for one of our newwebsites.  We use Fastly for our CDN and New Relic as a log aggregation tool, most of our infrastructure is setup using Terraform, which is a popular infrastructure as code (IaC) platform. Terraform supports Fastly through a custom plugin, which also has the capability of New Relic. We need to customize the format of New Relic so that we can find the logs easily in New Relic. As expected, the plugin actually provide a pretty straight forward to accomplish this -- what you need to do is to come up with a proper json string that align with the format that Fastly provided in their document. This seemingly straightforward task ended up took me some time to debug.&lt;/p&gt;</summary>
    
    
    
    
    <category term="Notes" scheme="https://jiangsc.me/tags/Notes/"/>
    
    <category term="Terraform" scheme="https://jiangsc.me/tags/Terraform/"/>
    
    <category term="Pitfalls" scheme="https://jiangsc.me/tags/Pitfalls/"/>
    
  </entry>
  
  <entry>
    <title>Automating Android data saver with tasker</title>
    <link href="https://jiangsc.me/2019/10/12/Automating-Android-data-saver-with-tasker/"/>
    <id>https://jiangsc.me/2019/10/12/Automating-Android-data-saver-with-tasker/</id>
    <published>2019-10-12T06:34:42.000Z</published>
    <updated>2022-08-28T04:14:29.062Z</updated>
    
    <content type="html"><![CDATA[<p>Recently, I have been eager to get the data saver on Android to work automatically for me. My goal is to have Tasker automatically enable the built-in data saver when my data is low. Before I came up with this idea, I have search the web to see if there is any solutions exist already so I don&#39;t have to reinventing the wheel. Unfortunately, I couldn&#39;t find anything on this topic so I have to create my own solution. Upon 1 week of testing, things to work as I expected so I decided to share in this article how I did it.</p><h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><ul><li>An rooted Android phone -- Unfortunately, the solution I came up with only works on rooted Android phone, I&#39;m running Android 9.0.</li><li>A way to get to know you current data usage -- Some carriers allow you to get you data usage through SMS, some might only allow you to use USSD to get data usage. I am only covering the case of using SMS here (my case).<span id="more"></span><h2 id="How-to"><a href="#How-to" class="headerlink" title="How-to"></a>How-to</h2>The data saver in Android is basically something that limits all the background data usage. After some digging on the Internet, I found that you can turn the data saver on with the following command <code>cmd netpolicy set restrict-background true</code> (requires root). Then it is pretty easy to have the data saver turned on automatically when the data is low. My way of doing this is as follows:<ul><li>Set a global variable as threshold for triggering the data saver.</li><li>Send an SMS to my carrier every morning at 8 AM, parsing the SMS to get my remaining data.</li><li>If my data remaining is lower than the threshold then turn on the data saver whenever mobile data is in use. This is done by using the run shell action and run the command mentioned above. </li><li>Turn data saver off automatically when I am connected to WiFi (Not necessary but add it just in case).</li></ul></li></ul><p>It is quite easy to do this when you carrier allows you to query data usage using SMS, with USSD however, things is not that easy and unfortunately, I haven&#39;t figure out a way yet.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Recently, I have been eager to get the data saver on Android to work automatically for me. My goal is to have Tasker automatically enable the built-in data saver when my data is low. Before I came up with this idea, I have search the web to see if there is any solutions exist already so I don&amp;#39;t have to reinventing the wheel. Unfortunately, I couldn&amp;#39;t find anything on this topic so I have to create my own solution. Upon 1 week of testing, things to work as I expected so I decided to share in this article how I did it.&lt;/p&gt;
&lt;h2 id=&quot;Prerequisite&quot;&gt;&lt;a href=&quot;#Prerequisite&quot; class=&quot;headerlink&quot; title=&quot;Prerequisite&quot;&gt;&lt;/a&gt;Prerequisite&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;An rooted Android phone -- Unfortunately, the solution I came up with only works on rooted Android phone, I&amp;#39;m running Android 9.0.&lt;/li&gt;
&lt;li&gt;A way to get to know you current data usage -- Some carriers allow you to get you data usage through SMS, some might only allow you to use USSD to get data usage. I am only covering the case of using SMS here (my case).</summary>
    
    
    
    
    <category term="Tasker" scheme="https://jiangsc.me/tags/Tasker/"/>
    
    <category term="Automation" scheme="https://jiangsc.me/tags/Automation/"/>
    
    <category term="Android" scheme="https://jiangsc.me/tags/Android/"/>
    
    <category term="Data Saver" scheme="https://jiangsc.me/tags/Data-Saver/"/>
    
  </entry>
  
  <entry>
    <title>Converting QEMU VM to VirtualBox VM</title>
    <link href="https://jiangsc.me/2019/05/28/Converting-QEMU-VM-to-VirtualBox-VM/"/>
    <id>https://jiangsc.me/2019/05/28/Converting-QEMU-VM-to-VirtualBox-VM/</id>
    <published>2019-05-28T08:55:20.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<p>Recently, I decided to convert my QEMU based virtual machine installed on my Manjaro Linux to the VirtualBox format. The reason behind this is that I would like to be able to use the same VM across different host system (specifically Manjaro Linux and Windows 7). It is not a easy  thing to do, so I decided to document it for future references.</p><h3 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite?"></a>Prerequisite?</h3><ul><li>An existing image created using QEMU (My VM file end with .img,  for example)</li><li>VirtualBox<span id="more"></span><h3 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h3></li></ul><p>First thing first, you would need to convert the QEMU image (extension img) to raw format, this can be done by issuing the following command:</p><p><code>qemu-img convert Windows7-compressed.img  -O raw  Windows7.raw</code></p><p>This will generate a raw image. Note that this newly generated file might be a lot larger than the file it based on, this is because the img file allocates space on as-is basis.</p><p>After you get the raw image, it&#39;s time to convert it to VDI format (which is used by VirtualBox). You can do this by running:</p><p><code>VBoxManage convertfromraw Windows7.raw --format vdi  Windows7.vdi</code></p><p>Then, it is recommended to compact the image:</p><p><code>VBoxManage modifyhd Windows7.vdi --compact</code></p><p>So after the previous step, you will have a working VirtualBox image, but if you boot it from VirtualBox, it might not work.</p><h3 id="Gotchas"><a href="#Gotchas" class="headerlink" title="Gotchas!"></a>Gotchas!</h3><p>In my case, what I was trying to convert was a Windows 7 VM, and when I finished the above steps and try to boot the VM, I got a BSOD. My feeling is that there were some default that QEMU used that doesn&#39;t work for a newly created machine in VirtualBox. I tweak the following settings in the newly created VirtualBox VM:</p><ul><li>Delete the auto created SATA controller and change it IDE controller.</li></ul><p>It turned out, after doing that, everything works as expected.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Recently, I decided to convert my QEMU based virtual machine installed on my Manjaro Linux to the VirtualBox format. The reason behind this is that I would like to be able to use the same VM across different host system (specifically Manjaro Linux and Windows 7). It is not a easy  thing to do, so I decided to document it for future references.&lt;/p&gt;
&lt;h3 id=&quot;Prerequisite&quot;&gt;&lt;a href=&quot;#Prerequisite&quot; class=&quot;headerlink&quot; title=&quot;Prerequisite?&quot;&gt;&lt;/a&gt;Prerequisite?&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;An existing image created using QEMU (My VM file end with .img,  for example)&lt;/li&gt;
&lt;li&gt;VirtualBox</summary>
    
    
    
    
    <category term="VitualBox" scheme="https://jiangsc.me/tags/VitualBox/"/>
    
    <category term="QEMU" scheme="https://jiangsc.me/tags/QEMU/"/>
    
    <category term="VM" scheme="https://jiangsc.me/tags/VM/"/>
    
  </entry>
  
  <entry>
    <title>Automating things on Android with Tasker (I)</title>
    <link href="https://jiangsc.me/2018/06/24/Automating-things-on-Android-with-Tasker/"/>
    <id>https://jiangsc.me/2018/06/24/Automating-things-on-Android-with-Tasker/</id>
    <published>2018-06-24T09:30:31.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Why-Tasker"><a href="#Why-Tasker" class="headerlink" title="Why Tasker?"></a>Why Tasker?</h3><p>This is probably an article that is long overdue to me personally. I have been an Android user since 2011, started with my Nexus S that I bought for use in college. It seems to me, the app Tasker had been very famous in the Andorid community, especially among users who know how to program.<br>For those who have never heard of this app, this is a powerful app that allows you to automate almost anything that you can think of on the Android system.For me,It was not until August of last year when I bought the tasker app that I started to realize how powerful this app is. I am really not a big fan of its old school UI and design so I didn&#39;t start using it until this year. After uisng it for a while, I did come to realize that there is no other apps close to it, if I were to move to iOS, this is probably among one the apps that I will miss.  In this article I will explain how I used takser to automate things for myself, it is some boring stuff, but it did become something that I&#39;m using everyday.</p><h3 id="What-can-you-use-it-for"><a href="#What-can-you-use-it-for" class="headerlink" title="What can you use it for?"></a>What can you use it for?</h3><p>I will list one of the most used Tasks&#x2F;Profiles that I created and used in this app:</p><span id="more"></span><h5 id="Turn-off-x2F-on-ADB-when-using-certain-apps"><a href="#Turn-off-x2F-on-ADB-when-using-certain-apps" class="headerlink" title="Turn off&#x2F;on ADB when using certain apps."></a>Turn off&#x2F;on ADB when using certain apps.</h5><p>This is one of the easy ones that I found very useful. It is not uncommon nowadays for some apps to require you to turn off your ADB (Android Debugging Bridge) settings when you are using them, which to me, is quite annoying. So naturally, I created a Tasker profile together with a task to automate this. The trick here is you need to have root access, otherwise you are pretty much out of luck for this particular example. To create such a task, assuming you already have proper root access, go to the TASKS page in the app and click on the add icon, choose a name you like, and then you can create your first task! Think of a task as the things you want Tasker to do for you. In this particular case, my goal is simple: turn off ADB if it was not already off, turn it on if it was off. This way we can have one task that a turns off the ADB when you turns on the app; when you turns the app off, ADB will be switch back to on. </p><p>It is clear that we will need a global variable that holds the  status of the adb status, to do this add an action: click on the button add icon while you are in the &quot;Task Edit&quot; page, and filter based on Shell, you will see a &quot;Run Shell&quot; as a result. Click on it, and in the &quot;Command&quot; input, enter &quot;settings get global adb_enabled&quot; and in &quot;Store Output In&quot; input, choose a global variable name you would like to use to hold the status of the current ADB status, just remember that you need to use all caps for the name for tasker to know it is an global variable. Also remember to check the &quot;Use Root&quot; checkbox. After this step, things will be simple, just add the if and else condition like I mentioned before, set adb_enabled to 0 if it is 1 and set it to 1 if it is 0, and after that don&#39;t forget to set the global variable again. </p><p>TL;DR Here is the XML, that you can directly import to your Tasker if you don&#39;t want to create it yourself:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TaskerData</span> <span class="attr">sr</span>=<span class="string">&quot;&quot;</span> <span class="attr">dvi</span>=<span class="string">&quot;1&quot;</span> <span class="attr">tv</span>=<span class="string">&quot;5.2.bf&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Task</span> <span class="attr">sr</span>=<span class="string">&quot;task3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cdate</span>&gt;</span>1526421645228<span class="tag">&lt;/<span class="name">cdate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edate</span>&gt;</span>1529892193595<span class="tag">&lt;/<span class="name">edate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>3<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nme</span>&gt;</span>adb_auto<span class="tag">&lt;/<span class="name">nme</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pri</span>&gt;</span>1006<span class="tag">&lt;/<span class="name">pri</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Action</span> <span class="attr">sr</span>=<span class="string">&quot;act0&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;7&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">code</span>&gt;</span>123<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg0&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>&gt;</span>settings get global adb_enabled<span class="tag">&lt;/<span class="name">Str</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Int</span> <span class="attr">sr</span>=<span class="string">&quot;arg1&quot;</span> <span class="attr">val</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Int</span> <span class="attr">sr</span>=<span class="string">&quot;arg2&quot;</span> <span class="attr">val</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg3&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>&gt;</span>%ADB_STATUS<span class="tag">&lt;/<span class="name">Str</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg4&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg5&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Action</span> <span class="attr">sr</span>=<span class="string">&quot;act1&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;7&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">code</span>&gt;</span>37<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ConditionList</span> <span class="attr">sr</span>=<span class="string">&quot;if&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Condition</span> <span class="attr">sr</span>=<span class="string">&quot;c0&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">lhs</span>&gt;</span>%ADB_STATUS<span class="tag">&lt;/<span class="name">lhs</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">op</span>&gt;</span>0<span class="tag">&lt;/<span class="name">op</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">rhs</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rhs</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Condition</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ConditionList</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Action</span> <span class="attr">sr</span>=<span class="string">&quot;act2&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;7&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">code</span>&gt;</span>123<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg0&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>&gt;</span>settings put global adb_enabled 0<span class="tag">&lt;/<span class="name">Str</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Int</span> <span class="attr">sr</span>=<span class="string">&quot;arg1&quot;</span> <span class="attr">val</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Int</span> <span class="attr">sr</span>=<span class="string">&quot;arg2&quot;</span> <span class="attr">val</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg3&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>&gt;</span>%ADB_STATUS<span class="tag">&lt;/<span class="name">Str</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg4&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg5&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Action</span> <span class="attr">sr</span>=<span class="string">&quot;act3&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;7&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">code</span>&gt;</span>43<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Action</span> <span class="attr">sr</span>=<span class="string">&quot;act4&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;7&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">code</span>&gt;</span>123<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg0&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>&gt;</span>settings put global adb_enabled 1<span class="tag">&lt;/<span class="name">Str</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Int</span> <span class="attr">sr</span>=<span class="string">&quot;arg1&quot;</span> <span class="attr">val</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Int</span> <span class="attr">sr</span>=<span class="string">&quot;arg2&quot;</span> <span class="attr">val</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg3&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>&gt;</span>%ADB_STATUS<span class="tag">&lt;/<span class="name">Str</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg4&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg5&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Action</span> <span class="attr">sr</span>=<span class="string">&quot;act5&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;7&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">code</span>&gt;</span>38<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Action</span> <span class="attr">sr</span>=<span class="string">&quot;act6&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;7&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">code</span>&gt;</span>123<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg0&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>&gt;</span>settings get global adb_enabled<span class="tag">&lt;/<span class="name">Str</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Int</span> <span class="attr">sr</span>=<span class="string">&quot;arg1&quot;</span> <span class="attr">val</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Int</span> <span class="attr">sr</span>=<span class="string">&quot;arg2&quot;</span> <span class="attr">val</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg3&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>&gt;</span>%ADB_STATUS<span class="tag">&lt;/<span class="name">Str</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg4&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Str</span> <span class="attr">sr</span>=<span class="string">&quot;arg5&quot;</span> <span class="attr">ve</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Task</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TaskerData</span>&gt;</span></span><br></pre></td></tr></table></figure><p>To import, you need to save the above snippet to XML on your phone. In tasker app,   click and hold the &quot;TASKS&quot; tab header, select import and choose the file </p><p>To run the task based on your predefined conditions, go to “PROFILES” tab, click on add button in the button, choose the application you want, and then, chose the task you imported and you are good to go! Now the app won&#39;t say you can&#39;t use it because you have ADB turned on, Tasker will turned adb off when you are using the app, and turn it on when you are not using it! :)</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;Why-Tasker&quot;&gt;&lt;a href=&quot;#Why-Tasker&quot; class=&quot;headerlink&quot; title=&quot;Why Tasker?&quot;&gt;&lt;/a&gt;Why Tasker?&lt;/h3&gt;&lt;p&gt;This is probably an article that is long overdue to me personally. I have been an Android user since 2011, started with my Nexus S that I bought for use in college. It seems to me, the app Tasker had been very famous in the Andorid community, especially among users who know how to program.&lt;br&gt;For those who have never heard of this app, this is a powerful app that allows you to automate almost anything that you can think of on the Android system.For me,It was not until August of last year when I bought the tasker app that I started to realize how powerful this app is. I am really not a big fan of its old school UI and design so I didn&amp;#39;t start using it until this year. After uisng it for a while, I did come to realize that there is no other apps close to it, if I were to move to iOS, this is probably among one the apps that I will miss.  In this article I will explain how I used takser to automate things for myself, it is some boring stuff, but it did become something that I&amp;#39;m using everyday.&lt;/p&gt;
&lt;h3 id=&quot;What-can-you-use-it-for&quot;&gt;&lt;a href=&quot;#What-can-you-use-it-for&quot; class=&quot;headerlink&quot; title=&quot;What can you use it for?&quot;&gt;&lt;/a&gt;What can you use it for?&lt;/h3&gt;&lt;p&gt;I will list one of the most used Tasks&amp;#x2F;Profiles that I created and used in this app:&lt;/p&gt;</summary>
    
    
    
    
    <category term="Tasker" scheme="https://jiangsc.me/tags/Tasker/"/>
    
    <category term="Automation" scheme="https://jiangsc.me/tags/Automation/"/>
    
    <category term="Android" scheme="https://jiangsc.me/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Automating Gmail Archive With Google App Scripts</title>
    <link href="https://jiangsc.me/2018/03/24/AutomatingStuffWithGoogleAppScripts/"/>
    <id>https://jiangsc.me/2018/03/24/AutomatingStuffWithGoogleAppScripts/</id>
    <published>2018-03-24T00:28:59.000Z</published>
    <updated>2022-08-28T04:14:29.066Z</updated>
    
    <content type="html"><![CDATA[<h4 id="What-is-Google-App-Scripts"><a href="#What-is-Google-App-Scripts" class="headerlink" title="What is Google App Scripts?"></a>What is Google App Scripts?</h4><p>Before explaining what I did with Google App Scripts, let me explain what is Google App Scripts. It is basically a scripting engine that let you access all kinds of Google App features (including Gmail, Google Calendar, Google Docs, etc.). There are other ways to access these features but Google App Script might be the easist way out there. It comes with an online editor (you can work offline as well), and Google can trigger your scripts at certain time based on your need. Oh, forgot to mention, Google App Script uses JavaScript which is one of the most popular languages right now (Sadly, it doesn&#39;t support ES6 syntax as of writing).</p><h4 id="Why-use-Google-App-Scripts"><a href="#Why-use-Google-App-Scripts" class="headerlink" title="Why use Google App Scripts?"></a>Why use Google App Scripts?</h4><p>I have a habit of archiving my Emails every week on Mondays. It is easy enough to do in the gmail Web interface but I do need to remember to do it. That make me think if I can find a good way to automate this. I would always think of using some kind of API first, but it seems to me that it wouldn&#39;t worth it to spend time to make a app just for the purpose of archiving emails. Then I came across Google App Scripts, which turned out to be exactly what I need to automate this.</p><span id="more"></span><h4 id="What-I-came-up-with"><a href="#What-I-came-up-with" class="headerlink" title="What I came up with"></a>What I came up with</h4><p>Here is what I came up with to archive emails that are one-week-old every Monday at midnight:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">gmailAutoarchive</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> maxDate = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  <span class="comment">// Archive all threads in inbox whose last message date is older than today.</span></span><br><span class="line">  <span class="keyword">var</span> threads = <span class="title class_">GmailApp</span>.<span class="title function_">getInboxThreads</span>();</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> threads)&#123;</span><br><span class="line">    <span class="keyword">var</span> thread = threads[i];</span><br><span class="line">    <span class="keyword">if</span> (thread.<span class="title function_">getLastMessageDate</span>()&lt;maxDate)&#123;</span><br><span class="line">      thread.<span class="title function_">moveToArchive</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You will be able to use this script by putting it into the google script editor located <a href="https://script.google.com/">here</a>.</p><p>To have Google auto run your scripts, you need to add the trigger which can be found under Edit --&gt; Current project&#39;s triggers.</p><h4 id="Variation"><a href="#Variation" class="headerlink" title="Variation"></a>Variation</h4><p>After creating this script, I created another script as a variation to this script that move messages with certain labels to trash.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">gmailAutoRemove</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> maxDate = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  maxDate.<span class="title function_">setDate</span>(maxDate.<span class="title function_">getDate</span>() - <span class="number">30</span>); <span class="comment">// what was the date at that time?</span></span><br><span class="line">  <span class="keyword">var</span> label = [<span class="title class_">GmailApp</span>.<span class="title function_">getUserLabelByName</span>(<span class="string">&quot;label1&quot;</span>), <span class="title class_">GmailApp</span>.<span class="title function_">getUserLabelByName</span>(<span class="string">&quot;label2&quot;</span>), <span class="title class_">GmailApp</span>.<span class="title function_">getUserLabelByName</span>(<span class="string">&quot;label3&quot;</span>)];</span><br><span class="line">  label.<span class="title function_">forEach</span>(<span class="title function_">removeByLabel</span>(maxDate));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeByLabel</span>(<span class="params">maxDate</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">label</span>)&#123;</span><br><span class="line">   <span class="keyword">var</span> threads = label.<span class="title function_">getThreads</span>(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> threads)&#123;</span><br><span class="line">      <span class="keyword">var</span> thread = threads[i];</span><br><span class="line">      <span class="keyword">if</span> (thread.<span class="title function_">getLastMessageDate</span>() &lt; maxDate)&#123;</span><br><span class="line">        thread.<span class="title function_">moveToTrash</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>References: <a href="https://medium.com/@fw3d/auto-archive-emails-in-gmail-after-2-days-1ebf0e076b1c">Auto archive emails in Gmail after 2 days</a></p>]]></content>
    
    
    <summary type="html">&lt;h4 id=&quot;What-is-Google-App-Scripts&quot;&gt;&lt;a href=&quot;#What-is-Google-App-Scripts&quot; class=&quot;headerlink&quot; title=&quot;What is Google App Scripts?&quot;&gt;&lt;/a&gt;What is Google App Scripts?&lt;/h4&gt;&lt;p&gt;Before explaining what I did with Google App Scripts, let me explain what is Google App Scripts. It is basically a scripting engine that let you access all kinds of Google App features (including Gmail, Google Calendar, Google Docs, etc.). There are other ways to access these features but Google App Script might be the easist way out there. It comes with an online editor (you can work offline as well), and Google can trigger your scripts at certain time based on your need. Oh, forgot to mention, Google App Script uses JavaScript which is one of the most popular languages right now (Sadly, it doesn&amp;#39;t support ES6 syntax as of writing).&lt;/p&gt;
&lt;h4 id=&quot;Why-use-Google-App-Scripts&quot;&gt;&lt;a href=&quot;#Why-use-Google-App-Scripts&quot; class=&quot;headerlink&quot; title=&quot;Why use Google App Scripts?&quot;&gt;&lt;/a&gt;Why use Google App Scripts?&lt;/h4&gt;&lt;p&gt;I have a habit of archiving my Emails every week on Mondays. It is easy enough to do in the gmail Web interface but I do need to remember to do it. That make me think if I can find a good way to automate this. I would always think of using some kind of API first, but it seems to me that it wouldn&amp;#39;t worth it to spend time to make a app just for the purpose of archiving emails. Then I came across Google App Scripts, which turned out to be exactly what I need to automate this.&lt;/p&gt;</summary>
    
    
    
    
    <category term="Automation" scheme="https://jiangsc.me/tags/Automation/"/>
    
    <category term="Google App Scripts" scheme="https://jiangsc.me/tags/Google-App-Scripts/"/>
    
    <category term="Gmail" scheme="https://jiangsc.me/tags/Gmail/"/>
    
  </entry>
  
</feed>
