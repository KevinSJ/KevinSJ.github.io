import{Q as G,b as N,d as F,a0 as W,r as E,o as P,c as R,a as M,k as Q,l as O,j,w as X,a6 as $,G as L,ad as D,aW as V,ag as H}from"./index-0c1fde36.js";import{B as o,a as J}from"./index-a6f01dde.js";import{g as K}from"./base64-ae7cf34b.js";import{s as C,u as Y}from"./index-fdbe2ce9.js";import{s as Z}from"./string_decoder-8ac4312e.js";import{u as k}from"./downloadBase64-508288e2.js";import{_ as ee}from"./Spin-885f2a22.js";import"./inherits_browser-6f38ab1b.js";import"./index-0397ab6f.js";import"./index-649b5bab.js";import"./index-6fddb70d.js";import"./index-cfd4d427.js";var z={exports:{}};(function(s,e){var i=G&&G.__extends||function(){var g=function(u,r){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(n[l]=t[l])},g(u,r)};return function(u,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");g(u,r);function n(){this.constructor=u}u.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),a=G&&G.__spreadArray||function(g,u,r){if(r||arguments.length===2)for(var n=0,t=u.length,l;n<t;n++)(l||!(n in u))&&(l||(l=Array.prototype.slice.call(u,0,n)),l[n]=u[n]);return g.concat(l||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0});var f=C,c=o.from("ffe1","hex"),m=o.from("457869660000","hex"),S=o.from("89504e470d0a1a0a","hex"),d=o.from("52494646","hex"),q=o.from("57454250","hex"),_=o.from("http://ns.adobe.com/xap","utf-8"),w=o.from("FLIR","utf-8"),x=Math.max(m.length,_.length,w.length),U=function(g){i(u,g);function u(r){var n=g.call(this,r)||this;return n.remainingScrubBytes=void 0,n.pending=[],n}return u.prototype._transform=function(r,n,t){this.mode===void 0&&(S.equals(Uint8Array.prototype.slice.call(r,0,8))?(this.mode="png",this.push(Uint8Array.prototype.slice.call(r,0,8)),r=o.from(Uint8Array.prototype.slice.call(r,8))):d.equals(Uint8Array.prototype.slice.call(r,0,4))&&q.equals(Uint8Array.prototype.slice.call(r,8,12))?(this.mode="webp",this.push(Uint8Array.prototype.slice.call(r,0,12)),r=o.from(Uint8Array.prototype.slice.call(r,12))):this.mode="other"),this._scrub(!1,r),t()},u.prototype._final=function(r){for(;this.pending.length!==0;)this._scrub(!0);r()},u.prototype._scrub=function(r,n){switch(this.mode){case"other":return this._scrubOther(r,n);case"png":return this._scrubPNG(r,n);case"webp":return this._scrubWEBP(r,n);default:throw new Error("unknown mode")}},u.prototype._scrubOther=function(r,n){var t=n?o.concat(a(a([],this.pending,!0),[n],!1)):o.concat(this.pending);if(this.remainingScrubBytes===void 0){var l=t.indexOf(c);if(l===-1){if(!r&&t[t.length-1]===c[0]){n&&this.pending.push(n);return}}else if(l+x+4>t.length){r?(this.push(t),this.pending.length=0):n&&this.pending.push(n);return}else{var v=Uint8Array.prototype.slice.call(t,l+4,l+x+4);(m.compare(v,0,m.length)===0||_.compare(v,0,_.length)===0||w.compare(v,0,w.length)===0)&&(this.remainingScrubBytes=t.readUInt16BE(l+2)+2,this.push(Uint8Array.prototype.slice.call(t,0,l)),t=o.from(Uint8Array.prototype.slice.call(t,l)))}}if(this.remainingScrubBytes!==void 0&&this.remainingScrubBytes!==0)if(t.length>=this.remainingScrubBytes){var b=o.from(Uint8Array.prototype.slice.call(t,this.remainingScrubBytes));this.pending=b.length!==0?[b]:[],this.remainingScrubBytes=void 0}else this.remainingScrubBytes-=t.length,this.pending.length=0;else this.push(t),this.remainingScrubBytes=void 0,this.pending.length=0},u.prototype._scrubPNG=function(r,n){for(var t=n?o.concat(a(a([],this.pending,!0),[n],!1)):o.concat(this.pending);t.length!==0;){if(t=this._processPNGGood(t),this.remainingScrubBytes!==void 0){if(t.length>=this.remainingScrubBytes){var l=o.from(Uint8Array.prototype.slice.call(t,this.remainingScrubBytes));this.pending=l.length!==0?[l]:[],this.remainingScrubBytes=void 0}else this.remainingScrubBytes-=t.length,this.pending.length=0;return}if(t.length===0)return;if(t.length<8){r?(this.push(t),this.pending.length=0):this.pending=[t];return}var v=t.readUInt32BE(0),b=Uint8Array.prototype.slice.call(t,4,8).toString();switch(b){case"tIME":case"iTXt":case"tEXt":case"zTXt":case"eXIf":case"dSIG":this.remainingScrubBytes=v+12;continue;default:this.remainingGoodBytes=v+12;continue}}},u.prototype._processPNGGood=function(r){if(this.remainingGoodBytes===void 0)return r;if(this.pending.length=0,this.remainingGoodBytes>=r.length)return this.remainingGoodBytes-=r.length,this.push(r),o.alloc(0);this.push(Uint8Array.prototype.slice.call(r,0,this.remainingGoodBytes));var n=o.from(Uint8Array.prototype.slice.call(r,this.remainingGoodBytes));return this.remainingGoodBytes=void 0,n},u.prototype._scrubWEBP=function(r,n){for(var t=n?o.concat(a(a([],this.pending,!0),[n],!1)):o.concat(this.pending);t.length!==0;){if(t=this._processPNGGood(t),this.remainingScrubBytes!==void 0){if(t.length>=this.remainingScrubBytes){var l=o.from(Uint8Array.prototype.slice.call(t,this.remainingScrubBytes));this.pending=l.length!==0?[l]:[],this.remainingScrubBytes=void 0}else this.remainingScrubBytes-=t.length,this.pending.length=0;return}if(t.length===0)return;if(t.length<8){r?(this.push(t),this.pending.length=0):this.pending=[t];return}var v=Uint8Array.prototype.slice.call(t,0,4).toString(),b=t.readUInt32LE(4);switch(v){case"EXIF":this.remainingScrubBytes=b+12;continue;default:this.remainingGoodBytes=b+12;continue}}},u}(f.Transform);e.default=U,s.exports=U})(z,z.exports);var te=z.exports;const re=N(te);var A=C,T=Y,ie=Z.StringDecoder;function p(s,e){if(!(this instanceof p))return new p(s,e);p.super_.call(this,e),this.init(s,e)}T.inherits(p,A.Readable);function y(s,e){if(!(this instanceof y))return new y(s,e);y.super_.call(this,e),this.init(s,e)}T.inherits(y,A.Writable);function h(s,e){if(!(this instanceof h))return new h(s,e);h.super_.call(this,e),this.init(s,e)}T.inherits(h,A.Duplex);p.prototype.init=y.prototype.init=h.prototype.init=function(e,i){var a=this;this.queue=[],e&&(Array.isArray(e)||(e=[e]),e.forEach(function(f){f instanceof o||(f=new o(f)),a.queue.push(f)})),i=i||{},this.maxbufsize=i.hasOwnProperty("maxbufsize")?i.maxbufsize:null,this.bufoverflow=i.hasOwnProperty("bufoverflow")?i.bufoverflow:null,this.frequence=i.hasOwnProperty("frequence")?i.frequence:null};function B(s,e){if(!(this instanceof B))return new B(s,e);e=e||{};var i=e.hasOwnProperty("readable")?e.readable:!0,a=e.hasOwnProperty("writable")?e.writable:!0;if(i&&a)return new h(s,e);if(i)return new p(s,e);if(a)return new y(s,e);throw new Error("Unknown stream type  Readable, Writable or Duplex ")}B.createReadStream=function(s,e){return e=e||{},e.readable=!0,e.writable=!1,new B(s,e)};B.createWriteStream=function(s,e){return e=e||{},e.readable=!1,e.writable=!0,new B(s,e)};p.prototype._read=h.prototype._read=function(e){var i=this,a=i.frequence||0,f=this instanceof A.Duplex&&!this._writableState.finished;!this.queue.length&&!f?this.push(null):this.queue.length&&setTimeout(function(){if(i.queue.length){var c=i.queue.shift();c&&!i._readableState.ended&&(i.push(c)||i.queue.unshift(c))}},a)};y.prototype._write=h.prototype._write=function(e,i,a){var f=null;try{f=this.decodeStrings&&i?new ie(i):null}catch(d){return a(d)}var c=f?f.write(e):e,m=this._getQueueSize(),S=c.length;if(this.maxbufsize&&m+S>this.maxbufsize)return this.bufoverflow?a("Buffer overflowed ("+this.bufoverflow+"/"+m+")"):a();if(this instanceof A.Duplex){for(;this.queue.length;)this.push(this.queue.shift());this.push(c)}else this.queue.push(c);a()};h.prototype.end=function(s,e,i){var a=this;return h.super_.prototype.end.call(this,s,e,function(){a.push(null),i&&i()})};p.prototype._getQueueSize=y.prototype._getQueueSize=h.prototype._getQueueSize=function(){var s=0,e;for(e=0;e<this.queue.length;e++)s+=Array.isArray(this.queue[e])?this.queue[e][0].length:this.queue[e].length;return s};y.prototype.toString=h.prototype.toString=p.prototype.toString=y.prototype.getAll=h.prototype.getAll=p.prototype.getAll=function(){var s="";return this.queue.forEach(function(e){s+=e}),s};y.prototype.toBuffer=h.prototype.toBuffer=p.prototype.toBuffer=function(){var s=new o(this._getQueueSize()),e=0;return this.queue.forEach(function(i){var a=i instanceof o?i:new o(i);a.copy(s,e),e+=i.length}),s};var ne=B;const I=N(ne),se={style:{flex:"0 0 100%"}},oe={"mx-auto":"","max-w-600px":""},ae={"mt-3":"",flex:"","justify-center":""},ve=F({__name:"remove-exif",setup(s){const{t:e}=W(),i=E("idle"),a=E(null),f=E(""),c=E(""),{download:m}=k({source:f,filename:c,extension:"jpg"});async function S(d){a.value=d;const q=await d.arrayBuffer();c.value=`noexif_${d.name}`,i.value="processing";try{const _=I.createReadStream(J.from(q)),w=I.createWriteStream(),x=new re;await new Promise((g,u)=>{_.pipe(x).pipe(w).on("finish",()=>g(!0))});const U=w.toBuffer();f.value=`data:image/File;base64,${K.fromUint8Array(U)}`,i.value="done",m()}catch{i.value="error"}}return(d,q)=>{const _=V,w=H,x=ee;return P(),R("div",null,[M("div",se,[M("div",oe,[Q(_,{title:O(e)("tools.remove-exif.texts.title-drag-and-drop-a-image-file-here-or-click-to-select-a-file"),accept:"image/*",onFileUpload:S},null,8,["title"])])]),M("div",ae,[O(i)==="error"?(P(),j(w,{key:0,type:"error"},{default:X(()=>[$(" An error occured processing "+L(O(c)),1)]),_:1})):D("",!0),O(i)==="processing"?(P(),j(x,{key:1,size:"small"})):D("",!0)])])}}});export{ve as default};
