import{i as N,p as v,s as y,n as B}from"./index-0898812d.js";const I={4:32,6:128};function g(n){return Array.from(new Set(n))}function S(n){return n.includes("/")?N(n):0}function p(n,t){const{number:e,version:r}=v(n.replace(/\/.+/,"")),{number:s,version:o}=v(t.replace(/\/.+/,""));return r===o?e-s>0n?1:e-s<0n?-1:0:r>o?1:0}function P(n,{compress:t=!0,hexify:e=!1}={}){const{start:r,end:s,prefix:o,version:i,prefixPresent:c}=d(n);return r!==s||c?`${B(y({number:r,version:i}),{compress:t,hexify:e})}/${o}`:B(n,{compress:t,hexify:e})}function $(n,t){return Array.isArray(n)?n.map(e=>$(e,t)):P(n,t)}function d(n){const t=S(n),e=Object.create(null);let r;if(t)r=n,e.version=t;else{const A=N(n);if(A)r=`${n}/${I[A]}`,e.version=A;else throw new Error(`Network is not a CIDR or IP: ${n}`)}const[s,o]=r.split("/");if(!/^[0-9]+$/.test(o))throw new Error(`Network is not a CIDR or IP: ${n}`);const{number:i,version:c,ipv4mapped:f,scopeid:a}=v(s);e.ip=y({number:i,version:c,ipv4mapped:f,scopeid:a}),e.cidr=`${e.ip}/${o}`,e.prefix=o,e.prefixPresent=!!t;const u=I[c],h=i.toString(2).padStart(u,"0"),l=Number(u-Number(o)),b=h.substring(0,u-l);return e.start=BigInt(`0b${b}${"0".repeat(l)}`),e.end=BigInt(`0b${b}${"1".repeat(l)}`),e}function z(n,t){return!(t.start<n.start||t.end>n.end)}function V(n,t,e){const r=[];if(n.start>t.end||n.end<t.start)return[n.cidr];if(n.start===t.start&&n.end===t.end)return[];if(n.start>t.start&&n.end<t.end)return[];n.start<t.start&&n.end<=t.end&&r.push({start:n.start,end:t.start-1n}),n.start>=t.start&&n.end>t.end&&r.push({start:t.end+1n,end:n.end}),n.start<t.start&&n.end>t.end&&r.push({start:n.start,end:t.start-1n},{start:t.end+1n,end:n.end});const s=[];for(const o of r)for(const i of m(o))s.push(C(i,e));return x(s)}function k(n){return n===0n?0n:2n**BigInt(String(n.toString(2).length-1))}function m(n){if(n.end-n.start===1n)return n.end%2n===0n?[{start:n.start,end:n.start},{start:n.end,end:n.end}]:[{start:n.start,end:n.end}];const t=w(n.end,n.start);let e=k(t),r,s;if(t===e&&n.start+t===n.end)return[n];if(n.start%e===0n)r=n.start,s=r+e-1n;else if(r=n.end/e*e,r+e-1n>n.end){for(r=(n.end/e-1n)*e;r<n.start;)e/=2n,r=(n.end/e-1n)*e;s=r+e-1n}else r=n.end/e*e,s=r+e-1n;let o=[{start:r,end:s}];return r!==n.start&&(o=o.concat(m({start:n.start,end:r-1n}))),s!==n.end&&(o=o.concat(m({start:s+1n,end:n.end}))),o}function w(n,t){return n+1n-t}function C(n,t){const e=$(y({number:BigInt(n.start.toString()),version:t})),r=w(n.end,n.start).toString(2),s=I[t]-(r.match(/0/g)||[]).length;return`${e}/${s}`}function E(n){const t={4:{},6:{}};for(const{start:e,end:r,version:s}of n)t[s][String(e)]||(t[s][String(e)]={start:0,end:0}),t[s][String(r)]||(t[s][String(r)]={start:0,end:0}),t[s][String(e)].start+=1,t[s][String(r)].end+=1;return t}function O(n){let t=null,e=null;const r=Object.keys(n);let s=0;const o=[];for(const[i,c]of r.entries()){const f=n[String(c)];if(t===null&&f.start&&(t=BigInt(c)),f.end&&(e=BigInt(c)),t===null)continue;f.start&&(s+=f.start),f.end&&(s-=f.end);const a=r[i+1];if(f.end&&s===0&&a&&BigInt(a)-BigInt(c)>1){for(const u of m({start:t,end:e}))o.push(u);t=null,e=null}else if(i===r.length-1)for(const u of m({start:t,end:e}))o.push(u)}return o}function x(n){const t=g((Array.isArray(n)?n:[n]).sort(p).map(d)),e=E(t),r={4:[],6:[]};for(const s of[4,6])r[s]=O(e[s]).map(o=>C(o,s));return[...r[4].sort(p),...r[6].sort(p)]}function D(n,t){const e=x(g(Array.isArray(n)?n:[n])),r=x(g(Array.isArray(t)?t:[t])),s={4:[],6:[]},o={4:[],6:[]};for(const i of e){const c=S(i);c&&s[c].push(i)}for(const i of r){const c=S(i);c&&o[c].push(i)}for(const i of[4,6])for(const c of o[i])for(const[f,a]of s[i].entries()){const u=d(a),h=d(c),l=V(u,h,i);u.cidr!==l.toString()&&(s[i]=s[i].concat(l),s[i].splice(f,1))}return s[4].concat(s[6]).sort(p)}function*M(n){const t=g(Array.isArray(n)?n:[n]);for(const e of x(t)){const{start:r,end:s,version:o}=d(e);for(let i=r;i<=s;i++)yield $(y({number:i,version:o}))}}function R(n,t){const e=g(Array.isArray(n)?n:[n]),r=g(Array.isArray(t)?t:[t]),s=r.length;let o=0;for(const i of e){const c=d(i);for(const f of r){const a=d(f);if(c.version===a.version&&z(c,a)){o++;continue}}}return o===s}export{D as a,R as c,M as e,x as m,d as p};
