import{c as ae,i as se}from"./style-ynO7IsM1.js";import"./version-BXrBJCm5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-C6L5gDe0.js";import{G as ie,a as A,f as Z,b as Q,P as q,y as ce,h as G,d as re,z as _,w as le}from"./main-CdZmBCMR.js";import"./mobileMenu-BoMunYmR.js";ie.workerSrc=new URL("/itools/assets/pdf.worker-DjmdXq8j.mjs",import.meta.url).toString();const i={file:null,pdfDoc:null,pdfBytes:null,pdfjsDoc:null};function U(){i.file=null,i.pdfDoc=null,i.pdfBytes=null,i.pdfjsDoc=null;const n=document.getElementById("file-display-area");n&&(n.innerHTML="");const t=document.getElementById("tool-options");t&&t.classList.add("hidden");const a=document.getElementById("file-input");a&&(a.value="");const s=document.getElementById("booklet-preview");s&&(s.innerHTML='<p class="text-gray-400 text-center py-8">Upload a PDF and click "Generate Preview" to see the booklet layout</p>');const r=document.getElementById("download-btn");r&&(r.disabled=!0)}async function de(){const n=document.getElementById("file-display-area"),t=document.getElementById("tool-options");if(n)if(n.innerHTML="",i.file){const a=document.createElement("div");a.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const s=document.createElement("div");s.className="flex flex-col overflow-hidden";const r=document.createElement("div");r.className="truncate font-medium text-gray-200 text-sm mb-1",r.textContent=i.file.name;const o=document.createElement("div");o.className="text-xs text-gray-400",o.textContent=`${Z(i.file.size)} • Loading...`,s.append(r,o);const l=document.createElement("button");l.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",l.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',l.onclick=function(){U()},a.append(s,l),n.appendChild(a),ae({icons:se});try{Q("Loading PDF...");const m=await i.file.arrayBuffer();i.pdfBytes=new Uint8Array(m),i.pdfDoc=await q.load(i.pdfBytes,{ignoreEncryption:!0,throwOnInvalidObject:!1}),i.pdfjsDoc=await ce({data:i.pdfBytes.slice()}).promise,G();const u=i.pdfDoc.getPageCount();o.textContent=`${Z(i.file.size)} • ${u} pages`,t&&t.classList.remove("hidden");const B=document.getElementById("preview-btn");B&&(B.disabled=!1)}catch(m){console.error("Error loading PDF:",m),G(),A("Error","Failed to load PDF file."),U()}}else t&&t.classList.add("hidden")}function ee(){switch(document.querySelector('input[name="grid-mode"]:checked')?.value||"1x2"){case"1x2":return{rows:1,cols:2};case"2x2":return{rows:2,cols:2};case"2x4":return{rows:2,cols:4};case"4x4":return{rows:4,cols:4};default:return{rows:1,cols:2}}}function fe(n){const t=document.querySelector('input[name="orientation"]:checked')?.value||"auto";return t==="portrait"?"portrait":t==="landscape"||n?"landscape":"portrait"}function te(n){const t=document.getElementById("paper-size").value,a=_[t]||_.Letter;return fe(n)==="landscape"?{width:a[1],height:a[0]}:{width:a[0],height:a[1]}}async function pe(){if(!i.pdfDoc||!i.pdfjsDoc){A("Error","Please load a PDF first.");return}const n=document.getElementById("booklet-preview"),t=i.pdfDoc.getPageCount(),{rows:a,cols:s}=ee(),r=a*s,o=a===1&&s===2;let l;o?l=Math.ceil(t/4)*2:l=Math.ceil(t/r);const{width:m,height:u}=te(o),k=document.getElementById("booklet-preview").clientWidth-32,M=m/u,v=k,x=k/M;n.innerHTML='<p class="text-gray-400 text-center py-4">Generating preview...</p>';const E=o?Math.ceil(t/4)*4:t,T=document.querySelector('input[name="rotation"]:checked')?.value||"none",R=new Map,D=.3;for(let c=1;c<=t;c++)try{const d=await i.pdfjsDoc.getPage(c),e=d.getViewport({scale:D}),h=new OffscreenCanvas(e.width,e.height),p=h.getContext("2d");await d.render({canvasContext:p,viewport:e,canvas:h}).promise;const y=await createImageBitmap(h);R.set(c,y)}catch(d){console.error(`Failed to render page ${c}:`,d)}n.innerHTML=`<p class="text-indigo-400 text-sm mb-4 text-center">${t} pages → ${l} output sheets</p>`;for(let c=0;c<l;c++){const d=document.createElement("canvas");d.width=v,d.height=x,d.className="border border-gray-600 rounded-lg mb-4";const e=d.getContext("2d"),h=c%2===0;e.fillStyle=h?"#1f2937":"#1a2e1a",e.fillRect(0,0,v,x),e.strokeStyle="#4b5563",e.lineWidth=1,e.strokeRect(0,0,v,x);const p=v/s,y=x/a,S=4;e.strokeStyle="#374151",e.lineWidth=1,e.setLineDash([2,2]);for(let f=1;f<s;f++)e.beginPath(),e.moveTo(f*p,0),e.lineTo(f*p,x),e.stroke();for(let f=1;f<a;f++)e.beginPath(),e.moveTo(0,f*y),e.lineTo(v,f*y),e.stroke();e.setLineDash([]);for(let f=0;f<a;f++)for(let b=0;b<s;b++){const N=f*s+b;let w;if(o){const g=Math.floor(c/2);c%2===0?w=b===0?E-2*g:2*g+1:w=b===0?2*g+2:E-2*g-1}else w=c*r+N+1;const L=b*p+S,I=f*y+S,C=p-S*2,W=y-S*2;if(w>=1&&w<=t){const g=R.get(w);if(g){let P=0;T==="90cw"?P=90:T==="90ccw"?P=-90:T==="alternate"&&(P=w%2===1?90:-90);const X=P!==0,V=X?g.height:g.width,Y=X?g.width:g.height,K=Math.min(C/V,W/Y),F=V*K,H=Y*K,O=L+(C-F)/2,z=I+(W-H)/2;if(e.save(),P!==0){const ne=O+F/2,oe=z+H/2;e.translate(ne,oe),e.rotate(P*Math.PI/180),e.drawImage(g,-H/2,-F/2,H,F)}else e.drawImage(g,O,z,F,H);e.restore(),e.strokeStyle="#6b7280",e.lineWidth=1,e.strokeRect(O,z,F,H),e.fillStyle="rgba(255, 255, 255, 0.8)",e.font="bold 10px sans-serif",e.textAlign="center",e.fillText(`${w}`,L+C/2,I+W-4)}}else e.fillStyle="#374151",e.fillRect(L,I,C,W),e.strokeStyle="#4b5563",e.lineWidth=1,e.strokeRect(L,I,C,W),e.fillStyle="#6b7280",e.font="10px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText("(blank)",L+C/2,I+W/2)}e.fillStyle="#9ca3af",e.font="bold 10px sans-serif",e.textAlign="right",e.textBaseline="top";const $=o?h?"Front":"Back":"";e.fillText(`Sheet ${Math.floor(c/(o?2:1))+1} ${$}`,v-6,4),n.appendChild(d)}R.forEach(c=>c.close());const j=document.getElementById("download-btn");j.disabled=!1}function ue(n,t){n.getPages().forEach((s,r)=>{let o=0;switch(t){case"90cw":o=90;break;case"90ccw":o=-90;break;case"alternate":o=r%2===0?90:-90;break;default:o=0}o!==0&&s.setRotation(le(s.getRotation().angle+o))})}async function he(){if(!i.pdfBytes){A("Error","Please load a PDF first.");return}Q("Creating Booklet...");try{const n=await q.load(i.pdfBytes.slice()),t=document.querySelector('input[name="rotation"]:checked')?.value||"none";ue(n,t);const a=n.getPageCount(),{rows:s,cols:r}=ee(),o=s*r,l=s===1&&r===2,{width:m,height:u}=te(l),B=await q.create();let k,M;l?(M=Math.ceil(a/4)*4,k=Math.ceil(a/4)*2):(M=a,k=Math.ceil(a/o));const v=m/r,x=u/s,E=10;for(let D=0;D<k;D++){const j=B.addPage([m,u]);for(let c=0;c<s;c++)for(let d=0;d<r;d++){const e=c*r+d;let h;if(l){const p=Math.floor(D/2);D%2===0?h=d===0?M-2*p:2*p+1:h=d===0?2*p+2:M-2*p-1}else h=D*o+e+1;if(h>=1&&h<=a){const[p]=await B.embedPdf(n,[h-1]),{width:y,height:S}=p,$=v-E*2,f=x-E*2,b=Math.min($/y,f/S),N=y*b,w=S*b,L=d*v+E+($-N)/2,I=u-(c+1)*x+E+(f-w)/2;j.drawPage(p,{x:L,y:I,width:N,height:w})}}}const T=await B.save(),R=i.file?.name.replace(/\.pdf$/i,"")||"document";re(new Blob([new Uint8Array(T)],{type:"application/pdf"}),`${R}_booklet.pdf`),A("Success",`Booklet created with ${k} sheets!`,"success",function(){U()})}catch(n){console.error(n),A("Error","An error occurred while creating the booklet.")}finally{G()}}function J(n){if(n&&n.length>0){const t=n[0];(t.type==="application/pdf"||t.name.toLowerCase().endsWith(".pdf"))&&(i.file=t,de())}}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("file-input"),t=document.getElementById("drop-zone"),a=document.getElementById("preview-btn"),s=document.getElementById("download-btn"),r=document.getElementById("back-to-tools");r&&r.addEventListener("click",function(){window.location.href="/itools/"}),n&&t&&(n.addEventListener("change",function(o){J(o.target.files)}),t.addEventListener("dragover",function(o){o.preventDefault(),t.classList.add("bg-gray-700")}),t.addEventListener("dragleave",function(o){o.preventDefault(),t.classList.remove("bg-gray-700")}),t.addEventListener("drop",function(o){o.preventDefault(),t.classList.remove("bg-gray-700");const l=o.dataTransfer?.files;if(l&&l.length>0){const m=Array.from(l).filter(function(u){return u.type==="application/pdf"||u.name.toLowerCase().endsWith(".pdf")});if(m.length>0){const u=new DataTransfer;u.items.add(m[0]),J(u.files)}}}),n.addEventListener("click",function(){n.value=""})),a&&a.addEventListener("click",pe),s&&s.addEventListener("click",he)});
