import{r as m,cc as N,d as O,a0 as V,i as q,b0 as K,o as $,c as U,j as W,w as d,a6 as x,G as _,k as s,ad as j,l as e,m as B,aj as D,a as M,a7 as F,a8 as z,ah as A,cb as G,b$ as H,ag as J,cE as Q,bq as X}from"./index-0c1fde36.js";import{_ as Y}from"./Space-7fc52151.js";import{_ as E}from"./Select-9917c364.js";import{_ as Z}from"./InputGroup-c4275982.js";import{_ as ee}from"./Card-7ba5ce79.js";import{_ as te}from"./a-07fc27a5.js";import"./get-slot-1efb97e5.js";import"./Tag-e75b8dae.js";import"./FocusDetector-089b8822.js";import"./VirtualList-8140ffff.js";import"./Empty-ca426d71.js";import"./index-cbfaa337.js";function oe(){const h=m(!1),o=m([]),u=m(9600),f=m("LF"),b=m([]);let a=null,y=null,c=null,g=null,k=null,w=!1,v=0;const P=3;function n(t){o.value.push(t)}async function L(){b.value=await navigator.serial.getPorts()}async function S(t){try{a=t||await navigator.serial.requestPort(),await R()}catch(r){n(`[Connect error] ${r}`)}}async function R(){try{await a.open({baudRate:u.value}),h.value=!0,v=0;const t=new TextDecoderStream;g=a.readable.pipeTo(t.writable),y=t.readable.getReader(),T();const r=new TextEncoderStream;k=r.readable.pipeTo(a.writable),c=r.writable.getWriter(),n("[Connected]")}catch(t){n(`[Open error] ${t}`),l()}}async function C(){if(!(!a||w)){w=!0,n("[Disconnecting...]");try{y?.cancel(),await g?.catch(()=>{}),y?.releaseLock(),await c?.close().catch(()=>{}),await k?.catch(()=>{}),c?.releaseLock(),await a.close(),n("[Disconnected]")}catch(t){n(`[Teardown error] ${t}`)}finally{h.value=!1,w=!1}}}async function T(){try{for(;;){const{value:t,done:r}=await y.read();if(r)break;t&&n(t)}}catch(t){w||(n(`[Read error] ${t}`),l())}}async function p(t){if(!c||!h.value)return;const r=f.value==="CR"?"\r":f.value==="CRLF"?`\r
`:`
`;c.write(t+r),n(`> ${t}`)}async function l(){if(v>=P){n("[Reconnect failed]");return}v++,n(`[Reconnecting... attempt ${v}]`),await new Promise(t=>setTimeout(t,1e3*v));try{await R()}catch{l()}}return N(()=>{C()}),{isConnected:h,outputLines:o,baudRate:u,lineEnding:f,availablePorts:b,connect:S,disconnect:C,send:p,listPorts:L}}const le=O({__name:"serial-console",setup(h){const{t:o}=V(),u=m(""),f=m(null),b=m(),{isConnected:a,outputLines:y,baudRate:c,lineEnding:g,availablePorts:k,connect:w,disconnect:v,send:P,listPorts:n}=oe(),L=[{label:o("tools.serial-console.texts.label-9600"),value:9600},{label:o("tools.serial-console.texts.label-19200"),value:19200},{label:o("tools.serial-console.texts.label-38400"),value:38400},{label:o("tools.serial-console.texts.label-57600"),value:57600},{label:o("tools.serial-console.texts.label-115200"),value:115200}],S=[{label:o("tools.serial-console.texts.label-lf-n"),value:"LF"},{label:o("tools.serial-console.texts.label-cr-r"),value:"CR"},{label:o("tools.serial-console.texts.label-crlf-r-n"),value:"CRLF"}],R=q(()=>k.value.map((p,l)=>({label:`Port ${l+1} (${p.getInfo().usbVendorId??"Unknown"})`,value:p})));function C(){u.value.trim()&&(P(u.value),u.value="",H(()=>{f.value?.scrollTo({top:f.value.scrollHeight,behavior:"smooth"})}))}K(()=>{n()});function T(){return window.isSecureContext}return(p,l)=>{const t=te,r=J;return $(),U(F,null,[T()?j("",!0):($(),W(r,{key:0,"mb-2":""},{default:d(()=>[x(_(p.$t("tools.pgp-encryption.texts.tag-your-browser-is-not-in")),1),s(t,{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts",target:"_blank"},{default:d(()=>[x(_(p.$t("tools.pgp-encryption.texts.tag-secure-context-https")),1)]),_:1}),x(_(p.$t("tools.pgp-encryption.texts.tag-this-tool-may-not-work-correctly-and-require-https-to-work-fully")),1)]),_:1})),s(e(ee),{title:e(o)("tools.serial-console.texts.title-serial-terminal")},{default:d(()=>[s(e(Y),null,{default:d(()=>[s(e(E),{value:e(c),"onUpdate:value":l[0]||(l[0]=i=>B(c)?c.value=i:null),options:L,placeholder:e(o)("tools.serial-console.texts.placeholder-baud-rate"),style:{width:"150px"}},null,8,["value","placeholder"]),s(e(E),{value:e(g),"onUpdate:value":l[1]||(l[1]=i=>B(g)?g.value=i:null),options:S,placeholder:e(o)("tools.serial-console.texts.placeholder-line-ending"),style:{width:"120px"}},null,8,["value","placeholder"]),s(e(E),{value:b.value,"onUpdate:value":l[2]||(l[2]=i=>b.value=i),options:e(R),"label-field":"label","value-field":"value",placeholder:e(o)("tools.serial-console.texts.placeholder-select-port"),style:{width:"200px"}},null,8,["value","options","placeholder"]),s(e(D),{type:"primary",disabled:e(a),onClick:l[3]||(l[3]=i=>e(w)(b.value))},{default:d(()=>[x(_(e(o)("tools.serial-console.texts.tag-connect")),1)]),_:1},8,["disabled"]),s(e(D),{type:"error",disabled:!e(a),onClick:e(v)},{default:d(()=>[x(_(e(o)("tools.serial-console.texts.tag-disconnect")),1)]),_:1},8,["disabled","onClick"])]),_:1}),M("div",{ref_key:"outputRef",ref:f,class:"terminal-output"},[($(!0),U(F,null,z(e(y),(i,I)=>($(),U("div",{key:I,class:"terminal-line"},_(i),1))),128))],512),s(e(Z),null,{default:d(()=>[s(e(A),{value:u.value,"onUpdate:value":l[4]||(l[4]=i=>u.value=i),placeholder:e(o)("tools.serial-console.texts.placeholder-type-a-command"),disabled:!e(a),onKeydown:G(Q(C,["prevent"]),["enter"])},null,8,["value","placeholder","disabled","onKeydown"]),s(e(D),{type:"primary",disabled:!e(a),onClick:C},{default:d(()=>[x(_(e(o)("tools.serial-console.texts.tag-send")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["title"])],64)}}});const _e=X(le,[["__scopeId","data-v-cb0ee3a9"]]);export{_e as default};
