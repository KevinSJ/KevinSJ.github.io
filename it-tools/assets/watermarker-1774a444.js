import{d as ne,a0 as re,r as W,ac as w,i as se,O as ue,o as O,c as me,k as a,l as t,j as Q,ad as X,a as Y,bc as ie,w as r,aj as P,a6 as I,G as R,ah as pe,m,aW as de,ak as ve,af as fe}from"./index-0c1fde36.js";import{_ as J}from"./Select-9917c364.js";import{_ as j}from"./Space-7fc52151.js";import{N as E}from"./Slider-38ef3da2.js";import{_ as ce}from"./ColorPicker-f5c5efe0.js";import{_ as ge}from"./Switch-a0f825a4.js";import{N as we}from"./Upload-98f6b12b.js";import{_ as xe}from"./RadioGroup-1850ca84.js";import{_ as K}from"./Radio-424d9905.js";import{_ as be}from"./FormItem-1b9a5952.js";import"./Tag-e75b8dae.js";import"./FocusDetector-089b8822.js";import"./VirtualList-8140ffff.js";import"./Empty-ca426d71.js";import"./index-cbfaa337.js";import"./get-slot-1efb97e5.js";import"./InputGroup-c4275982.js";import"./Progress-cb02197e.js";import"./Image-22bdebd3.js";import"./_arrayReduce-865b0d3f.js";import"./download-953ccaa2.js";import"./context-00991937.js";const ke={style:{"max-width":"100%","max-height":"50vh",overflow:"scroll","text-align":"center"}},Pe=ne({__name:"watermarker",setup(_e){const{t:n}=re(),d=W([]),y=W(0),U=w({name:"w",storageName:"watermarker:w",defaultValue:"Sample Watermark"}),p=w({name:"fs",storageName:"watermarker:fs",defaultValue:24}),A=w({name:"col",storageName:"watermarker:c",defaultValue:"#000000"}),k=w({name:"opa",storageName:"watermarker:o",defaultValue:40}),_=w({name:"rot",storageName:"watermarker:r",defaultValue:45}),C=w({name:"repeat",storageName:"watermarker:rep",defaultValue:!1}),v=w({name:"logow",storageName:"watermarker:lw",defaultValue:60}),f=w({name:"tilespc",storageName:"watermarker:ts",defaultValue:30}),z=w({name:"pos",storageName:"watermarker:pos",defaultValue:"center"}),N=W(null),B=W("png"),h=W(null),Z=se(()=>d.value.map((u,e)=>({label:u.getAttribute("data-name"),value:e})));function ee(u){d.value=[],u.forEach(e=>{const l=new FileReader;l.onload=()=>{const s=new Image;s.setAttribute("data-name",e.name),s.onload=()=>{d.value.push(s),d.value.length===1&&S(0)},s.src=l.result},l.readAsDataURL(e)})}function te({file:u}){if(!u.file)return;const e=new FileReader;e.onload=()=>{const l=new Image;l.onload=()=>{N.value=l},l.src=e.result},e.readAsDataURL(u.file)}function q(u,e=0){if(!N.value)return;const l=N.value.naturalHeight/N.value.naturalWidth,s=v.value*l;u.drawImage(N.value,-v.value/2,e+10,v.value,s)}function S(u){const e=d.value[u];if(!e||!h.value)return;const l=h.value.getContext("2d");if(!l)return;h.value.width=e.width,h.value.height=e.height,l.clearRect(0,0,e.width,e.height),l.drawImage(e,0,0),l.globalAlpha=k.value/100;const x=document.createElement("canvas").getContext("2d");x.font=`${p.value}px sans-serif`;const o=x.measureText(U.value).width,L=p.value,$=_.value*Math.PI/180,T=Math.abs(o*Math.cos($))+Math.abs(L*Math.sin($)),F=Math.abs(o*Math.sin($))+Math.abs(L*Math.cos($));if(C.value){const c=o+f.value,g=L+f.value,i=document.createElement("canvas"),b=i.getContext("2d");i.width=c,i.height=g,b.clearRect(0,0,c,g),b.font=`${p.value}px sans-serif`,b.fillStyle=A.value,b.textAlign="center",b.textBaseline="middle",b.translate(c/2,g/2),b.fillText(U.value,0,0),N.value&&q(b,L/2);const M=Math.sqrt(e.width*e.width+e.height*e.height),V=document.createElement("canvas"),D=V.getContext("2d");V.width=M,V.height=M,D.clearRect(0,0,M,M);const oe=D.createPattern(i,"repeat");D.fillStyle=oe,D.fillRect(0,0,M,M),l.save(),l.translate(e.width/2,e.height/2),l.rotate($),l.drawImage(V,-V.width/2,-V.height/2),l.restore()}else{l.save();let c=e.width/2,g=e.height/2;const i=f.value;switch(z.value){case"top-left":c=i+T/2,g=i+F/2;break;case"top-right":c=e.width-i-T/2,g=i+F/2;break;case"bottom-left":c=i+T/2,g=e.height-i-F/2;break;case"bottom-right":c=e.width-i-T/2,g=e.height-i-F/2;break}l.translate(c,g),l.rotate($),q(l),l.font=`${p.value}px sans-serif`,l.fillStyle=A.value,l.textAlign="center",l.textBaseline="middle",l.fillText(U.value,0,0),l.restore()}l.globalAlpha=1}function ae(){S(y.value)}function G(u){if(!h.value)return;const e=d.value[u].getAttribute("data-name")?.replace(/\.[^\.]+$/,"");S(u);const l=document.createElement("a");l.download=`watermarked-${e}.${B.value}`,l.href=h.value.toDataURL(`image/${B.value}`),l.click()}function le(){d.value.forEach((u,e)=>{G(e)}),S(y.value)}return ue(()=>S(y.value)),(u,e)=>{const l=de,s=be,x=ve,H=fe;return O(),me("div",null,[a(l,{title:t(n)("tools.watermarker.texts.title-drag-and-drop-images-here-or-click-to-select-some-files"),multiple:"",accept:"image/*",onFilesUpload:ee},null,8,["title"]),d.value.length?(O(),Q(t(J),{key:0,value:y.value,"onUpdate:value":e[0]||(e[0]=o=>y.value=o),options:Z.value,"label-field":"label","value-field":"value","mt-2":""},null,8,["value","options"])):X("",!0),Y("div",ke,[Y("canvas",{ref_key:"canvas",ref:h,style:ie(`border:1px solid #ccc;display: ${d.value.length>0?"inline-block":"none"};`)},null,4)]),a(t(j),{"mt-2":"",justify:"center"},{default:r(()=>[a(t(P),{onClick:ae},{default:r(()=>[I(R(t(n)("tools.watermarker.texts.tag-apply-to-current")),1)]),_:1}),a(t(P),{onClick:e[1]||(e[1]=o=>G(y.value))},{default:r(()=>[I(R(t(n)("tools.watermarker.texts.tag-download-current")),1)]),_:1}),a(t(P),{type:"primary",onClick:le},{default:r(()=>[I(R(t(n)("tools.watermarker.texts.tag-apply-download-all")),1)]),_:1})]),_:1}),a(H,{title:t(n)("tools.watermarker.texts.title-settings"),"mt-2":""},{default:r(()=>[a(s,{label:t(n)("tools.watermarker.texts.label-watermark-text"),"label-placement":"left","mt-2":""},{default:r(()=>[a(t(pe),{value:t(U),"onUpdate:value":e[2]||(e[2]=o=>m(U)?U.value=o:null),placeholder:t(n)("tools.watermarker.texts.placeholder-watermark-text")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(t(j),{justify:"center"},{default:r(()=>[a(s,{label:t(n)("tools.watermarker.texts.label-font-size"),"label-placement":"left","mt-2":""},{default:r(()=>[a(t(E),{value:t(p),"onUpdate:value":e[3]||(e[3]=o=>m(p)?p.value=o:null),step:1,min:1,max:100,"mr-2":""},null,8,["value"]),a(x,{value:t(p),"onUpdate:value":e[4]||(e[4]=o=>m(p)?p.value=o:null),size:"small",min:1,max:100},null,8,["value"])]),_:1},8,["label"]),a(s,{label:t(n)("tools.watermarker.texts.label-opacity"),"label-placement":"left","mt-2":""},{default:r(()=>[a(t(E),{value:t(k),"onUpdate:value":e[5]||(e[5]=o=>m(k)?k.value=o:null),step:.5,min:0,max:100,"mr-2":""},null,8,["value"]),a(x,{value:t(k),"onUpdate:value":e[6]||(e[6]=o=>m(k)?k.value=o:null),size:"small",min:0,max:100},null,8,["value"])]),_:1},8,["label"]),a(s,{label:t(n)("tools.watermarker.texts.label-color"),"label-placement":"left","mt-2":""},{default:r(()=>[a(t(ce),{value:t(A),"onUpdate:value":e[7]||(e[7]=o=>m(A)?A.value=o:null),style:{width:"100px"}},null,8,["value"])]),_:1},8,["label"]),a(s,{label:t(n)("tools.watermarker.texts.label-rotation"),"label-placement":"left","mt-2":""},{default:r(()=>[a(t(E),{value:t(_),"onUpdate:value":e[8]||(e[8]=o=>m(_)?_.value=o:null),step:.5,min:0,max:360,"mr-2":""},null,8,["value"]),a(x,{value:t(_),"onUpdate:value":e[9]||(e[9]=o=>m(_)?_.value=o:null),size:"small",min:0,max:360},null,8,["value"])]),_:1},8,["label"])]),_:1}),a(t(j),{justify:"center"},{default:r(()=>[a(s,{label:t(n)("tools.watermarker.texts.label-repeat-watermark"),"label-placement":"left","mt-2":""},{default:r(()=>[a(t(ge),{value:t(C),"onUpdate:value":e[10]||(e[10]=o=>m(C)?C.value=o:null)},null,8,["value"])]),_:1},8,["label"]),a(s,{label:t(C)?"Tile spacing:":"Margin:","label-placement":"left","mt-2":""},{default:r(()=>[a(t(E),{value:t(f),"onUpdate:value":e[11]||(e[11]=o=>m(f)?f.value=o:null),step:1,min:1,max:1e3,"mr-2":""},null,8,["value"]),a(x,{value:t(f),"onUpdate:value":e[12]||(e[12]=o=>m(f)?f.value=o:null),size:"small",min:1,max:1e3},null,8,["value"])]),_:1},8,["label"]),t(C)?X("",!0):(O(),Q(s,{key:0,label:t(n)("tools.watermarker.texts.label-position"),"label-placement":"left","mt-2":""},{default:r(()=>[a(t(J),{value:t(z),"onUpdate:value":e[13]||(e[13]=o=>m(z)?z.value=o:null),style:{"min-width":"130px"},options:[{label:t(n)("tools.watermarker.texts.label-center"),value:"center"},{label:t(n)("tools.watermarker.texts.label-top-left"),value:"top-left"},{label:t(n)("tools.watermarker.texts.label-top-right"),value:"top-right"},{label:t(n)("tools.watermarker.texts.label-bottom-left"),value:"bottom-left"},{label:t(n)("tools.watermarker.texts.label-bottom-right"),value:"bottom-right"}],placeholder:t(n)("tools.watermarker.texts.placeholder-watermark-position")},null,8,["value","options","placeholder"])]),_:1},8,["label"]))]),_:1}),a(H,{title:t(n)("tools.watermarker.texts.title-optional-logo")},{default:r(()=>[a(t(j),{justify:"center"},{default:r(()=>[a(t(we),{"show-file-list":!1,accept:"image/*",onChange:te},{default:r(()=>[a(t(P),null,{default:r(()=>[I(R(t(n)("tools.watermarker.texts.tag-upload-logo")),1)]),_:1})]),_:1})]),_:1}),a(s,{label:t(n)("tools.watermarker.texts.label-logo-width"),"label-placement":"left","mt-2":""},{default:r(()=>[a(t(E),{value:t(v),"onUpdate:value":e[14]||(e[14]=o=>m(v)?v.value=o:null),min:10,max:200,"mr-2":""},null,8,["value"]),a(x,{value:t(v),"onUpdate:value":e[15]||(e[15]=o=>m(v)?v.value=o:null),size:"small",min:10,max:200},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["title"]),a(H,{title:t(n)("tools.watermarker.texts.title-download-format"),"mt-2":""},{default:r(()=>[a(t(xe),{value:B.value,"onUpdate:value":e[16]||(e[16]=o=>B.value=o),name:"format",flex:"","justify-center":""},{default:r(()=>[a(t(j),null,{default:r(()=>[a(t(K),{value:"png"},{default:r(()=>[I(R(t(n)("tools.watermarker.texts.tag-png")),1)]),_:1}),a(t(K),{value:"jpeg"},{default:r(()=>[I(R(t(n)("tools.watermarker.texts.tag-jpeg")),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["title"])]),_:1},8,["title"])])}}});export{Pe as default};
