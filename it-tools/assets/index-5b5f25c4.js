import{r as He}from"./index-2709bfd9.js";var P={},m={};Object.defineProperty(m,"__esModule",{value:!0});m.fail=m.splitOnFirst=m.parseCommand=m.generateRandomString=m.convertName=m.convertDurationToNumber=void 0;function Pe(l){var n=/(?<value>\d+)(?<unit>[a-z]+)/g,p=Array.from(l.matchAll(n)),h={us:1,ms:1e3,s:1e3*1e3,m:1e3*1e3*60,h:1e3*1e3*60*60},b=p.reduce(function(u,k){var x=k.groups,A=x.value,C=x.unit,V=h[C];if(!V)throw new Error("unexpected unit: ".concat(C));return u+parseInt(A)*V},0);return b/1e3/1e3}m.convertDurationToNumber=Pe;function Se(l){var n=l.toLowerCase();return n=n.replace(/[^a-z0-9-]/g,"-"),n=n.replace(/^-+/,""),n=n.replace(/-+$/,""),n}m.convertName=Se;function We(){var l="generated-"+Math.random().toString(36).substring(2,15);return l}m.generateRandomString=We;function ze(l){for(var n=[],p="",h="",b=0;b<l.length;b++){var u=l[b];u===" "&&!h?p&&(n.push(p),p=""):u==='"'||u==="'"?h===u?h="":h?p+=u:h=u:p+=u}return p&&n.push(p),n}m.parseCommand=ze;function Be(l,n){var p=l.indexOf(n);return p===-1?[l,""]:[l.slice(0,p),l.slice(p+1)]}m.splitOnFirst=Be;function Je(){throw new Error("unexpected error")}m.fail=Je;Object.defineProperty(P,"__esModule",{value:!0});var Ke=P.convert=void 0,Te=He,o=m;function ke(l){var n,p,h,b,u,k,x,A,C={namespace:"default"},V=(0,Te.parse)(l),T=V,S=[],Ae=function(v){var a={};a.apiVersion="apps/v1",a.kind="Deployment";var e=T.services[v];if(v=e.container_name||v,v=(0,o.convertName)(v),a.metadata=a.metadata||{},a.metadata.name=v,a.metadata.namespace=C.namespace,a.metadata.labels=a.metadata.labels||{},a.metadata.labels.app=v,a.metadata.annotations=a.metadata.annotations||{},e.labels)if(Array.isArray(e.labels))for(var z=0,ne=e.labels;z<ne.length;z++){var Oe=ne[z],pe=Oe.split("="),q=pe[0],w=pe[1];a.metadata.annotations[q]=w||""}else for(var q in e.labels)a.metadata.annotations[q]=((n=e.labels[q])===null||n===void 0?void 0:n.toString())||"";a.spec=a.spec||{selector:{},template:{}},a.spec.replicas=((p=e.deploy)===null||p===void 0?void 0:p.replicas)||1,a.spec.selector.matchLabels=a.spec.selector.matchLabels||{},a.spec.selector.matchLabels.app=v,a.spec.template.metadata=a.spec.template.metadata||{},a.spec.template.metadata.labels=a.spec.template.metadata.labels||{},a.spec.template.metadata.labels.app=v,a.spec.template.spec=a.spec.template.spec||{containers:[]},a.spec.template.spec.hostname=e.hostname,e.pid&&(a.spec.template.spec.hostPID=e.pid==="host"),e.stop_grace_period&&(a.spec.template.spec.terminationGracePeriodSeconds=(0,o.convertDurationToNumber)(e.stop_grace_period));var t={};if(t.name=v,t.image=e.image||"PLACEHOLDER",t.args=typeof e.command=="string"?(0,o.parseCommand)(e.command):e.command===null?void 0:e.command,t.command=typeof e.entrypoint=="string"?e.entrypoint.split(/\s+/):e.entrypoint===null?void 0:e.entrypoint,e.volumes){a.spec.template.spec.volumes=[];for(var B=0,le=e.volumes;B<le.length;B++){var N=le[B],r={};if(typeof N=="string"){var J=N.split(":"),ce=J[0],Ie=J[1],ie=J[2];r.name=(0,o.convertName)(ce)||(0,o.generateRandomString)(),r.emptyDir={},t.volumeMounts=t.volumeMounts||[];var s={};s.name=r.name,s.mountPath=Ie||ce,ie&&(s.readOnly=ie==="ro"),t.volumeMounts.push(s)}else if(typeof N=="object"&&N.type==="volume"&&N.source&&N.target){r.name=(0,o.convertName)(N.source),r.emptyDir={},t.volumeMounts=t.volumeMounts||[];var s={};s.name=r.name,s.mountPath=N.target}a.spec.template.spec.volumes.push(r)}}if(e.configs){a.spec.template.spec.volumes=a.spec.template.spec.volumes||[];for(var K=0,me=e.configs;K<me.length;K++){var f=me[K];if(typeof f=="string"){var j=(h=T.configs)===null||h===void 0?void 0:h[f];if(j&&j.file){var r={};r.name=(0,o.convertName)(f),r.configMap={name:(0,o.convertName)(f)},t.volumeMounts=t.volumeMounts||[];var s={};s.name=r.name,s.mountPath="/".concat(f),s.readOnly=!0,t.volumeMounts.push(s),a.spec.template.spec.volumes.push(r)}}else if(typeof f=="object"&&f.source){var j=(b=T.configs)===null||b===void 0?void 0:b[f.source];if(j&&j.file){var r={};r.name=(0,o.convertName)(f.source),r.configMap={name:(0,o.convertName)(f.source)},t.volumeMounts=t.volumeMounts||[];var s={};s.name=r.name,s.mountPath=f.target||"/".concat(f.source),s.readOnly=!0,t.volumeMounts.push(s),a.spec.template.spec.volumes.push(r)}}}}if(e.secrets){a.spec.template.spec.volumes=a.spec.template.spec.volumes||[];for(var Q=0,ue=e.secrets;Q<ue.length;Q++){var c=ue[Q];if(typeof c=="string"){var L=(u=T.secrets)===null||u===void 0?void 0:u[c];if(L&&L.file){var r={};r.name=(0,o.convertName)(c),r.secret={secretName:(0,o.convertName)(c)},t.volumeMounts=t.volumeMounts||[];var s={};s.name=r.name,s.mountPath="/run/secrets/".concat(c),s.readOnly=!0,t.volumeMounts.push(s),a.spec.template.spec.volumes.push(r)}}else if(typeof c=="object"&&c.source){var L=(k=T.secrets)===null||k===void 0?void 0:k[c.source];if(L&&L.file){var r={};r.name=(0,o.convertName)(c.source),r.secret={secretName:(0,o.convertName)(c.source)},t.volumeMounts=t.volumeMounts||[];var s={};s.name=r.name,c.target?s.mountPath=c.target.startsWith("/")?c.target:"/run/secrets/".concat(c.target):s.mountPath="/run/secrets/".concat(c.source),s.readOnly=!0,t.volumeMounts.push(s),a.spec.template.spec.volumes.push(r)}}}}if(e.tmpfs){if(a.spec.template.spec.volumes=a.spec.template.spec.volumes||[],typeof e.tmpfs=="string"){var r={};r.name=(0,o.convertName)(e.tmpfs),r.emptyDir={},t.volumeMounts=t.volumeMounts||[];var s={};s.name=r.name,s.mountPath=e.tmpfs,t.volumeMounts.push(s),a.spec.template.spec.volumes.push(r)}else if(Array.isArray(e.tmpfs))for(var U=0,ve=e.tmpfs;U<ve.length;U++){var de=ve[U],r={};r.name=(0,o.convertName)(de),r.emptyDir={},t.volumeMounts=t.volumeMounts||[];var s={};s.name=r.name,s.mountPath=de,t.volumeMounts.push(s),a.spec.template.spec.volumes.push(r)}}t.ports=[];var O=e.ports;if((x=e.expose)===null||x===void 0||x.map(function($e){O?.push($e)}),O){for(var I=[],X=0,fe=O;X<fe.length;X++){var M=fe[X],G=[];if(typeof M=="string"){var he=M.split("/")[1]||"TCP";M=M.split("/")[0];var Y=M.split(":"),$=Y.pop()||(0,o.fail)(),F=Y.pop();Y.pop();for(var ye=$.includes("-")?$.split("-"):[$,$],Fe=ye[0],Ee=ye[1],d=parseInt(Fe);d<=parseInt(Ee);d++){var y={};y.containerPort=d,y.protocol=he,G.push(y)}if(F){for(var ge=F.includes("-")?F.split("-"):[F,F],Ve=ge[0],qe=ge[1],Z=[],d=parseInt(Ve);d<=parseInt(qe);d++)Z.push(d);for(var d=0;d<G.length;d++){var i={};i.apiVersion="v1",i.kind="Service",i.metadata={},i.metadata.namespace=C.namespace,i.metadata.name="".concat(v,"-").concat(Z[d]),i.metadata.namespace=C.namespace,i.metadata.labels={},i.metadata.labels.app=v,i.spec={},i.spec.ports=[];var H={};H.appProtocol=he,H.targetPort=G[d].containerPort,H.port=Z[d],i.spec.ports.push(H),i.spec.selector={},i.spec.selector.app=v,S.push(i)}}I.push.apply(I,G)}else if(typeof M=="number"){var y={};y.containerPort=M,y.protocol="TCP",I.push(y)}else if(typeof M=="object"){var y={};y.containerPort=M.target||(0,o.fail)(),y.protocol=M.protocol||"TCP",I.push(y)}}t.ports=I}if(t.env=[],e.environment)if(Array.isArray(e.environment))for(var R=0,Me=e.environment;R<Me.length;R++){var we=Me[R],be=(0,o.splitOnFirst)(we,"="),Ge=be[0],w=be[1];if(w){var D={};D.name=Ge,D.value=w,t.env.push(D)}}else for(var Ne in e.environment){var D={};D.name=Ne,D.value=(A=e.environment[Ne])===null||A===void 0?void 0:A.toString(),t.env.push(D)}if(e.group_add){var _={};_.supplementalGroups=[];for(var ee=0,De=e.group_add;ee<De.length;ee++){var E=De[ee];typeof E=="string"&&(E=parseInt(E)),E&&_.supplementalGroups.push(E)}a.spec.template.spec.securityContext=_}if(e.cap_add||e.cap_drop){if(t.securityContext={},t.securityContext.capabilities={},e.cap_add){t.securityContext.capabilities.add=[];for(var te=0,xe=e.cap_add;te<xe.length;te++){var ae=xe[te];t.securityContext.capabilities.add.push(ae)}}if(e.cap_drop){t.securityContext.capabilities.drop=[];for(var re=0,Ce=e.cap_drop;re<Ce.length;re++){var ae=Ce[re];t.securityContext.capabilities.drop.push(ae)}}}if(e.deploy&&e.deploy.resources&&(t.resources={},t.resources.limits={},t.resources.requests={},e.deploy.resources.reservations&&(e.deploy.resources.reservations.cpus&&(t.resources.requests.cpu="".concat(parseFloat(e.deploy.resources.reservations.cpus.toString())*1e3,"m")),e.deploy.resources.reservations.memory&&(t.resources.requests.memory=e.deploy.resources.reservations.memory)),e.deploy.resources.limits&&(e.deploy.resources.limits.cpus&&(t.resources.limits.cpu="".concat(parseFloat(e.deploy.resources.limits.cpus.toString())*1e3,"m")),e.deploy.resources.limits.memory&&(t.resources.limits.memory=e.deploy.resources.limits.memory))),e.healthcheck){var g={};e.healthcheck.start_period&&(g.initialDelaySeconds=(0,o.convertDurationToNumber)(e.healthcheck.start_period)),e.healthcheck.interval&&(g.periodSeconds=(0,o.convertDurationToNumber)(e.healthcheck.interval)),e.healthcheck.timeout&&(g.timeoutSeconds=(0,o.convertDurationToNumber)(e.healthcheck.timeout)),e.healthcheck.retries&&(g.failureThreshold=e.healthcheck.retries),e.healthcheck.test&&(g.exec={},typeof e.healthcheck.test=="string"?g.exec.command=["/bin/sh","-c",e.healthcheck.test]:e.healthcheck.test[0]==="CMD"?g.exec.command=e.healthcheck.test.slice(1):e.healthcheck.test[0]==="CMD-SHELL"&&(g.exec.command=["/bin/sh","-c",e.healthcheck.test.slice(1).join(" ")])),g.exec&&g.exec.command&&(t.livenessProbe=g)}a.spec.template.spec.containers.push(t),S.push(a)};for(var je in T.services)Ae(je);for(var se="",W=0,oe=S;W<oe.length;W++){var Le=oe[W];se+=`---
`+(0,Te.stringify)(Le)}return se}Ke=P.convert=ke;P.default=ke;export{Ke as c};
