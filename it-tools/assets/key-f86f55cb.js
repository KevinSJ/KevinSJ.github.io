const le={PasetoNotSupported:"ERR_PASETO_NOT_SUPPORTED",PasetoDecryptionFailed:"ERR_PASETO_DECRYPTION_FAILED",PasetoInvalid:"ERR_PASETO_INVALID",PasetoVerificationFailed:"ERR_PASETO_VERIFICATION_FAILED",PasetoPayloadInvalid:"ERR_PASETO_PAYLOAD_INVALID",PasetoClaimInvalid:"ERR_PASETO_CLAIM_INVALID",PasetoPurposeInvalid:"ERR_PASETO_PURPOSE_INVALID",PasetoFormatInvalid:"ERR_PASETO_FORMAT_INVALID",PasetoKeyInvalid:"ERR_PASETO_KEY_INVALID",PasetoTokenInvalid:"ERR_PASETO_TOKEN_INVALID",PasetoFooterInvalid:"ERR_PASETO_FOOTER_INVALID",PasetoSignatureInvalid:"ERR_PASETO_SIGNATURE_INVALID"};class rt extends Error{code;constructor(e){super(e),this.name=this.constructor.name,this.code=le[this.constructor.name]}}class Ve extends rt{}class Mt extends rt{}class xt extends rt{}class Q extends rt{}class fe extends rt{}class Ht extends rt{}class _t extends rt{}class dt extends rt{}class ze extends rt{}function ut(r){return!!r&&r.constructor==Object}function re(r,e){if(r.length!==e.length)return!1;let f=0;for(let t=0;t<r.length;t++)f|=r[t]^e[t];return f===0}function mt(r){return typeof r!="string"?!1:/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d{1,6})?(([+-]\d{2}:\d{2})|Z)$/.test(r)}function At(r){if(r.hasOwnProperty("kid")&&typeof r.kid!="string")throw new Q('Footer must have a valid "kid" claim (is not a string)');if(r.hasOwnProperty("wpk")&&typeof r.wpk!="string")throw new Q('Footer must have a valid "wpk" claim (is not a string)')}function Ce(r,e){if(typeof e=="string"&&e.startsWith(Rt.v4[r])||e instanceof Uint8Array&&re(e.subarray(0,$t.v4[r].length),$t.v4[r]))return e;throw new dt(`Invalid token format: must start with "${Rt.v4[r]}"`)}const xe=new TextDecoder,he=new TextEncoder;function tt(r){return he.encode(r)}function gt(r){return xe.decode(r)}function nt(...r){let e=0;for(const s of r)e+=s.length;const f=new Uint8Array(e);let t=0;for(const s of r)f.set(s,t),t+=s.length;return f}function Be(r){if(r instanceof Uint8Array)return r;if(typeof r=="string")try{return JSON.parse(r),tt(r)}catch{throw new Mt("Invalid payload. Payload must be a JSON string, object, or Uint8Array.")}else if(ut(r))return tt(JSON.stringify(r));throw new Mt("Invalid payload. Payload must be a JSON string, object, or Uint8Array.")}const Kt={v4:{local:"k4.local.",secret:"k4.secret.",public:"k4.public."}},Rt={v4:{local:"v4.local.",public:"v4.public."}},de={v4:{local:new Uint8Array([107,52,46,108,111,99,97,108,46]),secret:new Uint8Array([107,52,46,115,101,99,114,101,116,46]),public:new Uint8Array([107,52,46,112,117,98,108,105,99,46])}},$t={v4:{local:new Uint8Array([118,52,46,108,111,99,97,108,46]),public:new Uint8Array([118,52,46,112,117,98,108,105,99,46])}},Gt={v4:{local:32,secret:64,public:32}},ue=tt("paseto-encryption-key"),be=tt("paseto-auth-key-for-aead"),Ye=32,je=128;function _e(r){const e=r.split(" ");if(e.length!==2){const i=e[0].replace(/\d/g,""),o=parseInt(e[0].replace(/\D/g,""),10);e[0]=o.toString(),e[1]=i}const f=parseInt(e[0],10),t=e[1];let s=0;switch(t){case"s":case"sec":case"secs":case"second":case"seconds":s=f*1e3;break;case"m":case"min":case"mins":case"minute":case"minutes":s=f*1e3*60;break;case"h":case"hr":case"hrs":case"hour":case"hours":s=f*1e3*60*60;break;case"d":case"day":case"days":s=f*1e3*60*60*24;break;case"w":case"wk":case"wks":case"week":case"weeks":s=f*1e3*60*60*24*7;break;case"mo":case"mos":case"month":case"months":s=f*1e3*60*60*24*30;break;case"y":case"yr":case"yrs":case"year":case"years":s=f*1e3*60*60*24*365;break;default:throw new TypeError("Invalid time string")}return new Date(Date.now()+s)}function Ft(r){if(typeof r=="string"){const e=Date.parse(r);if(isNaN(e))try{return _e(r)}catch{throw new TypeError("Invalid date string")}return new Date(r)}else{if(typeof r=="number"&&!isNaN(r)&&isFinite(r))return new Date(r);if(r instanceof Date)return r;throw new TypeError("Time must be a string, number, or Date")}}const ye=new TextDecoder;function we(r){let e=r.replace(/\\"/g,"").replace(/\s+/g,"");if(e=e.replace(/"[^"]+"([:,\}\]])/g,"$1"),e=e.replace(/[^\[\{\}\]]/g,""),e.length===0)return 1;let f="",t=1;for(;e.length>0&&e!==f;)f=e,e=e.replace(/({}|\[\])/g,""),t++;if(e.length>0)throw new Error("Invalid JSON string");return t}function pe(r){return r.split(/[^\\]":/).length}function St(r,{maxDepth:e=10,maxKeys:f=100}){if(typeof r!="string")throw new xt(`JSON string must be a string (got ${typeof r}))`);if(e||f){const t=we(r),s=pe(r);if(e&&e>0&&t>e)throw new xt(`JSON string exceeds maximum depth of ${e}`);if(f&&f>0&&s>f)throw new xt(`JSON string exceeds maximum number of keys of ${f}`)}return!0}function We(r){if(!r)return"";r instanceof Uint8Array&&(r=ye.decode(r));try{return JSON.parse(r)}catch{return r}}function Et(r){if(!(r instanceof Uint8Array))throw new TypeError("Input must be a Uint8Array.");return btoa(String.fromCharCode(...r)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function bt(r){const e=ge(r),f=new Uint8Array(e.length);for(let t=0;t<e.length;t++)f[t]=e.charCodeAt(t);return f}function ge(r){if(typeof r!="string")throw new TypeError("Input must be a string.");switch(r=r.replace(/-/g,"+").replace(/_/g,"/"),r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw new Error("Invalid base64url string.")}return atob(r)}function Jt(r,e=0){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}function ft(r,e=0){return(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}function yt(r,e=new Uint8Array(4),f=0){return e[f+0]=r>>>24,e[f+1]=r>>>16,e[f+2]=r>>>8,e[f+3]=r>>>0,e}function me(r,e=new Uint8Array(4),f=0){return e[f+0]=r>>>0,e[f+1]=r>>>8,e[f+2]=r>>>16,e[f+3]=r>>>24,e}function D(r){for(let e=0;e<r.length;e++)r[e]=0;return r}const q=128,Ut=64,Ae=64,Ee=16,Ie=16,Le=Math.pow(2,32)-1,Pe=255,Se=255,Vt=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),U=[[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30],[28,20,8,16,18,30,26,12,2,24,0,4,22,14,10,6],[22,16,24,0,10,4,30,26,20,28,6,12,14,2,18,8],[14,18,6,2,26,24,22,28,4,12,10,20,8,0,30,16],[18,0,10,14,4,8,20,30,28,2,22,24,12,16,6,26],[4,24,12,20,0,22,16,6,8,26,14,10,30,28,2,18],[24,10,2,30,28,26,8,20,0,14,12,6,18,4,16,22],[26,22,14,28,24,2,6,18,10,0,30,8,16,12,4,20],[12,30,28,18,22,6,0,16,24,4,26,14,2,8,20,10],[20,4,16,8,14,12,2,10,30,22,18,28,6,24,26,0],[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30],[28,20,8,16,18,30,26,12,2,24,0,4,22,14,10,6]];class Ue{digestLength;blockSize=q;_state=new Int32Array(Vt);_buffer=new Uint8Array(q);_bufferLength=0;_ctr=new Uint32Array(4);_flag=new Uint32Array(4);_lastNode=!1;_finished=!1;_vtmp=new Uint32Array(32);_mtmp=new Uint32Array(32);_paddedKey;_initialState;constructor(e=64,f){if(this.digestLength=e,e<1||e>Ut)throw new Error("blake2b: wrong digest length");f&&this.validateConfig(f);let t=0;f&&f.key&&(t=f.key.length);let s=1,i=1;f&&f.tree&&(s=f.tree.fanout,i=f.tree.maxDepth),this._state[0]^=e|t<<8|s<<16|i<<24,f&&f.tree&&(this._state[1]^=f.tree.leafSize,this._state[2]^=f.tree.nodeOffsetLowBits,this._state[3]^=f.tree.nodeOffsetHighBits,this._state[4]^=f.tree.nodeDepth|f.tree.innerDigestLength<<8,this._lastNode=f.tree.lastNode),f&&f.salt&&(this._state[8]^=ft(f.salt,0),this._state[9]^=ft(f.salt,4),this._state[10]^=ft(f.salt,8),this._state[11]^=ft(f.salt,12)),f&&f.personalization&&(this._state[12]^=ft(f.personalization,0),this._state[13]^=ft(f.personalization,4),this._state[14]^=ft(f.personalization,8),this._state[15]^=ft(f.personalization,12)),this._initialState=new Uint32Array(this._state),f&&f.key&&t>0&&(this._paddedKey=new Uint8Array(q),this._paddedKey.set(f.key),this._buffer.set(this._paddedKey),this._bufferLength=q)}reset(){return this._state.set(this._initialState),this._paddedKey?(this._buffer.set(this._paddedKey),this._bufferLength=q):this._bufferLength=0,D(this._ctr),D(this._flag),this._finished=!1,this}validateConfig(e){if(e.key&&e.key.length>Ae)throw new Error("blake2b: wrong key length");if(e.salt&&e.salt.length!==Ie)throw new Error("blake2b: wrong salt length");if(e.personalization&&e.personalization.length!==Ee)throw new Error("blake2b: wrong personalization length");if(e.tree){if(e.tree.fanout<0||e.tree.fanout>Pe)throw new Error("blake2b: wrong tree fanout");if(e.tree.maxDepth<0||e.tree.maxDepth>Se)throw new Error("blake2b: wrong tree depth");if(e.tree.leafSize<0||e.tree.leafSize>Le)throw new Error("blake2b: wrong leaf size");if(e.tree.innerDigestLength<0||e.tree.innerDigestLength>Ut)throw new Error("blake2b: wrong tree inner digest length")}}update(e,f=e.length){if(this._finished)throw new Error("blake2b: can't update because hash was finished.");const t=q-this._bufferLength;let s=0;if(f===0)return this;if(f>t){for(let i=0;i<t;i++)this._buffer[this._bufferLength+i]=e[s+i];this._processBlock(q),s+=t,f-=t,this._bufferLength=0}for(;f>q;){for(let i=0;i<q;i++)this._buffer[i]=e[s+i];this._processBlock(q),s+=q,f-=q,this._bufferLength=0}for(let i=0;i<f;i++)this._buffer[this._bufferLength+i]=e[s+i];return this._bufferLength+=f,this}finish(e){if(!this._finished){for(let t=this._bufferLength;t<q;t++)this._buffer[t]=0;this._flag[0]=4294967295,this._flag[1]=4294967295,this._lastNode&&(this._flag[2]=4294967295,this._flag[3]=4294967295),this._processBlock(this._bufferLength),this._finished=!0}const f=this._buffer.subarray(0,64);for(let t=0;t<16;t++)me(this._state[t],f,t*4);return e.set(f.subarray(0,e.length)),this}digest(){const e=new Uint8Array(this.digestLength);return this.finish(e),e}clean(){D(this._vtmp),D(this._mtmp),D(this._state),D(this._buffer),D(this._initialState),this._paddedKey&&D(this._paddedKey),this._bufferLength=0,D(this._ctr),D(this._flag),this._lastNode=!1,this._finished=!1}saveState(){if(this._finished)throw new Error("blake2b: cannot save finished state");return{state:new Uint32Array(this._state),buffer:new Uint8Array(this._buffer),bufferLength:this._bufferLength,ctr:new Uint32Array(this._ctr),flag:new Uint32Array(this._flag),lastNode:this._lastNode,paddedKey:this._paddedKey?new Uint8Array(this._paddedKey):void 0,initialState:new Uint32Array(this._initialState)}}restoreState(e){return this._state.set(e.state),this._buffer.set(e.buffer),this._bufferLength=e.bufferLength,this._ctr.set(e.ctr),this._flag.set(e.flag),this._lastNode=e.lastNode,this._paddedKey&&D(this._paddedKey),this._paddedKey=e.paddedKey?new Uint8Array(e.paddedKey):void 0,this._initialState.set(e.initialState),this}cleanSavedState(e){D(e.state),D(e.buffer),D(e.initialState),e.paddedKey&&D(e.paddedKey),e.bufferLength=0,D(e.ctr),D(e.flag),e.lastNode=!1}_G(e,f,t,s,i,o,y,I,d,S,T,M,N){let E=e[f],w=e[o],A=e[t],g=e[y],L=e[s],p=e[I],m=e[i],P=e[d],b=E&65535,a=E>>>16,n=w&65535,u=w>>>16;b+=A&65535,a+=A>>>16,n+=g&65535,u+=g>>>16,a+=b>>>16,n+=a>>>16,u+=n>>>16,w=n&65535|u<<16,E=b&65535|a<<16,b=E&65535,a=E>>>16,n=w&65535,u=w>>>16,b+=S&65535,a+=S>>>16,n+=T&65535,u+=T>>>16,a+=b>>>16,n+=a>>>16,u+=n>>>16,w=n&65535|u<<16,E=b&65535|a<<16,m^=E,P^=w,b=P,P=m,m=b,b=L&65535,a=L>>>16,n=p&65535,u=p>>>16,b+=m&65535,a+=m>>>16,n+=P&65535,u+=P>>>16,a+=b>>>16,n+=a>>>16,u+=n>>>16,p=n&65535|u<<16,L=b&65535|a<<16,A^=L,g^=p,b=A<<8|g>>>24,A=g<<8|A>>>24,g=b,b=E&65535,a=E>>>16,n=w&65535,u=w>>>16,b+=A&65535,a+=A>>>16,n+=g&65535,u+=g>>>16,a+=b>>>16,n+=a>>>16,u+=n>>>16,w=n&65535|u<<16,E=b&65535|a<<16,b=E&65535,a=E>>>16,n=w&65535,u=w>>>16,b+=M&65535,a+=M>>>16,n+=N&65535,u+=N>>>16,a+=b>>>16,n+=a>>>16,u+=n>>>16,w=n&65535|u<<16,E=b&65535|a<<16,m^=E,P^=w,b=m<<16|P>>>16,m=P<<16|m>>>16,P=b,b=L&65535,a=L>>>16,n=p&65535,u=p>>>16,b+=m&65535,a+=m>>>16,n+=P&65535,u+=P>>>16,a+=b>>>16,n+=a>>>16,u+=n>>>16,p=n&65535|u<<16,L=b&65535|a<<16,A^=L,g^=p,b=g<<1|A>>>31,A=A<<1|g>>>31,g=b,e[f]=E,e[o]=w,e[t]=A,e[y]=g,e[s]=L,e[I]=p,e[i]=m,e[d]=P}_incrementCounter(e){for(let f=0;f<3;f++){let t=this._ctr[f]+e;if(this._ctr[f]=t>>>0,this._ctr[f]===t)return;e=1}}_processBlock(e){this._incrementCounter(e);let f=this._vtmp;f.set(this._state),f.set(Vt,16),f[12*2+0]^=this._ctr[0],f[12*2+1]^=this._ctr[1],f[13*2+0]^=this._ctr[2],f[13*2+1]^=this._ctr[3],f[14*2+0]^=this._flag[0],f[14*2+1]^=this._flag[1],f[15*2+0]^=this._flag[2],f[15*2+1]^=this._flag[3];let t=this._mtmp;for(let s=0;s<32;s++)t[s]=ft(this._buffer,s*4);for(let s=0;s<12;s++)this._G(f,0,8,16,24,1,9,17,25,t[U[s][0]],t[U[s][0]+1],t[U[s][1]],t[U[s][1]+1]),this._G(f,2,10,18,26,3,11,19,27,t[U[s][2]],t[U[s][2]+1],t[U[s][3]],t[U[s][3]+1]),this._G(f,4,12,20,28,5,13,21,29,t[U[s][4]],t[U[s][4]+1],t[U[s][5]],t[U[s][5]+1]),this._G(f,6,14,22,30,7,15,23,31,t[U[s][6]],t[U[s][6]+1],t[U[s][7]],t[U[s][7]+1]),this._G(f,0,10,20,30,1,11,21,31,t[U[s][8]],t[U[s][8]+1],t[U[s][9]],t[U[s][9]+1]),this._G(f,2,12,22,24,3,13,23,25,t[U[s][10]],t[U[s][10]+1],t[U[s][11]],t[U[s][11]+1]),this._G(f,4,14,16,26,5,15,17,27,t[U[s][12]],t[U[s][12]+1],t[U[s][13]],t[U[s][13]+1]),this._G(f,6,8,18,28,7,9,19,29,t[U[s][14]],t[U[s][14]+1],t[U[s][15]],t[U[s][15]+1]);for(let s=0;s<16;s++)this._state[s]^=f[s]^f[s+16]}}function zt(r,e=Ut,f){const t=new Ue(e,f);t.update(r);const s=t.digest();return t.clean(),s}function Xe(r,e,{version:f="v4"}={version:"v4"}){const t=Kt[f][r],s=de[f][r];if(!r||!e)throw new TypeError("Purpose and key are required.");if(typeof e!="string"&&!(e instanceof Uint8Array))throw new _t(`Invalid key data. Key data must be a string or Uint8Array and start with the UTF-8 string '${t}' for this purpose (${r}). Received: ${typeof e}.`);if(r!=="local"&&r!=="secret"&&r!=="public")throw new fe(`Invalid purpose. Must be one of 'local', 'secret' or 'public'. Received: ${r}`);if(typeof e=="string"){if(e.startsWith(Kt[f][r])===!1)throw new _t(`Invalid key (string). Key must start with ${t} to ensure it is a valid key for the given purpose. Received: ${e}`);e=bt(e.split(".")[2])}else{if(!re(e.subarray(0,9),s))throw new _t(`Invalid key. Key must start with the UTF-8 bytes ${s.toString()} to ensure it is a valid key for the given purpose.`);e=e.subarray(9)}if(e.byteLength!==Gt[f][r])throw new _t(`Invalid key. Key must be ${Gt[f][r]} bytes long.`);return e}function Ze(r){r instanceof Uint8Array&&(r=gt(r));const e=r.split(".");if(e.length>4)throw new dt(`Invalid token format: must contain 3 or 4 parts (is ${e.length})`);const f=bt(e[2]);if(f.length<64)throw new dt(`Invalid token format: payload must be at least 64 bytes (is ${f.length})`);const t=e[3]?bt(e[3]):new Uint8Array(0),s=f.subarray(0,-64),i=f.subarray(-64);return{payload:f,message:s,signature:i,footer:t}}function Qe(r){r instanceof Uint8Array&&(r=gt(r));const e=r.split(".");if(e.length>4)throw new dt(`Invalid token format: must contain 3 or 4 parts (is ${e.length})`);const f=bt(e[2]);if(f.length<32)throw new dt(`Invalid token format: payload must be at least 32 bytes (is ${f.length})`);const t=e[3]?bt(e[3]):new Uint8Array(0),s=f.slice(0,32),i=f.slice(-32),o=f.slice(32,-32);return{payload:f,nonce:s,tag:i,ciphertext:o,footer:t}}function qe(r,{addIat:e=!0,addExp:f=!0,maxDepth:t=32,maxKeys:s=128,validate:i=!0}={addIat:!0,addExp:!0,maxDepth:32,maxKeys:128,validate:!0}){let o;if(!ut(r)&&typeof r!="string"&&!(r instanceof Uint8Array))throw new xt("Payload must be valid JSON (is falsy)");const y=r instanceof Uint8Array?gt(r):r;if(typeof y=="string"){if(y.startsWith("[")||y.startsWith("["))throw new xt("Payload must be valid JSON (is an array)");try{St(y,{maxDepth:t,maxKeys:s}),o=JSON.parse(y)}catch{throw new xt("Payload must be valid JSON")}}else ut(r)&&(o=JSON.parse(JSON.stringify(r)));if(o.hasOwnProperty("iss")&&i&&typeof o.iss!="string")throw new Q('Payload must have a valid "iss" claim (is not a string)');if(o.hasOwnProperty("sub")&&i&&typeof o.sub!="string")throw new Q('Payload must have a valid "sub" claim (is not a string)');if(o.hasOwnProperty("aud")&&i&&typeof o.aud!="string")throw new Q('Payload must have a valid "aud" claim (is not a string)');const I=Date.now();if(o.hasOwnProperty("iat")&&i){const d=o.iat;if(!mt(d))throw new Q('Payload must have a valid "iat" claim (is not an ISO date)');if(Date.parse(d)>I)throw new Q('Payload must have a valid "iat" claim (is in the future)')}else e&&(o.iat=new Date().toISOString());if(o.hasOwnProperty("exp")&&i){let d=o.exp;try{d=Ft(d)}catch{throw new Q('Payload must have a valid "exp" claim (is not an date or a valid relative time string (e.g. "1 hour"))')}if(o.hasOwnProperty("iat")&&d<=Date.parse(o.iat))throw new Q('Payload must have a valid "exp" claim (is not greater than "iat")');if(d<=I)throw new Q('Payload must have a valid "exp" claim (has expired)');mt(o.exp)||(o.exp=new Date(d).toISOString())}else f&&(o.exp=new Date(I+36e5).toISOString());if(o.hasOwnProperty("nbf")&&i){let d=o.nbf;try{d=Ft(d)}catch{throw new Q('Payload must have a valid "nbf" claim (is not an date or a valid relative time string (e.g. "1 hour"))')}if(o.hasOwnProperty("iat")&&d<Date.parse(o.iat))throw new Q('Payload must have a valid "nbf" claim (is not greater than "iat")');if(d>I)throw new Q('Payload must have a valid "nbf" claim (is in the future)');mt(o.nbf)||(o.nbf=new Date(d).toISOString())}if(o.hasOwnProperty("jti")&&i&&typeof o.jti!="string")throw new Q('Payload must have a valid "jti" claim (is not a string)');return o}function tf(r,{maxDepth:e=32,maxKeys:f=128,validate:t=!0}={maxDepth:32,maxKeys:128,validate:!0}){if(typeof r=="string"){if(r.startsWith("{")&&r.endsWith("}")){St(r,{maxDepth:e,maxKeys:f});const s=JSON.parse(r);t&&At(s)}return tt(r)}else{if(ut(r))return t&&At(r),tt(JSON.stringify(r));if(r instanceof Uint8Array){const s=gt(r);if(s.startsWith("{")&&s.endsWith("}")&&t){St(s,{maxDepth:e,maxKeys:f});const i=JSON.parse(s);At(i)}return r}}throw new TypeError("Footer must be a string, Uint8Array, or object")}function ef(r){if(typeof r=="string")return tt(r);if(r instanceof Uint8Array)return r;if(ut(r))return tt(JSON.stringify(r));throw new TypeError("Assertion must be a string or Uint8Array")}function ff(r,e){const f=zt(nt(ue,e),56,{key:r}),t=f.slice(0,32),s=f.slice(32),i=zt(nt(be,e),32,{key:r});return{encryptionKey:t,counterNonce:s,authKey:i}}function Ct(r){let e=new Uint8Array(8);for(let f=0;f<8;++f)f===7&&(r&=127),e[f]=r&255,r=r>>>8;return e}function rf(...r){let e=r.length,f=nt(Ct(e));for(let t=0;t<e;t++){if(!(r[t]instanceof Uint8Array))throw new TypeError("PAE expects Uint8Array arguments");f=nt(f,Ct(r[t].length),r[t])}return f}const Bt=65536;class Te{isAvailable=!1;isInstantiated=!1;constructor(){typeof crypto<"u"&&"getRandomValues"in crypto&&(this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");const f=new Uint8Array(e);for(let t=0;t<f.length;t+=Bt)crypto.getRandomValues(f.subarray(t,t+Math.min(f.length-t,Bt)));return f}}const ke=new Te;function Oe(r,e=ke){return e.randomBytes(r)}const ve=64,Yt=128;class vt{digestLength=ve;blockSize=Yt;_stateHi=new Int32Array(8);_stateLo=new Int32Array(8);_tempHi=new Int32Array(16);_tempLo=new Int32Array(16);_buffer=new Uint8Array(256);_bufferLength=0;_bytesHashed=0;_finished=!1;constructor(){this.reset()}_initState(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209}reset(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this}clean(){D(this._buffer),D(this._tempHi),D(this._tempLo),this.reset()}update(e,f=e.length){if(this._finished)throw new Error("SHA512: can't update because hash was finished.");let t=0;if(this._bytesHashed+=f,this._bufferLength>0){for(;this._bufferLength<Yt&&f>0;)this._buffer[this._bufferLength++]=e[t++],f--;this._bufferLength===this.blockSize&&(It(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(f>=this.blockSize&&(t=It(this._tempHi,this._tempLo,this._stateHi,this._stateLo,e,t,f),f%=this.blockSize);f>0;)this._buffer[this._bufferLength++]=e[t++],f--;return this}finish(e){if(!this._finished){const f=this._bytesHashed,t=this._bufferLength,s=f/536870912|0,i=f<<3,o=f%128<112?128:256;this._buffer[t]=128;for(let y=t+1;y<o-8;y++)this._buffer[y]=0;yt(s,this._buffer,o-8),yt(i,this._buffer,o-4),It(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,o),this._finished=!0}for(let f=0;f<this.digestLength/8;f++)yt(this._stateHi[f],e,f*8),yt(this._stateLo[f],e,f*8+4);return this}digest(){const e=new Uint8Array(this.digestLength);return this.finish(e),e}saveState(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}}restoreState(e){return this._stateHi.set(e.stateHi),this._stateLo.set(e.stateLo),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this}cleanSavedState(e){D(e.stateHi),D(e.stateLo),e.buffer&&D(e.buffer),e.bufferLength=0,e.bytesHashed=0}}const jt=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function It(r,e,f,t,s,i,o){let y=f[0],I=f[1],d=f[2],S=f[3],T=f[4],M=f[5],N=f[6],E=f[7],w=t[0],A=t[1],g=t[2],L=t[3],p=t[4],m=t[5],P=t[6],b=t[7],a,n,u,O,x,c,l,h;for(;o>=128;){for(let H=0;H<16;H++){const et=8*H+i;r[H]=Jt(s,et),e[H]=Jt(s,et+4)}for(let H=0;H<80;H++){let et=y,it=I,ht=d,ot=S,G=T,F=M,J=N,R=E,V=w,z=A,C=g,K=L,B=p,Y=m,j=P,$=b;if(a=E,n=b,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=(T>>>14|p<<32-14)^(T>>>18|p<<32-18)^(p>>>41-32|T<<32-(41-32)),n=(p>>>14|T<<32-14)^(p>>>18|T<<32-18)^(T>>>41-32|p<<32-(41-32)),x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,a=T&M^~T&N,n=p&m^~p&P,x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,a=jt[H*2],n=jt[H*2+1],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,a=r[H%16],n=e[H%16],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,u=l&65535|h<<16,O=x&65535|c<<16,a=u,n=O,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=(y>>>28|w<<32-28)^(w>>>34-32|y<<32-(34-32))^(w>>>39-32|y<<32-(39-32)),n=(w>>>28|y<<32-28)^(y>>>34-32|w<<32-(34-32))^(y>>>39-32|w<<32-(39-32)),x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,a=y&I^y&d^I&d,n=w&A^w&g^A&g,x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,R=l&65535|h<<16,$=x&65535|c<<16,a=ot,n=K,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=u,n=O,x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,ot=l&65535|h<<16,K=x&65535|c<<16,I=et,d=it,S=ht,T=ot,M=G,N=F,E=J,y=R,A=V,g=z,L=C,p=K,m=B,P=Y,b=j,w=$,H%16===15)for(let k=0;k<16;k++)a=r[k],n=e[k],x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=r[(k+9)%16],n=e[(k+9)%16],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,u=r[(k+1)%16],O=e[(k+1)%16],a=(u>>>1|O<<32-1)^(u>>>8|O<<32-8)^u>>>7,n=(O>>>1|u<<32-1)^(O>>>8|u<<32-8)^(O>>>7|u<<32-7),x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,u=r[(k+14)%16],O=e[(k+14)%16],a=(u>>>19|O<<32-19)^(O>>>61-32|u<<32-(61-32))^u>>>6,n=(O>>>19|u<<32-19)^(u>>>61-32|O<<32-(61-32))^(O>>>6|u<<32-6),x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,r[k]=l&65535|h<<16,e[k]=x&65535|c<<16}a=y,n=w,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=f[0],n=t[0],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,f[0]=y=l&65535|h<<16,t[0]=w=x&65535|c<<16,a=I,n=A,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=f[1],n=t[1],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,f[1]=I=l&65535|h<<16,t[1]=A=x&65535|c<<16,a=d,n=g,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=f[2],n=t[2],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,f[2]=d=l&65535|h<<16,t[2]=g=x&65535|c<<16,a=S,n=L,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=f[3],n=t[3],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,f[3]=S=l&65535|h<<16,t[3]=L=x&65535|c<<16,a=T,n=p,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=f[4],n=t[4],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,f[4]=T=l&65535|h<<16,t[4]=p=x&65535|c<<16,a=M,n=m,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=f[5],n=t[5],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,f[5]=M=l&65535|h<<16,t[5]=m=x&65535|c<<16,a=N,n=P,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=f[6],n=t[6],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,f[6]=N=l&65535|h<<16,t[6]=P=x&65535|c<<16,a=E,n=b,x=n&65535,c=n>>>16,l=a&65535,h=a>>>16,a=f[7],n=t[7],x+=n&65535,c+=n>>>16,l+=a&65535,h+=a>>>16,c+=x>>>16,l+=c>>>16,h+=l>>>16,f[7]=E=l&65535|h<<16,t[7]=b=x&65535|c<<16,i+=128,o-=128}return i}function se(r){const e=new vt;e.update(r);const f=e.digest();return e.clean(),f}const Wt=64,Xt=64,Zt=32;function _(r){const e=new Float64Array(16);if(r)for(let f=0;f<r.length;f++)e[f]=r[f];return e}const Ne=new Uint8Array(32);Ne[0]=9;const Tt=_(),wt=_([1]),De=_([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),Me=_([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),Qt=_([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),qt=_([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),He=_([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function st(r,e){for(let f=0;f<16;f++)r[f]=e[f]|0}function Lt(r){let e=1;for(let f=0;f<16;f++){let t=r[f]+e+65535;e=Math.floor(t/65536),r[f]=t-e*65536}r[0]+=e-1+37*(e-1)}function ae(r,e,f){const t=~(f-1);for(let s=0;s<16;s++){const i=t&(r[s]^e[s]);r[s]^=i,e[s]^=i}}function pt(r,e){const f=_(),t=_();for(let s=0;s<16;s++)t[s]=e[s];Lt(t),Lt(t),Lt(t);for(let s=0;s<2;s++){f[0]=t[0]-65517;for(let o=1;o<15;o++)f[o]=t[o]-65535-(f[o-1]>>16&1),f[o-1]&=65535;f[15]=t[15]-32767-(f[14]>>16&1);const i=f[15]>>16&1;f[14]&=65535,ae(t,f,1-i)}for(let s=0;s<16;s++)r[2*s]=t[s]&255,r[2*s+1]=t[s]>>8}function ne(r,e){let f=0;for(let t=0;t<32;t++)f|=r[t]^e[t];return(1&f-1>>>8)-1}function te(r,e){const f=new Uint8Array(32),t=new Uint8Array(32);return pt(f,r),pt(t,e),ne(f,t)}function ie(r){const e=new Uint8Array(32);return pt(e,r),e[0]&1}function Ke(r,e){for(let f=0;f<16;f++)r[f]=e[2*f]+(e[2*f+1]<<8);r[15]&=32767}function ct(r,e,f){for(let t=0;t<16;t++)r[t]=e[t]+f[t]}function lt(r,e,f){for(let t=0;t<16;t++)r[t]=e[t]-f[t]}function v(r,e,f){let t,s,i=0,o=0,y=0,I=0,d=0,S=0,T=0,M=0,N=0,E=0,w=0,A=0,g=0,L=0,p=0,m=0,P=0,b=0,a=0,n=0,u=0,O=0,x=0,c=0,l=0,h=0,H=0,et=0,it=0,ht=0,ot=0,G=f[0],F=f[1],J=f[2],R=f[3],V=f[4],z=f[5],C=f[6],K=f[7],B=f[8],Y=f[9],j=f[10],$=f[11],k=f[12],W=f[13],X=f[14],Z=f[15];t=e[0],i+=t*G,o+=t*F,y+=t*J,I+=t*R,d+=t*V,S+=t*z,T+=t*C,M+=t*K,N+=t*B,E+=t*Y,w+=t*j,A+=t*$,g+=t*k,L+=t*W,p+=t*X,m+=t*Z,t=e[1],o+=t*G,y+=t*F,I+=t*J,d+=t*R,S+=t*V,T+=t*z,M+=t*C,N+=t*K,E+=t*B,w+=t*Y,A+=t*j,g+=t*$,L+=t*k,p+=t*W,m+=t*X,P+=t*Z,t=e[2],y+=t*G,I+=t*F,d+=t*J,S+=t*R,T+=t*V,M+=t*z,N+=t*C,E+=t*K,w+=t*B,A+=t*Y,g+=t*j,L+=t*$,p+=t*k,m+=t*W,P+=t*X,b+=t*Z,t=e[3],I+=t*G,d+=t*F,S+=t*J,T+=t*R,M+=t*V,N+=t*z,E+=t*C,w+=t*K,A+=t*B,g+=t*Y,L+=t*j,p+=t*$,m+=t*k,P+=t*W,b+=t*X,a+=t*Z,t=e[4],d+=t*G,S+=t*F,T+=t*J,M+=t*R,N+=t*V,E+=t*z,w+=t*C,A+=t*K,g+=t*B,L+=t*Y,p+=t*j,m+=t*$,P+=t*k,b+=t*W,a+=t*X,n+=t*Z,t=e[5],S+=t*G,T+=t*F,M+=t*J,N+=t*R,E+=t*V,w+=t*z,A+=t*C,g+=t*K,L+=t*B,p+=t*Y,m+=t*j,P+=t*$,b+=t*k,a+=t*W,n+=t*X,u+=t*Z,t=e[6],T+=t*G,M+=t*F,N+=t*J,E+=t*R,w+=t*V,A+=t*z,g+=t*C,L+=t*K,p+=t*B,m+=t*Y,P+=t*j,b+=t*$,a+=t*k,n+=t*W,u+=t*X,O+=t*Z,t=e[7],M+=t*G,N+=t*F,E+=t*J,w+=t*R,A+=t*V,g+=t*z,L+=t*C,p+=t*K,m+=t*B,P+=t*Y,b+=t*j,a+=t*$,n+=t*k,u+=t*W,O+=t*X,x+=t*Z,t=e[8],N+=t*G,E+=t*F,w+=t*J,A+=t*R,g+=t*V,L+=t*z,p+=t*C,m+=t*K,P+=t*B,b+=t*Y,a+=t*j,n+=t*$,u+=t*k,O+=t*W,x+=t*X,c+=t*Z,t=e[9],E+=t*G,w+=t*F,A+=t*J,g+=t*R,L+=t*V,p+=t*z,m+=t*C,P+=t*K,b+=t*B,a+=t*Y,n+=t*j,u+=t*$,O+=t*k,x+=t*W,c+=t*X,l+=t*Z,t=e[10],w+=t*G,A+=t*F,g+=t*J,L+=t*R,p+=t*V,m+=t*z,P+=t*C,b+=t*K,a+=t*B,n+=t*Y,u+=t*j,O+=t*$,x+=t*k,c+=t*W,l+=t*X,h+=t*Z,t=e[11],A+=t*G,g+=t*F,L+=t*J,p+=t*R,m+=t*V,P+=t*z,b+=t*C,a+=t*K,n+=t*B,u+=t*Y,O+=t*j,x+=t*$,c+=t*k,l+=t*W,h+=t*X,H+=t*Z,t=e[12],g+=t*G,L+=t*F,p+=t*J,m+=t*R,P+=t*V,b+=t*z,a+=t*C,n+=t*K,u+=t*B,O+=t*Y,x+=t*j,c+=t*$,l+=t*k,h+=t*W,H+=t*X,et+=t*Z,t=e[13],L+=t*G,p+=t*F,m+=t*J,P+=t*R,b+=t*V,a+=t*z,n+=t*C,u+=t*K,O+=t*B,x+=t*Y,c+=t*j,l+=t*$,h+=t*k,H+=t*W,et+=t*X,it+=t*Z,t=e[14],p+=t*G,m+=t*F,P+=t*J,b+=t*R,a+=t*V,n+=t*z,u+=t*C,O+=t*K,x+=t*B,c+=t*Y,l+=t*j,h+=t*$,H+=t*k,et+=t*W,it+=t*X,ht+=t*Z,t=e[15],m+=t*G,P+=t*F,b+=t*J,a+=t*R,n+=t*V,u+=t*z,O+=t*C,x+=t*K,c+=t*B,l+=t*Y,h+=t*j,H+=t*$,et+=t*k,it+=t*W,ht+=t*X,ot+=t*Z,i+=38*P,o+=38*b,y+=38*a,I+=38*n,d+=38*u,S+=38*O,T+=38*x,M+=38*c,N+=38*l,E+=38*h,w+=38*H,A+=38*et,g+=38*it,L+=38*ht,p+=38*ot,s=1,t=i+s+65535,s=Math.floor(t/65536),i=t-s*65536,t=o+s+65535,s=Math.floor(t/65536),o=t-s*65536,t=y+s+65535,s=Math.floor(t/65536),y=t-s*65536,t=I+s+65535,s=Math.floor(t/65536),I=t-s*65536,t=d+s+65535,s=Math.floor(t/65536),d=t-s*65536,t=S+s+65535,s=Math.floor(t/65536),S=t-s*65536,t=T+s+65535,s=Math.floor(t/65536),T=t-s*65536,t=M+s+65535,s=Math.floor(t/65536),M=t-s*65536,t=N+s+65535,s=Math.floor(t/65536),N=t-s*65536,t=E+s+65535,s=Math.floor(t/65536),E=t-s*65536,t=w+s+65535,s=Math.floor(t/65536),w=t-s*65536,t=A+s+65535,s=Math.floor(t/65536),A=t-s*65536,t=g+s+65535,s=Math.floor(t/65536),g=t-s*65536,t=L+s+65535,s=Math.floor(t/65536),L=t-s*65536,t=p+s+65535,s=Math.floor(t/65536),p=t-s*65536,t=m+s+65535,s=Math.floor(t/65536),m=t-s*65536,i+=s-1+37*(s-1),s=1,t=i+s+65535,s=Math.floor(t/65536),i=t-s*65536,t=o+s+65535,s=Math.floor(t/65536),o=t-s*65536,t=y+s+65535,s=Math.floor(t/65536),y=t-s*65536,t=I+s+65535,s=Math.floor(t/65536),I=t-s*65536,t=d+s+65535,s=Math.floor(t/65536),d=t-s*65536,t=S+s+65535,s=Math.floor(t/65536),S=t-s*65536,t=T+s+65535,s=Math.floor(t/65536),T=t-s*65536,t=M+s+65535,s=Math.floor(t/65536),M=t-s*65536,t=N+s+65535,s=Math.floor(t/65536),N=t-s*65536,t=E+s+65535,s=Math.floor(t/65536),E=t-s*65536,t=w+s+65535,s=Math.floor(t/65536),w=t-s*65536,t=A+s+65535,s=Math.floor(t/65536),A=t-s*65536,t=g+s+65535,s=Math.floor(t/65536),g=t-s*65536,t=L+s+65535,s=Math.floor(t/65536),L=t-s*65536,t=p+s+65535,s=Math.floor(t/65536),p=t-s*65536,t=m+s+65535,s=Math.floor(t/65536),m=t-s*65536,i+=s-1+37*(s-1),r[0]=i,r[1]=o,r[2]=y,r[3]=I,r[4]=d,r[5]=S,r[6]=T,r[7]=M,r[8]=N,r[9]=E,r[10]=w,r[11]=A,r[12]=g,r[13]=L,r[14]=p,r[15]=m}function at(r,e){v(r,e,e)}function Re(r,e){const f=_();let t;for(t=0;t<16;t++)f[t]=e[t];for(t=253;t>=0;t--)at(f,f),t!==2&&t!==4&&v(f,f,e);for(t=0;t<16;t++)r[t]=f[t]}function $e(r,e){const f=_();let t;for(t=0;t<16;t++)f[t]=e[t];for(t=250;t>=0;t--)at(f,f),t!==1&&v(f,f,e);for(t=0;t<16;t++)r[t]=f[t]}function kt(r,e){const f=_(),t=_(),s=_(),i=_(),o=_(),y=_(),I=_(),d=_(),S=_();lt(f,r[1],r[0]),lt(S,e[1],e[0]),v(f,f,S),ct(t,r[0],r[1]),ct(S,e[0],e[1]),v(t,t,S),v(s,r[3],e[3]),v(s,s,Me),v(i,r[2],e[2]),ct(i,i,i),lt(o,t,f),lt(y,i,s),ct(I,i,s),ct(d,t,f),v(r[0],o,y),v(r[1],d,I),v(r[2],I,y),v(r[3],o,d)}function ee(r,e,f){for(let t=0;t<4;t++)ae(r[t],e[t],f)}function Nt(r,e){const f=_(),t=_(),s=_();Re(s,e[2]),v(f,e[0],s),v(t,e[1],s),pt(r,t),r[31]^=ie(f)<<7}function oe(r,e,f){st(r[0],Tt),st(r[1],wt),st(r[2],wt),st(r[3],Tt);for(let t=255;t>=0;--t){const s=f[t/8|0]>>(t&7)&1;ee(r,e,s),kt(e,r),kt(r,r),ee(r,e,s)}}function Dt(r,e){const f=[_(),_(),_(),_()];st(f[0],Qt),st(f[1],qt),st(f[2],wt),v(f[3],Qt,qt),oe(r,f,e)}function Ge(r){if(r.length!==Zt)throw new Error(`ed25519: seed must be ${Zt} bytes`);const e=se(r);e[0]&=248,e[31]&=127,e[31]|=64;const f=new Uint8Array(32),t=[_(),_(),_(),_()];Dt(t,e),Nt(f,t);const s=new Uint8Array(64);return s.set(r),s.set(f,32),{publicKey:f,secretKey:s}}function Fe(r){const e=Oe(32,r),f=Ge(e);return D(e),f}const Pt=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function ce(r,e){let f,t,s,i;for(t=63;t>=32;--t){for(f=0,s=t-32,i=t-12;s<i;++s)e[s]+=f-16*e[t]*Pt[s-(t-32)],f=Math.floor((e[s]+128)/256),e[s]-=f*256;e[s]+=f,e[t]=0}for(f=0,s=0;s<32;s++)e[s]+=f-(e[31]>>4)*Pt[s],f=e[s]>>8,e[s]&=255;for(s=0;s<32;s++)e[s]-=f*Pt[s];for(t=0;t<32;t++)e[t+1]+=e[t]>>8,r[t]=e[t]&255}function Ot(r){const e=new Float64Array(64);for(let f=0;f<64;f++)e[f]=r[f];for(let f=0;f<64;f++)r[f]=0;ce(r,e)}function sf(r,e){if(r.length!==Xt)throw new Error(`ed25519: secret key must be ${Xt} bytes`);const f=new Float64Array(64),t=[_(),_(),_(),_()],s=se(r.subarray(0,32));s[0]&=248,s[31]&=127,s[31]|=64;const i=new Uint8Array(64);i.set(s.subarray(32),32);const o=new vt;o.update(i.subarray(32)),o.update(e);const y=o.digest();o.clean(),Ot(y),Dt(t,y),Nt(i,t),o.reset(),o.update(i.subarray(0,32)),o.update(r.subarray(32)),o.update(e);const I=o.digest();Ot(I);for(let d=0;d<32;d++)f[d]=y[d];for(let d=0;d<32;d++)for(let S=0;S<32;S++)f[d+S]+=I[d]*s[S];return ce(i.subarray(32),f),i}function Je(r,e){const f=_(),t=_(),s=_(),i=_(),o=_(),y=_(),I=_();return st(r[2],wt),Ke(r[1],e),at(s,r[1]),v(i,s,De),lt(s,s,r[2]),ct(i,r[2],i),at(o,i),at(y,o),v(I,y,o),v(f,I,s),v(f,f,i),$e(f,f),v(f,f,s),v(f,f,i),v(f,f,i),v(r[0],f,i),at(t,r[0]),v(t,t,i),te(t,s)&&v(r[0],r[0],He),at(t,r[0]),v(t,t,i),te(t,s)?-1:(ie(r[0])===e[31]>>7&&lt(r[0],Tt,r[0]),v(r[3],r[0],r[1]),0)}function af(r,e,f){const t=new Uint8Array(32),s=[_(),_(),_(),_()],i=[_(),_(),_(),_()];if(f.length!==Wt)throw new Error(`ed25519: signature must be ${Wt} bytes`);if(Je(i,r))return!1;const o=new vt;o.update(f.subarray(0,32)),o.update(r),o.update(e);const y=o.digest();return Ot(y),oe(s,i,y),Dt(i,f.subarray(32)),kt(s,i),Nt(t,s),!ne(f,t)}function nf(r,e={format:"paserk"}){let f;const t=e?.format??"paserk",s=e?.getRandomValues??(typeof globalThis<"u"&&globalThis.crypto?.getRandomValues?globalThis.crypto.getRandomValues.bind(globalThis.crypto):void 0);if(!s)throw new Error("No compatible getRandomValues implementation detected in the global scope. Please pass a getRandomValues implementation to the options object (signature: getRandomValues<Uint8Array>(array: Uint8Array): Uint8Array)");switch(r){case"local":const i=s(new Uint8Array(32));if(i===null)throw new Error("getRandomValues returned an invalid length Uint8Array");switch(t){case"paserk":f=`k4.local.${Et(i)}`;break;case"buffer":f=nt(tt("k4.local."),i);break;default:throw new Ht(`Invalid format: ${t}`)}break;case"public":const o=Fe();switch(t){case"paserk":f={secretKey:`k4.secret.${Et(o.secretKey)}`,publicKey:`k4.public.${Et(o.publicKey)}`};break;case"buffer":f={secretKey:nt(tt("k4.secret."),o.secretKey),publicKey:nt(tt("k4.public."),o.publicKey)};break;default:throw new Ht(`Invalid format: ${t}`)}break;default:throw new fe(`Invalid purpose: ${r}`)}return f}export{Ye as M,rf as P,Rt as T,Be as a,qe as b,tf as c,ef as d,Et as e,nt as f,je as g,$t as h,Ze as i,af as j,ze as k,nf as l,me as m,Qe as n,ff as o,Xe as p,zt as q,We as r,sf as s,re as t,gt as u,Ce as v,D as w,Ve as x};
