import{c as B,i as w}from"./style-ynO7IsM1.js";import"./version-BXrBJCm5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-C6L5gDe0.js";import{a as y,i as x,r as z,d as I,f as b}from"./main-CdZmBCMR.js";import{J as S}from"./jszip.min-eEAMQJTJ.js";import"./mobileMenu-BoMunYmR.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const f={files:[]};function E(){f.files=[];const e=document.getElementById("file-display-area");e&&(e.innerHTML="");const t=document.getElementById("tool-options");t&&t.classList.add("hidden");const n=document.getElementById("file-controls");n&&n.classList.add("hidden");const a=document.getElementById("file-input");a&&(a.value="")}async function v(){const e=document.getElementById("file-display-area"),t=document.getElementById("tool-options"),n=document.getElementById("file-controls");e&&(e.innerHTML="",f.files.length>0?(f.files.forEach((a,o)=>{const s=document.createElement("div");s.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const i=document.createElement("div");i.className="flex flex-col overflow-hidden";const r=document.createElement("div");r.className="truncate font-medium text-gray-200 text-sm mb-1",r.textContent=a.name;const d=document.createElement("div");d.className="text-xs text-gray-400",d.textContent=b(a.size),i.append(r,d);const l=document.createElement("button");l.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",l.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',l.onclick=function(){f.files.splice(o,1),v()},s.append(i,l),e.appendChild(s)}),B({icons:w}),t&&t.classList.remove("hidden"),n&&n.classList.remove("hidden")):(t&&t.classList.add("hidden"),n&&n.classList.add("hidden")))}function h(e){if(e&&e.length>0){const t=Array.from(e).filter(n=>n.type==="application/pdf"||n.name.toLowerCase().endsWith(".pdf"));t.length>0&&(f.files.push(...t),v())}}async function C(){const e=f.files.filter(r=>r.type==="application/pdf");if(!e||e.length===0){y("No PDF Files","Please upload at least one PDF file.");return}const t=document.getElementById("loader-modal"),n=document.getElementById("loader-text");t&&t.classList.remove("hidden"),n&&(n.textContent="Optimizing PDFs for web view (linearizing)...");const a=new S;let o,s=0,i=0;try{o=await x();for(let l=0;l<e.length;l++){const c=e[l],u=`/input_${l}.pdf`,p=`/output_${l}.pdf`;n&&(n.textContent=`Optimizing ${c.name} (${l+1}/${e.length})...`);try{const m=await z(c),L=new Uint8Array(m);o.FS.writeFile(u,L);const F=[u,"--linearize",p];o.callMain(F);const g=o.FS.readFile(p,{encoding:"binary"});if(!g||g.length===0)throw console.error(`Linearization resulted in an empty file for ${c.name}.`),new Error(`Processing failed for ${c.name}.`);a.file(`linearized-${c.name}`,g,{binary:!0}),s++}catch(m){i++,console.error(`Failed to linearize ${c.name}:`,m)}finally{try{o?.FS&&(o.FS.analyzePath(u).exists&&o.FS.unlink(u),o.FS.analyzePath(p).exists&&o.FS.unlink(p))}catch(m){console.warn(`Failed to cleanup WASM FS for ${c.name}:`,m)}}}if(s===0)throw new Error("No PDF files could be linearized.");n&&(n.textContent="Generating ZIP file...");const r=await a.generateAsync({type:"blob"});I(r,"linearized-pdfs.zip");let d=`${s} PDF(s) linearized successfully.`;i>0&&(d+=` ${i} file(s) failed.`),y("Processing Complete",d,"success",()=>{E()})}catch(r){console.error("Linearization process error:",r),y("Linearization Failed",`An error occurred: ${r.message||"Unknown error"}.`)}finally{t&&t.classList.add("hidden")}}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("file-input"),t=document.getElementById("drop-zone"),n=document.getElementById("process-btn"),a=document.getElementById("add-more-btn"),o=document.getElementById("clear-files-btn"),s=document.getElementById("back-to-tools");s&&s.addEventListener("click",function(){window.location.href="/itools/"}),e&&t&&(e.addEventListener("change",function(i){h(i.target.files)}),t.addEventListener("dragover",function(i){i.preventDefault(),t.classList.add("bg-gray-700")}),t.addEventListener("dragleave",function(i){i.preventDefault(),t.classList.remove("bg-gray-700")}),t.addEventListener("drop",function(i){i.preventDefault(),t.classList.remove("bg-gray-700"),h(i.dataTransfer?.files)}),e.addEventListener("click",function(){e.value=""})),n&&n.addEventListener("click",C),a&&a.addEventListener("click",function(){e.value="",e.click()}),o&&o.addEventListener("click",function(){E()})});
