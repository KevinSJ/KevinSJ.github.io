import{B as G}from"./index-a6f01dde.js";var y={},B={exports:{}};(function(r,e){(function(i){r.exports=i()})(function(){var i=function(){var f=[Object,Function,Array,String,Boolean,Number,Date,RegExp,Error],c=f.length;return function(p){for(var u=0;u<c;u++)if(f[u]===p)return!0;return!1}}(),n=function(){var f={}.toString;return function(c){var p=f.call(c).slice(8,-1);if(c==null)return p.toLowerCase();var u=a(c);return u&&!i(u)?u.name:p}}();function a(f){return f==null?f:f.constructor}function t(f,c){var p=a(c)===String?n:a;return p(f)===c}function l(f,c){return f instanceof c}function o(f,c){return l(f.prototype,c)}function s(f,c){if(!t(c,Array))throw"Second argument to .any() should be array";for(var p=0;p<c.length;p++){var u=c[p];if(t(f,u))return!0}return!1}var g=function(f,c){return arguments.length==1?a(f):t(c,Array)?s(f,c):t(f,c)};return g.instance=l,g.string=n,g.of=a,g.is=t,g.any=s,g.extension=o,g})})(B);var N=B.exports,T={},U=/\d{4}-\d{2}-\d{2}/;T.isNumber=function(r){return typeof r=="number"||Object.prototype.toString.call(r)==="[object Number]"};T.isDate=function(r){return new Date(r).toString()!=="Invalid Date"&&!isNaN(new Date(r))};T.isTimestamp=function(r){return r.length>18&&!isNaN(new Date(r).getTime())};T.isDateString=function(r){return r.match(U)};T.arrayLastItem=function(r){return r[r.length-1]};var X=N,F=T,K=function r(e,i){i=i||{};for(var n in e){var a=e[n],t=X.string(a).toLowerCase();t==="undefined"&&(t="null"),t==="string"&&F.isDate(a)&&(t="date"),t!=="object"?i[n]={type:t}:(i[n]=r(e[n]),i[n].type=t)}return i},P=N,Y=T;function $(r){switch(r){case"array":return"Array";case"buffer":return"Buffer";case"boolean":return"Boolean";case"date":return"Date";case"number":return"Number";case"string":return"String";case"objectid":return"ObjectId";case"null":case"undefined":case"regexp":default:return"Mixed"}}var z=function r(e,n){var n=n||{};for(var a in e){var t=e[a],l=null,o=null,s=null;if(t instanceof G&&(s="buffer"),t!=null&&typeof t.toString<"u"&&t.toString().match(/^[0-9a-fA-F]{24}$/)&&(s="objectid"),s||(s=P.string(t).toLowerCase()),s==="string"&&Y.isDate(t)&&(s="date"),s==="object")n[a]=r(e[a]);else{if(s==="undefined"&&(s="null"),s==="array"&&t.length){l=s,s=void 0;for(var g=0,f=t.length;g<f;g++)if(o=P.string(t[g]).toLowerCase(),s&&o!==s){s="mixed";break}else s=o}l&&l==="array"?n[a]={type:[$(s)]}:n[a]={type:$(s)}}}return n},x=T;function H(r){return Array.isArray(r)?"REPEATED":"NULLABLE"}function M(r){if(Array.isArray(r))return M(r[0]);if(r instanceof Date)return"TIMESTAMP";if(typeof r=="object")return"RECORD";if(typeof r=="boolean")return"BOOLEAN";if(typeof r=="string"){if(x.isDateString(r))return"DATE";if(x.isTimestamp(r))return"TIMESTAMP"}return isNaN(r)?"STRING":Number.isInteger(parseFloat(r))?"INTEGER":"FLOAT"}function q(r){return Object.keys(r).map(function(e){var i=r[e],n={name:e,type:M(r[e]),mode:H(r[e])};return n.type==="RECORD"&&(n.fields=q(n.mode==="REPEATED"?i[0]:i)),n})}var J=function(e){return q(e)},Q=N,j=T,D={boolean:"BOOLEAN",string:"TEXT",number:"INT",date:"DATE",timestamp:"TIMESTAMP",regexp:"TEXT",undefined:"TEXT",null:"TEXT"},h={create:function(r){return["CREATE TABLE ",r," ("].join("")},close:function(){return");"},id:function(r,e){return["  ",r,"_id ",e,","].join("")},property:function(r,e){return["  ",r," ",e,","].join("")},primary:function(r){return["  PRIMARY KEY (",r,"),"].join("")},foreign:function(r,e,i){return["  FOREIGN KEY (",r,") REFERENCES ",e,"(",i,"),"].join("")}};function O(r,e){var i=e.tableName,n=e.parentTableName,a=e.parentTableId,t=e.parentTableIdType,l=Object.keys(r),o=[],s=[],g=null,f="string";o.push(h.create(i)),n&&o.push(h.property(n+"_"+a,D[t]));for(var c,p=0;p<l.length;p++)(l[p].toLowerCase()==="id"||l[p].toLowerCase().indexOf("_id")>-1)&&(c=l[p],r[c]=r[l[p]],l[p]=c,g=l[p],f=typeof r[l[p]]);g||(g="id",f=t||f,o.push(h.property(g,D[f])));for(var u,d,v,p=0;p<l.length;p++)if(u=l[p],d=r[u],v=d instanceof Date?"date":Q.string(d).toLowerCase(),v!=="undefined"&&(v=j.isTimestamp(d)?"timestamp":v),v!=="function"){if(v==="object"&&!d.length){s.push(""),s.push(O(d,{parentTableName:i,parentTableId:g,parentTableIdType:f,tableName:i+"_"+u}).join(`
`));continue}if(v==="object"||v==="array"){if(typeof d[0]=="object"){s.push(""),s.push(O(d[0],{parentTableName:i,parentTableId:g,parentTableIdType:f,tableName:i+"_"+u}).join(`
`));continue}s.push(""),s.push(O({value:typeof d[0]},{parentTableName:i,parentTableId:g,parentTableIdType:f,tableName:i+"_"+u}).join(`
`));continue}o.push(h.property(u,D[v]))}return o.push(h.primary(g)),n&&o.push(h.foreign(n+"_id",n,a)),o[o.length-1]=j.arrayLastItem(o).substr(0,j.arrayLastItem(o).length-1),o.push(h.close()),o.concat(s)}var V=function(e,i){return typeof e!="string"&&(i=e,e="generic"),O(i,{tableName:e}).join(`
`)},I=N,W="http://json-schema.org/draft-04/schema#";function C(r){var e=I.string(r).toLowerCase();return e==="date"?"date-time":null}function E(r){var e=I.string(r).toLowerCase();return e==="date"||e==="regexp"||e==="function"?"string":e}function Z(r,e,i){r=Object.keys(r),e=Object.keys(e),i=i||[];for(var n,a,t,l=0,o=e.length;l<o;l++)n=e[l],t=r.indexOf(n),a=i.indexOf(n),t===-1?a!==-1&&i.splice(a,1):a===-1&&i.push(n);return i}function R(r,e,i){var n,a,t;i&&e?e={items:e}:(e=e||{},e.type=E(r),e.items=e.items||{},t=e.items.type||null);for(var l=0,o=r.length;l<o;l++){var s=E(r[l]),g=C(r[l]);if(t&&s!==t){e.items.oneOf=[],a=!0;break}else t=s,n=g}if(!a&&t?(e.items.type=t,n&&(e.items.format=n)):a&&t!=="object"&&(e.items={oneOf:[{type:t}],required:e.items.required}),typeof e.items.oneOf<"u"||t==="object")for(var f=0,c=r.length;f<c;f++){var p=r[f],u=E(p),d=C(p),v;if(u==="object"?(e.items.properties&&(e.items.required=Z(e.items.properties,p,e.items.required)),v=_(p,a?{}:e.items.properties,!0)):u==="array"?v=R(p,a?{}:e.items.properties,!0):(v={},v.type=u,d&&(v.format=d)),a){var m=I.string(p).toLowerCase(),L={};!v.type&&m==="object"&&(L.properties=v,L.type="object",v=L),e.items.oneOf.push(v)}else{if(e.items.type!=="object")continue;e.items.properties=v}}return i?e.items:e}function _(r,e,i){i&&e?e={properties:e}:(e=e||{},e.type=E(r),e.properties=e.properties||{});for(var n in r){var a=r[n],t=E(a),l=C(a);if(t=t==="undefined"?"null":t,t==="object"){e.properties[n]=_(a,e.properties[n]);continue}if(t==="array"){e.properties[n]=R(a,e.properties[n]);continue}if(e.properties[n]){var o=e.properties[n],s=Array.isArray(o.type);s&&o.type.indexOf(t)<0&&o.type.push(t),!s&&o.type!==t&&(o.type=[o.type,t]);continue}e.properties[n]={},e.properties[n].type=t,l&&(e.properties[n].format=l)}return i?e.properties:e}var k=function(e,i){var n,a={$schema:W};return typeof e!="string"?(i=e,e=void 0):a.title=e,a.type=I.string(i).toLowerCase(),a.type==="object"&&(n=_(i),a.type=n.type,a.properties=n.properties),a.type==="array"&&(n=R(i),a.type=n.type,a.items=n.items,a.title&&(a.items.title=a.title,a.title+=" Set")),a},ee=N,S=T,w={boolean:"String",string:"String",number:"Int32",date:"Date",timestamp:"DateTime",object:"Nested",regexp:"String",undefined:"String",null:"String"},b={create:function(r){return["CREATE TABLE ",r," ("].join("")},close:function(r,e){return e?[") ENGINE = MergeTree(",e,", (",r,", ",e,"), 8192);"].join(""):[") ENGINE = Memory;"].join("")},id:function(r,e){return["  ",r,"_id ",e,","].join("")},property:function(r,e){return["  ",r," ",e,","].join("")}};function A(r,e,i){var n=e.tableName,a=e.parentTableName,t=e.parentTableId,l=e.parentTableIdType,o=Object.keys(r),s=[],g=[],f=null,c="string";s.push(b.create(n)),a&&s.push(b.property(a+"_"+t,w[l]));for(var p,u=0;u<o.length;u++)(o[u].toLowerCase()==="id"||o[u].toLowerCase().indexOf("_id")>-1)&&(p=o[u],r[p]=r[o[u]],o[u]=p,f=o[u],c=typeof r[o[u]]);f||(f="id",c=l||c,s.push(b.property(f,w[c])));for(var d,v,m,u=0;u<o.length;u++){if(d=o[u],v=r[d],m=v instanceof Date?"date":ee.string(v).toLowerCase(),m=="date"&&!i)var i=d;if(m!=="undefined"&&(m=S.isTimestamp(v)?"timestamp":m),m!=="function"){if(m==="object"&&!v.length){g.push(""),g.push(A(v,{parentTableName:n,parentTableId:f,parentTableIdType:c,tableName:n+"_"+d}).join(""));continue}if(m==="object"||m==="array"){if(typeof v[0]=="object"){g.push(""),g.push(A(v[0],{parentTableName:n,parentTableId:f,parentTableIdType:c,tableName:n+"_"+d}).join(""));continue}g.push(""),g.push(A({value:typeof v[0]},{parentTableName:n,parentTableId:f,parentTableIdType:c,tableName:n+"_"+d}).join(""));continue}s.push(b.property(d,w[m]))}}return s[s.length-1]=S.arrayLastItem(s).substr(0,S.arrayLastItem(s).length-1),s.push(b.close(f,i)),s.concat(g)}var re=function(e,i,n){return typeof e!="string"&&(i=e,e="generic"),n||(n=null),A(i,{tableName:e},n).join("")};y.generic=K;y.mongoose=z;y.bigquery=J;y.mysql=V;y.json=k;y.clickhouse=re;export{y as s};
