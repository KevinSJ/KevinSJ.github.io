import{d as N,a0 as j,r as t,o as _,c as q,a as c,k as d,l as e,j as x,w as g,a6 as C,G as w,ad as y,aW as E,ag as P,af as U}from"./index-0c1fde36.js";import{_ as V}from"./InputCopyable.vue_vue_type_script_setup_true_lang-294ac243.js";import{g as $}from"./base64-ae7cf34b.js";import{q as A}from"./qpdf-45a7a22a.js";import{u as D}from"./downloadBase64-508288e2.js";import{_ as S}from"./Spin-885f2a22.js";import"./index-a6f01dde.js";import"./index-6fddb70d.js";import"./index-cfd4d427.js";const I={style:{flex:"0 0 100%"}},M={"mx-auto":"","max-w-600px":""},O={"mt-3":"",flex:"","justify-center":""},Y=N({__name:"pdf-linearize",setup(W){const{t:p}=j(),a=t("idle"),h=t(null),m=t(""),l=t([]),f=t(""),B=t("pdf"),{download:b}=D({source:m,filename:f,extension:B}),v=t("");async function k(o){h.value=o;const s=await o.arrayBuffer();f.value=`linearized_${o.name}`,a.value="processing";try{const n=await z(s,["--linearize","--warning-exit-0","--verbose","in.pdf","out.pdf"],0);m.value=`data:application/pdf;base64,${$.fromUint8Array(n)}`,a.value="done",b()}catch{a.value="error"}}async function z(o,s,n){v.value=s.join(" "),l.value=[];const r=await A({print(i){l.value.push(i)},printErr(i){l.value.push(i)}});r.FS.writeFile("in.pdf",new Uint8Array(o));const u=r.callMain(s);if(n!==u)throw new Error("Process run failed");return r.FS.readFile("out.pdf")}return(o,s)=>{const n=E,r=P,u=S,i=V,F=U;return _(),q("div",null,[c("div",I,[c("div",M,[d(n,{title:e(p)("tools.pdf-linearize.texts.title-drag-and-drop-a-pdf-file-here-or-click-to-select-a-file"),accept:".pdf",onFileUpload:k},null,8,["title"])])]),c("div",O,[e(a)==="error"?(_(),x(r,{key:0,type:"error"},{default:g(()=>[C(" An error occured processing "+w(e(f)),1)]),_:1})):y("",!0),e(a)==="processing"?(_(),x(u,{key:1,size:"small"})):y("",!0)]),d(F,{title:e(p)("tools.pdf-linearize.texts.title-logs")},{default:g(()=>[d(i,{label:e(p)("tools.pdf-linearize.texts.label-qpdf"),value:e(v),"mb-1":""},null,8,["label","value"]),c("pre",null,w(e(l).join(`
`)),1)]),_:1},8,["title"])])}}});export{Y as default};
