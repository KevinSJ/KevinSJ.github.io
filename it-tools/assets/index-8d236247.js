class k{static fract(t){return t-Math.floor(t)}static smoothStep(t,e,i){const n=(i-t)/(e-t),s=k.clamp(n,0,1);return s*s*(3-2*s)}static mix(t,e,i){return t*(1-i)+e*i}static sign(t){return t<0?-1:t>0?1:0}static step(t,e){return e<t?0:1}static length3(t,e,i){return Math.sqrt(t*t+e*e+i*i)}static gcd(t,e){let i=Math.abs(t),n=Math.abs(e);for(;n;){const s=n;n=i%n,i=s}return i}static clamp(t,e,i){return Math.max(e,Math.min(t,i))}static clampInt(t,e,i){return Math.trunc(k.clamp(t,e,i))}static clampInt255(t){return Math.trunc(k.clamp(t,0,255))}}class W extends Error{toString(){return`${this.constructor.name} (${this.message})`}}var v;(function(o){o[o.uint1=0]="uint1",o[o.uint2=1]="uint2",o[o.uint4=2]="uint4",o[o.uint8=3]="uint8",o[o.uint16=4]="uint16",o[o.uint32=5]="uint32",o[o.int8=6]="int8",o[o.int16=7]="int16",o[o.int32=8]="int32",o[o.float16=9]="float16",o[o.float32=10]="float32",o[o.float64=11]="float64"})(v||(v={}));var wt;(function(o){o[o.uint=0]="uint",o[o.int=1]="int",o[o.float=2]="float"})(wt||(wt={}));v.uint1,wt.uint,v.uint2,wt.uint,v.uint4,wt.uint,v.uint8,wt.uint,v.uint16,wt.uint,v.uint32,wt.uint,v.int8,wt.int,v.int16,wt.int,v.int32,wt.int,v.float16,wt.float,v.float32,wt.float,v.float64,wt.float;const ms=new Map([[v.uint1,1],[v.uint2,1],[v.uint4,1],[v.uint8,1],[v.uint16,2],[v.uint32,4],[v.int8,1],[v.int16,2],[v.int32,4],[v.float16,2],[v.float32,4],[v.float64,8]]),ts=new Map([[v.uint1,1],[v.uint2,3],[v.uint4,15],[v.uint8,255],[v.uint16,65535],[v.uint32,4294967295],[v.int8,127],[v.int16,32767],[v.int32,2147483647],[v.float16,1],[v.float32,1],[v.float64,1]]);function _s(o,t,e){return e===v.uint1?Math.ceil(o*t/8):e===v.uint2?Math.ceil(o*t/4):e===v.uint4?Math.ceil(o*t/2):o*t*ms.get(e)}function Hi(o,t,e){if(t===e)return o;switch(t){case v.uint1:return o===0?0:ts.get(e);case v.uint2:switch(e){case v.uint1:return o===0?0:1;case v.uint2:return o;case v.uint4:return o*5;case v.uint8:return o*75;case v.uint16:return o*21845;case v.uint32:return o*1431655765;case v.int8:return o*42;case v.int16:return o*10922;case v.int32:return o*715827882;case v.float16:case v.float32:case v.float64:return o/3}break;case v.uint4:switch(e){case v.uint1:return o===0?0:1;case v.uint2:return Math.trunc(o)>>>1;case v.uint4:return o;case v.uint8:return o*17;case v.uint16:return o*4369;case v.uint32:return o*286331153;case v.int8:return o*8;case v.int16:return o*2184;case v.int32:return o*143165576;case v.float16:case v.float32:case v.float64:return o/3}break;case v.uint8:switch(e){case v.uint1:return o===0?0:1;case v.uint2:return Math.trunc(o)>>>6;case v.uint4:return Math.trunc(o)>>>4;case v.uint8:return o;case v.uint16:return o*257;case v.uint32:return o*16843009;case v.int8:return Math.trunc(o)>>>1;case v.int16:return o*128;case v.int32:return o*8421504;case v.float16:case v.float32:case v.float64:return o/255}break;case v.uint16:switch(e){case v.uint1:return o===0?0:1;case v.uint2:return Math.trunc(o)>>>14;case v.uint4:return Math.trunc(o)>>>12;case v.uint8:return Math.trunc(o)>>>8;case v.uint16:return o;case v.uint32:return Math.trunc(o)<<8;case v.int8:return Math.trunc(o)>>>9;case v.int16:return Math.trunc(o)>>>1;case v.int32:return o*524296;case v.float16:case v.float32:case v.float64:return o/65535}break;case v.uint32:switch(e){case v.uint1:return o===0?0:1;case v.uint2:return Math.trunc(o)>>>30;case v.uint4:return Math.trunc(o)>>>28;case v.uint8:return Math.trunc(o)>>>24;case v.uint16:return Math.trunc(o)>>>16;case v.uint32:return o;case v.int8:return Math.trunc(o)>>>25;case v.int16:return Math.trunc(o)>>>17;case v.int32:return Math.trunc(o)>>>1;case v.float16:case v.float32:case v.float64:return o/4294967295}break;case v.int8:switch(e){case v.uint1:return o===0?0:1;case v.uint2:return o<=0?0:Math.trunc(o)>>>5;case v.uint4:return o<=0?0:Math.trunc(o)>>>3;case v.uint8:return o<=0?0:Math.trunc(o)<<1;case v.uint16:return o<=0?0:Math.trunc(o)*516;case v.uint32:return o<=0?0:Math.trunc(o)*33818640;case v.int8:return o;case v.int16:return o*258;case v.int32:return o*16909320;case v.float16:case v.float32:case v.float64:return o/127}break;case v.int16:switch(e){case v.uint1:return o===0?0:1;case v.uint2:return o<=0?0:Math.trunc(o)>>>15;case v.uint4:return o<=0?0:Math.trunc(o)>>>11;case v.uint8:return o<=0?0:Math.trunc(o)>>>7;case v.uint16:return o<=0?0:Math.trunc(o)<<1;case v.uint32:return o<=0?0:Math.trunc(o)*131076;case v.int8:return Math.trunc(o)>>>8;case v.int16:return o;case v.int32:return Math.trunc(o)*65538;case v.float16:case v.float32:case v.float64:return o/32767}break;case v.int32:switch(e){case v.uint1:return o===0?0:1;case v.uint2:return o<=0?0:Math.trunc(o)>>>29;case v.uint4:return o<=0?0:Math.trunc(o)>>>27;case v.uint8:return o<=0?0:Math.trunc(o)>>>23;case v.uint16:return o<=0?0:Math.trunc(o)>>>16;case v.uint32:return o<=0?0:Math.trunc(o)<<1;case v.int8:return Math.trunc(o)>>>24;case v.int16:return Math.trunc(o)>>>16;case v.int32:return o;case v.float16:case v.float32:case v.float64:return o/2147483647}break;case v.float16:case v.float32:case v.float64:switch(e){case v.uint1:return o===0?0:1;case v.uint2:return Math.trunc(k.clamp(o,0,1)*3);case v.uint4:return Math.trunc(k.clamp(o,0,1)*15);case v.uint8:return Math.trunc(k.clamp(o,0,1)*255);case v.uint16:return Math.trunc(k.clamp(o,0,1)*65535);case v.uint32:return Math.trunc(k.clamp(o,0,1)*4294967295);case v.int8:return Math.trunc(o<0?k.clamp(o,-1,1)*128:k.clamp(o,-1,1)*127);case v.int16:return Math.trunc(o<0?k.clamp(o,-1,1)*32768:k.clamp(o,-1,1)*32767);case v.int32:return Math.trunc(o<0?k.clamp(o,-1,1)*2147483648:k.clamp(o,-1,1)*2147483647);case v.float16:case v.float32:case v.float64:return o}break}throw new W("Unknown format.")}class Xt{get numerator(){return this._numerator}get denominator(){return this._denominator}get toInt(){return this.denominator!==0?Math.trunc(this.numerator/this.denominator):0}get toDouble(){return this.denominator!==0?this.numerator/this.denominator:0}constructor(t,e){this._numerator=t,this._denominator=e}simplify(){const t=k.gcd(this.numerator,this.denominator);t!==0&&(this._numerator=Math.trunc(this.numerator/t),this._denominator=Math.trunc(this.denominator/t))}equals(t){return this._numerator===t._numerator&&this._denominator===t._denominator}toString(){return`${this._numerator}/${this._denominator}`}}class F{static copyInt8(t,e,i){return Int8Array.from(t.subarray(e,i))}static copyUint8(t,e,i){return Uint8Array.from(t.subarray(e,i))}static copyInt16(t,e,i){return Int16Array.from(t.subarray(e,i))}static copyUint16(t,e,i){return Uint16Array.from(t.subarray(e,i))}static copyInt32(t,e,i){return Int32Array.from(t.subarray(e,i))}static copyUint32(t,e,i){return Uint32Array.from(t.subarray(e,i))}static copyFloat32(t,e,i){return Float32Array.from(t.subarray(e,i))}static copyFloat64(t,e,i){return Float64Array.from(t.subarray(e,i))}static copy(t,e,i){if(t instanceof Int8Array)return F.copyInt8(t,e,i);if(t instanceof Uint8Array)return F.copyUint8(t,e,i);if(t instanceof Int16Array)return F.copyInt16(t,e,i);if(t instanceof Uint16Array)return F.copyUint16(t,e,i);if(t instanceof Int32Array)return F.copyInt32(t,e,i);if(t instanceof Uint32Array)return F.copyUint32(t,e,i);if(t instanceof Float32Array)return F.copyFloat32(t,e,i);if(t instanceof Float64Array)return F.copyFloat64(t,e,i);throw new W("Unknown array type")}static copyRange(t,e,i,n,s){const a=t.subarray(e,e+s);i.set(a,n)}static fill(t,e){return new Array(t).fill(e)}static generate(t,e){const i=new Array(t);for(let n=0;n<t;++n)i[n]=e(n);return i}static equals(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(F.isNumArrayOrTypedArray(t[i])&&F.isNumArrayOrTypedArray(e[i])){if(!F.equals(t[i],e[i]))return!1}else if(t[i]!==e[i])return!1;return!0}static equalsRationalArray(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(!t[i].equals(e[i]))return!1;return!0}static getNumEnumValues(t){return Object.values(t).filter(e=>typeof e=="number")}static isNumArrayOrTypedArray(t){return!!(t&&typeof t=="object"&&(Array.isArray(t)&&t.every(e=>typeof e=="number")||ArrayBuffer.isView(t)&&!(t instanceof DataView)))}static isArrayOfRational(t){return!!(t&&typeof t=="object"&&Array.isArray(t)&&t.every(e=>e instanceof Xt))}}class q{static countTrailingZeroBits(t){let e=32;const i=t&-t;return i!==0&&e--,i&65535&&(e-=16),i&16711935&&(e-=8),i&252645135&&(e-=4),i&858993459&&(e-=2),i&1431655765&&(e-=1),e}static reverseByte(t){return this._reverseByteTable[t]}static sshR(t,e){return t>>e}static ushR(t,e){return t>>>e}static sshL(t,e){return t<<e}static ushL(t,e){return t<<e>>>0}static uint8ToInt8(t){return this._uint8[0]=t,this._uint8ToInt8[0]}static int8ToUint8(t){return this._int8[0]=t,this._int8ToUint8[0]}static uint16ToInt16(t){return this._uint16[0]=t,this._uint16ToInt16[0]}static int16ToUint16(t){return this._int16[0]=t,this._int16ToUint16[0]}static uint32ToInt32(t){return this._uint32[0]=t,this._uint32ToInt32[0]}static uint32ToFloat32(t){return this._uint32[0]=t,this._uint32ToFloat32[0]}static uint64ToFloat64(t){return this._uint64[0]=t,this._uint64ToFloat64[0]}static int32ToUint32(t){return this._int32[0]=t,this._int32ToUint32[0]}static float32ToUint32(t){return this._float32[0]=t,this._float32ToUint32[0]}static debugBits32(t){if(t===void 0)return"undefined";const e=32;let i="";for(let n=e;n>-1;n--)i+=t&1<<n?"1":"0";return i}}q._uint8=new Uint8Array(1);q._uint8ToInt8=new Int8Array(q._uint8.buffer);q._int8=new Int8Array(1);q._int8ToUint8=new Uint8Array(q._int8.buffer);q._uint16=new Uint16Array(1);q._uint16ToInt16=new Int16Array(q._uint16.buffer);q._int16=new Int16Array(1);q._int16ToUint16=new Uint16Array(q._int16.buffer);q._uint32=new Uint32Array(1);q._uint32ToInt32=new Int32Array(q._uint32.buffer);q._uint32ToFloat32=new Float32Array(q._uint32.buffer);q._int32=new Int32Array(1);q._int32ToUint32=new Uint32Array(q._int32.buffer);q._float32=new Float32Array(1);q._float32ToUint32=new Uint32Array(q._float32.buffer);q._uint64=new BigUint64Array(1);q._uint64ToFloat64=new Float64Array(q._uint64.buffer);q._reverseByteTable=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255];class Bt{static getCodePoints(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;i++){const n=t.codePointAt(i);if(n!==void 0)if(0<=n&&n<256)e[i]=n;else throw new W(`Error encoding text "${t}": unknown character code point ${n}`);else throw new W(`Error encoding text "${t}"`)}return e}}Bt.utf8Decoder=new TextDecoder("utf8");Bt.latin1Decoder=new TextDecoder("latin1");class D{set buffer(t){this._buffer=t}get buffer(){return this._buffer}set bigEndian(t){this._bigEndian=t}get bigEndian(){return this._bigEndian}set offset(t){this._offset=t}get offset(){return this._offset}get start(){return this._start}get end(){return this._end}get position(){return this._offset-this._start}get length(){return this._end-this._offset}get isEOS(){return this._offset>=this._end}constructor(t){var e,i;this._buffer=t.buffer,this._bigEndian=(e=t.bigEndian)!==null&&e!==void 0?e:!1,this._offset=(i=t.offset)!==null&&i!==void 0?i:0,this._start=this._offset,this._end=Math.min(this._buffer.length,t.length===void 0?this._buffer.length:this._offset+t.length)}static from(t,e,i){const n=e??0,s=new D({buffer:t._buffer,bigEndian:t._bigEndian,offset:t._offset+n,length:i});return s._start=t._start,s._end=Math.min(t.buffer.length,i===void 0?t._end:t.offset+n+i),s}rewind(){this._offset=this._start}get(t){return this._buffer[this._offset+t]}set(t,e){return this._buffer[this._offset+t]=e}memcpy(t,e,i,n=0){i instanceof D?F.copyRange(i.buffer,i.offset+n,this._buffer,this.offset+t,e):F.copyRange(i,n,this._buffer,this.offset+t,e)}memset(t,e,i){this._buffer.fill(i,this._offset+t,this._offset+t+e)}subarray(t,e,i=0){let n=e!==void 0?this._start+e:this._offset;return n+=i,new D({buffer:this._buffer,bigEndian:this._bigEndian,offset:n,length:t})}indexOf(t,e=0){const i=this.offset+this.length;for(let n=this.offset+e;n<i;++n)if(this._buffer[n]===t)return n-this._start;return-1}peek(t,e=0){return this.subarray(t,void 0,e)}skip(t){this._offset+=t}read(){return this._buffer[this._offset++]}readRange(t){const e=this.subarray(t);return this._offset+=e.length,e}readInt8(){return q.uint8ToInt8(this.read())}readString(t){if(t===void 0){const s=[];for(;!this.isEOS;){const a=this.read();if(a===0)return String.fromCodePoint(...s);s.push(a)}throw new W("EOF reached without finding string terminator.")}const i=this.readRange(t).toUint8Array();return String.fromCodePoint(...i)}readStringLine(t=256){const e=[];for(;!this.isEOS;){const i=this.read();if(e.push(i),i===10||e.length>=t)return String.fromCodePoint(...e)}return String.fromCodePoint(...e)}readStringUtf8(){const t=[];for(;!this.isEOS;){const i=this.read();if(i===0){const n=new Uint8Array(t);return Bt.utf8Decoder.decode(n)}t.push(i)}const e=new Uint8Array(t);return Bt.utf8Decoder.decode(e)}readUint16(){const t=this._buffer[this._offset++]&255,e=this._buffer[this._offset++]&255;return this._bigEndian?t<<8|e:e<<8|t}readInt16(){return q.uint16ToInt16(this.readUint16())}readUint24(){const t=this._buffer[this._offset++]&255,e=this._buffer[this._offset++]&255,i=this._buffer[this._offset++]&255;return this._bigEndian?i|e<<8|t<<16:t|e<<8|i<<16}readUint32(){return q.int32ToUint32(this.readInt32())}readInt32(){const t=this._buffer[this._offset++]&255,e=this._buffer[this._offset++]&255,i=this._buffer[this._offset++]&255,n=this._buffer[this._offset++]&255;return this._bigEndian?t<<24|e<<16|i<<8|n:n<<24|i<<16|e<<8|t}readFloat32(){return q.uint32ToFloat32(this.readUint32())}readFloat64(){return q.uint64ToFloat64(this.readUint64())}readUint64(){const t=this._buffer[this._offset++]&255,e=this._buffer[this._offset++]&255,i=this._buffer[this._offset++]&255,n=this._buffer[this._offset++]&255,s=this._buffer[this._offset++]&255,a=this._buffer[this._offset++]&255,r=this._buffer[this._offset++]&255,h=this._buffer[this._offset++]&255;return this._bigEndian?BigInt(t<<56)|BigInt(e<<48)|BigInt(i<<40)|BigInt(n<<32)|BigInt(s<<24)|BigInt(a<<16)|BigInt(r<<8)|BigInt(h):BigInt(h<<56)|BigInt(r<<48)|BigInt(a<<40)|BigInt(s<<32)|BigInt(n<<24)|BigInt(i<<16)|BigInt(e<<8)|BigInt(t)}toUint8Array(t=0,e){const i=e??this.length-t;return this._buffer instanceof Uint8Array?new Uint8Array(this._buffer.buffer,this._buffer.byteOffset+this._offset+t,i):Uint8Array.from(this._buffer.subarray(this._offset+t,this._offset+t+i))}toUint32Array(t=0){if(this._buffer instanceof Uint8Array)return new Uint32Array(this._buffer.buffer,this._buffer.byteOffset+this._offset+t);const e=this.toUint8Array();return new Uint32Array(e.buffer)}}var lt;(function(o){o[o.rgba=0]="rgba",o[o.bgra=1]="bgra",o[o.abgr=2]="abgr",o[o.argb=3]="argb",o[o.rgb=4]="rgb",o[o.bgr=5]="bgr",o[o.grayAlpha=6]="grayAlpha",o[o.red=7]="red"})(lt||(lt={}));const Ln=new Map([[lt.rgba,4],[lt.bgra,4],[lt.abgr,4],[lt.argb,4],[lt.rgb,3],[lt.bgr,3],[lt.grayAlpha,2],[lt.red,1]]);var X;(function(o){o[o.red=0]="red",o[o.green=1]="green",o[o.blue=2]="blue",o[o.alpha=3]="alpha",o[o.luminance=4]="luminance"})(X||(X={}));class ${static get _toFloatFloat32(){return this._toFloatFloat32Data!==void 0?this._toFloatFloat32Data:this.initialize()}constructor(t){this.bits=t!==void 0?$.doubleToFloat16(t):0}static convert(t){const e=t>>>16&32768;let i=(t>>>23&255)-(127-15),n=t&8388607;if(i<=0){if(i<-10)return e;n|=8388608;const s=14-i,a=(1<<s-1)-1,r=n>>>s&1;return n=n+a+r>>>s,e|n}else return i===255-(127-15)?n===0?e|31744:(n>>>=13,e|31744|n|(n===0?1:0)):(n=n+4095+(n>>>13&1),n&8388608&&(n=0,i+=1),i>30?e|31744:e|i<<10|n>>>13)}static initialize(){if(this._toFloatFloat32Data!==void 0)return this._toFloatFloat32Data;const t=new Uint32Array(65536);this._toFloatFloat32Data=new Float32Array(t.buffer),this._eLut=new Uint16Array(512);for(let i=0;i<256;i++){const n=(i&255)-112;n<=0||n>=30?(this._eLut[i]=0,this._eLut[i|256]=0):(this._eLut[i]=n<<10,this._eLut[i|256]=n<<10|32768)}const e=65536;for(let i=0;i<e;i++)t[i]=this.halfToFloat(i);return this._toFloatFloat32Data}static halfToFloat(t){const e=t>>>15&1;let i=t>>>10&31,n=t&1023;if(i===0){if(n===0)return e<<31;for(;!(n&1024);)n<<=1,i-=1;i+=1,n&=-1025}else if(i===31)return n===0?e<<31|2139095040:e<<31|2139095040|n<<13;return i+=127-15,n<<=13,e<<31|i<<23|n}static from(t){const e=new $;return e.bits=t.bits,e}static fromBits(t){const e=new $;return e.bits=t,e}static float16ToDouble(t){return this._toFloatFloat32[t]}static doubleToFloat16(t){const e=t,i=q.float32ToUint32(e);if(e===0)return i>>>16;this._toFloatFloat32Data===void 0&&this.initialize();let n=i>>>23&511;if(n=this._eLut[n],n!==0){const s=i&8388607;return n+(s+4095+(s>>>13&1)>>>13)}return this.convert(i)}static posInf(){return $.fromBits(31744)}static negInf(){return $.fromBits(64512)}static qNan(){return $.fromBits(32767)}static sNan(){return $.fromBits(32255)}toDouble(){return $._toFloatFloat32[this.bits]}minus(){return $.fromBits(this.bits^32768)}add(t){const e=t instanceof $?t.toDouble():typeof t=="number"?t:0;return new $(this.toDouble()+e)}sub(t){const e=t instanceof $?t.toDouble():typeof t=="number"?t:0;return new $(this.toDouble()-e)}mul(t){const e=t instanceof $?t.toDouble():typeof t=="number"?t:0;return new $(this.toDouble()*e)}div(t){const e=t instanceof $?t.toDouble():typeof t=="number"?t:0;return new $(this.toDouble()/e)}round(t){if(t>=10)return $.from(this);const e=this.bits&32768;let i=this.bits&32767;return i>>>=9-t,i+=i&1,i<<=9-t,i>=31744&&(i=this.bits,i>>>=10-t,i<<=10-t),$.fromBits(e|i)}isFinite(){return(this.bits>>>10&31)<31}isNormalized(){const t=this.bits>>>10&31;return t>0&&t<31}isDenormalized(){const t=this.bits>>>10&31,e=this.bits&1023;return t===0&&e!==0}isZero(){return(this.bits&32767)===0}isNaN(){const t=this.bits>>>10&31,e=this.bits&1023;return t===31&&e!==0}isInfinity(){const t=this.bits>>>10&31,e=this.bits&1023;return t===31&&e===0}isNegative(){return(this.bits&32768)!==0}}class Fe{get format(){return v.float16}get length(){return this.data.length}get maxChannelValue(){return 1}get maxIndexValue(){return 1}get isLdrFormat(){return!1}get isHdrFormat(){return!0}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?this.data=new Uint16Array(t):this.data=t.slice()}static from(t){const e=new Fe(t.length);return e.data=t.data,e}static fromArray(t){const e=new Fe(t),i=t.length;for(let n=0;n<i;++n)e.data[n]=$.doubleToFloat16(t[n]);return e}static rgb(t,e,i){const n=new Uint16Array([$.doubleToFloat16(t),$.doubleToFloat16(e),$.doubleToFloat16(i)]);return new Fe(n)}static rgba(t,e,i,n){const s=new Uint16Array([$.doubleToFloat16(t),$.doubleToFloat16(e),$.doubleToFloat16(i),$.doubleToFloat16(n)]);return new Fe(s)}getChannel(t){return t===X.luminance?this.luminance:t<this.data.length?$.float16ToDouble(this.data[t]):0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.data.length&&(this.data[t]=$.doubleToFloat16(e))}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this.data[0]=$.doubleToFloat16(t);const n=this.data.length;n>1&&(this.data[1]=$.doubleToFloat16(e),n>2&&(this.data[2]=$.doubleToFloat16(i)))}setRgba(t,e,i,n){this.data[0]=$.doubleToFloat16(t);const s=this.data.length;s>1&&(this.data[1]=$.doubleToFloat16(e),s>2&&(this.data[2]=$.doubleToFloat16(i),s>3&&(this.data[3]=$.doubleToFloat16(n))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return Fe.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class Te{get format(){return v.float32}get length(){return this.data.length}get maxChannelValue(){return 1}get maxIndexValue(){return 1}get isLdrFormat(){return!1}get isHdrFormat(){return!0}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?this.data=new Float32Array(t):this.data=t.slice()}static from(t){const e=new Te(t.length);return e.data=t.data,e}static fromArray(t){return new Te(t)}static rgb(t,e,i){const n=new Float32Array([t,e,i]);return new Te(n)}static rgba(t,e,i,n){const s=new Float32Array([t,e,i,n]);return new Te(s)}getChannel(t){return t===X.luminance?this.luminance:t<this.data.length?this.data[t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.data.length&&(this.data[t]=e)}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this.data[0]=t;const n=this.data.length;n>1&&(this.data[1]=e,n>2&&(this.data[2]=i))}setRgba(t,e,i,n){this.data[0]=t;const s=this.data.length;s>1&&(this.data[1]=e,s>2&&(this.data[2]=i,s>3&&(this.data[3]=n)))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return Te.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class Ve{get format(){return v.float64}get length(){return this.data.length}get maxChannelValue(){return 1}get maxIndexValue(){return 1}get isLdrFormat(){return!0}get isHdrFormat(){return!1}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?this.data=new Float64Array(t):this.data=t.slice()}static from(t){const e=new Ve(t.length);return e.data=t.data,e}static fromArray(t){return new Ve(t)}static rgb(t,e,i){const n=new Float64Array([t,e,i]);return new Ve(n)}static rgba(t,e,i,n){const s=new Float64Array([t,e,i,n]);return new Ve(s)}getChannel(t){return t===X.luminance?this.luminance:t<this.data.length?this.data[t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.data.length&&(this.data[t]=e)}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this.data[0]=t;const n=this.data.length;n>1&&(this.data[1]=e,n>2&&(this.data[2]=i))}setRgba(t,e,i,n){this.data[0]=t;const s=this.data.length;s>1&&(this.data[1]=e,s>2&&(this.data[2]=i,s>3&&(this.data[3]=n)))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return Ve.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class Oe{get format(){return v.int16}get length(){return this._data.length}get maxChannelValue(){return 32767}get maxIndexValue(){return 32767}get isLdrFormat(){return!1}get isHdrFormat(){return!0}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this._data.length>0?this._data[0]:0}set r(t){this._data.length>0&&(this._data[0]=Math.trunc(t))}get g(){return this._data.length>1?this._data[1]:0}set g(t){this._data.length>1&&(this._data[1]=Math.trunc(t))}get b(){return this._data.length>2?this._data[2]:0}set b(t){this._data.length>2&&(this._data[2]=Math.trunc(t))}get a(){return this._data.length>3?this._data[3]:0}set a(t){this._data.length>3&&(this._data[3]=Math.trunc(t))}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?this._data=new Int16Array(t):this._data=t.slice()}static from(t){const e=new Oe(t.length);return e._data=t._data,e}static fromArray(t){const e=new Int16Array(t);return new Oe(e)}static rgb(t,e,i){const n=new Int16Array([t,e,i]);return new Oe(n)}static rgba(t,e,i,n){const s=new Int16Array([t,e,i,n]);return new Oe(s)}getChannel(t){return t===X.luminance?this.luminance:t<this._data.length?this._data[t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this._data.length&&(this._data[t]=Math.trunc(e))}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this._data[0]=Math.trunc(t);const n=this._data.length;n>1&&(this._data[1]=Math.trunc(e),n>2&&(this._data[2]=Math.trunc(i)))}setRgba(t,e,i,n){this._data[0]=Math.trunc(t);const s=this._data.length;s>1&&(this._data[1]=Math.trunc(e),s>2&&(this._data[2]=Math.trunc(i),s>3&&(this._data[3]=Math.trunc(n))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return Oe.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class He{get format(){return v.int32}get length(){return this._data.length}get maxChannelValue(){return 2147483647}get maxIndexValue(){return 2147483647}get isLdrFormat(){return!1}get isHdrFormat(){return!0}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this._data.length>0?this._data[0]:0}set r(t){this._data.length>0&&(this._data[0]=Math.trunc(t))}get g(){return this._data.length>1?this._data[1]:0}set g(t){this._data.length>1&&(this._data[1]=Math.trunc(t))}get b(){return this._data.length>2?this._data[2]:0}set b(t){this._data.length>2&&(this._data[2]=Math.trunc(t))}get a(){return this._data.length>3?this._data[3]:0}set a(t){this._data.length>3&&(this._data[3]=Math.trunc(t))}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?this._data=new Int32Array(t):this._data=t.slice()}static from(t){const e=new He(t.length);return e._data=t._data,e}static fromArray(t){const e=new Int32Array(t);return new He(e)}static rgb(t,e,i){const n=new Int32Array([t,e,i]);return new He(n)}static rgba(t,e,i,n){const s=new Int32Array([t,e,i,n]);return new He(s)}getChannel(t){return t===X.luminance?this.luminance:t<this._data.length?this._data[t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this._data.length&&(this._data[t]=Math.trunc(e))}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this._data[0]=Math.trunc(t);const n=this._data.length;n>1&&(this._data[1]=Math.trunc(e),n>2&&(this._data[2]=Math.trunc(i)))}setRgba(t,e,i,n){this._data[0]=Math.trunc(t);const s=this._data.length;s>1&&(this._data[1]=Math.trunc(e),s>2&&(this._data[2]=Math.trunc(i),s>3&&(this._data[3]=Math.trunc(n))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return He.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class qe{get format(){return v.int8}get length(){return this._data.length}get maxChannelValue(){return 127}get maxIndexValue(){return 127}get isLdrFormat(){return!1}get isHdrFormat(){return!0}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this._data.length>0?this._data[0]:0}set r(t){this._data.length>0&&(this._data[0]=Math.trunc(t))}get g(){return this._data.length>1?this._data[1]:0}set g(t){this._data.length>1&&(this._data[1]=Math.trunc(t))}get b(){return this._data.length>2?this._data[2]:0}set b(t){this._data.length>2&&(this._data[2]=Math.trunc(t))}get a(){return this._data.length>3?this._data[3]:0}set a(t){this._data.length>3&&(this._data[3]=Math.trunc(t))}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?this._data=new Int8Array(t):this._data=t.slice()}static from(t){const e=new qe(t.length);return e._data=t._data,e}static fromArray(t){const e=new Int8Array(t);return new qe(e)}static rgb(t,e,i){const n=new Int8Array([t,e,i]);return new qe(n)}static rgba(t,e,i,n){const s=new Int8Array([t,e,i,n]);return new qe(s)}getChannel(t){return t===X.luminance?this.luminance:t<this._data.length?this._data[t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this._data.length&&(this._data[t]=Math.trunc(e))}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this._data[0]=Math.trunc(t);const n=this._data.length;n>1&&(this._data[1]=Math.trunc(e),n>2&&(this._data[2]=Math.trunc(i)))}setRgba(t,e,i,n){this._data[0]=Math.trunc(t);const s=this._data.length;s>1&&(this._data[1]=Math.trunc(e),s>2&&(this._data[2]=Math.trunc(i),s>3&&(this._data[3]=Math.trunc(n))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return qe.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class Ee{get format(){return v.uint1}get length(){return this._length}get maxChannelValue(){return 1}get maxIndexValue(){return 1}get isLdrFormat(){return!0}get isHdrFormat(){return!1}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?(this._length=t,this._data=0):(this._length=t.length,this._data=0,this.setRgba(t.length>0?t[0]:0,t.length>1?t[1]:0,t.length>2?t[2]:0,t.length>3?t[3]:0))}static from(t){const e=new Ee(t._length);return e._data=t._data,e}static fromArray(t){return new Ee(t)}static rgb(t,e,i){return new Ee([t,e,i])}static rgba(t,e,i,n){return new Ee([t,e,i,n])}getChannel(t){return t<this.length?this._data>>>7-t&1:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){let i=t;if(i>=this.length)return;i=7-i;let n=this._data;e!==0?n|=1<<i:n&=~(1<<i&255),this._data=n}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this.r=t,this.g=e,this.b=i}setRgba(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return Ee.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class Ye{get format(){return v.uint16}get length(){return this.data.length}get maxChannelValue(){return 65535}get maxIndexValue(){return 65535}get isLdrFormat(){return!1}get isHdrFormat(){return!0}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?this.data=new Uint16Array(t):this.data=t.slice()}static from(t){const e=new Ye(t.length);return e.data=t.data,e}static fromArray(t){return new Ye(t)}static rgb(t,e,i){const n=new Uint16Array([t,e,i]);return new Ye(n)}static rgba(t,e,i,n){const s=new Uint16Array([t,e,i,n]);return new Ye(s)}getChannel(t){return t===X.luminance?this.luminance:t<this.data.length?this.data[t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.data.length&&(this.data[t]=Math.trunc(e))}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this.data[0]=Math.trunc(t);const n=this.data.length;n>1&&(this.data[1]=Math.trunc(e),n>2&&(this.data[2]=Math.trunc(i)))}setRgba(t,e,i,n){this.data[0]=Math.trunc(t);const s=this.data.length;s>1&&(this.data[1]=Math.trunc(e),s>2&&(this.data[2]=Math.trunc(i),s>3&&(this.data[3]=Math.trunc(n))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return Ye.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class Ge{get format(){return v.uint2}get length(){return this._length}get maxChannelValue(){return 3}get maxIndexValue(){return 3}get isLdrFormat(){return!0}get isHdrFormat(){return!1}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?(this._length=t,this._data=0):(this._length=t.length,this._data=0,this.setRgba(t.length>0?t[0]:0,t.length>1?t[1]:0,t.length>2?t[2]:0,t.length>3?t[3]:0))}static from(t){const e=new Ge(t._length);return e._data=t._data,e}static fromArray(t){return new Ge(t)}static rgb(t,e,i){return new Ge([t,e,i])}static rgba(t,e,i,n){return new Ge([t,e,i,n])}getChannel(t){return t<this.length?this._data>>>6-(t<<1)&3:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){if(t>=this.length)return;const s=[~(3<<6-0)&255,~(3<<6-2)&255,~(3<<6-4)&255,~(3<<6-6)&255][t],a=Math.trunc(e)&3;this._data=this._data&s|a<<6-(t<<1)}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this.r=t,this.g=e,this.b=i}setRgba(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return Ge.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class $e{get format(){return v.uint32}get length(){return this.data.length}get maxChannelValue(){return 4294967295}get maxIndexValue(){return 4294967295}get isLdrFormat(){return!1}get isHdrFormat(){return!0}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?this.data=new Uint32Array(t):this.data=t.slice()}static from(t){const e=new $e(t.length);return e.data=t.data,e}static fromArray(t){return new $e(t)}static rgb(t,e,i){const n=new Uint32Array([t,e,i]);return new $e(n)}static rgba(t,e,i,n){const s=new Uint32Array([t,e,i,n]);return new $e(s)}getChannel(t){return t===X.luminance?this.luminance:t<this.data.length?this.data[t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.data.length&&(this.data[t]=Math.trunc(e))}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this.data[0]=Math.trunc(t);const n=this.data.length;n>1&&(this.data[1]=Math.trunc(e),n>2&&(this.data[2]=Math.trunc(i)))}setRgba(t,e,i,n){this.data[0]=Math.trunc(t);const s=this.data.length;s>1&&(this.data[1]=Math.trunc(e),s>2&&(this.data[2]=Math.trunc(i),s>3&&(this.data[3]=Math.trunc(n))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return $e.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class We{get format(){return v.uint4}get length(){return this._length}get maxChannelValue(){return 15}get maxIndexValue(){return 15}get isLdrFormat(){return!0}get isHdrFormat(){return!1}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?(this._length=t,this._data=new Uint8Array(this.length<3?1:2)):(this._length=t.length,this._data=new Uint8Array(this._length<3?1:2),this.setRgba(this._length>0?t[0]:0,this._length>1?t[1]:0,this._length>2?t[2]:0,this._length>3?t[3]:0))}static from(t){const e=new We(t._length);return e._data=t._data,e}static fromArray(t){return new We(t)}static rgb(t,e,i){const n=new We(3);return n.setRgb(t,e,i),n}static rgba(t,e,i,n){const s=new We(4);return s.setRgba(t,e,i,n),s}getChannel(t){return t<0||t>=this.length?0:t<2?this._data[0]>>>4-(t<<2)&15:this._data[1]>>>4-((t&1)<<2)&15}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){let i=t;if(i>=this.length)return;const n=k.clamp(Math.trunc(e),0,15);let s=0;i>1&&(i&=1,s=1),i===0?this._data[s]=this._data[s]&15|n<<4:i===1&&(this._data[s]=this._data[s]&240|n)}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this.r=t,this.g=e,this.b=i}setRgba(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return We.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}class E{static convertColorInternal(t,e,i){var n,s;const a=e.length,r=e.format,h=(s=(n=t.palette)===null||n===void 0?void 0:n.format)!==null&&s!==void 0?s:t.format,l=t.length;if(a===1){const u=Math.trunc(t.length>2?t.luminance:t.getChannel(0));e.setChannel(0,Hi(Math.floor(u),h,r))}else if(a<=l)for(let u=0;u<a;++u)e.setChannel(u,Hi(t.getChannel(u),h,r));else if(l===2){const u=Hi(t.getChannel(0),h,r);if(a===3)e.setChannel(0,u),e.setChannel(1,u),e.setChannel(2,u);else{const d=Hi(t.getChannel(1),h,r);e.setChannel(0,u),e.setChannel(1,u),e.setChannel(2,u),e.setChannel(3,d)}}else{for(let d=0;d<l;++d)e.setChannel(d,Hi(t.getChannel(d),h,r));const u=l===1?e.getChannel(0):0;for(let d=l;d<a;++d)e.setChannel(d,d===3?i:u)}return e}static uint32ToRed(t){return t&255}static uint32ToGreen(t){return t>>>8&255}static uint32ToBlue(t){return t>>>16&255}static uint32ToAlpha(t){return t>>>24&255}static rgbaToUint32(t,e,i,n){return k.clampInt255(t)|k.clampInt255(e)<<8|k.clampInt255(i)<<16|k.clampInt255(n)<<24}static convertColor(t){var e,i,n,s,a,r,h,l,u,d,c,g,f,m,_,x,b,p,w,C,y;const A=(i=(e=t.from.palette)===null||e===void 0?void 0:e.format)!==null&&i!==void 0?i:t.from.format,B=(a=(s=(n=t.to)===null||n===void 0?void 0:n.format)!==null&&s!==void 0?s:t.format)!==null&&a!==void 0?a:t.from.format,z=(l=(h=(r=t.to)===null||r===void 0?void 0:r.length)!==null&&h!==void 0?h:t.numChannels)!==null&&l!==void 0?l:t.from.length,U=(u=t.alpha)!==null&&u!==void 0?u:0;if(B===A&&z===t.from.length)return t.to===void 0?t.from.clone():(t.to.set(t.from),t.to);switch(B){case v.uint8:{const P=(d=t.to)!==null&&d!==void 0?d:new ie(z);return this.convertColorInternal(t.from,P,U)}case v.uint1:{const P=(c=t.to)!==null&&c!==void 0?c:new Ee(z);return this.convertColorInternal(t.from,P,U)}case v.uint2:{const P=(g=t.to)!==null&&g!==void 0?g:new Ge(z);return this.convertColorInternal(t.from,P,U)}case v.uint4:{const P=(f=t.to)!==null&&f!==void 0?f:new We(z);return this.convertColorInternal(t.from,P,U)}case v.uint16:{const P=(m=t.to)!==null&&m!==void 0?m:new Ye(z);return this.convertColorInternal(t.from,P,U)}case v.uint32:{const P=(_=t.to)!==null&&_!==void 0?_:new $e(z);return this.convertColorInternal(t.from,P,U)}case v.int8:{const P=(x=t.to)!==null&&x!==void 0?x:new qe(z);return this.convertColorInternal(t.from,P,U)}case v.int16:{const P=(b=t.to)!==null&&b!==void 0?b:new Oe(z);return this.convertColorInternal(t.from,P,U)}case v.int32:{const P=(p=t.to)!==null&&p!==void 0?p:new He(z);return this.convertColorInternal(t.from,P,U)}case v.float16:{const P=(w=t.to)!==null&&w!==void 0?w:new Fe(z);return this.convertColorInternal(t.from,P,U)}case v.float32:{const P=(C=t.to)!==null&&C!==void 0?C:new Te(z);return this.convertColorInternal(t.from,P,U)}case v.float64:{const P=(y=t.to)!==null&&y!==void 0?y:new Ve(z);return this.convertColorInternal(t.from,P,U)}}throw new W("Unknown format.")}static getLuminance(t){return .299*t.r+.587*t.g+.114*t.b}static getLuminanceNormalized(t){return .299*t.rNormalized+.587*t.gNormalized+.114*t.bNormalized}static getLuminanceRgb(t,e,i){return .299*t+.587*e+.114*i}static hslToRgb(t,e,i,n){if(e===0){const d=Math.trunc(i*255);n[0]=d,n[1]=d,n[2]=d;return}const s=(d,c,g)=>{let f=g;return f<0&&(f+=1),f>1&&(f-=1),f<1/6?d+(c-d)*6*f:f<1/2?c:f<2/3?d+(c-d)*(2/3-f)*6:d},a=i<.5?i*(1+e):i+e-i*e,r=2*i-a,h=s(r,a,t+1/3),l=s(r,a,t),u=s(r,a,t-1/3);n[0]=Math.round(h*255),n[1]=Math.round(l*255),n[2]=Math.round(u*255)}static rgbToHsv(t,e,i,n){const s=Math.min(t,Math.min(e,i)),a=Math.max(t,Math.max(e,i)),r=a-s;if(a===0||r===0){n[0]=0,n[1]=0,n[2]=a;return}let h=0,l=0,u=0;u=a,l=r/a,t===a?h=(e-i)/r:e===a?h=2+(i-t)/r:h=4+(t-e)/r,h*=60,h<0&&(h+=360),n[0]=h,n[1]=l,n[2]=u}static hsvToRgb(t,e,i,n){let s=t;if(e===0){const d=k.clamp(i,0,1);n[0]=d,n[1]=d,n[2]=d;return}for(;t<0;)s+=360;for(;t>360;)s-=360;s/=60;const a=Math.floor(s),r=s-a,h=k.clamp(i*(1-e),0,1),l=k.clamp(i*(1-e*r),0,1),u=k.clamp(i*(1-e*(1-r)),0,1);switch(a){case 0:n[0]=i,n[1]=u,n[2]=h;return;case 1:n[0]=l,n[1]=i,n[2]=h;return;case 2:n[0]=h,n[1]=i,n[2]=u;return;case 3:n[0]=h,n[1]=l,n[2]=i;return;case 4:n[0]=u,n[1]=h,n[2]=i;return;default:n[0]=i,n[1]=h,n[2]=l;return}}static rgbToHsl(t,e,i){const n=t/255,s=e/255,a=i/255,r=Math.max(n,Math.max(s,a)),h=Math.min(n,Math.min(s,a)),l=(r+h)/2;if(r===h)return[0,0,l];const u=r-h,d=l>.5?u/(2-r-h):u/(r+h);let c=0;return r===n?c=(s-a)/u+(s<a?6:0):r===s?c=(a-n)/u+2:c=(n-s)/u+4,c/=6,[c,d,l]}static labToXyz(t,e,i){let n=(t+16)/116,s=n+e/500,a=n-i/200;return Math.pow(s,3)>.008856?s=Math.pow(s,3):s=(s-16/116)/7.787,Math.pow(n,3)>.008856?n=Math.pow(n,3):n=(n-16/116)/7.787,Math.pow(a,3)>.008856?a=Math.pow(a,3):a=(a-16/116)/7.787,[Math.trunc(s*95.047),Math.trunc(n*100),Math.trunc(a*108.883)]}static xyzToRgb(t,e,i){const n=t/100,s=e/100,a=i/100;let r=3.2406*n+-1.5372*s+-.4986*a,h=-.9689*n+1.8758*s+.0415*a,l=.0557*n+-.204*s+1.057*a;return r>.0031308?r=1.055*Math.pow(r,.4166666667)-.055:r*=12.92,h>.0031308?h=1.055*Math.pow(h,.4166666667)-.055:h*=12.92,l>.0031308?l=1.055*Math.pow(l,.4166666667)-.055:l*=12.92,[k.clampInt255(r*255),k.clampInt255(h*255),k.clampInt255(l*255)]}static cmykToRgb(t,e,i,n,s){const a=t/255,r=e/255,h=i/255,l=n/255;s[0]=Math.round(255*(1-a)*(1-l)),s[1]=Math.round(255*(1-r)*(1-l)),s[2]=Math.round(255*(1-h)*(1-l))}static labToRgb(t,e,i){let r=(t+16)/116,h=e/500+r,l=r-i/200;const u=Math.pow(r,3);u>.008856?r=u:r=(r-16/116)/7.787;const d=Math.pow(h,3);d>.008856?h=d:h=(h-16/116)/7.787;const c=Math.pow(l,3);c>.008856?l=c:l=(l-16/116)/7.787,h*=95.047,r*=100,l*=108.883,h/=100,r/=100,l/=100;let g=h*3.2406+r*-1.5372+l*-.4986,f=h*-.9689+r*1.8758+l*.0415,m=h*.0557+r*-.204+l*1.057;return g>.0031308?g=1.055*Math.pow(g,1/2.4)-.055:g*=12.92,f>.0031308?f=1.055*Math.pow(f,1/2.4)-.055:f*=12.92,m>.0031308?m=1.055*Math.pow(m,1/2.4)-.055:m*=12.92,[k.clampInt255(g*255),k.clampInt255(f*255),k.clampInt255(m*255)]}static rgbToXyz(t,e,i){let n=t/255,s=e/255,a=i/255;return n>.04045?n=Math.pow((n+.055)/1.055,2.4):n/=12.92,s>.04045?s=Math.pow((s+.055)/1.055,2.4):s/=12.92,a>.04045?a=Math.pow((a+.055)/1.055,2.4):a/=12.92,n*=100,s*=100,a*=100,[n*.4124+s*.3576+a*.1805,n*.2126+s*.7152+a*.0722,n*.0193+s*.1192+a*.9505]}static xyzToLab(t,e,i){let n=t/95.047,s=e/100,a=i/108.883;return n>.008856?n=Math.pow(n,1/3):n=7.787*n+16/116,s>.008856?s=Math.pow(s,1/3):s=7.787*s+16/116,a>.008856?a=Math.pow(a,1/3):a=7.787*a+16/116,[116*s-16,500*(n-s),200*(s-a)]}static rgbToLab(t,e,i){let n=t/255,s=e/255,a=i/255;n>.04045?n=Math.pow((n+.055)/1.055,2.4):n/=12.92,s>.04045?s=Math.pow((s+.055)/1.055,2.4):s/=12.92,a>.04045?a=Math.pow((a+.055)/1.055,2.4):a/=12.92,n*=100,s*=100,a*=100;let r=n*.4124+s*.3576+a*.1805,h=n*.2126+s*.7152+a*.0722,l=n*.0193+s*.1192+a*.9505;return r/=95.047,h/=100,l/=108.883,r>.008856?r=Math.pow(r,1/3):r=7.787*r+16/116,h>.008856?h=Math.pow(h,1/3):h=7.787*h+16/116,l>.008856?l=Math.pow(l,1/3):l=7.787*l+16/116,[116*h-16,500*(r-h),200*(h-l)]}}class ie{get format(){return v.uint8}get length(){return this.data.length}get maxChannelValue(){return 255}get maxIndexValue(){return 255}get isLdrFormat(){return!0}get isHdrFormat(){return!1}get hasPalette(){return!1}get palette(){}get index(){return this.r}set index(t){this.r=t}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3,255)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t){typeof t=="number"?this.data=new Uint8Array(t):this.data=t.slice()}static from(t){const e=new ie(t.length);return e.data=t.data,e}static fromArray(t){return new ie(t)}static rgb(t,e,i){const n=new Uint8Array([t,e,i]);return new ie(n)}static rgba(t,e,i,n){const s=new Uint8Array([t,e,i,n]);return new ie(s)}getChannel(t,e=0){return t===X.luminance?this.luminance:t<this.data.length?this.data[t]:e}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.data.length&&(this.data[t]=Math.trunc(e))}set(t){this.setRgba(t.r,t.g,t.b,t.a)}setRgb(t,e,i){this.data[0]=Math.trunc(t);const n=this.data.length;n>1&&(this.data[1]=Math.trunc(e),n>2&&(this.data[2]=Math.trunc(i)))}setRgba(t,e,i,n){this.data[0]=Math.trunc(t);const s=this.data.length;s>1&&(this.data[1]=Math.trunc(e),s>2&&(this.data[2]=Math.trunc(i),s>3&&(this.data[3]=Math.trunc(n))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return ie.from(this)}equals(t){if(t.length!==this.length)return!1;for(let e=0;e<this.length;e++)if(t.getChannel(e)!==this.getChannel(e))return!1;return!0}convert(t){return E.convertColor({from:this,format:t?.format,numChannels:t?.numChannels,alpha:t?.alpha})}}var Xe;(function(o){o[o.nearest=0]="nearest",o[o.linear=1]="linear",o[o.cubic=2]="cubic",o[o.average=3]="average"})(Xe||(Xe={}));class xs{get tag(){return this._tag}get value(){return this._value}set value(t){this._value=t}constructor(t,e){this._tag=t,this._value=e}}var N;(function(o){o[o.none=0]="none",o[o.byte=1]="byte",o[o.ascii=2]="ascii",o[o.short=3]="short",o[o.long=4]="long",o[o.rational=5]="rational",o[o.sByte=6]="sByte",o[o.undefined=7]="undefined",o[o.sShort=8]="sShort",o[o.sLong=9]="sLong",o[o.sRational=10]="sRational",o[o.single=11]="single",o[o.double=12]="double",o[o.ifd=13]="ifd"})(N||(N={}));const _n=[0,1,1,2,4,8,1,1,2,4,8,4,8,4];function bs(o){return N[o]}function ws(o,t=1){return _n[o]*t}class R{get name(){return this._name}get type(){return this._type}get count(){return this._count}constructor(t){var e;this._name=t.name,this._type=(e=t.type)!==null&&e!==void 0?e:N.none,this._count=t.count}}const pt=new Map([["ProcessingSoftware",11],["SubfileType",254],["OldSubfileType",255],["ImageWidth",256],["ImageLength",257],["ImageHeight",257],["BitsPerSample",258],["Compression",259],["PhotometricInterpretation",262],["Thresholding",263],["CellWidth",264],["CellLength",265],["FillOrder",266],["DocumentName",269],["ImageDescription",270],["Make",271],["Model",272],["StripOffsets",273],["Orientation",274],["SamplesPerPixel",277],["RowsPerStrip",278],["StripByteCounts",279],["MinSampleValue",280],["MaxSampleValue",281],["XResolution",282],["YResolution",283],["PlanarConfiguration",284],["PageName",285],["XPosition",286],["YPosition",287],["GrayResponseUnit",290],["GrayResponseCurve",291],["T4Options",292],["T6Options",293],["ResolutionUnit",296],["PageNumber",297],["ColorResponseUnit",300],["TransferFunction",301],["Software",305],["DateTime",306],["Artist",315],["HostComputer",316],["Predictor",317],["WhitePoint",318],["PrimaryChromaticities",319],["ColorMap",320],["HalftoneHints",321],["TileWidth",322],["TileLength",323],["TileOffsets",324],["TileByteCounts",325],["BadFaxLines",326],["CleanFaxData",327],["ConsecutiveBadFaxLines",328],["InkSet",332],["InkNames",333],["NumberofInks",334],["DotRange",336],["TargetPrinter",337],["ExtraSamples",338],["SampleFormat",339],["SMinSampleValue",340],["SMaxSampleValue",341],["TransferRange",342],["ClipPath",343],["JPEGProc",512],["JPEGInterchangeFormat",513],["JPEGInterchangeFormatLength",514],["YCbCrCoefficients",529],["YCbCrSubSampling",530],["YCbCrPositioning",531],["ReferenceBlackWhite",532],["ApplicationNotes",700],["Rating",18246],["CFARepeatPatternDim",33421],["CFAPattern",33422],["BatteryLevel",33423],["Copyright",33432],["ExposureTime",33434],["FNumber",33437],["IPTC-NAA",33723],["ExifOffset",34665],["InterColorProfile",34675],["ExposureProgram",34850],["SpectralSensitivity",34852],["GPSOffset",34853],["ISOSpeed",34855],["OECF",34856],["SensitivityType",34864],["RecommendedExposureIndex",34866],["ExifVersion",36864],["DateTimeOriginal",36867],["DateTimeDigitized",36868],["OffsetTime",36880],["OffsetTimeOriginal",36881],["OffsetTimeDigitized",36882],["ComponentsConfiguration",37121],["CompressedBitsPerPixel",37122],["ShutterSpeedValue",37377],["ApertureValue",37378],["BrightnessValue",37379],["ExposureBiasValue",37380],["MaxApertureValue",37381],["SubjectDistance",37382],["MeteringMode",37383],["LightSource",37384],["Flash",37385],["FocalLength",37386],["SubjectArea",37396],["MakerNote",37500],["UserComment",37510],["SubSecTime",37520],["SubSecTimeOriginal",37521],["SubSecTimeDigitized",37522],["XPTitle",40091],["XPComment",40092],["XPAuthor",40093],["XPKeywords",40094],["XPSubject",40095],["FlashPixVersion",40960],["ColorSpace",40961],["ExifImageWidth",40962],["ExifImageLength",40963],["RelatedSoundFile",40964],["InteroperabilityOffset",40965],["FlashEnergy",41483],["SpatialFrequencyResponse",41484],["FocalPlaneXResolution",41486],["FocalPlaneYResolution",41487],["FocalPlaneResolutionUnit",41488],["SubjectLocation",41492],["ExposureIndex",41493],["SensingMethod",41495],["FileSource",41728],["SceneType",41729],["CVAPattern",41730],["CustomRendered",41985],["ExposureMode",41986],["WhiteBalance",41987],["DigitalZoomRatio",41988],["FocalLengthIn35mmFilm",41989],["SceneCaptureType",41990],["GainControl",41991],["Contrast",41992],["Saturation",41993],["Sharpness",41994],["DeviceSettingDescription",41995],["SubjectDistanceRange",41996],["ImageUniqueID",42016],["CameraOwnerName",42032],["BodySerialNumber",42033],["LensSpecification",42034],["LensMake",42035],["LensModel",42036],["LensSerialNumber",42037],["Gamma",42240],["PrintIM",50341],["Padding",59932],["OffsetSchema",59933],["OwnerName",65e3],["SerialNumber",65001],["InteropIndex",1],["InteropVersion",2],["RelatedImageFileFormat",4096],["RelatedImageWidth",4097],["RelatedImageLength",4098],["GPSVersionID",0],["GPSLatitudeRef",1],["GPSLatitude",2],["GPSLongitudeRef",3],["GPSLongitude",4],["GPSAltitudeRef",5],["GPSAltitude",6],["GPSTimeStamp",7],["GPSSatellites",8],["GPSStatus",9],["GPSMeasureMode",10],["GPSDOP",11],["GPSSpeedRef",12],["GPSSpeed",13],["GPSTrackRef",14],["GPSTrack",15],["GPSImgDirectionRef",16],["GPSImgDirection",17],["GPSMapDatum",18],["GPSDestLatitudeRef",19],["GPSDestLatitude",20],["GPSDestLongitudeRef",21],["GPSDestLongitude",22],["GPSDestBearingRef",23],["GPSDestBearing",24],["GPSDestDistanceRef",25],["GPSDestDistance",26],["GPSProcessingMethod",27],["GPSAreaInformation",28],["GPSDate",29],["GPSDifferential",30]]),Rn=new Map([[11,new R({name:"ProcessingSoftware",type:N.ascii})],[254,new R({name:"SubfileType",type:N.long,count:1})],[255,new R({name:"OldSubfileType",type:N.long,count:1})],[256,new R({name:"ImageWidth",type:N.long,count:1})],[257,new R({name:"ImageLength",type:N.long,count:1})],[258,new R({name:"BitsPerSample",type:N.short,count:1})],[259,new R({name:"Compression",type:N.short,count:1})],[262,new R({name:"PhotometricInterpretation",type:N.short,count:1})],[263,new R({name:"Thresholding",type:N.short,count:1})],[264,new R({name:"CellWidth",type:N.short,count:1})],[265,new R({name:"CellLength",type:N.short,count:1})],[266,new R({name:"FillOrder",type:N.short,count:1})],[269,new R({name:"DocumentName",type:N.ascii})],[270,new R({name:"ImageDescription",type:N.ascii})],[271,new R({name:"Make",type:N.ascii})],[272,new R({name:"Model",type:N.ascii})],[273,new R({name:"StripOffsets",type:N.long})],[274,new R({name:"Orientation",type:N.short,count:1})],[277,new R({name:"SamplesPerPixel",type:N.short,count:1})],[278,new R({name:"RowsPerStrip",type:N.long,count:1})],[279,new R({name:"StripByteCounts",type:N.long,count:1})],[280,new R({name:"MinSampleValue",type:N.short,count:1})],[281,new R({name:"MaxSampleValue",type:N.short,count:1})],[282,new R({name:"XResolution",type:N.rational,count:1})],[283,new R({name:"YResolution",type:N.rational,count:1})],[284,new R({name:"PlanarConfiguration",type:N.short,count:1})],[285,new R({name:"PageName",type:N.ascii})],[286,new R({name:"XPosition",type:N.rational,count:1})],[287,new R({name:"YPosition",type:N.rational,count:1})],[290,new R({name:"GrayResponseUnit",type:N.short,count:1})],[291,new R({name:"GrayResponseCurve"})],[292,new R({name:"T4Options"})],[293,new R({name:"T6Options"})],[296,new R({name:"ResolutionUnit",type:N.short,count:1})],[297,new R({name:"PageNumber",type:N.short,count:2})],[300,new R({name:"ColorResponseUnit"})],[301,new R({name:"TransferFunction",type:N.short,count:768})],[305,new R({name:"Software",type:N.ascii})],[306,new R({name:"DateTime",type:N.ascii})],[315,new R({name:"Artist",type:N.ascii})],[316,new R({name:"HostComputer",type:N.ascii})],[317,new R({name:"Predictor",type:N.short,count:1})],[318,new R({name:"WhitePoint",type:N.rational,count:2})],[319,new R({name:"PrimaryChromaticities",type:N.rational,count:6})],[320,new R({name:"ColorMap",type:N.short})],[321,new R({name:"HalftoneHints",type:N.short,count:2})],[322,new R({name:"TileWidth",type:N.long,count:1})],[323,new R({name:"TileLength",type:N.long,count:1})],[324,new R({name:"TileOffsets",type:N.long})],[325,new R({name:"TileByteCounts"})],[326,new R({name:"BadFaxLines"})],[327,new R({name:"CleanFaxData"})],[328,new R({name:"ConsecutiveBadFaxLines"})],[332,new R({name:"InkSet"})],[333,new R({name:"InkNames"})],[334,new R({name:"NumberofInks"})],[336,new R({name:"DotRange"})],[337,new R({name:"TargetPrinter",type:N.ascii})],[338,new R({name:"ExtraSamples"})],[339,new R({name:"SampleFormat",type:N.short,count:1})],[340,new R({name:"SMinSampleValue"})],[341,new R({name:"SMaxSampleValue"})],[342,new R({name:"TransferRange"})],[343,new R({name:"ClipPath"})],[512,new R({name:"JPEGProc"})],[513,new R({name:"JPEGInterchangeFormat"})],[514,new R({name:"JPEGInterchangeFormatLength"})],[529,new R({name:"YCbCrCoefficients",type:N.rational,count:3})],[530,new R({name:"YCbCrSubSampling",type:N.short,count:1})],[531,new R({name:"YCbCrPositioning",type:N.short,count:1})],[532,new R({name:"ReferenceBlackWhite",type:N.rational,count:6})],[700,new R({name:"ApplicationNotes",type:N.short,count:1})],[18246,new R({name:"Rating",type:N.short,count:1})],[33421,new R({name:"CFARepeatPatternDim"})],[33422,new R({name:"CFAPattern"})],[33423,new R({name:"BatteryLevel"})],[33432,new R({name:"Copyright",type:N.ascii})],[33434,new R({name:"ExposureTime",type:N.rational,count:1})],[33437,new R({name:"FNumber",type:N.rational})],[33723,new R({name:"IPTC-NAA",type:N.long,count:1})],[34665,new R({name:"ExifOffset"})],[34675,new R({name:"InterColorProfile"})],[34850,new R({name:"ExposureProgram",type:N.short})],[34852,new R({name:"SpectralSensitivity",type:N.ascii})],[34853,new R({name:"GPSOffset"})],[34855,new R({name:"ISOSpeed",type:N.long,count:1})],[34856,new R({name:"OECF"})],[34864,new R({name:"SensitivityType",type:N.short,count:1})],[34866,new R({name:"RecommendedExposureIndex",type:N.long,count:1})],[34867,new R({name:"ISOSpeed",type:N.long,count:1})],[36864,new R({name:"ExifVersion",type:N.undefined})],[36867,new R({name:"DateTimeOriginal",type:N.ascii})],[36868,new R({name:"DateTimeDigitized",type:N.ascii})],[36880,new R({name:"OffsetTime",type:N.ascii})],[36881,new R({name:"OffsetTimeOriginal",type:N.ascii})],[36882,new R({name:"OffsetTimeDigitized",type:N.ascii})],[37121,new R({name:"ComponentsConfiguration",type:N.undefined})],[37122,new R({name:"CompressedBitsPerPixel"})],[37377,new R({name:"ShutterSpeedValue"})],[37378,new R({name:"ApertureValue"})],[37379,new R({name:"BrightnessValue"})],[37380,new R({name:"ExposureBiasValue"})],[37381,new R({name:"MaxApertureValue"})],[37382,new R({name:"SubjectDistance"})],[37383,new R({name:"MeteringMode"})],[37384,new R({name:"LightSource"})],[37385,new R({name:"Flash"})],[37386,new R({name:"FocalLength"})],[37396,new R({name:"SubjectArea"})],[37500,new R({name:"MakerNote",type:N.undefined})],[37510,new R({name:"UserComment",type:N.undefined})],[37520,new R({name:"SubSecTime"})],[37521,new R({name:"SubSecTimeOriginal"})],[37522,new R({name:"SubSecTimeDigitized"})],[40091,new R({name:"XPTitle"})],[40092,new R({name:"XPComment"})],[40093,new R({name:"XPAuthor"})],[40094,new R({name:"XPKeywords"})],[40095,new R({name:"XPSubject"})],[40960,new R({name:"FlashPixVersion"})],[40961,new R({name:"ColorSpace",type:N.short,count:1})],[40962,new R({name:"ExifImageWidth",type:N.short,count:1})],[40963,new R({name:"ExifImageLength",type:N.short,count:1})],[40964,new R({name:"RelatedSoundFile"})],[40965,new R({name:"InteroperabilityOffset"})],[41483,new R({name:"FlashEnergy"})],[41484,new R({name:"SpatialFrequencyResponse"})],[41486,new R({name:"FocalPlaneXResolution"})],[41487,new R({name:"FocalPlaneYResolution"})],[41488,new R({name:"FocalPlaneResolutionUnit"})],[41492,new R({name:"SubjectLocation"})],[41493,new R({name:"ExposureIndex"})],[41495,new R({name:"SensingMethod"})],[41728,new R({name:"FileSource"})],[41729,new R({name:"SceneType"})],[41730,new R({name:"CVAPattern"})],[41985,new R({name:"CustomRendered"})],[41986,new R({name:"ExposureMode"})],[41987,new R({name:"WhiteBalance"})],[41988,new R({name:"DigitalZoomRatio"})],[41989,new R({name:"FocalLengthIn35mmFilm"})],[41990,new R({name:"SceneCaptureType"})],[41991,new R({name:"GainControl"})],[41992,new R({name:"Contrast"})],[41993,new R({name:"Saturation"})],[41994,new R({name:"Sharpness"})],[41995,new R({name:"DeviceSettingDescription"})],[41996,new R({name:"SubjectDistanceRange"})],[42016,new R({name:"ImageUniqueID"})],[42032,new R({name:"CameraOwnerName",type:N.ascii})],[42033,new R({name:"BodySerialNumber",type:N.ascii})],[42034,new R({name:"LensSpecification"})],[42035,new R({name:"LensMake",type:N.ascii})],[42036,new R({name:"LensModel",type:N.ascii})],[42037,new R({name:"LensSerialNumber",type:N.ascii})],[42240,new R({name:"Gamma",type:N.rational,count:1})],[50341,new R({name:"PrintIM"})],[59932,new R({name:"Padding"})],[59933,new R({name:"OffsetSchema"})],[65e3,new R({name:"OwnerName",type:N.ascii})],[65001,new R({name:"SerialNumber",type:N.ascii})]]);new R({name:"InteropIndex",type:N.ascii}),new R({name:"InteropVersion",type:N.undefined}),new R({name:"RelatedImageFileFormat",type:N.ascii}),new R({name:"RelatedImageWidth",type:N.short,count:1}),new R({name:"RelatedImageLength",type:N.short,count:1});new R({name:"GPSVersionID"}),new R({name:"GPSLatitudeRef"}),new R({name:"GPSLatitude"}),new R({name:"GPSLongitudeRef"}),new R({name:"GPSLongitude"}),new R({name:"GPSAltitudeRef"}),new R({name:"GPSAltitude"}),new R({name:"GPSTimeStamp"}),new R({name:"GPSSatellites"}),new R({name:"GPSStatus"}),new R({name:"GPSMeasureMode"}),new R({name:"GPSDOP"}),new R({name:"GPSSpeedRef"}),new R({name:"GPSSpeed"}),new R({name:"GPSTrackRef"}),new R({name:"GPSTrack"}),new R({name:"GPSImgDirectionRef"}),new R({name:"GPSImgDirection"}),new R({name:"GPSMapDatum"}),new R({name:"GPSDestLatitudeRef"}),new R({name:"GPSDestLatitude"}),new R({name:"GPSDestLongitudeRef"}),new R({name:"GPSDestLongitude"}),new R({name:"GPSDestBearingRef"}),new R({name:"GPSDestBearing"}),new R({name:"GPSDestDistanceRef"}),new R({name:"GPSDestDistance"}),new R({name:"GPSProcessingMethod"}),new R({name:"GPSAreaInformation"}),new R({name:"GPSDate"}),new R({name:"GPSDifferential"});class ae{get type(){return N.none}get length(){return 0}get dataSize(){return ws(this.type,this.length)}get typeString(){return bs(this.type)}toBool(t){return!1}toInt(t){return 0}toDouble(t){return 0}toData(){return new Uint8Array}toRational(t){return new Xt(0,1)}write(t){}setBool(t,e){}setInt(t,e){}setDouble(t,e){}setRational(t,e,i){}setString(t){}equals(t){return!1}clone(){throw new W("Cannot be copied.")}toString(){return""}}class Zt extends ae{get type(){return N.ascii}get length(){return Bt.getCodePoints(this._value).length+1}constructor(t){super(),typeof t=="string"?this._value=t:this._value=String.fromCodePoint(...t)}static data(t,e){const i=e>0?t.readString(e-1):"";return new Zt(i)}toData(){return Bt.getCodePoints(this._value)}write(t){const e=Bt.getCodePoints(this._value);t.writeBytes(e),t.writeByte(0)}setString(t){this._value=t}equals(t){return t instanceof Zt&&this.length===t.length&&this._value===this._value}clone(){return new Zt(this._value)}toString(){return this._value}}class ue extends ae{get type(){return N.short}get length(){return this._value.length}constructor(t){super(),typeof t=="number"?(this._value=new Uint16Array(1),this._value[0]=t):this._value=Uint16Array.from(t)}static data(t,e){const i=new Uint16Array(e);for(let n=0;n<e;++n)i[n]=t.readUint16();return new ue(i)}toInt(t=0){return this._value[t]}toData(){return new Uint8Array(this._value.buffer)}write(t){for(let e=0,i=this._value.length;e<i;++e)t.writeUint16(this._value[e])}setInt(t,e=0){this._value[e]=t}equals(t){return t instanceof ue&&this.length===t.length&&F.equals(this._value,t._value)}clone(){return new ue(this._value)}toString(){return`[${this._value.toString()}]`}}class ce extends ae{get type(){return N.rational}get length(){return this._value.length}constructor(t){super(),t instanceof Xt?this._value=[t]:this._value=t}static data(t,e){const i=new Array;for(let n=0;n<e;n++){const s=new Xt(t.readUint32(),t.readUint32());i.push(s)}return new ce(i)}static from(t){const e=new Xt(t.numerator,t.denominator);return new ce(e)}toInt(t=0){return this._value[t].toInt}toDouble(t=0){return this._value[t].toDouble}toRational(t=0){return this._value[t]}write(t){for(const e of this._value)t.writeUint32(e.numerator),t.writeUint32(e.denominator)}setRational(t,e,i=0){this._value[i]=new Xt(t,e)}equals(t){return t instanceof ce&&this.length===t.length&&F.equalsRationalArray(this._value,t._value)}clone(){return new ce(this._value)}toString(){return`[${this._value.toString()}]`}}class Qe extends ae{get type(){return N.byte}get length(){return this._value.length}constructor(t){super(),typeof t=="number"?(this._value=new Uint8Array(1),this._value[0]=t):this._value=Uint8Array.from(t)}static data(t,e,i){const n=t.toUint8Array(e,i);return new Qe(n)}toInt(t=0){return this._value[t]}toData(){return this._value}write(t){t.writeBytes(this._value)}setInt(t,e=0){this._value[e]=t}equals(t){return t instanceof Qe&&this.length===t.length&&F.equals(this._value,t._value)}clone(){return new Qe(this._value)}toString(){return`[${this._value.toString()}]`}}class ze extends ae{get type(){return N.long}get length(){return this._value.length}constructor(t){super(),typeof t=="number"?(this._value=new Uint32Array(1),this._value[0]=t):this._value=Uint32Array.from(t)}static data(t,e){const i=new Uint32Array(e);for(let n=0;n<e;++n)i[n]=t.readUint32();return new ze(i)}toInt(t=0){return this._value[t]}toData(){return new Uint8Array(this._value.buffer)}write(t){for(let e=0,i=this._value.length;e<i;++e)t.writeUint32(this._value[e])}setInt(t,e=0){this._value[e]=t}equals(t){return t instanceof ze&&this.length===t.length&&F.equals(this._value,t._value)}clone(){return new ze(this._value)}toString(){return`[${this._value.toString()}]`}}class ii extends ae{get type(){return N.sByte}get length(){return this._value.length}constructor(t){super(),typeof t=="number"?(this._value=new Int8Array(1),this._value[0]=t):this._value=Int8Array.from(t)}static data(t,e,i){const n=new Int8Array(new Int8Array(t.toUint8Array(e,i).buffer));return new ii(n)}toInt(t=0){return this._value[t]}toData(){return new Uint8Array(this._value.buffer)}write(t){t.writeBytes(new Uint8Array(this._value.buffer))}setInt(t,e=0){this._value[e]=t}equals(t){return t instanceof ii&&this.length===t.length&&F.equals(this._value,t._value)}clone(){return new ii(this._value)}toString(){return`[${this._value.toString()}]`}}class ni extends ae{get type(){return N.undefined}get length(){return this._value.length}constructor(t){super(),typeof t=="number"?(this._value=new Uint8Array(1),this._value[0]=t):this._value=t}static data(t,e,i){const n=new Uint8Array(t.toUint8Array(e,i));return new ni(n)}toData(){return this._value}write(t){t.writeBytes(this._value)}equals(t){return t instanceof ni&&this.length===t.length&&F.equals(this._value,t._value)}clone(){return new ni(this._value)}toString(){return"undefined"}}class si extends ae{get type(){return N.sShort}get length(){return this._value.length}constructor(t){super(),typeof t=="number"?(this._value=new Int16Array(1),this._value[0]=t):this._value=Int16Array.from(t)}static data(t,e){const i=new Int16Array(e);for(let n=0;n<e;++n)i[n]=t.readInt16();return new si(i)}toInt(t=0){return this._value[t]}toData(){return new Uint8Array(this._value.buffer)}write(t){const e=new Int16Array(1),i=new Uint16Array(e.buffer);for(let n=0,s=this._value.length;n<s;++n)e[0]=this._value[n],t.writeUint16(i[0])}setInt(t,e=0){this._value[e]=t}equals(t){return t instanceof si&&this.length===t.length&&F.equals(this._value,t._value)}clone(){return new si(this._value)}toString(){return`[${this._value.toString()}]`}}class ai extends ae{get type(){return N.sLong}get length(){return this._value.length}constructor(t){super(),typeof t=="number"?(this._value=new Int32Array(1),this._value[0]=t):this._value=Int32Array.from(t)}static data(t,e){const i=new Int32Array(e);for(let n=0;n<e;++n)i[n]=t.readInt32();return new ai(i)}toInt(t=0){return this._value[t]}toData(){return new Uint8Array(this._value.buffer)}write(t){for(let e=0,i=this._value.length;e<i;++e)t.writeUint32(q.int32ToUint32(this._value[e]))}setInt(t,e=0){this._value[e]=t}equals(t){return t instanceof ai&&this.length===t.length&&F.equals(this._value,t._value)}clone(){return new ai(this._value)}toString(){return`[${this._value.toString()}]`}}class Ue extends ae{get type(){return N.sRational}get length(){return this._value.length}constructor(t){super(),t instanceof Xt?this._value=[t]:this._value=t}static data(t,e){const i=new Array;for(let n=0;n<e;n++){const s=new Xt(t.readInt32(),t.readInt32());i.push(s)}return new Ue(i)}static from(t){const e=new Xt(t.numerator,t.denominator);return new Ue(e)}toInt(t=0){return this._value[t].toInt}toDouble(t=0){return this._value[t].toDouble}toRational(t=0){return this._value[t]}write(t){for(const e of this._value)t.writeUint32(q.int32ToUint32(e.numerator)),t.writeUint32(q.int32ToUint32(e.denominator))}setRational(t,e,i=0){this._value[i]=new Xt(t,e)}equals(t){return t instanceof Ue&&this.length===t.length&&F.equalsRationalArray(this._value,t._value)}clone(){return new Ue(this._value)}toString(){return`[${this._value.toString()}]`}}class ri extends ae{get type(){return N.single}get length(){return this._value.length}constructor(t){super(),typeof t=="number"?(this._value=new Float32Array(1),this._value[0]=t):this._value=Float32Array.from(t)}static data(t,e){const i=new Float32Array(e);for(let n=0;n<e;++n)i[n]=t.readFloat32();return new ri(i)}toDouble(t=0){return this._value[t]}toData(){return new Uint8Array(this._value.buffer)}write(t){for(let e=0,i=this._value.length;e<i;++e)t.writeFloat32(this._value[e])}setDouble(t,e=0){this._value[e]=t}equals(t){return t instanceof ri&&this.length===t.length&&F.equals(this._value,t._value)}clone(){return new ri(this._value)}toString(){return`[${this._value.toString()}]`}}class Ie extends ae{get type(){return N.double}get length(){return this._value.length}constructor(t){super(),typeof t=="number"?(this._value=new Float64Array(1),this._value[0]=t):this._value=Float64Array.from(t)}static data(t,e){const i=new Float64Array(e);for(let n=0;n<e;++n)i[n]=t.readFloat64();return new Ie(i)}toDouble(t=0){return this._value[t]}toData(){return new Uint8Array(this._value.buffer)}write(t){for(let e=0,i=this._value.length;e<i;++e)t.writeFloat64(this._value[e])}setDouble(t,e=0){this._value[e]=t}equals(t){return t instanceof Ie&&this.length===t.length&&F.equals(this._value,t._value)}clone(){return new Ie(this._value)}toString(){return`[${this._value.toString()}]`}}class zi extends ae{get type(){return N.ifd}get length(){return 1}constructor(t){super(),this._offset=t}static data(t){const e=t.readUint32();return new zi(e)}toInt(t=0){if(t!==0)throw new W("Ifd tags are required to have a single entry (the offset).");return this._offset}toData(){return Uint8Array.from([this._offset>>24,this._offset>>16,this._offset>>8,this._offset])}write(t){t.writeUint32(this._offset)}setInt(t,e=0){if(e!==0)throw new W("Ifd tags are required to have a single entry (the offset).");this._offset=t}equals(t){return t instanceof zi&&this.length===t.length&&this._offset===t._offset}clone(){return new zi(this._offset)}toString(){return this._offset.toString()}}class xi{get sub(){return this._sub}get keys(){return this._data.keys()}get values(){return this._data.values()}get entries(){return this._data.entries()}get size(){return this._data.size}get isEmpty(){return this._data.size===0&&this._sub.isEmpty}get hasUserComment(){return this._data.has(37510)}get userComment(){var t;const e=(t=this._data.get(37510))===null||t===void 0?void 0:t.toData();return e!==void 0?Bt.utf8Decoder.decode(e):void 0}set userComment(t){if(t===void 0)this._data.delete(37510);else{const e=Bt.getCodePoints(t);this._data.set(37510,new ni(e))}}get hasImageDescription(){return this._data.has(270)}get imageDescription(){var t;return(t=this._data.get(270))===null||t===void 0?void 0:t.toString()}set imageDescription(t){t===void 0?this._data.delete(270):this._data.set(270,new Zt(t))}get hasMake(){return this._data.has(271)}get make(){var t;return(t=this._data.get(271))===null||t===void 0?void 0:t.toString()}set make(t){t===void 0?this._data.delete(271):this._data.set(271,new Zt(t))}get hasModel(){return this._data.has(272)}get model(){var t;return(t=this._data.get(272))===null||t===void 0?void 0:t.toString()}set model(t){t===void 0?this._data.delete(272):this._data.set(272,new Zt(t))}get hasOrientation(){return this._data.has(274)}get orientation(){var t;return(t=this._data.get(274))===null||t===void 0?void 0:t.toInt()}set orientation(t){t===void 0?this._data.delete(274):this._data.set(274,new ue(t))}get hasResolutionX(){return this._data.has(282)}get resolutionX(){var t;return(t=this._data.get(282))===null||t===void 0?void 0:t.toRational()}set resolutionX(t){this.setRational(282,t)||this._data.delete(282)}get hasResolutionY(){return this._data.has(283)}get resolutionY(){var t;return(t=this._data.get(283))===null||t===void 0?void 0:t.toRational()}set resolutionY(t){this.setRational(283,t)||this._data.delete(283)}get hasResolutionUnit(){return this._data.has(296)}get resolutionUnit(){var t;return(t=this._data.get(296))===null||t===void 0?void 0:t.toInt()}set resolutionUnit(t){t===void 0?this._data.delete(296):this._data.set(296,new ue(Math.trunc(t)))}get hasImageWidth(){return this._data.has(256)}get imageWidth(){var t;return(t=this._data.get(256))===null||t===void 0?void 0:t.toInt()}set imageWidth(t){t===void 0?this._data.delete(256):this._data.set(256,new ue(Math.trunc(t)))}get hasImageHeight(){return this._data.has(257)}get imageHeight(){var t;return(t=this._data.get(257))===null||t===void 0?void 0:t.toInt()}set imageHeight(t){t===void 0?this._data.delete(257):this._data.set(257,new ue(Math.trunc(t)))}get hasSoftware(){return this._data.has(305)}get software(){var t;return(t=this._data.get(305))===null||t===void 0?void 0:t.toString()}set software(t){t===void 0?this._data.delete(305):this._data.set(305,new Zt(t))}get hasCopyright(){return this._data.has(33432)}get copyright(){var t;return(t=this._data.get(33432))===null||t===void 0?void 0:t.toString()}set copyright(t){t===void 0?this._data.delete(33432):this._data.set(33432,new Zt(t))}get hasGPSLatitudeRef(){return this._data.has(1)}get gpsLatitudeRef(){var t;return(t=this._data.get(1))===null||t===void 0?void 0:t.toString()}set gpsLatitudeRef(t){t===void 0?this._data.delete(1):this._data.set(1,new Zt(t))}get hasGPSLatitude(){return this._data.has(2)}get gpsLatitude(){var t;return(t=this._data.get(2))===null||t===void 0?void 0:t.toDouble()}set gpsLatitude(t){t===void 0?this._data.delete(2):this._data.set(2,new Ie(t))}get hasGPSLongitudeRef(){return this._data.has(3)}get gpsLongitudeRef(){var t;return(t=this._data.get(3))===null||t===void 0?void 0:t.toString()}set gpsLongitudeRef(t){t===void 0?this._data.delete(3):this._data.set(3,new Zt(t))}get hasGPSLongitude(){return this._data.has(4)}get gpsLongitude(){var t;return(t=this._data.get(4))===null||t===void 0?void 0:t.toDouble()}set gpsLongitude(t){t===void 0?this._data.delete(4):this._data.set(4,new Ie(t))}get hasGPSDate(){return this._data.has(29)}get gpsDate(){var t;return(t=this._data.get(29))===null||t===void 0?void 0:t.toString()}set gpsDate(t){t===void 0?this._data.delete(29):this._data.set(29,new Zt(t))}get dataSize(){let e=2+12*this.size+4;for(const i of this.values){const n=i.dataSize;n>4&&(e+=n)}for(const[i,n]of this.sub.entries){let s=2+12*n.size;for(const a of n.values){const r=a.dataSize;r>4&&(s+=r)}e+=s}return e}constructor(t){this._sub=new xn,this._data=t??new Map}setRational(t,e){if(e instanceof Xt)return this._data.set(t,ce.from(e)),!0;if(F.isNumArrayOrTypedArray(e)&&e.length>=2){const i=new Xt(e[0],e[1]);return this._data.set(t,ce.from(i)),!0}return!1}static from(t){return new xi(new Map(t._data))}static isArrayOfRationalNumbers(t){return Array.isArray(t)&&t.every(e=>F.isNumArrayOrTypedArray(e)&&e.length>=2)}has(t){return this._data.has(t)}get(t){let e=t;if(typeof e=="string"&&(e=pt.get(e)),typeof e=="number")return this._data.get(e)}set(t,e){let i=t;if(typeof i=="string"&&(i=pt.get(i)),typeof i=="number")if(e===void 0)this._data.delete(i);else if(e instanceof ae)this._data.set(i,e);else{const n=Rn.get(i);if(n!==void 0)switch(n.type){case N.byte:F.isNumArrayOrTypedArray(e)?this._data.set(i,new Qe(new Uint8Array(e))):typeof e=="number"&&this._data.set(i,new Qe(e));break;case N.ascii:typeof e=="string"&&this._data.set(i,new Zt(e));break;case N.short:F.isNumArrayOrTypedArray(e)?this._data.set(i,new ue(new Uint16Array(e))):typeof e=="number"&&this._data.set(i,new ue(e));break;case N.long:F.isNumArrayOrTypedArray(e)?this._data.set(i,new ze(new Uint32Array(e))):typeof e=="number"&&this._data.set(i,new ze(e));break;case N.rational:if(F.isArrayOfRational(e))this._data.set(i,new ce(e));else if(F.isNumArrayOrTypedArray(e)&&e.length>=2){const a=new Xt(e[0],e[1]);this._data.set(i,new ce(a))}else e instanceof Xt&&this._data.set(i,new ce(e));break;case N.sByte:F.isNumArrayOrTypedArray(e)?this._data.set(i,new ii(new Int8Array(e))):typeof e=="number"&&this._data.set(i,new ii(e));break;case N.undefined:F.isNumArrayOrTypedArray(e)&&this._data.set(i,new ni(new Uint8Array(e)));break;case N.sShort:F.isNumArrayOrTypedArray(e)?this._data.set(i,new si(new Int16Array(e))):typeof e=="number"&&this._data.set(i,new si(e));break;case N.sLong:F.isNumArrayOrTypedArray(e)?this._data.set(i,new ai(new Int32Array(e))):typeof e=="number"&&this._data.set(i,new ai(e));break;case N.sRational:if(F.isArrayOfRational(e))this._data.set(i,new Ue(e));else if(F.isNumArrayOrTypedArray(e)&&e.length>=2){const a=new Xt(e[0],e[1]);this._data.set(i,new Ue(a))}else e instanceof Xt&&this._data.set(i,new Ue(e));break;case N.single:F.isNumArrayOrTypedArray(e)?this._data.set(i,new ri(new Float32Array(e))):typeof e=="number"&&this._data.set(i,new ri(e));break;case N.double:F.isNumArrayOrTypedArray(e)?this._data.set(i,new Ie(new Float64Array(e))):typeof e=="number"&&this._data.set(i,new Ie(e));break;case N.ifd:typeof e=="number"&&this._data.set(i,new zi(e));break;case N.none:break}}}setGpsLocation(t,e){this.gpsLatitude=Math.abs(t),this.gpsLongitude=Math.abs(e),this.gpsLatitudeRef=t<0?"S":"N",this.gpsLongitudeRef=e<0?"W":"E"}copyFrom(t){t._data.forEach((e,i)=>this._data.set(i,e.clone()));for(const[e,i]of t._sub.entries)this._sub.set(e,i.clone())}clone(){return xi.from(this)}}class xn{get keys(){return this.directories.keys()}get values(){return this.directories.values()}get entries(){return this.directories.entries()}get size(){return this.directories.size}get isEmpty(){if(this.directories.size===0)return!0;for(const t of this.directories.values())if(!t.isEmpty)return!1;return!0}constructor(t){this.directories=t??new Map}static from(t){const e=new Map(t.directories);return new xn(e)}has(t){return this.directories.has(t)}get(t){let e=this.directories.get(t);return e===void 0&&(e=new xi,this.directories.set(t,e)),e}set(t,e){this.directories.set(t,e)}clear(){this.directories.clear()}}class me extends xn{get imageIfd(){return this.get("ifd0")}get thumbnailIfd(){return this.get("ifd1")}get exifIfd(){return this.get("ifd0").sub.get("exif")}get gpsIfd(){return this.get("ifd0").sub.get("gps")}get interopIfd(){return this.get("ifd0").sub.get("interop")}get dataSize(){var t,e;return 8+((e=(t=this.directories.get("ifd0"))===null||t===void 0?void 0:t.dataSize)!==null&&e!==void 0?e:0)}hasTag(t){for(const e of this.directories.values())if(e.has(t))return!0;return!1}getTag(t){for(const e of this.directories.values())if(e.has(t))return e.get(t)}getTagName(t){var e,i;return(i=(e=Rn.get(t))===null||e===void 0?void 0:e.name)!==null&&i!==void 0?i:"<unknown>"}write(t){const e=t.bigEndian;t.bigEndian=!0,t.writeUint16(19789),t.writeUint16(42),t.writeUint32(8),this.directories.get("ifd0")===void 0&&this.directories.set("ifd0",new xi);const i=["ifd0"];i.push(...Array.from(this.directories.keys()).filter(r=>r!=="ifd0"));let n=8;const s=new Map;for(const r of i){const h=this.directories.get(r);s.set(r,n),h.sub.has("exif")?h.set(34665,new ze(0)):h.set(34665,void 0),h.sub.has("interop")?h.set(40965,new ze(0)):h.set(40965,void 0),h.sub.has("gps")?h.set(34853,new ze(0)):h.set(34853,void 0),n+=2+12*h.size+4;for(const l of h.values){const u=l.dataSize;u>4&&(n+=u)}for(const[l,u]of h.sub.entries){s.set(l,n);let d=2+12*u.size;for(const c of u.values){const g=c.dataSize;g>4&&(d+=g)}n+=d}}const a=i.length;for(let r=0;r<a;++r){const h=i[r],l=this.directories.get(h);l.sub.has("exif")&&l.get(34665).setInt(s.get("exif")),l.sub.has("interop")&&l.get(40965).setInt(s.get("interop")),l.sub.has("gps")&&l.get(34853).setInt(s.get("gps"));const d=s.get(h)+2+12*l.size+4;this.writeDirectory(t,l,d),r===a-1?t.writeUint32(0):t.writeUint32(s.get(i[r+1])),this.writeDirectoryLargeValues(t,l);for(const[c,g]of l.sub.entries){const m=s.get(c)+2+12*g.size;this.writeDirectory(t,g,m),this.writeDirectoryLargeValues(t,g)}}t.bigEndian=e}read(t){const e=t.bigEndian;t.bigEndian=!0;const i=t.offset,n=t.readUint16();if(n===18761){if(t.bigEndian=!1,t.readUint16()!==42)return t.bigEndian=e,!1}else if(n===19789){if(t.bigEndian=!0,t.readUint16()!==42)return t.bigEndian=e,!1}else return!1;let s=t.readUint32(),a=0;for(;s>0&&(t.offset=i+s,!(t.length<2));){const h=new xi,l=t.readUint16(),u=new Array;for(let c=0;c<l;c++){const g=this.readEntry(t,i);u.push(g)}for(const c of u)c.value!==void 0&&h.set(c.tag,c.value);this.directories.set(`ifd${a}`,h),a++;const d=t.readUint32();if(d===s)break;s=d}const r=new Map([[34665,"exif"],[40965,"interop"],[34853,"gps"]]);for(const h of this.directories.values())for(const l of r.keys())try{const u=h.get(l).toInt();t.offset=i+u;const d=new xi,c=t.readUint16(),g=F.generate(c,f=>this.readEntry(t,i));for(const f of g)f.value!==void 0&&d.set(f.tag,f.value);h.sub.set(r.get(l),d)}catch{continue}return t.bigEndian=e,!1}clone(){return me.from(this)}toString(){let t="";for(const[e,i]of this.directories){t+=`${e}
`;for(const[n,s]of i.entries)s===void 0?t+=`	${this.getTagName(n)}
`:t+=`	${this.getTagName(n)}: ${s.toString()}
`;for(const[n,s]of i.sub.entries){t+=`${n}
`;for(const[a,r]of s.entries)r===void 0?t+=`	${this.getTagName(a)}
`:t+=`	${this.getTagName(a)}: ${r}
`}}return`${this.constructor.name} (${t})`}static from(t){const e=new Map(t.directories);return new me(e)}static fromInputBuffer(t){const e=new me;return e.read(t),e}writeDirectory(t,e,i){let n=i;const s=pt.get("StripOffsets");t.writeUint16(e.size);for(const[a,r]of e.entries){const h=a===s&&r.type===N.undefined?N.long:r.type,l=a===s&&r.type===N.undefined?1:r.length;t.writeUint16(a),t.writeUint16(h),t.writeUint32(l);let u=r.dataSize;if(u<=4)for(r.write(t);u<4;)t.writeByte(0),u++;else t.writeUint32(n),n+=u}return n}writeDirectoryLargeValues(t,e){for(const i of e.values)i.dataSize>4&&i.write(t)}readEntry(t,e){const i=t.readUint16(),n=t.readUint16(),s=t.readUint32(),a=new xs(i,void 0);if(n>Object.keys(N).length)return a;const r=n,h=_n[n],l=s*h,u=t.offset+4;if(l>4){const c=t.readUint32();t.offset=c+e}if(t.offset+l>t.end)return a;const d=t.readRange(l);switch(r){case N.none:break;case N.sByte:a.value=ii.data(d,s);break;case N.byte:a.value=Qe.data(d,s);break;case N.undefined:a.value=ni.data(d,s);break;case N.ascii:a.value=Zt.data(d,s);break;case N.short:a.value=ue.data(d,s);break;case N.long:a.value=ze.data(d,s);break;case N.rational:a.value=ce.data(d,s);break;case N.sRational:a.value=Ue.data(d,s);break;case N.sShort:a.value=si.data(d,s);break;case N.sLong:a.value=ai.data(d,s);break;case N.single:a.value=ri.data(d,s);break;case N.double:a.value=Ie.data(d,s);break;case N.ifd:s===1&&(a.value=zi.data(d));break}return t.offset=u,a}}var hi;(function(o){o[o.animation=0]="animation",o[o.page=1]="page",o[o.sequence=2]="sequence"})(hi||(hi={}));function _e(o,t){var e;const i=t?.order,n=(e=t?.inPlace)!==null&&e!==void 0?e:!1;if(i===void 0)return o.toUint8Array();if(o.numChannels===4){if(i===lt.abgr||i===lt.argb||i===lt.bgra){const s=n?o:o.clone();if(i===lt.abgr)for(const a of s){const r=a.r,h=a.g,l=a.b,u=a.a;a.r=u,a.g=l,a.b=h,a.a=r}else if(i===lt.argb)for(const a of s){const r=a.r,h=a.g,l=a.b,u=a.a;a.r=u,a.g=r,a.b=h,a.a=l}else if(i===lt.bgra)for(const a of s){const r=a.r,h=a.g,l=a.b,u=a.a;a.r=l,a.g=h,a.b=r,a.a=u}return s.toUint8Array()}}else if(o.numChannels===3&&i===lt.bgr){const s=n?o:o.clone();for(const a of s){const r=a.r;a.r=a.b,a.b=r}return s.toUint8Array()}return o.toUint8Array()}class we{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.r}set index(t){this.r=t}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){return this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.float16}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){}get r(){return this.numChannels>0?$.float16ToDouble(this.data[this._index]):0}set r(t){this.numChannels>0&&(this.data[this._index]=$.doubleToFloat16(t))}get g(){return this.numChannels>1?$.float16ToDouble(this.data[this._index+1]):0}set g(t){this.numChannels>1&&(this.data[this._index+1]=$.doubleToFloat16(t))}get b(){return this.numChannels>2?$.float16ToDouble(this.data[this._index+2]):0}set b(t){this.numChannels>2&&(this.data[this._index+2]=$.doubleToFloat16(t))}get a(){return this.numChannels>3?$.float16ToDouble(this.data[this._index+3]):0}set a(t){this.numChannels>3&&(this.data[this._index+3]=$.doubleToFloat16(t))}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t,e,i,n){this._image=n,this._index=i,this._x=t,this._y=e}static imageData(t){return new we(-1,0,-t.numChannels,t)}static image(t){return new we(-1,0,-t.numChannels,t.data instanceof Ui?t.data:new Ui(0,0,0))}static from(t){return new we(t.x,t.y,t._index,t.image)}next(){return this._x++,this._x===this.width&&(this._x=0,this._y++,this._y===this.height)?{done:!0,value:this}:(this._index+=this.numChannels,{done:this._index>=this.image.data.length,value:this})}setPosition(t,e){this._x=t,this._y=e,this._index=this._y*this._image.width*this._image.numChannels+this._x*this._image.numChannels}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return t===X.luminance?this.luminance:t<this.numChannels?$.float16ToDouble(this.data[this._index+t]):0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.numChannels&&(this.data[this._index+t]=$.doubleToFloat16(e))}set(t){this.numChannels>0&&(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a)}setRgb(t,e,i){this.numChannels>0&&(this.data[this._index]=$.doubleToFloat16(t),this.numChannels>1&&(this.data[this._index+1]=$.doubleToFloat16(e),this.numChannels>2&&(this.data[this._index+2]=$.doubleToFloat16(i))))}setRgba(t,e,i,n){this.numChannels>0&&(this.data[this._index]=$.doubleToFloat16(t),this.numChannels>1&&(this.data[this._index+1]=$.doubleToFloat16(e),this.numChannels>2&&(this.data[this._index+2]=$.doubleToFloat16(i),this.numChannels>3&&(this.data[this._index+3]=$.doubleToFloat16(n)))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}equals(t){return t instanceof we?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}clone(){return we.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}[Symbol.iterator](){return this}}class xe{constructor(t,e,i,n,s){this._pixel=t,this._x1=e,this._y1=i,this._x2=e+n-1,this._y2=i+s-1,this._pixel.setPosition(e-1,i)}next(){return this._pixel.x+1>this._x2?(this._pixel.setPosition(this._x1,this._pixel.y+1),{done:this._pixel.y>this._y2,value:this._pixel}):this._pixel.next()}[Symbol.iterator](){return this}}class Ui{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.float16}get formatType(){return wt.float}get buffer(){return this._data.buffer}get rowStride(){return this._width*this._numChannels*2}get iterator(){return we.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){return 1}get maxIndexValue(){return 1}get hasPalette(){return this.palette!==void 0}get palette(){}get isHdrFormat(){return!0}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 16}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._data=n??new Uint16Array(this._width*this._height*this._numChannels)}static from(t,e=!1){const i=e?new Uint16Array(t.data.length):t.data.slice();return new Ui(t.width,t.height,t._numChannels,i)}getRange(t,e,i,n){return new xe(we.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?Fe.rgb(t,e,i):Fe.rgba(t,e,i,n)}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof we)||n.image!==this)&&(n=we.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){const n=e*this._width*this._numChannels+t*this.numChannels;this.data[n]=$.doubleToFloat16(i)}setPixelRgb(t,e,i,n,s){const a=e*this._width*this._numChannels+t*this._numChannels;this._data[a]=$.doubleToFloat16(i),this._numChannels>1&&(this._data[a+1]=$.doubleToFloat16(n),this._numChannels>2&&(this._data[a+2]=$.doubleToFloat16(s)))}setPixelRgba(t,e,i,n,s,a){const r=e*this._width*this._numChannels+t*this._numChannels;this._data[r]=$.doubleToFloat16(i),this._numChannels>1&&(this._data[r+1]=$.doubleToFloat16(n),this._numChannels>2&&(this._data[r+2]=$.doubleToFloat16(s),this._numChannels>3&&(this._data[r+3]=$.doubleToFloat16(a))))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return Ui.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return we.imageData(this)}}class pe{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.r}set index(t){this.r=t}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){return this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.float32}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){}get r(){return this.numChannels>0?this.data[this._index]:0}set r(t){this.numChannels>0&&(this.data[this._index]=t)}get g(){return this.numChannels>1?this.data[this._index+1]:0}set g(t){this.numChannels>1&&(this.data[this._index+1]=t)}get b(){return this.numChannels>2?this.data[this._index+2]:0}set b(t){this.numChannels>2&&(this.data[this._index+2]=t)}get a(){return this.numChannels>3?this.data[this._index+3]:1}set a(t){this.numChannels>3&&(this.data[this._index+3]=t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t,e,i,n){this._image=n,this._index=i,this._x=t,this._y=e}static imageData(t){return new pe(-1,0,-t.numChannels,t)}static image(t){return new pe(-1,0,-t.numChannels,t.data instanceof Ii?t.data:new Ii(0,0,0))}static from(t){return new pe(t.x,t.y,t._index,t.image)}next(){return this._x++,this._x===this.width&&(this._x=0,this._y++,this._y===this.height)?{done:!0,value:this}:(this._index+=this.numChannels,{done:this._index>=this.image.data.length,value:this})}setPosition(t,e){this._x=t,this._y=e,this._index=this._y*this._image.width*this._image.numChannels+this._x*this._image.numChannels}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return t===X.luminance?this.luminance:t<this.numChannels?this.data[this._index+t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.numChannels&&(this.data[this._index+t]=e)}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}setRgb(t,e,i){this.numChannels>0&&(this.data[this._index]=t,this.numChannels>1&&(this.data[this._index+1]=e,this.numChannels>2&&(this.data[this._index+2]=i)))}setRgba(t,e,i,n){this.numChannels>0&&(this.data[this._index]=t,this.numChannels>1&&(this.data[this._index+1]=e,this.numChannels>2&&(this.data[this._index+2]=i,this.numChannels>3&&(this.data[this._index+3]=n))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}equals(t){return t instanceof pe?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}clone(){return pe.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}[Symbol.iterator](){return this}}class Ii{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.float32}get formatType(){return wt.float}get buffer(){return this._data.buffer}get rowStride(){return this._width*this._numChannels*4}get iterator(){return pe.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){return 1}get maxIndexValue(){return 1}get hasPalette(){return this.palette!==void 0}get palette(){}get isHdrFormat(){return!0}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 32}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._data=n??new Float32Array(this._width*this._height*this._numChannels)}static from(t,e=!1){const i=e?new Float32Array(t.data.length):t.data.slice();return new Ii(t.width,t.height,t._numChannels,i)}getRange(t,e,i,n){return new xe(pe.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?Te.rgb(t,e,i):Te.rgba(t,e,i,n)}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof pe)||n.image!==this)&&(n=pe.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){const n=e*this._width*this._numChannels+t*this.numChannels;this.data[n]=i}setPixelRgb(t,e,i,n,s){const a=e*this._width*this._numChannels+t*this._numChannels;this._data[a]=i,this._numChannels>1&&(this._data[a+1]=n,this._numChannels>2&&(this._data[a+2]=s))}setPixelRgba(t,e,i,n,s,a){const r=e*this._width*this._numChannels+t*this._numChannels;this._data[r]=i,this._numChannels>1&&(this._data[r+1]=n,this._numChannels>2&&(this._data[r+2]=s,this._numChannels>3&&(this._data[r+3]=a)))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return Ii.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return pe.imageData(this)}}class Ce{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.r}set index(t){this.r=t}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){return this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.float64}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){}get r(){return this.numChannels>0?this.data[this._index]:0}set r(t){this.numChannels>0&&(this.data[this._index]=t)}get g(){return this.numChannels>1?this.data[this._index+1]:0}set g(t){this.numChannels>1&&(this.data[this._index+1]=t)}get b(){return this.numChannels>2?this.data[this._index+2]:0}set b(t){this.numChannels>2&&(this.data[this._index+2]=t)}get a(){return this.numChannels>3?this.data[this._index+3]:0}set a(t){this.numChannels>3&&(this.data[this._index+3]=t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t,e,i,n){this._image=n,this._index=i,this._x=t,this._y=e}static imageData(t){return new Ce(-1,0,-t.numChannels,t)}static image(t){return new Ce(-1,0,-t.numChannels,t.data instanceof Ni?t.data:new Ni(0,0,0))}static from(t){return new Ce(t.x,t.y,t._index,t.image)}[Symbol.iterator](){return this}next(){return this._x++,this._x===this.width&&(this._x=0,this._y++,this._y===this.height)?{done:!0,value:this}:(this._index+=this.numChannels,{done:this._index>=this.image.data.length,value:this})}setPosition(t,e){this._x=t,this._y=e,this._index=this._y*this._image.width*this._image.numChannels+this._x*this._image.numChannels}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return t===X.luminance?this.luminance:t<this.numChannels?this.data[this._index+t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.numChannels&&(this.data[this._index+t]=e)}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}setRgb(t,e,i){this.numChannels>0&&(this.data[this._index]=t,this.numChannels>1&&(this.data[this._index+1]=e,this.numChannels>2&&(this.data[this._index+2]=i)))}setRgba(t,e,i,n){this.numChannels>0&&(this.data[this._index]=t,this.numChannels>1&&(this.data[this._index+1]=e,this.numChannels>2&&(this.data[this._index+2]=i,this.numChannels>3&&(this.data[this._index+3]=n))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}equals(t){return t instanceof Ce?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}clone(){return Ce.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}}class Ni{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.float64}get formatType(){return wt.float}get buffer(){return this._data.buffer}get rowStride(){return this._width*this._numChannels*8}get iterator(){return Ce.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){return 1}get maxIndexValue(){return 1}get hasPalette(){return this.palette!==void 0}get palette(){}get isHdrFormat(){return!0}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 64}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._data=n??new Float64Array(this._width*this._height*4*this._numChannels)}static from(t,e=!1){const i=e?new Float64Array(t.data.length):t.data.slice();return new Ni(t.width,t.height,t._numChannels,i)}getRange(t,e,i,n){return new xe(Ce.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?Ve.rgb(t,e,i):Ve.rgba(t,e,i,n)}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof Ce)||n.image!==this)&&(n=Ce.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){const n=e*this._width*this._numChannels+t*this.numChannels;this.data[n]=i}setPixelRgb(t,e,i,n,s){const a=e*this._width*this._numChannels+t*this._numChannels;this._data[a]=i,this._numChannels>1&&(this._data[a+1]=n,this._numChannels>2&&(this._data[a+2]=s))}setPixelRgba(t,e,i,n,s,a){const r=e*this._width*this._numChannels+t*this._numChannels;this._data[r]=i,this._numChannels>1&&(this._data[r+1]=n,this._numChannels>2&&(this._data[r+2]=s,this._numChannels>3&&(this._data[r+3]=a)))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return Ni.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return Ce.imageData(this)}}class ye{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.r}set index(t){this.r=t}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){return this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.int16}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){}get r(){return this.numChannels>0?this.data[this._index]:0}set r(t){this.numChannels>0&&(this.data[this._index]=Math.trunc(t))}get g(){return this.numChannels>1?this.data[this._index+1]:0}set g(t){this.numChannels>1&&(this.data[this._index+1]=Math.trunc(t))}get b(){return this.numChannels>2?this.data[this._index+2]:0}set b(t){this.numChannels>2&&(this.data[this._index+2]=Math.trunc(t))}get a(){return this.numChannels>3?this.data[this._index+3]:0}set a(t){this.numChannels>3&&(this.data[this._index+3]=Math.trunc(t))}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t,e,i,n){this._image=n,this._index=i,this._x=t,this._y=e}static imageData(t){return new ye(-1,0,-t.numChannels,t)}static image(t){return new ye(-1,0,-t.numChannels,t.data instanceof Di?t.data:new Di(0,0,0))}static from(t){return new ye(t.x,t.y,t._index,t.image)}next(){return this._x++,this._x===this.width&&(this._x=0,this._y++,this._y===this.height)?{done:!0,value:this}:(this._index+=this.numChannels,{done:this._index>=this.image.data.length,value:this})}setPosition(t,e){this._x=t,this._y=e,this._index=this._y*this._image.width*this._image.numChannels+this._x*this._image.numChannels}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return t===X.luminance?this.luminance:t<this.numChannels?this.data[this._index+t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.numChannels&&(this.data[this._index+t]=Math.trunc(e))}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}setRgb(t,e,i){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i))))}setRgba(t,e,i,n){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i),this.numChannels>3&&(this.data[this._index+3]=Math.trunc(n)))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}equals(t){return t instanceof ye?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}clone(){return ye.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}[Symbol.iterator](){return this}}class Di{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.int16}get formatType(){return wt.int}get buffer(){return this._data.buffer}get rowStride(){return this._width*this._numChannels*2}get iterator(){return ye.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){return 32767}get maxIndexValue(){return 32767}get hasPalette(){return this.palette!==void 0}get palette(){}get isHdrFormat(){return!0}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 16}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._data=n??new Int16Array(this._width*this._height*this._numChannels)}static from(t,e=!1){const i=e?new Int16Array(t.data.length):t.data.slice();return new Di(t.width,t.height,t._numChannels,i)}getRange(t,e,i,n){return new xe(ye.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?Oe.rgb(Math.trunc(t),Math.trunc(e),Math.trunc(i)):Oe.rgba(Math.trunc(t),Math.trunc(e),Math.trunc(i),Math.trunc(n))}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof ye)||n.image!==this)&&(n=ye.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){const n=e*this.width*this.numChannels+t*this.numChannels;this.data[n]=Math.trunc(i)}setPixelRgb(t,e,i,n,s){const a=e*this.width*this.numChannels+t*this._numChannels;this._data[a]=Math.trunc(i),this._numChannels>1&&(this._data[a+1]=Math.trunc(n),this._numChannels>2&&(this._data[a+2]=Math.trunc(s)))}setPixelRgba(t,e,i,n,s,a){const r=e*this.width*this.numChannels+t*this._numChannels;this._data[r]=Math.trunc(i),this._numChannels>1&&(this._data[r+1]=Math.trunc(n),this._numChannels>2&&(this._data[r+2]=Math.trunc(s),this._numChannels>3&&(this._data[r+3]=Math.trunc(a))))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return Di.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return ye.imageData(this)}}class ve{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.r}set index(t){this.r=t}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){return this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.int32}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){}get r(){return this.numChannels>0?this.data[this._index]:0}set r(t){this.numChannels>0&&(this.data[this._index]=Math.trunc(t))}get g(){return this.numChannels>1?this.data[this._index+1]:0}set g(t){this.numChannels>1&&(this.data[this._index+1]=Math.trunc(t))}get b(){return this.numChannels>2?this.data[this._index+2]:0}set b(t){this.numChannels>2&&(this.data[this._index+2]=Math.trunc(t))}get a(){return this.numChannels>3?this.data[this._index+3]:0}set a(t){this.numChannels>3&&(this.data[this._index+3]=Math.trunc(t))}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t,e,i,n){this._image=n,this._index=i,this._x=t,this._y=e}static imageData(t){return new ve(-1,0,-t.numChannels,t)}static image(t){return new ve(-1,0,-t.numChannels,t.data instanceof Li?t.data:new Li(0,0,0))}static from(t){return new ve(t.x,t.y,t._index,t.image)}next(){return this._x++,this._x===this.width&&(this._x=0,this._y++,this._y===this.height)?{done:!0,value:this}:(this._index+=this.numChannels,{done:this._index>=this.image.data.length,value:this})}setPosition(t,e){this._x=t,this._y=e,this._index=this._y*this._image.width*this._image.numChannels+this._x*this._image.numChannels}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return t===X.luminance?this.luminance:t<this.numChannels?this.data[this._index+t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.numChannels&&(this.data[this._index+t]=Math.trunc(e))}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}setRgb(t,e,i){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i))))}setRgba(t,e,i,n){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i),this.numChannels>3&&(this.data[this._index+3]=Math.trunc(n)))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}equals(t){return t instanceof ve?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}clone(){return ve.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}[Symbol.iterator](){return this}}class Li{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.int32}get formatType(){return wt.int}get buffer(){return this._data.buffer}get rowStride(){return this._width*this._numChannels*4}get iterator(){return ve.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){return 2147483647}get maxIndexValue(){return 2147483647}get hasPalette(){return this.palette!==void 0}get palette(){}get isHdrFormat(){return!0}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 32}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._data=n??new Int32Array(this._width*this._height*this._numChannels)}static from(t,e=!1){const i=e?new Int32Array(t.data.length):t.data.slice();return new Li(t.width,t.height,t._numChannels,i)}getRange(t,e,i,n){return new xe(ve.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?He.rgb(Math.trunc(t),Math.trunc(e),Math.trunc(i)):He.rgba(Math.trunc(t),Math.trunc(e),Math.trunc(i),Math.trunc(n))}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof ve)||n.image!==this)&&(n=ve.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){const n=e*this.width*this.numChannels+t*this.numChannels;this.data[n]=Math.trunc(i)}setPixelRgb(t,e,i,n,s){const a=e*this.width*this.numChannels+t*this._numChannels;this._data[a]=Math.trunc(i),this._numChannels>1&&(this._data[a+1]=Math.trunc(n),this._numChannels>2&&(this._data[a+2]=Math.trunc(s)))}setPixelRgba(t,e,i,n,s,a){const r=e*this.width*this.numChannels+t*this._numChannels;this._data[r]=Math.trunc(i),this._numChannels>1&&(this._data[r+1]=Math.trunc(n),this._numChannels>2&&(this._data[r+2]=Math.trunc(s),this._numChannels>3&&(this._data[r+3]=Math.trunc(a))))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return Li.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return ve.imageData(this)}}class Se{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.r}set index(t){this.r=t}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){return this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.int8}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){}get r(){return this.numChannels>0?this.data[this._index]:0}set r(t){this.numChannels>0&&(this.data[this._index]=Math.trunc(t))}get g(){return this.numChannels>1?this.data[this._index+1]:0}set g(t){this.numChannels>1&&(this.data[this._index+1]=Math.trunc(t))}get b(){return this.numChannels>2?this.data[this._index+2]:0}set b(t){this.numChannels>2&&(this.data[this._index+2]=Math.trunc(t))}get a(){return this.numChannels>3?this.data[this._index+3]:0}set a(t){this.numChannels>3&&(this.data[this._index+3]=Math.trunc(t))}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t,e,i,n){this._image=n,this._index=i,this._x=t,this._y=e}static imageData(t){return new Se(-1,0,-t.numChannels,t)}static image(t){return new Se(-1,0,-t.numChannels,t.data instanceof Fi?t.data:new Fi(0,0,0))}static from(t){return new Se(t.x,t.y,t._index,t.image)}next(){return this._x++,this._x===this.width&&(this._x=0,this._y++,this._y===this.height)?{done:!0,value:this}:(this._index+=this.numChannels,{done:this._index>=this.image.data.length,value:this})}setPosition(t,e){this._x=t,this._y=e,this._index=this._y*this._image.width*this._image.numChannels+this._x*this._image.numChannels}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return t===X.luminance?this.luminance:t<this.numChannels?this.data[this._index+t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.numChannels&&(this.data[this._index+t]=Math.trunc(e))}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}setRgb(t,e,i){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i))))}setRgba(t,e,i,n){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i),this.numChannels>3&&(this.data[this._index+3]=Math.trunc(n)))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}equals(t){return t instanceof Se?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}clone(){return Se.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}[Symbol.iterator](){return this}}class Fi{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.int8}get formatType(){return wt.int}get buffer(){return this._data.buffer}get rowStride(){return this._width*this._numChannels}get iterator(){return Se.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){return 127}get maxIndexValue(){return 127}get hasPalette(){return this.palette!==void 0}get palette(){}get isHdrFormat(){return!0}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 8}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._data=n??new Int8Array(this._width*this._height*this._numChannels)}static from(t,e=!1){const i=e?new Int8Array(t.data.length):t.data.slice();return new Fi(t.width,t.height,t._numChannels,i)}getRange(t,e,i,n){return new xe(Se.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?qe.rgb(Math.trunc(t),Math.trunc(e),Math.trunc(i)):qe.rgba(Math.trunc(t),Math.trunc(e),Math.trunc(i),Math.trunc(n))}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof Se)||n.image!==this)&&(n=Se.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){const n=e*this.rowStride+t*this.numChannels;this.data[n]=Math.trunc(i)}setPixelRgb(t,e,i,n,s){const a=e*this.rowStride+t*this._numChannels;this._data[a]=Math.trunc(i),this._numChannels>1&&(this._data[a+1]=Math.trunc(n),this._numChannels>2&&(this._data[a+2]=Math.trunc(s)))}setPixelRgba(t,e,i,n,s,a){const r=e*this.rowStride+t*this._numChannels;this._data[r]=Math.trunc(i),this._numChannels>1&&(this._data[r+1]=Math.trunc(n),this._numChannels>2&&(this._data[r+2]=Math.trunc(s),this._numChannels>3&&(this._data[r+3]=Math.trunc(a))))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return Fi.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}[Symbol.iterator](){return Se.imageData(this)}}class Qt{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.getChannelInternal(0)}set index(t){this.setChannel(0,t)}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){var t,e;return(e=(t=this.palette)===null||t===void 0?void 0:t.numChannels)!==null&&e!==void 0?e:this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.uint1}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){return this._image.palette}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}get imageLength(){return this._image.length}constructor(t,e,i,n,s,a){this._image=a,this._index=i,this._bitIndex=n,this._rowOffset=s,this._x=t,this._y=e}static imageData(t){return new Qt(-1,0,0,-1,0,t)}static image(t){return new Qt(-1,0,0,-1,0,t.data instanceof li?t.data:new li(0,0,0))}static from(t){return new Qt(t.x,t.y,t._index,t._bitIndex,t._rowOffset,t.image)}getChannelInternal(t){let e=this._index,i=7-(this._bitIndex+t);return i<0&&(i+=8,e++),e>=this._image.data.length?0:this._image.data[e]>>>i&1}next(){if(this._x++,this._x===this.width)return this._x=0,this._y++,this._bitIndex=0,this._index++,this._rowOffset+=this.image.rowStride,{done:this._y>=this.height,value:this};const t=this.numChannels;if(this.palette!==void 0||t===1)this._bitIndex++,this._bitIndex>7&&(this._bitIndex=0,this._index++);else{const e=this.image.numChannels;this._bitIndex=this._x*e&7,this._index=this._rowOffset+(this._x*e>>>3)}return{done:this._index>=this.imageLength,value:this}}setPosition(t,e){this._x=t,this._y=e;const i=this._image.numChannels;this._rowOffset=this._y*this._image.rowStride,this._index=this._rowOffset+(this._x*i>>>3),this._bitIndex=this._x*i&7}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return this.palette!==void 0?this.palette.get(this.getChannelInternal(0),t):t===X.luminance?this.luminance:t<this.numChannels?this.getChannelInternal(t):0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){if(t>=this.numChannels)return;let i=this._index,n=7-(this._bitIndex+t);n<0&&(n+=8,i++);let s=this.data[i];const a=k.clampInt(e,0,1),h=[254,253,251,247,239,223,191,127][n];s=s&h|a<<n,this.data[i]=s}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}setRgb(t,e,i){const n=this.image.numChannels;n>0&&(this.setChannel(0,t),n>1&&(this.setChannel(1,e),n>2&&this.setChannel(2,i)))}setRgba(t,e,i,n){const s=this.numChannels;s>0&&(this.setChannel(0,t),s>1&&(this.setChannel(1,e),s>2&&(this.setChannel(2,i),s>3&&this.setChannel(3,n))))}toArray(){return F.generate(this.length,t=>this.getChannel(t))}equals(t){return t instanceof Qt?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}clone(){return Qt.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}[Symbol.iterator](){return this}}class li{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.uint1}get formatType(){return wt.uint}get buffer(){return this._data.buffer}get rowStride(){return this._rowStride}get iterator(){return Qt.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){var t,e;return(e=(t=this._palette)===null||t===void 0?void 0:t.maxChannelValue)!==null&&e!==void 0?e:1}get maxIndexValue(){return 1}get hasPalette(){return this.palette!==void 0}get palette(){return this._palette}set palette(t){this._palette=t}get isHdrFormat(){return!1}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 1}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._rowStride=Math.ceil(this._width*this._numChannels/8),this._palette=void 0,this._data=n??new Uint8Array(Math.max(this._rowStride*this._height,1))}static palette(t,e,i){const n=Math.ceil(t/8),s=new Uint8Array(Math.max(n*e,1)),a=new li(t,e,1,s);return a._rowStride=n,a._palette=i,a}static from(t,e=!1){var i;const n=e?new Uint8Array(t.data.length):t.data.slice(),s=new li(t.width,t.height,t._numChannels,n);return s._rowStride=t.rowStride,s._palette=(i=t.palette)===null||i===void 0?void 0:i.clone(),s}getRange(t,e,i,n){return new xe(Qt.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?Ee.rgb(Math.trunc(t),Math.trunc(e),Math.trunc(i)):Ee.rgba(Math.trunc(t),Math.trunc(e),Math.trunc(i),Math.trunc(n))}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof Qt)||n.image!==this)&&(n=Qt.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){var n;this._numChannels<1||((n=this.pixel)!==null&&n!==void 0||(this.pixel=Qt.imageData(this)),this.pixel.setPosition(t,e),this.pixel.index=i)}setPixelRgb(t,e,i,n,s){var a;this._numChannels<1||((a=this.pixel)!==null&&a!==void 0||(this.pixel=Qt.imageData(this)),this.pixel.setPosition(t,e),this.pixel.setRgb(i,n,s))}setPixelRgba(t,e,i,n,s,a){var r;this._numChannels<1||((r=this.pixel)!==null&&r!==void 0||(this.pixel=Qt.imageData(this)),this.pixel.setPosition(t,e),this.pixel.setRgba(i,n,s,a))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return li.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return Qt.imageData(this)}}class ke{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.r}set index(t){this.r=t}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){var t,e;return(e=(t=this.palette)===null||t===void 0?void 0:t.numChannels)!==null&&e!==void 0?e:this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.uint16}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){return this._image.palette}get r(){return this.palette===void 0?this.numChannels>0?this.data[this._index]:0:this.palette.getRed(this.data[this._index])}set r(t){this.numChannels>0&&(this.data[this._index]=Math.trunc(t))}get g(){return this.palette===void 0?this.numChannels>1?this.data[this._index+1]:0:this.palette.getGreen(this.data[this._index])}set g(t){this.numChannels>1&&(this.data[this._index+1]=Math.trunc(t))}get b(){return this.palette===void 0?this.numChannels>2?this.data[this._index+2]:0:this.palette.getBlue(this.data[this._index])}set b(t){this.numChannels>2&&(this.data[this._index+2]=Math.trunc(t))}get a(){return this.palette===void 0?this.numChannels>3?this.data[this._index+3]:0:this.palette.getAlpha(this.data[this._index])}set a(t){this.numChannels>3&&(this.data[this._index+3]=Math.trunc(t))}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t,e,i,n){this._image=n,this._index=i,this._x=t,this._y=e}static imageData(t){return new ke(-1,0,-t.numChannels,t)}static image(t){return new ke(-1,0,-t.numChannels,t.data instanceof oi?t.data:new oi(0,0,0))}static from(t){return new ke(t.x,t.y,t._index,t.image)}next(){return this._x++,this._x===this.width&&(this._x=0,this._y++,this._y===this.height)?{done:!0,value:this}:(this._index+=this.palette===void 0?this.numChannels:1,{done:this._index>=this.image.data.length,value:this})}setPosition(t,e){this._x=t,this._y=e,this._index=this._y*this._image.width*this._image.numChannels+this._x*this._image.numChannels}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return t===X.luminance?this.luminance:this.palette!==void 0?this.palette.get(this.data[this._index],t):t<this.numChannels?this.data[this._index+t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.numChannels&&(this.data[this._index+t]=Math.trunc(e))}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}setRgb(t,e,i){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i))))}setRgba(t,e,i,n){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i),this.numChannels>3&&(this.data[this._index+3]=Math.trunc(n)))))}equals(t){return t instanceof ke?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return ke.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}[Symbol.iterator](){return this}}class oi{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.uint16}get formatType(){return wt.uint}get buffer(){return this._data.buffer}get rowStride(){return this._width*this._numChannels*2}get iterator(){return ke.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){var t,e;return(e=(t=this._palette)===null||t===void 0?void 0:t.maxChannelValue)!==null&&e!==void 0?e:65535}get maxIndexValue(){return 65535}get hasPalette(){return this.palette!==void 0}get palette(){return this._palette}get isHdrFormat(){return!0}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 16}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._data=n??new Uint16Array(this._width*this._height*this._numChannels)}static palette(t,e,i){const n=new Uint16Array(t*e),s=new oi(t,e,1,n);return s._palette=i,s}static from(t,e=!1){var i;const n=e?new Uint16Array(t.data.length):t.data.slice(),s=new oi(t.width,t.height,t._numChannels,n);return s._palette=(i=t.palette)===null||i===void 0?void 0:i.clone(),s}getRange(t,e,i,n){return new xe(ke.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?Ye.rgb(Math.trunc(t),Math.trunc(e),Math.trunc(i)):Ye.rgba(Math.trunc(t),Math.trunc(e),Math.trunc(i),Math.trunc(n))}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof ke)||n.image!==this)&&(n=ke.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){const n=e*this._width*this._numChannels+t*this.numChannels;this.data[n]=Math.trunc(i)}setPixelRgb(t,e,i,n,s){const a=e*this._width*this._numChannels+t*this._numChannels;this._data[a]=Math.trunc(i),this._numChannels>1&&(this._data[a+1]=Math.trunc(n),this._numChannels>2&&(this._data[a+2]=Math.trunc(s)))}setPixelRgba(t,e,i,n,s,a){const r=e*this._width*this._numChannels+t*this._numChannels;this._data[r]=Math.trunc(i),this._numChannels>1&&(this._data[r+1]=Math.trunc(n),this._numChannels>2&&(this._data[r+2]=Math.trunc(s),this._numChannels>3&&(this._data[r+3]=Math.trunc(a))))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return oi.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return ke.imageData(this)}}class Jt{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.getChannelInternal(0)}set index(t){this.setChannel(0,t)}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){var t,e;return(e=(t=this.palette)===null||t===void 0?void 0:t.numChannels)!==null&&e!==void 0?e:this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.uint2}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){return this._image.palette}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}get bitsPerPixel(){return this._image.palette!==void 0?2:this._image.numChannels<<1}constructor(t,e,i,n,s,a){this._image=a,this._index=i,this._bitIndex=n,this._rowOffset=s,this._x=t,this._y=e}static imageData(t){return new Jt(-1,0,0,-2,0,t)}static image(t){return new Jt(-1,0,0,-2,0,t.data instanceof ui?t.data:new ui(0,0,0))}static from(t){return new Jt(t.x,t.y,t._index,t._bitIndex,t._rowOffset,t.image)}getChannelInternal(t){let e=this._index,i=6-(this._bitIndex+(t<<1));return i<0&&(i+=8,e++),this._image.data[e]>>>i&3}next(){if(this._x++,this._x===this.width)return this._x=0,this._y++,this._bitIndex=0,this._index++,this._rowOffset+=this.image.rowStride,{done:this._y>=this.height,value:this};const t=this.numChannels;if(this.palette!==void 0||t===1)this._bitIndex+=2,this._bitIndex>7&&(this._bitIndex=0,this._index++);else{const e=this.bitsPerPixel;this._bitIndex=this._x*e&7,this._index=this._rowOffset+(this._x*e>>>3)}return{done:this._index>=this.image.data.length,value:this}}setPosition(t,e){this._x=t,this._y=e;const i=this.bitsPerPixel;this._rowOffset=this._y*this._image.rowStride,this._index=this._rowOffset+(this._x*i>>>3),this._bitIndex=this._x*i&7}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return this.palette!==void 0?this.palette.get(this.getChannelInternal(0),t):t===X.luminance?this.luminance:t<this.numChannels?this.getChannelInternal(t):0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){if(t>=this.image.numChannels)return;let i=this._index,n=6-(this._bitIndex+(t<<1));n<0&&(n+=8,i++);let s=this.data[i];const a=k.clampInt(e,0,3),h=[252,243,207,63][n>>>1];s=s&h|a<<n,this.data[i]=s}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}setRgb(t,e,i){const n=this.image.numChannels;n>0&&(this.setChannel(0,t),n>1&&(this.setChannel(1,e),n>2&&this.setChannel(2,i)))}setRgba(t,e,i,n){const s=this.image.numChannels;s>0&&(this.setChannel(0,t),s>1&&(this.setChannel(1,e),s>2&&(this.setChannel(2,i),s>3&&this.setChannel(3,n))))}equals(t){return t instanceof Jt?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return Jt.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}[Symbol.iterator](){return this}}class ui{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.uint2}get formatType(){return wt.uint}get buffer(){return this._data.buffer}get rowStride(){return this._rowStride}get iterator(){return Jt.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){var t,e;return(e=(t=this._palette)===null||t===void 0?void 0:t.maxChannelValue)!==null&&e!==void 0?e:3}get maxIndexValue(){return 1}get hasPalette(){return this.palette!==void 0}get palette(){return this._palette}set palette(t){this._palette=t}get isHdrFormat(){return!1}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 2}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._rowStride=Math.ceil(this._width*(this._numChannels<<1)/8),this._palette=void 0,this._data=n??new Uint8Array(Math.max(this._rowStride*this._height,1))}static palette(t,e,i){const n=Math.ceil(t/4),s=new Uint8Array(Math.max(n*e,1)),a=new ui(t,e,1,s);return a._rowStride=n,a._palette=i,a}static from(t,e=!1){var i;const n=e?new Uint8Array(t.data.length):t.data.slice(),s=new ui(t.width,t.height,t._numChannels,n);return s._rowStride=t.rowStride,s._palette=(i=t.palette)===null||i===void 0?void 0:i.clone(),s}getRange(t,e,i,n){return new xe(Jt.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?Ge.rgb(Math.trunc(t),Math.trunc(e),Math.trunc(i)):Ge.rgba(Math.trunc(t),Math.trunc(e),Math.trunc(i),Math.trunc(n))}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof Jt)||n.image!==this)&&(n=Jt.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){var n;this._numChannels<1||((n=this._pixel)!==null&&n!==void 0||(this._pixel=Jt.imageData(this)),this._pixel.setPosition(t,e),this._pixel.index=i)}setPixelRgb(t,e,i,n,s){var a;this._numChannels<1||((a=this._pixel)!==null&&a!==void 0||(this._pixel=Jt.imageData(this)),this._pixel.setPosition(t,e),this._pixel.setRgb(i,n,s))}setPixelRgba(t,e,i,n,s,a){var r;this._numChannels<1||((r=this._pixel)!==null&&r!==void 0||(this._pixel=Jt.imageData(this)),this._pixel.setPosition(t,e),this._pixel.setRgba(i,n,s,a))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return ui.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return Jt.imageData(this)}}class Pe{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.r}set index(t){this.r=t}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){return this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.uint32}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){}get r(){return this.numChannels>0?this.data[this._index]:0}set r(t){this.numChannels>0&&(this.data[this._index]=Math.trunc(t))}get g(){return this.numChannels>1?this.data[this._index+1]:0}set g(t){this.numChannels>1&&(this.data[this._index+1]=Math.trunc(t))}get b(){return this.numChannels>2?this.data[this._index+2]:0}set b(t){this.numChannels>2&&(this.data[this._index+2]=Math.trunc(t))}get a(){return this.numChannels>3?this.data[this._index+3]:0}set a(t){this.numChannels>3&&(this.data[this._index+3]=Math.trunc(t))}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t,e,i,n){this._image=n,this._index=i,this._x=t,this._y=e}static imageData(t){return new Pe(-1,0,-t.numChannels,t)}static image(t){return new Pe(-1,0,-t.numChannels,t.data instanceof Ti?t.data:new Ti(0,0,0))}static from(t){return new Pe(t.x,t.y,t._index,t.image)}next(){return this._x++,this._x===this.width&&(this._x=0,this._y++,this._y===this.height)?{done:!0,value:this}:(this._index+=this.numChannels,{done:this._index>=this.image.data.length,value:this})}setPosition(t,e){this._x=t,this._y=e,this._index=this._y*this._image.width*this._image.numChannels+this._x*this._image.numChannels}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return t===X.luminance?this.luminance:t<this.numChannels?this.data[this._index+t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.numChannels&&(this.data[this._index+t]=Math.trunc(e))}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}setRgb(t,e,i){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i))))}setRgba(t,e,i,n){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i),this.numChannels>3&&(this.data[this._index+3]=Math.trunc(n)))))}equals(t){return t instanceof Pe?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return Pe.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}[Symbol.iterator](){return this}}class Ti{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.uint32}get formatType(){return wt.uint}get buffer(){return this._data.buffer}get rowStride(){return this._width*this._numChannels*4}get iterator(){return Pe.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){return 4294967295}get maxIndexValue(){return 4294967295}get hasPalette(){return this.palette!==void 0}get palette(){}get isHdrFormat(){return!0}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 32}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._data=n??new Uint32Array(this._width*this._height*this._numChannels)}static from(t,e=!1){const i=e?new Uint32Array(t.data.length):t.data.slice();return new Ti(t.width,t.height,t._numChannels,i)}getRange(t,e,i,n){return new xe(Pe.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?$e.rgb(Math.trunc(t),Math.trunc(e),Math.trunc(i)):$e.rgba(Math.trunc(t),Math.trunc(e),Math.trunc(i),Math.trunc(n))}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof Pe)||n.image!==this)&&(n=Pe.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){const n=e*this._width*this._numChannels+t*this.numChannels;this.data[n]=Math.trunc(i)}setPixelRgb(t,e,i,n,s){const a=e*this._width*this._numChannels+t*this._numChannels;this._data[a]=Math.trunc(i),this._numChannels>1&&(this._data[a+1]=Math.trunc(n),this._numChannels>2&&(this._data[a+2]=Math.trunc(s)))}setPixelRgba(t,e,i,n,s,a){const r=e*this._width*this._numChannels+t*this._numChannels;this._data[r]=Math.trunc(i),this._numChannels>1&&(this._data[r+1]=Math.trunc(n),this._numChannels>2&&(this._data[r+2]=Math.trunc(s),this._numChannels>3&&(this._data[r+3]=Math.trunc(a))))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return Ti.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return Pe.imageData(this)}}class te{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.getChannelInternal(0)}set index(t){this.setChannel(0,t)}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){var t,e;return(e=(t=this.palette)===null||t===void 0?void 0:t.numChannels)!==null&&e!==void 0?e:this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.uint4}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){return this._image.palette}get r(){return this.getChannel(0)}set r(t){this.setChannel(0,t)}get g(){return this.getChannel(1)}set g(t){this.setChannel(1,t)}get b(){return this.getChannel(2)}set b(t){this.setChannel(2,t)}get a(){return this.getChannel(3)}set a(t){this.setChannel(3,t)}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return E.getLuminance(this)}get luminanceNormalized(){return E.getLuminanceNormalized(this)}constructor(t,e,i,n,s){this._image=s,this._index=i,this._bitIndex=n,this._x=t,this._y=e}static imageData(t){return new te(-1,0,0,-(t.numChannels<<2),t)}static image(t){return new te(-1,0,0,-(t.numChannels<<2),t.data instanceof ci?t.data:new ci(0,0,0))}static from(t){return new te(t.x,t.y,t._index,t._bitIndex,t.image)}getChannelInternal(t){let e=this._index,i=4-(this._bitIndex+(t<<2));return i<0&&(i+=8,e++),this._image.data[e]>>>i&15}next(){if(this._x++,this._x===this.width)return this._x=0,this._y++,this._bitIndex=0,this._index=this._y*this.image.rowStride,{done:this._y>=this.height,value:this};const t=this.image.numChannels;if(this.palette!==void 0||t===1)this._bitIndex+=4,this._bitIndex>7&&(this._bitIndex=0,this._index++);else{const e=t<<2;for(this._bitIndex+=e;this._bitIndex>7;)this._bitIndex-=8,this._index++}return{done:this._index>=this.image.data.length,value:this}}setPosition(t,e){this._x=t,this._y=e;const i=this.image.numChannels*4,n=this.image.width,s=this.image.rowStride;this._index=i===4?this._y*s+(this._x>>>1):i===8?this._y*n+this._x:i===16?this._y*s+(this._x<<1):this._y*s+(this._x*i>>>3),this._bitIndex=i>7?this._x*i&4:this._x*i&7}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return t===X.luminance?this.luminance:this.palette!==void 0?this.palette.get(this.getChannelInternal(0),t):t<this.numChannels?this.getChannelInternal(t):0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){if(t>=this.image.numChannels)return;let i=this._index,n=4-(this._bitIndex+(t<<2));n<0&&(n+=8,i++);let s=this.data[i];const a=k.clampInt(e,0,15);s=s&(n===4?15:240)|a<<n,this.data[i]=s}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}setRgb(t,e,i){const n=this.image.numChannels;n>0&&(this.setChannel(0,t),n>1&&(this.setChannel(1,e),n>2&&this.setChannel(2,i)))}setRgba(t,e,i,n){const s=this.image.numChannels;s>0&&(this.setChannel(0,t),s>1&&(this.setChannel(1,e),s>2&&(this.setChannel(2,i),s>3&&this.setChannel(3,n))))}equals(t){return t instanceof te?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return te.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}[Symbol.iterator](){return this}}class ci{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.uint4}get formatType(){return wt.uint}get buffer(){return this._data.buffer}get rowStride(){return this._rowStride}get iterator(){return te.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){var t,e;return(e=(t=this._palette)===null||t===void 0?void 0:t.maxChannelValue)!==null&&e!==void 0?e:15}get maxIndexValue(){return 15}get hasPalette(){return this.palette!==void 0}get palette(){return this._palette}set palette(t){this._palette=t}get isHdrFormat(){return!1}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 4}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._rowStride=this._numChannels===2?this._width:this._numChannels===4?this._width*2:this._numChannels===3?Math.ceil(this._width*1.5):Math.ceil(this._width/2),this._palette=void 0,this._data=n??new Uint8Array(Math.max(this._rowStride*this._height,1))}static palette(t,e,i){const n=Math.ceil(t/2),s=new Uint8Array(Math.max(n*e,1)),a=new ci(t,e,1,s);return a._rowStride=n,a._palette=i,a}static from(t,e=!1){var i;const n=e?new Uint8Array(t.data.length):t.data.slice(),s=new ci(t.width,t.height,t._numChannels,n);return s._rowStride=t.rowStride,s._palette=(i=t.palette)===null||i===void 0?void 0:i.clone(),s}getRange(t,e,i,n){return new xe(te.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?We.rgb(Math.trunc(t),Math.trunc(e),Math.trunc(i)):We.rgba(Math.trunc(t),Math.trunc(e),Math.trunc(i),Math.trunc(n))}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof te)||n.image!==this)&&(n=te.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){var n;this._numChannels<1||((n=this._pixel)!==null&&n!==void 0||(this._pixel=te.imageData(this)),this._pixel.setPosition(t,e),this._pixel.index=i)}setPixelRgb(t,e,i,n,s){var a;this._numChannels<1||((a=this._pixel)!==null&&a!==void 0||(this._pixel=te.imageData(this)),this._pixel.setPosition(t,e),this._pixel.setRgb(i,n,s))}setPixelRgba(t,e,i,n,s,a){var r;this._numChannels<1||((r=this._pixel)!==null&&r!==void 0||(this._pixel=te.imageData(this)),this._pixel.setPosition(t,e),this._pixel.setRgba(i,n,s,a))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){}clone(t=!1){return ci.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return te.imageData(this)}}class Me{get image(){return this._image}get x(){return this._x}get y(){return this._y}get xNormalized(){return this.width>1?this._x/(this.width-1):0}get yNormalized(){return this.height>1?this._y/(this.height-1):0}get index(){return this.data[this._index]}set index(t){this.data[this._index]=k.clampInt255(t)}get data(){return this._image.data}get isValid(){return this._x>=0&&this._x<this._image.width-1&&this._y>=0&&this._y<this._image.height-1}get width(){return this._image.width}get height(){return this._image.height}get length(){var t,e;return(e=(t=this.palette)===null||t===void 0?void 0:t.numChannels)!==null&&e!==void 0?e:this._image.numChannels}get numChannels(){return this._image.numChannels}get maxChannelValue(){return this._image.maxChannelValue}get maxIndexValue(){return this._image.maxIndexValue}get format(){return v.uint8}get isLdrFormat(){return this._image.isLdrFormat}get isHdrFormat(){return this._image.isLdrFormat}get hasPalette(){return this._image.hasPalette}get palette(){return this._image.palette}get r(){return this.palette===void 0?this.numChannels>0?this.data[this._index]:0:this.palette.getRed(this.data[this._index])}set r(t){this.numChannels>0&&(this.data[this._index]=k.clampInt255(t))}get g(){return this.palette===void 0?this.numChannels===2?this.data[this._index]:this.numChannels>1?this.data[this._index+1]:0:this.palette.getGreen(this.data[this._index])}set g(t){this.numChannels===2?this.data[this._index]=k.clampInt255(t):this.image.numChannels>1&&(this.data[this._index+1]=k.clampInt255(t))}get b(){return this.palette===void 0?this.numChannels===2?this.data[this._index]:this.numChannels>2?this.data[this._index+2]:0:this.palette.getBlue(this.data[this._index])}set b(t){this.numChannels===2?this.data[this._index]=k.clampInt255(t):this.image.numChannels>2&&(this.data[this._index+2]=k.clampInt255(t))}get a(){return this.palette===void 0?this.numChannels===2?this.data[this._index+1]:this.numChannels>3?this.data[this._index+3]:255:this.palette.getAlpha(this.data[this._index])}set a(t){this.numChannels===2?this.data[this._index+1]=k.clampInt255(t):this.image.numChannels>3&&(this.data[this._index+3]=k.clampInt255(t))}get rNormalized(){return this.r/this.maxChannelValue}set rNormalized(t){this.r=t*this.maxChannelValue}get gNormalized(){return this.g/this.maxChannelValue}set gNormalized(t){this.g=t*this.maxChannelValue}get bNormalized(){return this.b/this.maxChannelValue}set bNormalized(t){this.b=t*this.maxChannelValue}get aNormalized(){return this.a/this.maxChannelValue}set aNormalized(t){this.a=t*this.maxChannelValue}get luminance(){return this.numChannels===2?this.r:E.getLuminance(this)}get luminanceNormalized(){return this.numChannels===2?this.rNormalized:E.getLuminanceNormalized(this)}constructor(t,e,i,n){this._image=n,this._index=i,this._x=t,this._y=e}static imageData(t){return new Me(-1,0,-t.numChannels,t)}static image(t){return new Me(-1,0,-t.numChannels,t.data instanceof Je?t.data:new Je(0,0,0))}static from(t){return new Me(t.x,t.y,t._index,t.image)}next(){return this._x++,this._x===this.width&&(this._x=0,this._y++,this._y===this.height)?{done:!0,value:this}:(this._index+=this.palette===void 0?this.numChannels:1,{done:this._index>=this.image.data.length,value:this})}setPosition(t,e){this._x=t,this._y=e,this._index=this._y*this._image.width*this._image.numChannels+this._x*this._image.numChannels}setPositionNormalized(t,e){return this.setPosition(Math.floor(t*(this.width-1)),Math.floor(e*(this.height-1)))}getChannel(t){return t===X.luminance?this.luminance:this.palette!==void 0?this.palette.get(this.data[this._index],t):t<this.numChannels?this.data[this._index+t]:0}getChannelNormalized(t){return this.getChannel(t)/this.maxChannelValue}setChannel(t,e){t<this.numChannels&&(this.data[this._index+t]=k.clampInt255(e))}set(t){this._image.hasPalette?this.index=t.index:(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a)}setRgb(t,e,i){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i))))}setRgba(t,e,i,n){this.numChannels>0&&(this.data[this._index]=Math.trunc(t),this.numChannels>1&&(this.data[this._index+1]=Math.trunc(e),this.numChannels>2&&(this.data[this._index+2]=Math.trunc(i),this.numChannels>3&&(this.data[this._index+3]=Math.trunc(n)))))}equals(t){return t instanceof Me?F.equals(this.toArray(),t.toArray()):Array.isArray(t)?F.equals(this.toArray(),t):!1}toArray(){return F.generate(this.length,t=>this.getChannel(t))}clone(){return Me.from(this)}convert(t){return E.convertColor({from:this,format:t.format,numChannels:t.numChannels,alpha:t.alpha})}toString(){return`${this.constructor.name} (${this.toArray()})`}[Symbol.iterator](){return this}}class pi extends ie{constructor(t,e,i){const n=new Uint8Array([t,e,i]);super(n)}static from(t){const e=new Uint8Array([t.getChannel(0),t.getChannel(1),t.getChannel(2)]);return new ie(e)}}class Ci extends ie{constructor(t,e,i,n){const s=new Uint8Array([t,e,i,n]);super(s)}static from(t){const e=new Uint8Array([t.getChannel(0),t.getChannel(1),t.getChannel(2),t.getChannel(3)]);return new ie(e)}}class Je{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get data(){return this._data}get numChannels(){return this._numChannels}get format(){return v.uint8}get formatType(){return wt.uint}get buffer(){return this._data.buffer}get rowStride(){return this._width*this._numChannels}get iterator(){return Me.imageData(this)}get byteLength(){return this._data.byteLength}get length(){return this._data.byteLength}get maxChannelValue(){var t,e;return(e=(t=this._palette)===null||t===void 0?void 0:t.maxChannelValue)!==null&&e!==void 0?e:255}get maxIndexValue(){return 255}get hasPalette(){return this.palette!==void 0}get palette(){return this._palette}set palette(t){this._palette=t}get isHdrFormat(){return!1}get isLdrFormat(){return!this.isHdrFormat}get bitsPerChannel(){return 8}constructor(t,e,i,n){this._width=t,this._height=e,this._numChannels=i,this._palette=void 0,this._data=n??new Uint8Array(this._width*this._height*this._numChannels)}static palette(t,e,i){const n=new Uint8Array(t*e),s=new Je(t,e,1,n);return s._palette=i,s}static from(t,e=!1){var i;const n=e?new Uint8Array(t.data.length):t.data.slice(),s=new Je(t.width,t.height,t._numChannels,n);return s._palette=(i=t.palette)===null||i===void 0?void 0:i.clone(),s}getRange(t,e,i,n){return new xe(Me.imageData(this),t,e,i,n)}getColor(t,e,i,n){return n===void 0?new pi(k.clampInt255(t),k.clampInt255(e),k.clampInt255(i)):new Ci(k.clampInt255(t),k.clampInt255(e),k.clampInt255(i),k.clampInt255(n))}getPixel(t,e,i){let n=i;return(n===void 0||!(n instanceof Me)||n.image!==this)&&(n=Me.imageData(this)),n.setPosition(t,e),n}setPixel(t,e,i){this.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelR(t,e,i){const n=e*this.rowStride+t*this.numChannels;this.data[n]=Math.trunc(i)}setPixelRgb(t,e,i,n,s){const a=e*this.rowStride+t*this._numChannels;this._data[a]=Math.trunc(i),this._numChannels>1&&(this._data[a+1]=Math.trunc(n),this._numChannels>2&&(this._data[a+2]=Math.trunc(s)))}setPixelRgba(t,e,i,n,s,a){const r=e*this.rowStride+t*this._numChannels;this._data[r]=Math.trunc(i),this._numChannels>1&&(this._data[r+1]=Math.trunc(n),this._numChannels>2&&(this._data[r+2]=Math.trunc(s),this._numChannels>3&&(this._data[r+3]=Math.trunc(a))))}setPixelRgbSafe(t,e,i,n,s){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgb(t,e,i,n,s)}setPixelRgbaSafe(t,e,i,n,s,a){t<0||t>=this.width||e<0||e>=this.height||this.setPixelRgba(t,e,i,n,s,a)}clear(t){const e=t?.convert({format:v.uint8});if(this._numChannels===1){const i=e===void 0?0:k.clampInt255(e.r);this._data.fill(i)}else if(this._numChannels===2){const i=e===void 0?0:k.clampInt255(e.r),s=(e===void 0?0:k.clampInt255(e.g))<<8|i;new Uint16Array(this._data.buffer).fill(s)}else if(this._numChannels===4){const i=e===void 0?0:k.clampInt255(e.r),n=e===void 0?0:k.clampInt255(e.g),s=e===void 0?0:k.clampInt255(e.b),r=(e===void 0?0:k.clampInt255(e.a))<<24|s<<16|n<<8|i;new Uint32Array(this._data.buffer).fill(r)}else{const i=e===void 0?0:k.clampInt255(e.r),n=e===void 0?0:k.clampInt255(e.g),s=e===void 0?0:k.clampInt255(e.b);for(const a of this)a.r=i,a.g=n,a.b=s}}clone(t=!1){return Je.from(this,t)}toUint8Array(){return new Uint8Array(this.buffer)}getBytes(t){return _e(this,t)}toString(){return`${this.constructor.name} (w: ${this._width}, h: ${this._height}, ch: ${this._numChannels})`}[Symbol.iterator](){return Me.imageData(this)}}class an{get data(){return this._data}get numColors(){return this._numColors}get numChannels(){return this._numChannels}get byteLength(){return this.data.byteLength}get buffer(){return this.data.buffer}get format(){return v.float16}get maxChannelValue(){return 1}constructor(t,e,i){this._numColors=t,this._numChannels=e,this._data=i??new Uint16Array(t*e)}static from(t){return new an(t.numColors,t.numChannels,t.data)}setRgb(t,e,i,n){let s=t;s*=this._numChannels,this._data[s]=$.doubleToFloat16(e),this._numChannels>1&&(this._data[s+1]=$.doubleToFloat16(i),this._numChannels>2&&(this._data[s+2]=$.doubleToFloat16(n)))}setRgba(t,e,i,n,s){let a=t;a*=this._numChannels,this._data[a]=$.doubleToFloat16(e),this._numChannels>1&&(this._data[a+1]=$.doubleToFloat16(i),this._numChannels>2&&(this._data[a+2]=$.doubleToFloat16(n),this._numChannels>3&&(this._data[a+3]=$.doubleToFloat16(s))))}set(t,e,i){let n=t;e<this._numChannels&&(n*=this._numChannels,this._data[n+e]=$.doubleToFloat16(i))}get(t,e){return e<this._numChannels?$.float16ToDouble(this._data[t*this._numChannels+e]):0}getRed(t){let e=t;return e*=this._numChannels,$.float16ToDouble(this._data[e])}getGreen(t){let e=t;return this._numChannels<2?0:(e*=this._numChannels,$.float16ToDouble(this._data[e+1]))}getBlue(t){let e=t;return this._numChannels<3?0:(e*=this._numChannels,$.float16ToDouble(this._data[e+2]))}getAlpha(t){let e=t;return this._numChannels<4?255:(e*=this._numChannels,$.float16ToDouble(this._data[e+3]))}setRed(t,e){this.set(t,0,e)}setGreen(t,e){this.set(t,1,e)}setBlue(t,e){this.set(t,2,e)}setAlpha(t,e){this.set(t,3,e)}clone(){return an.from(this)}toUint8Array(){return new Uint8Array(this.buffer)}}class rn{get data(){return this._data}get numColors(){return this._numColors}get numChannels(){return this._numChannels}get byteLength(){return this.data.byteLength}get buffer(){return this.data.buffer}get format(){return v.float32}get maxChannelValue(){return 1}constructor(t,e,i){this._numColors=t,this._numChannels=e,this._data=i??new Float32Array(t*e)}static from(t){return new rn(t.numColors,t.numChannels,t.data)}setRgb(t,e,i,n){let s=t;s*=this._numChannels,this._data[s]=e,this._numChannels>1&&(this._data[s+1]=i,this._numChannels>2&&(this._data[s+2]=n))}setRgba(t,e,i,n,s){let a=t;a*=this._numChannels,this._data[a]=e,this._numChannels>1&&(this._data[a+1]=i,this._numChannels>2&&(this._data[a+2]=n,this._numChannels>3&&(this._data[a+3]=s)))}set(t,e,i){let n=t;e<this._numChannels&&(n*=this._numChannels,this._data[n+e]=i)}get(t,e){return e<this._numChannels?this._data[t*this._numChannels+e]:0}getRed(t){let e=t;return e*=this._numChannels,this._data[e]}getGreen(t){let e=t;return this._numChannels<2?0:(e*=this._numChannels,this._data[e+1])}getBlue(t){let e=t;return this._numChannels<3?0:(e*=this._numChannels,this._data[e+2])}getAlpha(t){let e=t;return this._numChannels<4?255:(e*=this._numChannels,this._data[e+3])}setRed(t,e){this.set(t,0,e)}setGreen(t,e){this.set(t,1,e)}setBlue(t,e){this.set(t,2,e)}setAlpha(t,e){this.set(t,3,e)}clone(){return rn.from(this)}toUint8Array(){return new Uint8Array(this.buffer)}}class hn{get data(){return this._data}get numColors(){return this._numColors}get numChannels(){return this._numChannels}get byteLength(){return this.data.byteLength}get buffer(){return this.data.buffer}get format(){return v.float64}get maxChannelValue(){return 1}constructor(t,e,i){this._numColors=t,this._numChannels=e,this._data=i??new Float64Array(t*e)}static from(t){return new hn(t.numColors,t.numChannels,t.data)}setRgb(t,e,i,n){let s=t;s*=this._numChannels,this._data[s]=e,this._numChannels>1&&(this._data[s+1]=i,this._numChannels>2&&(this._data[s+2]=n))}setRgba(t,e,i,n,s){let a=t;a*=this._numChannels,this._data[a]=e,this._numChannels>1&&(this._data[a+1]=i,this._numChannels>2&&(this._data[a+2]=n,this._numChannels>3&&(this._data[a+3]=s)))}set(t,e,i){let n=t;e<this._numChannels&&(n*=this._numChannels,this._data[n+e]=i)}get(t,e){return e<this._numChannels?this._data[t*this._numChannels+e]:0}getRed(t){let e=t;return e*=this._numChannels,this._data[e]}getGreen(t){let e=t;return this._numChannels<2?0:(e*=this._numChannels,this._data[e+1])}getBlue(t){let e=t;return this._numChannels<3?0:(e*=this._numChannels,this._data[e+2])}getAlpha(t){let e=t;return this._numChannels<4?255:(e*=this._numChannels,this._data[e+3])}setRed(t,e){this.set(t,0,e)}setGreen(t,e){this.set(t,1,e)}setBlue(t,e){this.set(t,2,e)}setAlpha(t,e){this.set(t,3,e)}clone(){return hn.from(this)}toUint8Array(){return new Uint8Array(this.buffer)}}class ln{get data(){return this._data}get numColors(){return this._numColors}get numChannels(){return this._numChannels}get byteLength(){return this._data.byteLength}get buffer(){return this._data.buffer}get format(){return v.int16}get maxChannelValue(){return 32767}constructor(t,e,i){this._numColors=t,this._numChannels=e,this._data=i??new Int16Array(t*e)}static from(t){return new ln(t.numColors,t.numChannels,t.data)}setRgb(t,e,i,n){let s=t;s*=this._numChannels,this._data[s]=Math.trunc(e),this._numChannels>1&&(this._data[s+1]=Math.trunc(i),this._numChannels>2&&(this._data[s+2]=Math.trunc(n)))}setRgba(t,e,i,n,s){let a=t;a*=this._numChannels,this._data[a]=Math.trunc(e),this._numChannels>1&&(this._data[a+1]=Math.trunc(i),this._numChannels>2&&(this._data[a+2]=Math.trunc(n),this._numChannels>3&&(this._data[a+3]=Math.trunc(s))))}set(t,e,i){let n=t;e<this._numChannels&&(n*=this._numChannels,this._data[n+e]=Math.trunc(i))}get(t,e){return e<this._numChannels?this._data[t*this._numChannels+e]:0}getRed(t){let e=t;return e*=this._numChannels,this._data[e]}getGreen(t){let e=t;return this._numChannels<2?0:(e*=this._numChannels,this._data[e+1])}getBlue(t){let e=t;return this._numChannels<3?0:(e*=this._numChannels,this._data[e+2])}getAlpha(t){let e=t;return this._numChannels<4?0:(e*=this._numChannels,this._data[e+3])}setRed(t,e){this.set(t,0,e)}setGreen(t,e){this.set(t,1,e)}setBlue(t,e){this.set(t,2,e)}setAlpha(t,e){this.set(t,3,e)}clone(){return ln.from(this)}toUint8Array(){return new Uint8Array(this.buffer)}}class on{get data(){return this._data}get numColors(){return this._numColors}get numChannels(){return this._numChannels}get byteLength(){return this._data.byteLength}get buffer(){return this._data.buffer}get format(){return v.int32}get maxChannelValue(){return 2147483647}constructor(t,e,i){this._numColors=t,this._numChannels=e,this._data=i??new Int32Array(t*e)}static from(t){return new on(t.numColors,t.numChannels,t.data)}setRgb(t,e,i,n){let s=t;s*=this._numChannels,this._data[s]=Math.trunc(e),this._numChannels>1&&(this._data[s+1]=Math.trunc(i),this._numChannels>2&&(this._data[s+2]=Math.trunc(n)))}setRgba(t,e,i,n,s){let a=t;a*=this._numChannels,this._data[a]=Math.trunc(e),this._numChannels>1&&(this._data[a+1]=Math.trunc(i),this._numChannels>2&&(this._data[a+2]=Math.trunc(n),this._numChannels>3&&(this._data[a+3]=Math.trunc(s))))}set(t,e,i){let n=t;e<this._numChannels&&(n*=this._numChannels,this._data[n+e]=Math.trunc(i))}get(t,e){return e<this._numChannels?this._data[t*this._numChannels+e]:0}getRed(t){let e=t;return e*=this._numChannels,this._data[e]}getGreen(t){let e=t;return this._numChannels<2?0:(e*=this._numChannels,this._data[e+1])}getBlue(t){let e=t;return this._numChannels<3?0:(e*=this._numChannels,this._data[e+2])}getAlpha(t){let e=t;return this._numChannels<4?0:(e*=this._numChannels,this._data[e+3])}setRed(t,e){this.set(t,0,e)}setGreen(t,e){this.set(t,1,e)}setBlue(t,e){this.set(t,2,e)}setAlpha(t,e){this.set(t,3,e)}clone(){return on.from(this)}toUint8Array(){return new Uint8Array(this.buffer)}}class un{get data(){return this._data}get numColors(){return this._numColors}get numChannels(){return this._numChannels}get byteLength(){return this.data.byteLength}get buffer(){return this.data.buffer}get format(){return v.int8}get maxChannelValue(){return 127}constructor(t,e,i){this._numColors=t,this._numChannels=e,this._data=i??new Int8Array(t*e)}static from(t){return new un(t.numColors,t.numChannels,t.data)}setRgb(t,e,i,n){let s=t;s*=this._numChannels,this._data[s]=Math.trunc(e),this._numChannels>1&&(this._data[s+1]=Math.trunc(i),this._numChannels>2&&(this._data[s+2]=Math.trunc(n)))}setRgba(t,e,i,n,s){let a=t;a*=this._numChannels,this._data[a]=Math.trunc(e),this._numChannels>1&&(this._data[a+1]=Math.trunc(i),this._numChannels>2&&(this._data[a+2]=Math.trunc(n),this._numChannels>3&&(this._data[a+3]=Math.trunc(s))))}set(t,e,i){let n=t;e<this._numChannels&&(n*=this._numChannels,this._data[n+e]=Math.trunc(i))}get(t,e){return e<this._numChannels?this._data[t*this._numChannels+e]:0}getRed(t){let e=t;return e*=this._numChannels,this._data[e]}getGreen(t){let e=t;return this._numChannels<2?0:(e*=this._numChannels,this._data[e+1])}getBlue(t){let e=t;return this._numChannels<3?0:(e*=this._numChannels,this._data[e+2])}getAlpha(t){let e=t;return this._numChannels<4?0:(e*=this._numChannels,this._data[e+3])}setRed(t,e){this.set(t,0,e)}setGreen(t,e){this.set(t,1,e)}setBlue(t,e){this.set(t,2,e)}setAlpha(t,e){this.set(t,3,e)}clone(){return un.from(this)}toUint8Array(){return new Uint8Array(this.buffer)}}class cn{get data(){return this._data}get numColors(){return this._numColors}get numChannels(){return this._numChannels}get byteLength(){return this._data.byteLength}get buffer(){return this._data.buffer}get format(){return v.uint16}get maxChannelValue(){return 65535}constructor(t,e,i){this._numColors=t,this._numChannels=e,this._data=i??new Uint16Array(t*e)}static from(t){return new cn(t.numColors,t.numChannels,t.data)}setRgb(t,e,i,n){let s=t;s*=this._numChannels,this._data[s]=Math.trunc(e),this._numChannels>1&&(this._data[s+1]=Math.trunc(i),this._numChannels>2&&(this._data[s+2]=Math.trunc(n)))}setRgba(t,e,i,n,s){let a=t;a*=this._numChannels,this._data[a]=Math.trunc(e),this._numChannels>1&&(this._data[a+1]=Math.trunc(i),this._numChannels>2&&(this._data[a+2]=Math.trunc(n),this._numChannels>3&&(this._data[a+3]=Math.trunc(s))))}set(t,e,i){let n=t;e<this._numChannels&&(n*=this._numChannels,this._data[n+e]=Math.trunc(i))}get(t,e){return e<this._numChannels?this._data[t*this._numChannels+e]:0}getRed(t){let e=t;return e*=this._numChannels,this._data[e]}getGreen(t){let e=t;return this._numChannels<2?0:(e*=this._numChannels,this._data[e+1])}getBlue(t){let e=t;return this._numChannels<3?0:(e*=this._numChannels,this._data[e+2])}getAlpha(t){let e=t;return this._numChannels<4?0:(e*=this._numChannels,this._data[e+3])}setRed(t,e){this.set(t,0,e)}setGreen(t,e){this.set(t,1,e)}setBlue(t,e){this.set(t,2,e)}setAlpha(t,e){this.set(t,3,e)}clone(){return cn.from(this)}toUint8Array(){return new Uint8Array(this.buffer)}}class Zi{get data(){return this._data}get numColors(){return this._numColors}get numChannels(){return this._numChannels}get byteLength(){return this._data.byteLength}get buffer(){return this._data.buffer}get format(){return v.uint32}get maxChannelValue(){return 4294967295}constructor(t,e,i){this._numColors=t,this._numChannels=e,this._data=i??new Uint32Array(t*e)}static from(t){return new Zi(t.numColors,t.numChannels,t.data)}setRgb(t,e,i,n){let s=t;s*=this._numChannels,this._data[s]=Math.trunc(e),this._numChannels>1&&(this._data[s+1]=Math.trunc(i),this._numChannels>2&&(this._data[s+2]=Math.trunc(n)))}setRgba(t,e,i,n,s){let a=t;a*=this._numChannels,this._data[a]=Math.trunc(e),this._numChannels>1&&(this._data[a+1]=Math.trunc(i),this._numChannels>2&&(this._data[a+2]=Math.trunc(n),this._numChannels>3&&(this._data[a+3]=Math.trunc(s))))}set(t,e,i){let n=t;e<this._numChannels&&(n*=this._numChannels,this._data[n+e]=Math.trunc(i))}get(t,e){return e<this._numChannels?this._data[t*this._numChannels+e]:0}getRed(t){let e=t;return e*=this._numChannels,this._data[e]}getGreen(t){let e=t;return this._numChannels<2?0:(e*=this._numChannels,this._data[e+1])}getBlue(t){let e=t;return this._numChannels<3?0:(e*=this._numChannels,this._data[e+2])}getAlpha(t){let e=t;return this._numChannels<4?0:(e*=this._numChannels,this._data[e+3])}setRed(t,e){this.set(t,0,e)}setGreen(t,e){this.set(t,1,e)}setBlue(t,e){this.set(t,2,e)}setAlpha(t,e){this.set(t,3,e)}clone(){return Zi.from(this)}toUint8Array(){return new Uint8Array(this.buffer)}}class ne{get data(){return this._data}get numColors(){return this._numColors}get numChannels(){return this._numChannels}get byteLength(){return this._data.byteLength}get buffer(){return this._data.buffer}get format(){return v.uint8}get maxChannelValue(){return 255}constructor(t,e,i){this._numColors=t,this._numChannels=e,this._data=i??new Uint8Array(t*e)}static from(t){return new ne(t.numColors,t.numChannels,t.data)}setRgb(t,e,i,n){let s=t;s*=this._numChannels,this._data[s]=Math.trunc(e),this._numChannels>1&&(this._data[s+1]=Math.trunc(i),this._numChannels>2&&(this._data[s+2]=Math.trunc(n)))}setRgba(t,e,i,n,s){let a=t;a*=this._numChannels,this._data[a]=Math.trunc(e),this._numChannels>1&&(this._data[a+1]=Math.trunc(i),this._numChannels>2&&(this._data[a+2]=Math.trunc(n),this._numChannels>3&&(this._data[a+3]=Math.trunc(s))))}set(t,e,i){let n=t;e<this._numChannels&&(n*=this._numChannels,this._data[n+e]=Math.trunc(i))}get(t,e){return e<this._numChannels?this._data[t*this._numChannels+e]:0}getRed(t){let e=t;return e*=this._numChannels,e>=this._data.length?0:this._data[e]}getGreen(t){let e=t;return this._numChannels<2||(e*=this._numChannels,e>=this._data.length)?0:this._data[e+1]}getBlue(t){let e=t;return this._numChannels<3||(e*=this._numChannels,e>=this._data.length)?0:this._data[e+2]}getAlpha(t){let e=t;return this._numChannels<4?255:(e*=this._numChannels,e>=this._data.length?0:this._data[e+3])}setRed(t,e){this.set(t,0,e)}setGreen(t,e){this.set(t,1,e)}setBlue(t,e){this.set(t,2,e)}setAlpha(t,e){this.set(t,3,e)}clone(){return ne.from(this)}toUint8Array(){return new Uint8Array(this.buffer)}}class Bi{get image(){return Bi._nullImageData}get isValid(){return!1}get width(){return 0}get height(){return 0}get x(){return 0}get y(){return 0}get xNormalized(){return 0}get yNormalized(){return 0}get length(){return 0}get maxChannelValue(){return 0}get maxIndexValue(){return 0}get format(){return v.uint8}get isLdrFormat(){return!1}get isHdrFormat(){return!1}get hasPalette(){return!1}get palette(){}get index(){return 0}set index(t){}get r(){return 0}set r(t){}get g(){return 0}set g(t){}get b(){return 0}set b(t){}get a(){return 0}set a(t){}get rNormalized(){return 0}set rNormalized(t){}get gNormalized(){return 0}set gNormalized(t){}get bNormalized(){return 0}set bNormalized(t){}get aNormalized(){return 0}set aNormalized(t){}get luminance(){return 0}get luminanceNormalized(){return 0}getChannel(t){return 0}getChannelNormalized(t){return 0}setChannel(t,e){}set(t){}setRgb(t,e,i){}setRgba(t,e,i,n){}clone(){return new Bi}convert(t){return this}setPosition(t,e){}setPositionNormalized(t,e){}equals(t){return t instanceof Bi}next(){return{done:!0,value:this}}toArray(){return[]}toString(){return`${this.constructor.name} (undefined)`}[Symbol.iterator](){return this}}Bi._nullImageData=new Je(0,0,0);const yn=new Bi;class tt{get data(){return this._data}get format(){var t,e;return(e=(t=this._data)===null||t===void 0?void 0:t.format)!==null&&e!==void 0?e:v.uint8}get hasPalette(){var t;return((t=this._data)===null||t===void 0?void 0:t.palette)!==void 0}get palette(){var t;return(t=this._data)===null||t===void 0?void 0:t.palette}set palette(t){this._data!==void 0&&(this._data.palette=t)}get numChannels(){var t,e,i,n;return(n=(e=(t=this.palette)===null||t===void 0?void 0:t.numChannels)!==null&&e!==void 0?e:(i=this._data)===null||i===void 0?void 0:i.numChannels)!==null&&n!==void 0?n:0}get hasAnimation(){return this._frames.length>1}get numFrames(){return this._frames.length}get exifData(){var t;return(t=this._exifData)!==null&&t!==void 0||(this._exifData=new me),this._exifData}set exifData(t){this._exifData=t}get maxChannelValue(){var t,e;return(e=(t=this._data)===null||t===void 0?void 0:t.maxChannelValue)!==null&&e!==void 0?e:0}get maxIndexValue(){var t,e;return(e=(t=this.data)===null||t===void 0?void 0:t.maxIndexValue)!==null&&e!==void 0?e:0}get supportsPalette(){return this.format===v.uint1||this.format===v.uint2||this.format===v.uint4||this.format===v.uint8||this.format===v.uint16}get width(){var t,e;return(e=(t=this.data)===null||t===void 0?void 0:t.width)!==null&&e!==void 0?e:0}get height(){var t,e;return(e=(t=this.data)===null||t===void 0?void 0:t.height)!==null&&e!==void 0?e:0}get formatType(){var t,e;return(e=(t=this.data)===null||t===void 0?void 0:t.formatType)!==null&&e!==void 0?e:wt.uint}get isValid(){return this._data!==void 0&&this.width>0&&this.height>0}get buffer(){var t;return(t=this._data)===null||t===void 0?void 0:t.buffer}get byteLength(){var t,e;return(e=(t=this._data)===null||t===void 0?void 0:t.buffer.byteLength)!==null&&e!==void 0?e:0}get rowStride(){var t,e;return(e=(t=this._data)===null||t===void 0?void 0:t.rowStride)!==null&&e!==void 0?e:0}get isLdrFormat(){var t,e;return(e=(t=this._data)===null||t===void 0?void 0:t.isLdrFormat)!==null&&e!==void 0?e:!1}get isHdrFormat(){var t,e;return(e=(t=this._data)===null||t===void 0?void 0:t.isHdrFormat)!==null&&e!==void 0?e:!1}get bitsPerChannel(){var t,e;return(e=(t=this._data)===null||t===void 0?void 0:t.bitsPerChannel)!==null&&e!==void 0?e:0}get hasAlpha(){return this.numChannels===2||this.numChannels===4}get iccProfile(){return this._iccProfile}set iccProfile(t){this._iccProfile=t}get textData(){return this._textData}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t}get loopCount(){return this._loopCount}set loopCount(t){this._loopCount=t}get frameType(){return this._frameType}set frameType(t){this._frameType=t}get frames(){return this._frames}get frameDuration(){return this._frameDuration}set frameDuration(t){this._frameDuration=t}get frameIndex(){return this._frameIndex}set frameIndex(t){this._frameIndex=t}constructor(t){var e,i,n,s,a,r,h,l;this._frames=[],t!==void 0?(this._loopCount=(e=t.loopCount)!==null&&e!==void 0?e:0,this._frameType=(i=t.frameType)!==null&&i!==void 0?i:hi.sequence,this._frameDuration=(n=t.frameDuration)!==null&&n!==void 0?n:0,this._frameIndex=(s=t.frameIndex)!==null&&s!==void 0?s:0,this._backgroundColor=t.backgroundColor,this._textData=t.textData,this._frames.push(this),this.initialize({width:t.width,height:t.height,format:(a=t.format)!==null&&a!==void 0?a:v.uint8,numChannels:(r=t.numChannels)!==null&&r!==void 0?r:3,withPalette:(h=t.withPalette)!==null&&h!==void 0?h:!1,paletteFormat:(l=t.paletteFormat)!==null&&l!==void 0?l:v.uint8,palette:t.palette,exifData:t.exifData,iccProfile:t.iccProfile})):(this._loopCount=0,this._frameType=hi.sequence,this._frameDuration=0,this._frameIndex=0)}static getNumPixelColors(t){return t===v.uint1?2:t===v.uint2?4:t===v.uint4?16:t===v.uint8?256:t===v.uint16?65536:0}static fromResized(t,e,i,n=!1){var s,a,r,h;const l=new tt({width:e,height:i,loopCount:t._loopCount,frameType:t._frameType,frameDuration:t._frameDuration,frameIndex:t._frameIndex,backgroundColor:(s=t._backgroundColor)===null||s===void 0?void 0:s.clone(),format:t.format,numChannels:t.numChannels,withPalette:t.hasPalette,paletteFormat:(a=t.palette)===null||a===void 0?void 0:a.format,palette:t.palette,exifData:(r=t._exifData)===null||r===void 0?void 0:r.clone(),iccProfile:(h=t._iccProfile)===null||h===void 0?void 0:h.clone(),textData:t._textData!==void 0?new Map(t._textData):void 0});if(t._extraChannels!==void 0&&(l._extraChannels=new Map(t._extraChannels)),!n){const u=t.numFrames;for(let d=1;d<u;++d){const c=t._frames[d];l.addFrame(tt.fromResized(c,e,i))}}return l}static from(t,e=!1,i=!1){var n,s,a,r;const h=new tt;if(h._data=(n=t.data)===null||n===void 0?void 0:n.clone(i),h._exifData=(s=t._exifData)===null||s===void 0?void 0:s.clone(),h._iccProfile=(a=t.iccProfile)===null||a===void 0?void 0:a.clone(),h._frameType=t.frameType,h._loopCount=t._loopCount,h._backgroundColor=(r=t._backgroundColor)===null||r===void 0?void 0:r.clone(),h._frameDuration=t._frameDuration,h._frameIndex=t._frameIndex,t._extraChannels!==void 0&&(h._extraChannels=new Map(t._extraChannels)),t._textData!==void 0&&(h._textData=new Map(t.textData)),h._frames.push(h),!e&&t.hasAnimation){const l=t.numFrames;for(let u=1;u<l;++u){const d=t._frames[u];h.addFrame(tt.from(d))}}return h}static fromBytes(t){var e,i,n,s,a,r,h,l,u,d,c;const g=(e=t.byteOffset)!==null&&e!==void 0?e:0,f=new tt;f._loopCount=(i=t.loopCount)!==null&&i!==void 0?i:0,f._frameType=(n=t.frameType)!==null&&n!==void 0?n:hi.sequence,f._frameDuration=(s=t.frameDuration)!==null&&s!==void 0?s:0,f._frameIndex=(a=t.frameIndex)!==null&&a!==void 0?a:0,f._backgroundColor=t.backgroundColor,f._textData=t.textData,f._frames.push(f);const m=(r=t.format)!==null&&r!==void 0?r:v.uint8,_=(h=t.withPalette)!==null&&h!==void 0?h:!1,x=(l=t.paletteFormat)!==null&&l!==void 0?l:v.uint8,b=(u=t.numChannels)!==null&&u!==void 0?u:t.channelOrder!==void 0?Ln.get(t.channelOrder):3;if(b<0||b>4)throw new W("A MemoryImage can only have 1-4 channels.");let p=(d=t.channelOrder)!==null&&d!==void 0?d:b===3?lt.rgb:b===4?lt.rgba:b===1?lt.red:lt.grayAlpha;if(b===1?p=lt.red:b===2?p=lt.grayAlpha:b===3?p!==lt.rgb&&p!==lt.bgr&&(p=lt.rgb):b===4&&p!==lt.bgra&&p!==lt.rgba&&p!==lt.abgr&&p!==lt.argb&&(p=lt.rgba),f.initialize({width:t.width,height:t.height,format:m,numChannels:b,withPalette:_,paletteFormat:x,palette:t.palette,exifData:t.exifData,iccProfile:t.iccProfile}),f.data!==void 0){const w=f.data.toUint8Array(),C=new Uint8Array(t.bytes,g),y=(c=t.rowStride)!==null&&c!==void 0?c:_s(t.width,b,m),A=f.data.rowStride,B=Math.min(y,A);let z=0,U=0;for(let P=0;P<t.height;++P,U+=y,z+=A)F.copyRange(C,U,w,z,B);if(b===3&&p===lt.bgr)for(const P of f){const L=P.r;P.r=P.b,P.b=L}else if(b===4&&p===lt.abgr)for(const P of f){const L=P.r,V=P.g,T=P.b,H=P.a;P.r=H,P.g=T,P.b=V,P.a=L}else if(b===4&&p===lt.argb)for(const P of f){const L=P.r,V=P.g,T=P.b,H=P.a;P.r=H,P.g=L,P.b=V,P.a=T}else if(b===4&&p===lt.bgra)for(const P of f){const L=P.r,V=P.g,T=P.b,H=P.a;P.r=T,P.g=V,P.b=L,P.a=H}}return f}initialize(t){var e,i,n,s,a;const r=(e=t.format)!==null&&e!==void 0?e:v.uint8,h=(i=t.numChannels)!==null&&i!==void 0?i:3,l=(n=t.withPalette)!==null&&n!==void 0?n:!1,u=(s=t.paletteFormat)!==null&&s!==void 0?s:v.uint8;this._iccProfile=t.iccProfile,t.exifData!==void 0&&(this._exifData=t.exifData.clone());const d=(a=t.palette)!==null&&a!==void 0?a:l&&this.supportsPalette?this.createPalette(r,u,h):void 0;this.createImageData(t.width,t.height,r,h,d)}createImageData(t,e,i,n,s){switch(i){case v.uint1:s===void 0?this._data=new li(t,e,n):this._data=li.palette(t,e,s);break;case v.uint2:s===void 0?this._data=new ui(t,e,n):this._data=ui.palette(t,e,s);break;case v.uint4:s===void 0?this._data=new ci(t,e,n):this._data=ci.palette(t,e,s);break;case v.uint8:s===void 0?this._data=new Je(t,e,n):this._data=Je.palette(t,e,s);break;case v.uint16:s===void 0?this._data=new oi(t,e,n):this._data=oi.palette(t,e,s);break;case v.uint32:this._data=new Ti(t,e,n);break;case v.int8:this._data=new Fi(t,e,n);break;case v.int16:this._data=new Di(t,e,n);break;case v.int32:this._data=new Li(t,e,n);break;case v.float16:this._data=new Ui(t,e,n);break;case v.float32:this._data=new Ii(t,e,n);break;case v.float64:this._data=new Ni(t,e,n);break}}createPalette(t,e,i){switch(e){case v.uint1:return;case v.uint2:return;case v.uint4:return;case v.uint8:return new ne(tt.getNumPixelColors(t),i);case v.uint16:return new cn(tt.getNumPixelColors(t),i);case v.uint32:return new Zi(tt.getNumPixelColors(t),i);case v.int8:return new un(tt.getNumPixelColors(t),i);case v.int16:return new ln(tt.getNumPixelColors(t),i);case v.int32:return new on(tt.getNumPixelColors(t),i);case v.float16:return new an(tt.getNumPixelColors(t),i);case v.float32:return new rn(tt.getNumPixelColors(t),i);case v.float64:return new hn(tt.getNumPixelColors(t),i)}throw new W("Unknown palette format.")}addFrame(t){const e=t??tt.from(this,!0,!0);return e._frameIndex=this._frames.length,(this._frames.length===0||this._frames[this._frames.length-1]!==e)&&this._frames.push(e),e}getFrame(t){return this._frames[t]}clone(t){var e,i;const n=(e=t?.skipAnimation)!==null&&e!==void 0?e:!1,s=(i=t?.skipPixels)!==null&&i!==void 0?i:!1;return tt.from(this,n,s)}hasExtraChannel(t){return this._extraChannels!==void 0&&this._extraChannels.has(t)}getExtraChannel(t){return this._extraChannels!==void 0?this._extraChannels.get(t):void 0}setExtraChannel(t,e){var i;this._extraChannels===void 0&&e===void 0||((i=this._extraChannels)!==null&&i!==void 0||(this._extraChannels=new Map),e===void 0?this._extraChannels.delete(t):this._extraChannels.set(t,e),this._extraChannels.size===0&&(this._extraChannels=void 0))}getRange(t,e,i,n){return this.data.getRange(t,e,i,n)}toUint8Array(){var t,e;return(e=(t=this._data)===null||t===void 0?void 0:t.toUint8Array())!==null&&e!==void 0?e:this.buffer!==void 0?new Uint8Array(this.buffer):new Uint8Array}getBytes(t){var e,i,n,s,a,r;const h=t?.order,l=t?.alpha;if(h!==void 0){const u=Ln.get(h);return u!==this.numChannels?(i=(e=this.convert({numChannels:u,alpha:l}).data)===null||e===void 0?void 0:e.getBytes({order:h,inPlace:!0}))!==null&&i!==void 0?i:this.toUint8Array():(s=(n=this.data)===null||n===void 0?void 0:n.getBytes({order:h,inPlace:!1}))!==null&&s!==void 0?s:this.toUint8Array()}else return(r=(a=this.data)===null||a===void 0?void 0:a.getBytes({order:h}))!==null&&r!==void 0?r:this.toUint8Array()}remapChannels(t){if(this.numChannels===4){if(t===lt.abgr||t===lt.argb||t===lt.bgra){if(t===lt.abgr)for(const e of this){const i=e.r,n=e.g,s=e.b,a=e.a;e.r=a,e.g=s,e.b=n,e.a=i}else if(t===lt.argb)for(const e of this){const i=e.r,n=e.g,s=e.b,a=e.a;e.r=a,e.g=i,e.b=n,e.a=s}else if(t===lt.bgra)for(const e of this){const i=e.r,n=e.g,s=e.b,a=e.a;e.r=s,e.g=n,e.b=i,e.a=a}}}else if(this.numChannels===3&&t===lt.bgr)for(const e of this){const i=e.r;e.r=e.b,e.b=i}}isBoundsSafe(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height}getColor(t,e,i,n){var s,a;return(a=(s=this._data)===null||s===void 0?void 0:s.getColor(t,e,i,n))!==null&&a!==void 0?a:new ie(0)}getPixel(t,e,i){var n,s;return(s=(n=this._data)===null||n===void 0?void 0:n.getPixel(t,e,i))!==null&&s!==void 0?s:yn}getPixelSafe(t,e,i){return t<0||t>=this.width||e<0||e>=this.height?yn:this.getPixel(t,e,i)}getPixelClamped(t,e,i){const n=k.clamp(t,0,this.width-1),s=k.clamp(e,0,this.height-1);return this.getPixel(n,s,i)}getPixelIndex(t,e){var i;const n=(i=this._data)===null||i===void 0?void 0:i.getPixel(t,e).index;return n!==void 0?Math.trunc(n):0}getPixelInterpolate(t,e,i=Xe.linear){switch(i){case Xe.nearest:return this.getPixelSafe(Math.trunc(t),Math.trunc(e));case Xe.linear:case Xe.average:return this.getPixelLinear(t,e);case Xe.cubic:return this.getPixelCubic(t,e)}throw new W("Unknown Interpolation mode.")}getPixelLinear(t,e){const i=Math.trunc(t)-(t>=0?0:1),n=i+1,s=Math.trunc(e)-(e>=0?0:1),a=s+1,r=t-i,h=e-s,l=(f,m,_,x)=>f+r*(m-f+h*(f+x-_-m))+h*(_-f),u=this.getPixelSafe(i,s),d=a>=this.height?u:this.getPixelSafe(i,a),c=n>=this.width?u:this.getPixelSafe(n,s),g=n>=this.width||a>=this.height?u:this.getPixelSafe(n,a);return this.getColor(l(u.r,c.r,d.r,g.r),l(u.g,c.g,d.g,g.g),l(u.b,c.b,d.b,g.b),l(u.a,c.a,d.a,g.a))}getPixelCubic(t,e){const i=Math.trunc(t)-(t>=0?0:1),n=i-1,s=i+1,a=i+2,r=Math.trunc(e)-(e>=0?0:1),h=r-1,l=r+1,u=r+2,d=t-i,c=e-r,g=(Gt,Si,ki,Tt,$t)=>ki+.5*(Gt*(-Si+Tt)+Gt*Gt*(2*Si-5*ki+4*Tt-$t)+Gt*Gt*Gt*(-Si+3*ki-3*Tt+$t)),f=this.getPixelSafe(i,r),m=n<0||h<0?f:this.getPixelSafe(n,h),_=n<0?f:this.getPixelSafe(i,h),x=h<0||s>=this.width?f:this.getPixelSafe(s,h),b=a>=this.width||h<0?f:this.getPixelSafe(a,h),p=g(d,m.r,_.r,x.r,b.r),w=g(d,m.g,_.g,x.g,b.g),C=g(d,m.b,_.b,x.b,b.b),y=g(d,m.a,_.a,x.a,b.a),A=n<0?f:this.getPixelSafe(n,r),B=s>=this.width?f:this.getPixelSafe(s,r),z=a>=this.width?f:this.getPixelSafe(a,r),U=g(d,A.r,f.r,B.r,z.r),P=g(d,A.g,f.g,B.g,z.g),L=g(d,A.b,f.b,B.b,z.b),V=g(d,A.a,f.a,B.a,z.a),T=n<0||l>=this.height?f:this.getPixelSafe(n,l),H=l>=this.height?f:this.getPixelSafe(i,l),Y=s>=this.width||l>=this.height?f:this.getPixelSafe(s,l),j=a>=this.width||l>=this.height?f:this.getPixelSafe(a,l),ut=g(d,T.r,H.r,Y.r,j.r),ct=g(d,T.g,H.g,Y.g,j.g),ft=g(d,T.b,H.b,Y.b,j.b),at=g(d,T.a,H.a,Y.a,j.a),mt=n<0||u>=this.height?f:this.getPixelSafe(n,u),xt=u>=this.height?f:this.getPixelSafe(i,u),St=s>=this.width||u>=this.height?f:this.getPixelSafe(s,u),yt=a>=this.width||u>=this.height?f:this.getPixelSafe(a,u),Ct=g(d,mt.r,xt.r,St.r,yt.r),Ut=g(d,mt.g,xt.g,St.g,yt.g),qt=g(d,mt.b,xt.b,St.b,yt.b),Kt=g(d,mt.a,xt.a,St.a,yt.a),Et=g(c,p,U,ut,Ct),At=g(c,w,P,ct,Ut),Yt=g(c,C,L,ft,qt),Ft=g(c,y,V,at,Kt);return this.getColor(Math.trunc(Et),Math.trunc(At),Math.trunc(Yt),Math.trunc(Ft))}setPixel(t,e,i){var n;if("image"in i&&"index"in i&&i.image.hasPalette&&this.hasPalette){this.setPixelIndex(t,e,i.index);return}(n=this._data)===null||n===void 0||n.setPixelRgba(t,e,i.r,i.g,i.b,i.a)}setPixelIndex(t,e,i){var n;(n=this._data)===null||n===void 0||n.setPixelR(t,e,i)}setPixelR(t,e,i){var n;(n=this._data)===null||n===void 0||n.setPixelR(t,e,i)}setPixelRgb(t,e,i,n,s){var a;(a=this._data)===null||a===void 0||a.setPixelRgb(t,e,i,n,s)}setPixelRgba(t,e,i,n,s,a){var r;(r=this._data)===null||r===void 0||r.setPixelRgba(t,e,i,n,s,a)}clear(t){var e;(e=this._data)===null||e===void 0||e.clear(t)}convert(t){var e,i,n,s,a,r,h,l,u,d;const c=(e=t.format)!==null&&e!==void 0?e:this.format,g=(i=t.numChannels)!==null&&i!==void 0?i:this.numChannels,f=(n=t.alpha)!==null&&n!==void 0?n:ts.get(c),m=(s=t.withPalette)!==null&&s!==void 0?s:!1,_=(a=t.skipAnimation)!==null&&a!==void 0?a:!1;if(c===this.format&&g===this.numChannels&&(!m&&this.palette===void 0||m&&this.palette!==void 0))return tt.from(this);let x;for(const b of this._frames){const p=new tt({width:b.width,height:b.height,format:c,numChannels:g,withPalette:m,exifData:(r=b._exifData)===null||r===void 0?void 0:r.clone(),iccProfile:(h=b._iccProfile)===null||h===void 0?void 0:h.clone(),backgroundColor:(l=b._backgroundColor)===null||l===void 0?void 0:l.clone(),frameType:b._frameType,loopCount:b._loopCount,frameDuration:b._frameDuration,textData:b._textData!==void 0?new Map(b.textData):void 0});x!==void 0?x.addFrame(p):x=p;const w=p.palette,C=(d=(u=p.palette)===null||u===void 0?void 0:u.format)!==null&&d!==void 0?d:c;if(w!==void 0){const y=new Map;let A=0;const B=b.getPixel(0,0);let z;for(const U of p){const P=Math.floor(B.rNormalized*255),L=Math.floor(B.gNormalized*255),V=Math.floor(B.bNormalized*255),T=E.rgbaToUint32(P,L,V,0);y.has(T)?U.index=y.get(T):(y.set(T,A),U.index=A,z=E.convertColor({from:B,to:z,format:C,numChannels:g,alpha:f}),w.setRgb(A,z.r,z.g,z.b),A++),B.next()}}else{const y=b.getPixel(0,0);for(const A of p)E.convertColor({from:y,to:A,alpha:f}),y.next()}if(_)break}return x}addTextData(t){var e;(e=this._textData)!==null&&e!==void 0||(this._textData=new Map);for(const[i,n]of t)this._textData.set(i,n)}getColorExtremes(){let t=!0,e=0,i=0;for(const n of this){for(let s=0;s<n.length;s++){const a=n.getChannel(s);(t||a<e)&&(e=a),(t||a>i)&&(i=a)}t=!1}return{min:e,max:i}}toString(){return`${this.constructor.name} (w: ${this.width}, h: ${this.height}, f: ${v[this.format]}, ch: ${this.numChannels})`}[Symbol.iterator](){return this._data!==void 0?this._data[Symbol.iterator]():{next:()=>({done:!0,value:yn})}}}class ti{get fileLength(){return this._fileLength}set imageOffset(t){this._imageOffset=t}get imageOffset(){return this._imageOffset}constructor(t){if(!ti.isValidFile(t))throw new W("Not a bitmap file.");t.skip(2),this._fileLength=t.readInt32(),t.skip(4),this._imageOffset=t.readInt32()}static isValidFile(t){return t.length<2?!1:D.from(t).readUint16()===ti.signature}}ti.signature=19778;var je;(function(o){o[o.none=0]="none",o[o.rle8=1]="rle8",o[o.rle4=2]="rle4",o[o.bitfields=3]="bitfields",o[o.jpeg=4]="jpeg",o[o.png=5]="png",o[o.alphaBitfields=6]="alphaBitfields",o[o.reserved7=7]="reserved7",o[o.reserved8=8]="reserved8",o[o.reserved9=9]="reserved9",o[o.reserved10=10]="reserved10",o[o.cmyk=11]="cmyk",o[o.cmykRle8=12]="cmykRle8",o[o.cmykRle4=13]="cmykRle4"})(je||(je={}));class es{get width(){return this._width}get height(){return Math.abs(this._height)}get backgroundColor(){return this._backgroundColor}get numFrames(){return this._numFrames}get header(){return this._header}get headerSize(){return this._headerSize}get planes(){return this._planes}get bitsPerPixel(){return this._bitsPerPixel}get compression(){return this._compression}get imageSize(){return this._imageSize}get xppm(){return this._xppm}get yppm(){return this._yppm}get totalColors(){return this._totalColors}get importantColors(){return this._importantColors}get redMask(){return this._redMask}get greenMask(){return this._greenMask}get blueMask(){return this._blueMask}get alphaMask(){return this._alphaMask}get palette(){return this._palette}get readBottomUp(){return this._height>=0}get ignoreAlphaChannel(){return this._headerSize===40||this._headerSize===124&&this._alphaMask===0}constructor(t,e){this._redShift=0,this._redScale=0,this._greenShift=0,this._greenScale=0,this._blueShift=0,this._blueScale=0,this._alphaShift=0,this._alphaScale=0,this._width=0,this._height=0,this._backgroundColor=void 0,this._numFrames=1,this._redMask=0,this._greenMask=0,this._blueMask=0,this._alphaMask=0,this._header=e??new ti(t),this._startPos=t.offset,this._headerSize=t.readUint32(),this._width=t.readInt32(),this._height=t.readInt32(),this._planes=t.readUint16(),this._bitsPerPixel=t.readUint16(),this._compression=t.readUint32(),this._imageSize=t.readUint32(),this._xppm=t.readInt32(),this._yppm=t.readInt32(),this._totalColors=t.readUint32(),this._importantColors=t.readUint32();const i=255;if(this._headerSize>40||this._compression===je.bitfields||this._compression===je.alphaBitfields){this._redMask=t.readUint32(),this._redShift=q.countTrailingZeroBits(this._redMask);const a=this._redMask>>>this._redShift;this._redScale=a>0?i/a:0,this._greenMask=t.readUint32(),this._greenShift=q.countTrailingZeroBits(this._greenMask);const r=this._greenMask>>>this._greenShift;this._greenScale=a>0?i/r:0,this._blueMask=t.readUint32(),this._blueShift=q.countTrailingZeroBits(this._blueMask);const h=this._blueMask>>>this._blueShift;if(this._blueScale=a>0?i/h:0,this._headerSize>40||this._compression===je.alphaBitfields){this._alphaMask=t.readUint32(),this._alphaShift=q.countTrailingZeroBits(this._alphaMask);const l=this._alphaMask>>>this._alphaShift;this._alphaScale=l>0?i/l:0}else this._bitsPerPixel===16?(this._alphaMask=4278190080,this._alphaShift=24,this._alphaScale=1):(this._alphaMask=4278190080,this._alphaShift=24,this._alphaScale=1)}else if(this._bitsPerPixel===16){this._redMask=31744,this._redShift=10;const a=this._redMask>>>this._redShift;this._redScale=a>0?i/a:0,this._greenMask=992,this._greenShift=5;const r=this._greenMask>>>this._greenShift;this._greenScale=a>0?i/r:0,this._blueMask=31,this._blueShift=0;const h=this._blueMask>>>this._blueShift;this._blueScale=a>0?i/h:0,this._alphaMask=0,this._alphaShift=0,this._alphaScale=0}else this._redMask=16711680,this._redShift=16,this._redScale=1,this._greenMask=65280,this._greenShift=8,this._greenScale=1,this._blueMask=255,this._blueShift=0,this._blueScale=1,this._alphaMask=4278190080,this._alphaShift=24,this._alphaScale=1;const n=t.offset-this._startPos,s=this._headerSize-n;t.skip(s),this._bitsPerPixel<=8&&this.readPalette(t)}readPalette(t){const e=this._totalColors===0?1<<this._bitsPerPixel:this._totalColors,i=3;this._palette=new ne(e,i);for(let n=0;n<e;++n){const s=t.read(),a=t.read(),r=t.read(),h=t.read();this._palette.setRgba(n,r,a,s,h)}}decodePixel(t,e){if(this._palette!==void 0){if(this._bitsPerPixel===1){const i=t.read();for(let n=7;n>=0;--n){const s=i>>>n&1;e(s,0,0,0)}return}else if(this._bitsPerPixel===2){const i=t.read();for(let n=6;n>=0;n-=2){const s=i>>>n&2;e(s,0,0,0)}}else if(this._bitsPerPixel===4){const i=t.read(),n=i>>>4&15;e(n,0,0,0);const s=i&15;e(s,0,0,0);return}else if(this._bitsPerPixel===8){const i=t.read();e(i,0,0,0);return}}if(this._compression===je.bitfields&&this._bitsPerPixel===32){const i=t.readUint32(),n=Math.trunc(((i&this._redMask)>>>this._redShift)*this._redScale),s=Math.trunc(((i&this._greenMask)>>>this._greenShift)*this._greenScale),a=Math.trunc(((i&this._blueMask)>>>this._blueShift)*this._blueScale),r=this.ignoreAlphaChannel?255:Math.trunc(((i&this._alphaMask)>>>this._alphaShift)*this._alphaScale);e(n,s,a,r);return}else if(this._bitsPerPixel===32&&this._compression===je.none){const i=t.read(),n=t.read(),s=t.read(),a=t.read();e(s,n,i,this.ignoreAlphaChannel?255:a);return}else if(this._bitsPerPixel===24){const i=t.read(),n=t.read(),s=t.read();e(s,n,i,255);return}else if(this._bitsPerPixel===16){const i=t.readUint16(),n=Math.trunc(((i&this._redMask)>>>this._redShift)*this._redScale),s=Math.trunc(((i&this._greenMask)>>>this._greenShift)*this._greenScale),a=Math.trunc(((i&this._blueMask)>>>this._blueShift)*this._blueScale),r=this.ignoreAlphaChannel?255:Math.trunc(((i&this._alphaMask)>>>this._alphaShift)*this._alphaScale);e(n,s,a,r);return}else throw new W(`Unsupported bitsPerPixel (${this._bitsPerPixel}) or compression (${this._compression}).`)}}var le;(function(o){o[o.bmp=0]="bmp",o[o.gif=1]="gif",o[o.ico=2]="ico",o[o.jpg=3]="jpg",o[o.png=4]="png",o[o.pnm=5]="pnm",o[o.psd=6]="psd",o[o.pvr=7]="pvr",o[o.tga=8]="tga",o[o.tiff=9]="tiff",o[o.webp=10]="webp",o[o.custom=11]="custom",o[o.invalid=12]="invalid"})(le||(le={}));class is{get format(){return le.bmp}get numFrames(){return this._info!==void 0?this._info.numFrames:0}constructor(t=!1){this._forceRgba=t}isValidFile(t){return ti.isValidFile(new D({buffer:t}))}startDecode(t){if(this.isValidFile(t))return this._input=new D({buffer:t}),this._info=new es(this._input),this._info}decodeFrame(t){if(this._input===void 0||this._info===void 0)return;const e=this._info;this._input.offset=e.header.imageOffset;const i=e.bitsPerPixel,n=Math.trunc((e.width*i+31)/32)*4,s=this._forceRgba?4:i===1||i===4||i===8?1:i===32?4:3,a=this._forceRgba?v.uint8:i===1?v.uint1:i===2?v.uint2:i===4?v.uint4:v.uint8,r=this._forceRgba?void 0:e.palette,h=new tt({width:e.width,height:e.height,format:a,numChannels:s,palette:r});for(let l=h.height-1;l>=0;--l){const u=e.readBottomUp?l:h.height-1-l,d=this._input.readRange(n),c=h.width;let g=0;const f=h.getPixel(0,u);for(;g<c;)e.decodePixel(d,(m,_,x,b)=>{if(g<c){if(this._forceRgba&&e.palette!==void 0){const p=Math.trunc(m),w=e.palette.getRed(p),C=e.palette.getGreen(p),y=e.palette.getBlue(p),A=e.palette.getAlpha(p);f.setRgba(w,C,y,A)}else f.setRgba(m,_,x,b);f.next(),g++}})}return h}decode(t){var e;const i=t.bytes,n=(e=t.frameIndex)!==null&&e!==void 0?e:0;if(this.startDecode(i)!==void 0)return this.decodeFrame(n)}}class Mt{get buffer(){return this._buffer}get bigEndian(){return this._bigEndian}set bigEndian(t){this._bigEndian=t}get length(){return this._length}set length(t){this._length=t}constructor(t){var e,i;this._bigEndian=(e=t?.bigEndian)!==null&&e!==void 0?e:!1,this._buffer=new Uint8Array((i=t?.size)!==null&&i!==void 0?i:Mt._blockSize),this._length=0}expandBuffer(t){let e=Mt._blockSize;t!==void 0?e=t:this._buffer.length>0&&(e=this._buffer.length*2);const i=new Uint8Array(this._buffer.length+e);F.copyRange(this._buffer,0,i,0,this._buffer.length),this._buffer=i}rewind(){this._length=0}clear(){this._buffer=new Uint8Array(Mt._blockSize),this._length=0}getBytes(){return new Uint8Array(this._buffer.buffer,0,this._length)}writeByte(t){this._length===this._buffer.length&&this.expandBuffer(),this._buffer[this._length++]=t&255}writeBytes(t,e){const i=e??t.length;for(;this._length+i>this._buffer.length;)this.expandBuffer(this._length+i-this._buffer.length);F.copyRange(t,0,this._buffer,this._length,i),this._length+=i}writeBuffer(t){const e=t.length,i=this._length+e;for(;i>this._buffer.length;)this.expandBuffer(i-this._buffer.length);F.copyRange(t.buffer,t.offset,this._buffer,this._length,e),this._length+=e}writeUint16(t){if(this._bigEndian){this.writeByte(t>>>8&255),this.writeByte(t&255);return}this.writeByte(t&255),this.writeByte(t>>>8&255)}writeUint32(t){if(this._bigEndian){this.writeByte(t>>>24&255),this.writeByte(t>>>16&255),this.writeByte(t>>>8&255),this.writeByte(t&255);return}this.writeByte(t&255),this.writeByte(t>>>8&255),this.writeByte(t>>>16&255),this.writeByte(t>>>24&255)}writeFloat32(t){const e=new Float32Array(1);e[0]=t;const i=new Uint8Array(e.buffer);if(this._bigEndian){this.writeByte(i[3]),this.writeByte(i[2]),this.writeByte(i[1]),this.writeByte(i[0]);return}this.writeByte(i[0]),this.writeByte(i[1]),this.writeByte(i[2]),this.writeByte(i[3])}writeFloat64(t){const e=new Float64Array(1);e[0]=t;const i=new Uint8Array(e.buffer);if(this._bigEndian){this.writeByte(i[7]),this.writeByte(i[6]),this.writeByte(i[5]),this.writeByte(i[4]),this.writeByte(i[3]),this.writeByte(i[2]),this.writeByte(i[1]),this.writeByte(i[0]);return}this.writeByte(i[0]),this.writeByte(i[1]),this.writeByte(i[2]),this.writeByte(i[3]),this.writeByte(i[4]),this.writeByte(i[5]),this.writeByte(i[6]),this.writeByte(i[7])}subarray(t,e){const i=t>=0?t:this._length+t;let n=e??this._length;return n<0&&(n=this._length+n),new Uint8Array(this._buffer.buffer,i,n-i)}}Mt._blockSize=8192;class ps{constructor(){this._supportsAnimation=!1}get supportsAnimation(){return this._supportsAnimation}encode(t){let e=t.image;const i=new Mt,n=e.numChannels;let s=e.palette;const a=e.format;a===v.uint1&&n===1&&s===void 0?(s=new ne(2,3),s.setRgb(0,0,0,0),s.setRgb(1,255,255,255)):a===v.uint1&&n===2?(e=e.convert({format:v.uint2,numChannels:1,withPalette:!0}),s=e.palette):a===v.uint1&&n===3&&s===void 0?(e=e.convert({format:v.uint4,withPalette:!0}),s=e.palette):a===v.uint1&&n===4?e=e.convert({format:v.uint8,numChannels:4}):a===v.uint2&&n===1&&s===void 0?(e=e.convert({format:v.uint2,withPalette:!0}),s=e.palette):a===v.uint2&&n===2?(e=e.convert({format:v.uint8,withPalette:!0}),s=e.palette):a===v.uint2&&n===3&&s===void 0?(e=e.convert({format:v.uint8,withPalette:!0}),s=e.palette):a===v.uint2&&n===4?(e=e.convert({format:v.uint8,withPalette:!0}),s=e.palette):a===v.uint4&&n===1&&s===void 0?(e=e.convert({format:v.uint8,withPalette:!0}),s=e.palette):a===v.uint4&&n===2?e=e.convert({format:v.uint8,numChannels:3}):a===v.uint4&&n===3&&s===void 0?e=e.convert({format:v.uint8,numChannels:3}):a===v.uint4&&n===4?e=e.convert({format:v.uint8,numChannels:4}):a===v.uint8&&n===1&&s===void 0?e=e.convert({format:v.uint8,withPalette:!0}):a===v.uint8&&n===2?e=e.convert({format:v.uint8,numChannels:3}):e.isHdrFormat?e=e.convert({format:v.uint8}):e.hasPalette&&e.numChannels===4&&(e=e.convert({numChannels:4}));let r=e.bitsPerChannel*e.data.numChannels;r===12&&(r=16);const h=r>8?je.bitfields:je.none,l=e.rowStride,u=Math.trunc((e.width*r+31)/32)*4,d=u-l,c=d>0?new Uint8Array(d).fill(255):void 0,g=r>=1&&r<=8?1<<r:0,f=u*e.height,m=r>8?124:40,_=m+14,x=g*4,b=_+x,p=b,w=p-b,C=f+_+x+w,y=1934772034;if(i.writeUint16(ti.signature),i.writeUint32(C),i.writeUint32(0),i.writeUint32(p),i.writeUint32(m),i.writeUint32(e.width),i.writeUint32(e.height),i.writeUint16(1),i.writeUint16(r),i.writeUint32(h),i.writeUint32(f),i.writeUint32(11811),i.writeUint32(11811),i.writeUint32(r===8?255:0),i.writeUint32(r===8?255:0),r>8){const P=r===16?15:255,L=r===16?240:65280,V=r===16?3840:16711680,T=r===16?61440:4278190080;i.writeUint32(V),i.writeUint32(L),i.writeUint32(P),i.writeUint32(T),i.writeUint32(y),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0),i.writeUint32(2),i.writeUint32(0),i.writeUint32(0),i.writeUint32(0)}if(r===1||r===2||r===4||r===8){if(s!==void 0){const P=s.numColors>g?g:s.numColors;let L=0;for(L=0;L<P;++L)i.writeByte(Math.trunc(s.getBlue(L))),i.writeByte(Math.trunc(s.getGreen(L))),i.writeByte(Math.trunc(s.getRed(L))),i.writeByte(0);for(;L<g;++L)i.writeByte(0),i.writeByte(0),i.writeByte(0),i.writeByte(0)}else if(r===1)i.writeByte(0),i.writeByte(0),i.writeByte(0),i.writeByte(0),i.writeByte(255),i.writeByte(255),i.writeByte(255),i.writeByte(0);else if(r===2)for(let P=0;P<4;++P){const L=P*85;i.writeByte(L),i.writeByte(L),i.writeByte(L),i.writeByte(0)}else if(r===4)for(let P=0;P<16;++P){const L=P*17;i.writeByte(L),i.writeByte(L),i.writeByte(L),i.writeByte(0)}else if(r===8)for(let P=0;P<256;++P)i.writeByte(P),i.writeByte(P),i.writeByte(P),i.writeByte(0)}let A=w;for(;A-- >0;)i.writeByte(0);if(r===1||r===2||r===4||r===8){let P=e.byteLength-l;const L=e.height;for(let V=0;V<L;++V){const T=e.buffer!==void 0?new Uint8Array(e.buffer,P,l):new Uint8Array;if(r===1)i.writeBytes(T);else if(r===2){const H=T.length;for(let Y=0;Y<H;++Y){const j=T[Y],ut=j>>>4,ft=(j&15)<<4|ut;i.writeByte(ft)}}else if(r===4){const H=T.length;for(let Y=0;Y<H;++Y){const j=T[Y],ut=j>>>4,ct=j&15,ft=ut<<4|ct;i.writeByte(ft)}}else i.writeBytes(T);c!==void 0&&i.writeBytes(c),P-=l}return i.getBytes()}const B=e.numChannels===4,z=e.height,U=e.width;if(r===16){let P;for(let L=z-1;L>=0;--L){P=e.getPixel(0,L,P);for(let V=0;V<U;++V)i.writeByte(Math.trunc(P.g)<<4|Math.trunc(P.b)),i.writeByte(Math.trunc(P.a)<<4|Math.trunc(P.r)),P.next();c!==void 0&&i.writeBytes(c)}}else{let P;for(let L=z-1;L>=0;--L){P=e.getPixel(0,L,P);for(let V=0;V<U;++V)i.writeByte(Math.trunc(P.b)),i.writeByte(Math.trunc(P.g)),i.writeByte(Math.trunc(P.r)),B&&i.writeByte(Math.trunc(P.a)),P.next();c!==void 0&&i.writeBytes(c)}}return i.getBytes()}}class bi{get numColors(){return this._numColors}get palette(){return this._palette}get bitsPerPixel(){return this._bitsPerPixel}set transparent(t){this._transparent=t}get transparent(){return this._transparent}constructor(t,e){this._numColors=t,this._palette=e??new ne(t,3),this._bitsPerPixel=bi.bitSize(t)}static bitSize(t){for(let e=1;e<=8;e++)if(1<<e>=t)return e;return 0}static from(t){const e=ne.from(t._palette),i=new bi(t.numColors,e);return i._bitsPerPixel=t._bitsPerPixel,i._transparent=t._transparent,i}getColor(t){const e=this.getRed(t),i=this.getGreen(t),n=this.getBlue(t),s=this.getAlpha(t);return ie.rgba(e,i,n,s)}setColor(t,e,i,n){this._palette.setRgb(t,e,i,n)}findColor(t,e,i,n){let s=-1,a=-1;if(n===0&&this._transparent!==void 0)return this._transparent;for(let r=0;r<this._numColors;++r){const h=this._palette.getRed(r),l=this._palette.getGreen(r),u=this._palette.getBlue(r),d=this._palette.getAlpha(r);if(h===t&&l===e&&u===i&&d===n)return r;const c=t-h,g=e-l,f=i-u,m=n-d,_=c*c+g*g+f*f+m*m;(a===-1||_<s)&&(a=r,s=_)}return a}getRed(t){return Math.trunc(this._palette.getRed(t))}getGreen(t){return Math.trunc(this._palette.getGreen(t))}getBlue(t){return Math.trunc(this._palette.getBlue(t))}getAlpha(t){return t===this._transparent?0:255}getPalette(){if(this._transparent===void 0)return this._palette;const t=new ne(this._palette.numColors,4),e=this._palette.numColors;for(let i=0;i<e;++i)t.setRgba(i,this.getRed(i),this.getGreen(i),this.getBlue(i),this.getAlpha(i));return t}}class Cs{get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}get interlaced(){return this._interlaced}get colorMap(){return this._colorMap}set colorMap(t){this._colorMap=t}set duration(t){this._duration=t}get duration(){return this._duration}set disposal(t){this._disposal=t}get disposal(){return this._disposal}set transparent(t){this._transparent=t}get transparent(){return this._transparent}get inputPosition(){return this._inputPosition}constructor(t){this._duration=80,this._disposal=0,this._transparent=-1,this._x=t.readUint16(),this._y=t.readUint16(),this._width=t.readUint16(),this._height=t.readUint16();const e=t.read(),i=(e&7)+1;if(this._interlaced=(e&64)!==0,e&128){this._colorMap=new bi(1<<i);for(let n=0;n<this._colorMap.numColors;++n)this._colorMap.setColor(n,t.read(),t.read(),t.read())}this._inputPosition=t.position}}class ys{get width(){return this._width}get height(){return this._height}get backgroundColor(){return this._backgroundColor}get frames(){return this._frames}get colorResolution(){return this._colorResolution}get globalColorMap(){return this._globalColorMap}get isGif89(){return this._isGif89}get numFrames(){return this.frames.length}constructor(t){var e,i,n,s,a;this._width=0,this._height=0,this._backgroundColor=void 0,this._isGif89=!1,this._width=(e=t?.width)!==null&&e!==void 0?e:0,this._height=(i=t?.height)!==null&&i!==void 0?i:0,this._backgroundColor=t?.backgroundColor,this._frames=(n=t?.frames)!==null&&n!==void 0?n:new Array,this._colorResolution=(s=t?.colorResolution)!==null&&s!==void 0?s:0,this._globalColorMap=t?.globalColorMap,this._isGif89=(a=t?.isGif89)!==null&&a!==void 0?a:!1}}class et{get format(){return le.gif}get numFrames(){return this._info!==void 0?this._info.numFrames:0}constructor(t){this._repeat=0,this._bitsPerPixel=0,this._currentShiftDWord=0,this._currentShiftState=0,this._stackPtr=0,this._lastCode=0,this._maxCode1=0,this._runningBits=0,this._runningCode=0,this._eofCode=0,this._clearCode=0,this._transparentFlag=0,this._disposalMethod=0,this._transparent=0,this._duration=0,t!==void 0&&this.startDecode(t)}static getPrefixChar(t,e,i){let n=e,s=0;for(;n>i&&s++<=et._lzMaxCode;){if(n>et._lzMaxCode)return et._noSuchCode;n=t[n]}return n}static updateImage(t,e,i,n){if(i!==void 0){const s=n.length;for(let a=0;a<s;++a)t.setPixelRgb(a,e,n[a],0,0)}}getInfo(){if(this._input===void 0)return!1;const t=this._input.readString(et._stampSize);if(t!==et._gif87Stamp&&t!==et._gif89Stamp)return!1;const e=this._input.readUint16(),i=this._input.readUint16(),n=this._input.read(),s=((n&112)+1>>>4)+1,a=(n&7)+1,r=new ie(new Uint8Array([this._input.read()]));this._input.skip(1);let h;if(n&128){h=new bi(1<<a);for(let u=0;u<h.numColors;++u){const d=this._input.read(),c=this._input.read(),g=this._input.read();h.setColor(u,d,c,g)}}const l=t===et._gif89Stamp;return this._info=new ys({width:e,height:i,colorResolution:s,backgroundColor:r,globalColorMap:h,isGif89:l}),!0}skipImage(){if(this._input===void 0||this._input.isEOS)return;const t=new Cs(this._input);return this._input.skip(1),this.skipRemainder(),t}skipRemainder(){if(this._input===void 0||this._input.isEOS)return!0;let t=this._input.read();for(;t!==0&&!this._input.isEOS;){if(this._input.skip(t),this._input.isEOS)return!0;t=this._input.read()}return!0}readApplicationExt(t){const e=t.read();if(t.readString(e)==="NETSCAPE2.0"){const n=t.read(),s=t.read();n===3&&s===1&&(this._repeat=t.readUint16())}else this.skipRemainder()}readGraphicsControlExt(t){t.read();const e=t.read();if(this._duration=t.readUint16(),this._transparent=t.read(),t.read(),this._disposalMethod=e>>>2&7,this._transparentFlag=e&1,t.peek(1).get(0)===et._imageDescRecordType){t.skip(1);const n=this.skipImage();if(n===void 0)return;n.duration=this._duration,n.disposal=this._disposalMethod,n.transparent=this._transparentFlag!==0?this._transparent:-1,this._transparentFlag!==0&&(n.colorMap===void 0&&this._info.globalColorMap!==void 0&&(n.colorMap=bi.from(this._info.globalColorMap)),n.colorMap!==void 0&&(n.colorMap.transparent=this._transparent)),this._info.frames.push(n)}}getLine(t){return this._pixelCount=this._pixelCount-t.length,this.decompressLine(t)?(this._pixelCount===0&&this.skipRemainder(),!0):!1}decompressLine(t){if(this._stackPtr>et._lzMaxCode)return!1;const e=t.length;let i=0;if(this._stackPtr!==0)for(;this._stackPtr!==0&&i<e;)t[i++]=this._stack[--this._stackPtr];let n;for(;i<e;){if(this._currentCode=this.decompressInput(),this._currentCode===void 0||this._currentCode===this._eofCode)return!1;if(this._currentCode===this._clearCode){for(let s=0;s<=et._lzMaxCode;s++)this._prefix[s]=et._noSuchCode;this._runningCode=this._eofCode+1,this._runningBits=this._bitsPerPixel+1,this._maxCode1=1<<this._runningBits,this._lastCode=et._noSuchCode}else{if(this._currentCode<this._clearCode)t[i++]=this._currentCode;else{if(this._prefix[this._currentCode]===et._noSuchCode)if(this._currentCode===this._runningCode-2){n=this._lastCode;const a=et.getPrefixChar(this._prefix,this._lastCode,this._clearCode);this._stack[this._stackPtr++]=a,this._suffix[this._runningCode-2]=a}else return!1;else n=this._currentCode;let s=0;for(;s++<=et._lzMaxCode&&n>this._clearCode&&n<=et._lzMaxCode;)this._stack[this._stackPtr++]=this._suffix[n],n=this._prefix[n];if(s>=et._lzMaxCode||n>et._lzMaxCode)return!1;for(this._stack[this._stackPtr++]=n;this._stackPtr!==0&&i<e;)t[i++]=this._stack[--this._stackPtr]}this._lastCode!==et._noSuchCode&&this._prefix[this._runningCode-2]===et._noSuchCode&&(this._prefix[this._runningCode-2]=this._lastCode,this._currentCode===this._runningCode-2?this._suffix[this._runningCode-2]=et.getPrefixChar(this._prefix,this._lastCode,this._clearCode):this._suffix[this._runningCode-2]=et.getPrefixChar(this._prefix,this._currentCode,this._clearCode)),this._lastCode=this._currentCode}}return!0}decompressInput(){if(this._runningBits>et._lzBits)return;for(;this._currentShiftState<this._runningBits;){const e=this.bufferedInput();this._currentShiftDWord|=e<<this._currentShiftState,this._currentShiftState+=8}const t=this._currentShiftDWord&et._codeMasks[this._runningBits];return this._currentShiftDWord>>>=this._runningBits,this._currentShiftState-=this._runningBits,this._runningCode<et._lzMaxCode+2&&++this._runningCode>this._maxCode1&&this._runningBits<et._lzBits&&(this._maxCode1<<=1,this._runningBits++),t}bufferedInput(){let t=0;if(this._buffer[0]===0){if(this._buffer[0]=this._input.read(),this._buffer[0]===0)return;const e=this._input.readRange(this._buffer[0]).toUint8Array();F.copyRange(e,0,this._buffer,1,this._buffer[0]),t=this._buffer[1],this._buffer[1]=2,this._buffer[0]--}else t=this._buffer[this._buffer[1]++],this._buffer[0]--;return t}initDecode(){this._buffer=new Uint8Array(256),this._stack=new Uint8Array(et._lzMaxCode),this._suffix=new Uint8Array(et._lzMaxCode+1),this._prefix=new Uint32Array(et._lzMaxCode+1)}decodeImage(t){if(this._input===void 0||this._info===void 0)return;this._buffer===void 0&&this.initDecode(),this._bitsPerPixel=this._input.read(),this._clearCode=1<<this._bitsPerPixel,this._eofCode=this._clearCode+1,this._runningCode=this._eofCode+1,this._runningBits=this._bitsPerPixel+1,this._maxCode1=1<<this._runningBits,this._stackPtr=0,this._lastCode=et._noSuchCode,this._currentShiftState=0,this._currentShiftDWord=0,this._buffer[0]=0,this._prefix.fill(et._noSuchCode,0,this._prefix.length);const e=t.width,i=t.height;if(t.x+e>this._info.width||t.y+i>this._info.height)return;const n=t.colorMap!==void 0?t.colorMap:this._info.globalColorMap;this._pixelCount=e*i;const s=new tt({width:e,height:i,numChannels:1,palette:n.getPalette()}),a=new Uint8Array(e);if(t.interlaced){const r=t.y;for(let h=0,l=0;h<4;++h)for(let u=r+et._interlacedOffset[h];u<r+i;u+=et._interlacedJump[h],++l){if(!this.getLine(a))return s;et.updateImage(s,u,n,a)}}else for(let r=0;r<i;++r){if(!this.getLine(a))return s;et.updateImage(s,r,n,a)}return s}isValidFile(t){return this._input=new D({buffer:t}),this.getInfo()}startDecode(t){if(this._input=new D({buffer:t}),!!this.getInfo()){try{for(;!this._input.isEOS;)switch(this._input.read()){case et._imageDescRecordType:{const i=this.skipImage();if(i===void 0)return this._info;i.duration=this._duration,i.disposal=this._disposalMethod,this._transparentFlag!==0&&(i.colorMap===void 0&&this._info.globalColorMap!==void 0&&(i.colorMap=bi.from(this._info.globalColorMap)),i.colorMap!==void 0&&(i.colorMap.transparent=this._transparent)),this._info.frames.push(i);break}case et._extensionRecordType:{const i=this._input.read();i===et._applicationExt?this.readApplicationExt(this._input):i===et._graphicControlExt?this.readGraphicsControlExt(this._input):this.skipRemainder();break}case et._terminateRecordType:return this._info;default:break}}catch{}return this._info}}decode(t){var e;const i=t.bytes;if(this.startDecode(i)===void 0||this._info===void 0)return;if(this._info.numFrames===1||t.frameIndex!==void 0)return this.decodeFrame((e=t.frameIndex)!==null&&e!==void 0?e:0);let n,s;for(let a=0;a<this._info.numFrames;++a){const r=this._info.frames[a],h=this.decodeFrame(a);if(h===void 0)return;if(h.frameDuration=r.duration*10,n===void 0||s===void 0){n=h,s=h,h.loopCount=this._repeat;continue}if(h.width===s.width&&h.height===s.height&&r.x===0&&r.y===0&&r.disposal===2){s=h,n.addFrame(s);continue}const l=r.colorMap!==void 0?r.colorMap:this._info.globalColorMap,u=new tt({width:s.width,height:s.height,numChannels:1,palette:l.getPalette()});if(r.disposal===2){const d=u.toUint8Array();r.transparent!==-1?d.fill(r.transparent,0,d.length-1):d.fill(this._info.backgroundColor.r,0,d.length-1)}else if(r.disposal!==3&&r.colorMap!==void 0){const d=s.palette,c=new Map;for(let m=0;m<l.numColors;++m){const _=l.findColor(d.getRed(m),d.getGreen(m),d.getBlue(m),d.getAlpha(m));c.set(m,_)}const g=u.toUint8Array(),f=s.toUint8Array();for(let m=0,_=g.length;m<_;++m){const x=f[m],b=c.get(x);b!==-1&&(g[m]=b)}}u.frameDuration=h.frameDuration;for(const d of h)d.a!==0&&u.setPixel(d.x+r.x,d.y+r.y,d);n.addFrame(u),s=u}return n}decodeFrame(t){if(this._input===void 0||this._info===void 0||t>=this._info.frames.length||t<0)return;const e=this._info.frames[t];return this._input.offset=e.inputPosition,this.decodeImage(this._info.frames[t])}}et._stampSize=6;et._gif87Stamp="GIF87a";et._gif89Stamp="GIF89a";et._imageDescRecordType=44;et._extensionRecordType=33;et._terminateRecordType=59;et._graphicControlExt=249;et._applicationExt=255;et._lzMaxCode=4095;et._lzBits=12;et._noSuchCode=4098;et._codeMasks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095];et._interlacedOffset=[0,4,2,1];et._interlacedJump=[8,8,4,2];class it{get palette(){return this._palette}get numColors(){return this._netSize}constructor(t,e=256,i=10){this._netIndex=new Int32Array(256),this._netSize=16,this._specials=3,this._bgColor=0,this._cutNetSize=0,this._maxNetPos=0,this._initRadius=0,this._initBiasRadius=0,this._samplingFactor=i,this.initialize(e),this.addImage(t)}initialize(t){this._netSize=Math.max(t,4),this._cutNetSize=this._netSize-this._specials,this._maxNetPos=this._netSize-1,this._initRadius=Math.floor(this._netSize/8),this._initBiasRadius=this._initRadius*it._radiusBias,this._paletteInternal=new Zi(256,4),this._palette=new ne(256,3),this._specials=3,this._bgColor=this._specials-1,this._radiusPower=new Int32Array(this._netSize>>>3),this._network=new Array(this._netSize*3).fill(0),this._bias=new Array(this._netSize).fill(0),this._freq=new Array(this._netSize).fill(0),this._network[0]=0,this._network[1]=0,this._network[2]=0,this._network[3]=255,this._network[4]=255,this._network[5]=255;const e=1/this._netSize;for(let i=0;i<this._specials;++i)this._freq[i]=e,this._bias[i]=0;for(let i=this._specials,n=this._specials*3;i<this._netSize;++i)this._network[n++]=255*(i-this._specials)/this._cutNetSize,this._network[n++]=255*(i-this._specials)/this._cutNetSize,this._network[n++]=255*(i-this._specials)/this._cutNetSize,this._freq[i]=e,this._bias[i]=0}updateRadiusPower(t,e){for(let i=0;i<t;i++)this._radiusPower[i]=Math.trunc(e*((t*t-i*i)*it._radiusBias/(t*t)))}specialFind(t,e,i){for(let n=0,s=0;n<this._specials;n++)if(this._network[s++]===t&&this._network[s++]===e&&this._network[s++]===i)return n;return-1}contest(t,e,i){let n=1e30,s=n,a=-1,r=a;for(let h=this._specials,l=this._specials*3;h<this._netSize;h++){let u=this._network[l++]-t;u<0&&(u=-u);let d=this._network[l++]-e;d<0&&(d=-d),u+=d,d=this._network[l++]-i,d<0&&(d=-d),u+=d,u<n&&(n=u,a=h);const c=u-this._bias[h];c<s&&(s=c,r=h),this._freq[h]-=it._beta*this._freq[h],this._bias[h]+=it._betaGamma*this._freq[h]}return this._freq[a]+=it._beta,this._bias[a]-=it._betaGamma,r}alterSingle(t,e,i,n,s){const a=e*3;this._network[a]-=t*(this._network[a]-i),this._network[a+1]-=t*(this._network[a+1]-n),this._network[a+2]-=t*(this._network[a+2]-s)}alterNeighbors(t,e,i,n,s,a){let r=i-e;r<this._specials-1&&(r=this._specials-1);let h=i+e;h>this._netSize&&(h=this._netSize);let l=i+1,u=i-1,d=1;for(;l<h||u>r;){const c=this._radiusPower[d++];if(l<h){const g=l*3;this._network[g]-=c*(this._network[g]-n)/it.alphaRadiusBias,this._network[g+1]-=c*(this._network[g+1]-s)/it.alphaRadiusBias,this._network[g+2]-=c*(this._network[g+2]-a)/it.alphaRadiusBias,l++}if(u>r){const g=u*3;this._network[g]-=c*(this._network[g]-n)/it.alphaRadiusBias,this._network[g+1]-=c*(this._network[g+1]-s)/it.alphaRadiusBias,this._network[g+2]-=c*(this._network[g+2]-a)/it.alphaRadiusBias,u--}}}learn(t){let e=this._initBiasRadius;const i=30+Math.floor((this._samplingFactor-1)/3),n=t.width*t.height,s=Math.floor(n/this._samplingFactor);let a=Math.max(Math.floor(s/it._numCycles),1),r=it._initAlpha;a===0&&(a=1);let h=e>>>it._radiusBiasShift;h<=1&&(h=0),this.updateRadiusPower(h,r);let l=0,u=0;n<it._smallImageBytes?(this._samplingFactor=1,l=1):n%it._prime1!==0?l=it._prime1:n%it._prime2!==0?l=it._prime2:n%it._prime3!==0?l=it._prime3:l=it._prime4;const d=t.width,c=t.height;let g=0,f=0,m=0;for(;m<s;){const _=t.getPixel(g,f),x=_.r,b=_.g,p=_.b;m===0&&(this._network[this._bgColor*3]=p,this._network[this._bgColor*3+1]=b,this._network[this._bgColor*3+2]=x);let w=this.specialFind(p,b,x);if(w=w<0?this.contest(p,b,x):w,w>=this._specials){const C=Number(r)/it._initAlpha;this.alterSingle(C,w,p,b,x),h>0&&this.alterNeighbors(C,h,w,p,b,x)}for(u+=l,g+=l;g>d;)g-=d,f++;for(;u>=n;)u-=n,f-=c;m++,m%a===0&&(r-=Math.floor(r/i),e-=Math.floor(e/it._radiusDec),h=e>>>it._radiusBiasShift,h<=1&&(h=0),this.updateRadiusPower(h,r))}}fix(){for(let t=0,e=0;t<this._netSize;t++){for(let i=0;i<3;++i,++e){const n=k.clampInt255(Math.trunc(.5+this._network[e]));this._paletteInternal.set(t,i,n)}this._paletteInternal.set(t,3,t)}}inxBuild(){let t=0,e=0;for(let i=0;i<this._netSize;i++){let n=i,s=this._paletteInternal.get(i,1);for(let h=i+1;h<this._netSize;h++)this._paletteInternal.get(h,1)<s&&(n=h,s=this._paletteInternal.get(h,1));const a=i,r=n;if(i!==n){let h=this._paletteInternal.get(r,0);this._paletteInternal.set(r,0,this._paletteInternal.get(a,0)),this._paletteInternal.set(a,0,h),h=this._paletteInternal.get(r,1),this._paletteInternal.set(r,1,this._paletteInternal.get(a,1)),this._paletteInternal.set(a,1,h),h=this._paletteInternal.get(r,2),this._paletteInternal.set(r,2,this._paletteInternal.get(a,2)),this._paletteInternal.set(a,2,h),h=this._paletteInternal.get(r,3),this._paletteInternal.set(r,3,this._paletteInternal.get(a,3)),this._paletteInternal.set(a,3,h)}if(s!==t){this._netIndex[t]=e+i>>>1;for(let h=t+1;h<s;h++)this._netIndex[h]=i;t=Math.trunc(s),e=i}}this._netIndex[t]=e+this._maxNetPos>>>1;for(let i=t+1;i<256;i++)this._netIndex[i]=this._maxNetPos}copyPalette(){for(let t=0;t<this._netSize;++t)this._palette.setRgb(t,Math.abs(this._paletteInternal.get(t,2)),Math.abs(this._paletteInternal.get(t,1)),Math.abs(this._paletteInternal.get(t,0)))}inxSearch(t,e,i){let n=1e3,s=-1,a=this._netIndex[e],r=a-1;for(;a<this._netSize||r>=0;){if(a<this._netSize){let h=this._paletteInternal.get(a,1)-e;if(h>=n)a=this._netSize;else{h<0&&(h=-h);let l=this._paletteInternal.get(a,0)-t;l<0&&(l=-l),h+=l,h<n&&(l=this._paletteInternal.get(a,2)-i,l<0&&(l=-l),h+=l,h<n&&(n=Math.trunc(h),s=a)),a++}}if(r>=0){let h=e-this._paletteInternal.get(r,1);if(h>=n)r=-1;else{h<0&&(h=-h);let l=this._paletteInternal.get(r,0)-t;l<0&&(l=-l),h+=l,h<n&&(l=this._paletteInternal.get(r,2)-i,l<0&&(l=-l),h+=l,h<n&&(n=Math.trunc(h),s=r)),r--}}}return s}getColorIndex(t){const e=Math.trunc(t.r),i=Math.trunc(t.g),n=Math.trunc(t.b);return this.inxSearch(n,i,e)}getColorIndexRgb(t,e,i){return this.inxSearch(i,e,t)}getQuantizedColor(t){const e=this.getColorIndex(t),i=t.length===4?new Ci(0,0,0,255):new pi(0,0,0);return i.r=this.palette.get(e,0),i.g=this.palette.get(e,1),i.b=this.palette.get(e,2),t.length===4&&(i.a=t.a),i}getIndexImage(t){const e=new tt({width:t.width,height:t.height,numChannels:1,palette:this.palette});e.frameIndex=t.frameIndex,e.frameType=t.frameType,e.frameDuration=t.frameDuration;const i=t[Symbol.iterator](),n=e[Symbol.iterator]();let s,a;for(;s=i.next(),a=n.next(),!s.done&&!a.done;)a.value.setChannel(0,this.getColorIndex(s.value));return e}addImage(t){this.learn(t),this.fix(),this.inxBuild(),this.copyPalette()}}it._numCycles=100;it._alphaBiasShift=10;it._initAlpha=1<<it._alphaBiasShift;it._radiusBiasShift=8;it._radiusBias=1<<it._radiusBiasShift;it._alphaRadiusBiasShift=it._alphaBiasShift+it._radiusBiasShift;it.alphaRadiusBias=1<<it._alphaRadiusBiasShift;it._radiusDec=30;it._gamma=1024;it._beta=1/1024;it._betaGamma=it._beta*it._gamma;it._prime1=499;it._prime2=491;it._prime3=487;it._prime4=503;it._smallImageBytes=3*it._prime4;var _i;(function(o){o[o.octree=0]="octree",o[o.neural=1]="neural",o[o.binary=2]="binary"})(_i||(_i={}));class vs{constructor(){this._buf=[void 0]}get buf(){return this._buf}get n(){return this._buf.length}}class Fn{get r(){return this._r}set r(t){this._r=t}get g(){return this._g}set g(t){this._g=t}get b(){return this._b}set b(t){this._b=t}get count(){return this._count}set count(t){this._count=t}get heapIndex(){return this._heapIndex}set heapIndex(t){this._heapIndex=t}get paletteIndex(){return this._paletteIndex}set paletteIndex(t){this._paletteIndex=t}get parent(){return this._parent}get children(){return this._children}get childCount(){return this._childCount}set childCount(t){this._childCount=t}get childIndex(){return this._childIndex}get flags(){return this._flags}set flags(t){this._flags=t}get depth(){return this._depth}constructor(t,e,i){this._r=0,this._g=0,this._b=0,this._count=0,this._heapIndex=0,this._paletteIndex=0,this._children=F.fill(8,void 0),this._childCount=0,this._childIndex=0,this._flags=0,this._depth=0,this._childIndex=t,this._depth=e,this._parent=i,i!==void 0&&i._childCount++}}class yi{get palette(){return this._palette}constructor(t,e=256){this._root=new Fn(0,0);const i=new vs;for(const r of t){const h=Math.trunc(r.r),l=Math.trunc(r.g),u=Math.trunc(r.b);this.heapAdd(i,this.nodeInsert(this._root,h,l,u))}const n=e+1;for(;i.n>n;)this.heapAdd(i,this.nodeFold(this.popHeap(i)));for(let r=1;r<i.n;r++){const h=i.buf[r],l=h.count;h.r=Math.round(h.r/l),h.g=Math.round(h.g/l),h.b=Math.round(h.b/l)}const s=[];this.getNodes(s,this._root),this._palette=new ne(s.length,3);const a=s.length;for(let r=0;r<a;++r){s[r].paletteIndex=r;const h=s[r];this._palette.setRgb(r,h.r,h.g,h.b)}}nodeInsert(t,e,i,n){let s=t,a=0;for(let r=128;++a<8;r>>>=1){const h=(i&r?1:0)*4+(e&r?1:0)*2+(n&r?1:0);s.children[h]===void 0&&(s.children[h]=new Fn(h,a,s)),s=s.children[h]}return s.r+=e,s.g+=i,s.b+=n,s.count++,s}popHeap(t){if(t.n<=1)return;const e=t.buf[1];return t.buf[1]=t.buf.pop(),t.buf[1].heapIndex=1,this.downHeap(t,t.buf[1]),e}heapAdd(t,e){if(e.flags&yi._inHeap){this.downHeap(t,e),this.upHeap(t,e);return}e.flags|=yi._inHeap,e.heapIndex=t.n,t.buf.push(e),this.upHeap(t,e)}downHeap(t,e){let i=e.heapIndex;for(;;){let n=i*2;if(n>=t.n||(n+1<t.n&&this.compareNode(t.buf[n],t.buf[n+1])>0&&n++,this.compareNode(e,t.buf[n])<=0))break;t.buf[i]=t.buf[n],t.buf[i].heapIndex=i,i=n}t.buf[i]=e,e.heapIndex=i}upHeap(t,e){let i=e.heapIndex,n;for(;i>1&&(n=t.buf[Math.trunc(i/2)],!(this.compareNode(e,n)>=0));)t.buf[i]=n,n.heapIndex=i,i=Math.trunc(i/2);t.buf[i]=e,e.heapIndex=i}nodeFold(t){if(t.childCount>0)return;const e=t.parent;return e.count+=t.count,e.r+=t.r,e.g+=t.g,e.b+=t.b,e.childCount--,e.children[t.childIndex]=void 0,e}compareNode(t,e){if(t.childCount<e.childCount)return-1;if(t.childCount>e.childCount)return 1;const i=t.count>>>t.depth,n=e.count>>>e.depth;return i<n?-1:i>n?1:0}getNodes(t,e){if(e.childCount===0){t.push(e);return}for(const i of e.children)i!==void 0&&this.getNodes(t,i)}getColorIndex(t){return this.getColorIndexRgb(Math.trunc(t.r),Math.trunc(t.g),Math.trunc(t.b))}getColorIndexRgb(t,e,i){var n;let s=this._root;for(let a=128;a!==0;a>>>=1){const r=(e&a?1:0)*4+(t&a?1:0)*2+(i&a?1:0);if(s.children[r]===void 0)break;s=s.children[r]}return(n=s?.paletteIndex)!==null&&n!==void 0?n:0}getQuantizedColor(t){let e=Math.trunc(t.r),i=Math.trunc(t.g),n=Math.trunc(t.b),s=this._root;for(let a=128;a!==0;a>>>=1){const r=(i&a?1:0)*4+(e&a?1:0)*2+(n&a?1:0);if(s.children[r]===void 0)break;s=s.children[r]}return e=s.r,i=s.g,n=s.b,new pi(e,i,n)}getIndexImage(t){const e=new tt({width:t.width,height:t.height,numChannels:1,palette:this.palette});e.frameIndex=t.frameIndex,e.frameType=t.frameType,e.frameDuration=t.frameDuration;const i=t[Symbol.iterator](),n=e[Symbol.iterator]();let s,a;for(;s=i.next(),a=n.next(),!s.done&&!a.done;)a.value.setChannel(0,this.getColorIndex(s.value));return e}}yi._inHeap=1;class Vt{static crand(){return 1-2*Math.random()}static grand(){let t=0,e=0;do{const i=2*Math.random()-1;t=2*Math.random()-1,e=t*t+i*i}while(e<=0||e>=1);return t*Math.sqrt(-2*Math.log(e)/e)}static prand(t){if(t<=1e-10)return 0;if(t>100)return Math.trunc(Math.sqrt(t)*Vt.grand()+t);let e=0;const i=Math.exp(-t);for(let n=1;n>=i;++e)n*=Math.random();return e-1}static intrand(t){return Math.floor(Math.random()*t)}}class Wt{get x1(){return this._x1}get y1(){return this._y1}get x2(){return this._x2}get y2(){return this._y2}get dx(){return this._x2-this._x1}get dy(){return this._y2-this._y1}constructor(t,e,i,n){this._x1=t,this._y1=e,this._x2=i,this._y2=n}static from(t){return new Wt(t.x1,t.y1,t.x2,t.y2)}movePoint1(t,e){this._x1=t,this._y1=e}movePoint2(t,e){this._x2=t,this._y2=e}swapXY1(){const t=this._x1;this._x1=this._y1,this._y1=t}swapXY2(){const t=this._x2;this._x2=this._y2,this._y2=t}flipX(){const t=this._x1;this._x1=this._x2,this._x2=t}flipY(){const t=this._y1;this._y1=this._y2,this._y2=t}clone(){return new Wt(this._x1,this._y1,this._x2,this._y2)}toString(){return`${this.constructor.name} (x1: ${this._x1}, y1: ${this._y1}, x2: ${this._x2}, y2: ${this._y2})`}}class K{get x(){return this._x}get y(){return this._y}get xt(){return Math.trunc(this.x)}get yt(){return Math.trunc(this.y)}constructor(t,e){this._x=t,this._y=e}static from(t){return new K(t._x,t._y)}move(t,e){return new K(t,e)}offset(t,e){return this.move(this._x+t,this._y+e)}mul(t){return this.move(this._x*t,this._y*t)}add(t){return this.move(this._x+t._x,this._y+t._y)}equals(t){return this._x===t._x&&this._y===t._y}toString(){return`${this.constructor.name} (x: ${this._x}, y: ${this._y})`}}class Ki{get left(){return this._left}get top(){return this._top}get right(){return this._right}get bottom(){return this._bottom}get width(){return this._right-this._left}get height(){return this._bottom-this._top}get topLeft(){return new K(this._left,this._top)}get topRight(){return new K(this._right,this._top)}get bottomLeft(){return new K(this._left,this._bottom)}get bottomRight(){return new K(this._right,this._bottom)}constructor(t,e,i,n){this._left=Math.min(t,i),this._top=Math.min(e,n),this._right=Math.max(t,i),this._bottom=Math.max(e,n)}static fromXYWH(t,e,i,n){return new Ki(t,e,t+i,e+n)}static from(t){return new Ki(t._left,t._top,t._right,t._bottom)}toString(){return`${this.constructor.name} (l: ${this._left}, t: ${this._top}, r: ${this._right}, b: ${this._bottom}, w: ${this.width}, h: ${this.height})`}}class Pi{static circleTest(t,e,i,n=!0){let s=0;const a=t.x-e.x,r=t.y-e.y,l=a*a+r*r<=i?1:0;s+=l;const u=t.x+1-e.x,d=t.y-e.y,g=u*u+d*d<=i?1:0;s+=g;const f=t.x+1-e.x,m=t.y+1-e.y,x=f*f+m*m<=i?1:0;s+=x;const b=t.x-e.x,p=t.y+1-e.y,C=b*b+p*p<=i?1:0;s+=C;const y=t.x+.5-e.x,A=t.y-e.y,z=y*y+A*A<=i?1:0;s+=z;const U=t.x+.5-e.x,P=t.y+1-e.y,V=U*U+P*P<=i?1:0;s+=V;const T=t.x-e.x,H=t.y+.5-e.y,j=T*T+H*H<=i?1:0;s+=j;const ut=t.x+1-e.x,ct=t.y+.5-e.y,at=ut*ut+ct*ct<=i?1:0;s+=at;const mt=t.x+.5-e.x,xt=t.y+.5-e.y,yt=mt*mt+xt*xt<=i?1:0;return s+=yt,n?s/9:s>0?1:0}static clipLine(t,e){const i=t.left,n=t.top,s=t.right,a=t.bottom,r=0,h=1,l=2,u=4,d=8,c=_=>{let x=r;return _.x<i?x|=h:_.x>s&&(x|=l),_.y<n?x|=u:_.y>a&&(x|=d),x};let g=c(new K(e.x1,e.y1)),f=c(new K(e.x2,e.y2)),m=!1;for(;;)if(g|f){if(g&f)break;{const _=g!==0?g:f;let x=0,b=0;_&d?(x=e.x1+Math.trunc(e.dx*(a-e.y1)/e.dy),b=a):_&u?(x=e.x1+Math.trunc(e.dx*(n-e.y1)/e.dy),b=n):_&l?(b=e.y1+Math.trunc(e.dy*(s-e.x1)/e.dx),x=s):_&h&&(b=e.y1+Math.trunc(e.dy*(i-e.x1)/e.dx),x=i),_===g?(e.movePoint1(x,b),g=c(new K(e.x1,e.y1))):(e.movePoint2(x,b),f=c(new K(e.x2,e.y2)))}}else{m=!0;break}return m}}var _t;(function(o){o[o.direct=0]="direct",o[o.alpha=1]="alpha",o[o.lighten=2]="lighten",o[o.screen=3]="screen",o[o.dodge=4]="dodge",o[o.addition=5]="addition",o[o.darken=6]="darken",o[o.multiply=7]="multiply",o[o.burn=8]="burn",o[o.overlay=9]="overlay",o[o.softLight=10]="softLight",o[o.hardLight=11]="hardLight",o[o.difference=12]="difference",o[o.subtract=13]="subtract",o[o.divide=14]="divide"})(_t||(_t={}));var be;(function(o){o[o.topLeft=1]="topLeft",o[o.topRight=2]="topRight",o[o.bottomLeft=4]="bottomLeft",o[o.bottomRight=8]="bottomRight",o[o.all=15]="all"})(be||(be={}));class G{static calculateCircumference(t,e,i){if(i<0||e.x+i<0||e.x-i>=t.width||e.y+i<0||e.y-i>=t.height)return[];if(i===0)return[e];const n=[new K(e.x-i,e.y),new K(e.x+i,e.y),new K(e.x,e.y-i),new K(e.x,e.y+i)];if(i===1)return n;for(let s=1-i,a=0,r=-(i<<1),h=0,l=i;h<l;)if(s>=0&&(r+=2,s+=r,--l),++h,a+=2,s+=a+1,h!==l+1){const u=e.x-l,d=e.x+l,c=e.y-h,g=e.y+h,f=e.x-h,m=e.x+h,_=e.y-l,x=e.y+l;n.push(new K(u,c)),n.push(new K(u,g)),n.push(new K(d,c)),n.push(new K(d,g)),h!==l&&(n.push(new K(f,_)),n.push(new K(m,x)),n.push(new K(m,_)),n.push(new K(f,x)))}return n}static drawAntialiasCircle(t){var e,i,n;const s=(e=t.blend)!==null&&e!==void 0?e:_t.alpha,a=(d,c,g,f,m)=>{r&be.bottomRight&&G.drawPixel({image:t.image,pos:new K(d+g,c+f),color:t.color,alpha:m,blend:s,maskChannel:h,mask:t.mask}),r&be.bottomLeft&&G.drawPixel({image:t.image,pos:new K(d-g,c+f),color:t.color,alpha:m,blend:s,maskChannel:h,mask:t.mask}),r&be.topRight&&G.drawPixel({image:t.image,pos:new K(d+g,c-f),color:t.color,alpha:m,blend:s,maskChannel:h,mask:t.mask}),r&be.topLeft&&G.drawPixel({image:t.image,pos:new K(d-g,c-f),color:t.color,alpha:m,blend:s,maskChannel:h,mask:t.mask})},r=(i=t.quadrants)!==null&&i!==void 0?i:be.all,h=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance,l=t.radius*t.radius,u=Math.round(t.radius/Math.SQRT2);for(let d=0;d<=u;++d){const c=Math.sqrt(l-d*d),g=k.fract(c),f=g*(d===u?.25:1),m=Math.floor(c);a(t.x,t.y,d,m,1-g),a(t.x,t.y,d,m+1,f),a(t.x,t.y,m,d,1-g),a(t.x,t.y,m+1,d,f)}return t.image}static drawLineWu(t){var e;const i=(e=t.blend)!==null&&e!==void 0?e:_t.alpha,n=t.line.clone(),s=Math.abs(n.dy)>Math.abs(n.dx);s&&(n.swapXY1(),n.swapXY2()),n.x1>n.x2&&(n.flipX(),n.flipY());const a=n.dx===1?1:n.dy/n.dx;let r=Math.floor(n.x1+.5),h=n.y1+a*(r-n.x1),l=1-(n.x1+.5-Math.floor(n.x1+.5));const u=r,d=Math.floor(h);s?(G.drawPixel({image:t.image,pos:new K(d,u),color:t.color,alpha:(1-(h-Math.floor(h)))*l,blend:i,maskChannel:t.maskChannel,mask:t.mask}),G.drawPixel({image:t.image,pos:new K(d+1,u),color:t.color,alpha:(h-Math.floor(h))*l,blend:i,maskChannel:t.maskChannel,mask:t.mask})):(G.drawPixel({image:t.image,pos:new K(u,d),color:t.color,alpha:(1-(h-Math.floor(h)))*l,blend:i,maskChannel:t.maskChannel,mask:t.mask}),G.drawPixel({image:t.image,pos:new K(u,d+1),color:t.color,alpha:(h-Math.floor(h))*l,blend:i,maskChannel:t.maskChannel,mask:t.mask}));let c=h+a;r=Math.floor(n.x2+.5),h=n.y2+a*(r-n.x2),l=n.x2+.5-Math.floor(n.x2+.5);const g=r,f=Math.floor(h);if(s){G.drawPixel({image:t.image,pos:new K(f,g),color:t.color,alpha:(1-(h-Math.floor(h)))*l,blend:i,mask:t.mask,maskChannel:t.maskChannel}),G.drawPixel({image:t.image,pos:new K(f+1,g),color:t.color,alpha:(h-Math.floor(h))*l,blend:i,maskChannel:t.maskChannel,mask:t.mask});for(let m=u+1;m<=g-1;m++)G.drawPixel({image:t.image,pos:new K(Math.floor(c),m),color:t.color,alpha:1-(c-Math.floor(c)),blend:i,mask:t.mask,maskChannel:t.maskChannel}),G.drawPixel({image:t.image,pos:new K(Math.floor(c)+1,m),color:t.color,alpha:c-Math.floor(c),blend:i,maskChannel:t.maskChannel,mask:t.mask}),c+=a}else{G.drawPixel({image:t.image,pos:new K(g,f),color:t.color,alpha:(1-(h-Math.floor(h)))*l,blend:i,maskChannel:t.maskChannel,mask:t.mask}),G.drawPixel({image:t.image,pos:new K(g,f+1),color:t.color,alpha:(h-Math.floor(h))*l,blend:i,maskChannel:t.maskChannel,mask:t.mask});for(let m=u+1;m<=g-1;m++)G.drawPixel({image:t.image,pos:new K(m,Math.floor(c)),color:t.color,alpha:1-(c-Math.floor(c)),blend:i,maskChannel:t.maskChannel,mask:t.mask}),G.drawPixel({image:t.image,pos:new K(m,Math.floor(c)+1),color:t.color,alpha:c-Math.floor(c),blend:i,maskChannel:t.maskChannel,mask:t.mask}),c+=a}return t.image}static setAlpha(t,e){return t.a=e,t}static colorDistance(t,e,i){const n=t[0]-e[0],s=t[1]-e[1],a=t[2]-e[2];if(i){const r=t[3]-e[3];return Math.sqrt(Math.max(n*n,(n-r)*(n-r))+Math.max(s*s,(s-r)*(s-r))+Math.max(a*a,(a-r)*(a-r)))}else return Math.sqrt(n*n+s*s+a*a)}static testPixelLabColorDistance(t,e,i,n,s){const a=t.getPixel(e,i),r=n.length>3,h=E.rgbToLab(a.r,a.g,a.b);return r&&h.push(a.a),G.colorDistance(h,n,r)>s}static fill4Core(t,e,i,n,s,a){let r=e,h=i;if(a[h*t.width+r]===1)return;let l=0;do{let u=0,d=r;if(l!==0&&n(h,r)){do if(--l===0)return;while(n(h,++r));d=r}else for(;r!==0&&!n(h,r-1);u++,l++)s(h,--r),h!==0&&!n(h-1,r)&&G.fill4(t,r,h-1,n,s,a);for(;d<t.width&&!n(h,d);u++,d++)s(h,d);if(u<l)for(const c=r+l;++d<c;)n(h,d)||G.fill4Core(t,d,h,n,s,a);else if(u>l&&h!==0)for(let c=r+l;++c<d;)n(h-1,c)||G.fill4(t,c,h-1,n,s,a);l=u}while(l!==0&&++h<t.height)}static fill4(t,e,i,n,s,a){let r=e,h=i;if(a[h*t.width+r]!==1){for(;;){const l=r,u=h;for(;h!==0&&!n(h-1,r);)h--;for(;r!==0&&!n(h,r-1);)r--;if(r===l&&h===u)break}G.fill4Core(t,r,h,n,s,a)}}static imgDirectComposite(t,e,i,n,s,a,r,h,l,u){let d;if(u!==void 0)for(let c=0;c<a;++c)for(let g=0;g<s;++g){const f=r[g],m=h[c];d=t.getPixel(f,m,d);const _=u.getPixel(f,m).getChannelNormalized(l);if(_===1)e.setPixel(i+g,n+c,d);else{const x=e.getPixel(i+g,n+c);x.r=k.mix(x.r,d.r,_),x.g=k.mix(x.g,d.g,_),x.b=k.mix(x.b,d.b,_),x.a=k.mix(x.a,d.a,_)}}else for(let c=0;c<a;++c)for(let g=0;g<s;++g)d=t.getPixel(r[g],h[c],d),e.setPixel(i+g,n+c,d)}static imgComposite(t,e,i,n,s,a,r,h,l,u,d,c){let g;for(let f=0;f<a;++f)for(let m=0;m<s;++m)g=t.getPixel(r[m],h[f],g),G.drawPixel({image:e,pos:new K(i+m,n+f),color:g,blend:l,linearBlend:u,maskChannel:d,mask:c})}static drawCircle(t){var e,i,n;const s=(e=t.antialias)!==null&&e!==void 0?e:!1,a=(i=t.blend)!==null&&i!==void 0?i:_t.alpha,r=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance;if(s)return G.drawAntialiasCircle({image:t.image,x:t.center.x,y:t.center.y,radius:t.radius,color:t.color,blend:a,mask:t.mask,maskChannel:r});const h=G.calculateCircumference(t.image,t.center,t.radius);for(const l of h)G.drawPixel({image:t.image,pos:new K(l.x,l.y),color:t.color,blend:a,mask:t.mask,maskChannel:r});return t.image}static fillCircle(t){var e,i,n;const s=(e=t.antialias)!==null&&e!==void 0?e:!1,a=(i=t.blend)!==null&&i!==void 0?i:_t.alpha,r=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance,h=t.radius*t.radius,l=Math.max(0,t.center.x-t.radius),u=Math.max(0,t.center.y-t.radius),d=Math.min(t.image.width-1,t.center.x+t.radius),c=Math.min(t.image.height-1,t.center.y+t.radius),g=t.image.getRange(l,u,d-l+1,c-u+1);let f;for(;f=g.next(),!f.done;){const m=f.value;if(s){const _=Pi.circleTest(m,t.center,h,s);if(_>0){const x=t.color.aNormalized*_;G.drawPixel({image:t.image,pos:new K(m.x,m.y),color:t.color,alpha:x,blend:a,maskChannel:r,mask:t.mask})}}else{const _=m.x-t.center.x,x=m.y-t.center.y;_*_+x*x<h&&G.drawPixel({image:t.image,pos:new K(m.x,m.y),color:t.color,blend:a,maskChannel:r,mask:t.mask})}}return t.image}static drawLine(t){var e,i,n,s;const a=(e=t.blend)!==null&&e!==void 0?e:_t.alpha,r=t.line.clone(),h=(i=t.antialias)!==null&&i!==void 0?i:!1,l=(n=t.thickness)!==null&&n!==void 0?n:1,u=(s=t.maskChannel)!==null&&s!==void 0?s:X.luminance;if(!Pi.clipLine(new Ki(0,0,t.image.width-1,t.image.height-1),r))return t.image;const d=Math.floor(l/2);if(r.dx===0&&r.dy===0)return t.thickness===1?G.drawPixel({image:t.image,pos:new K(r.x1,r.y1),color:t.color,blend:a,maskChannel:t.maskChannel,mask:t.mask}):G.fillCircle({image:t.image,center:new K(r.x1,r.y1),radius:d,color:t.color,blend:a,maskChannel:t.maskChannel,mask:t.mask}),t.image;if(r.dx===0){if(r.dy<0)for(let m=r.y2;m<=r.y1;++m)if(l<=1)G.drawPixel({image:t.image,pos:new K(r.x1,m),color:t.color,blend:a,maskChannel:u,mask:t.mask});else for(let _=0;_<l;_++)G.drawPixel({image:t.image,pos:new K(r.x1-d+_,m),color:t.color,blend:a,maskChannel:u,mask:t.mask});else for(let m=r.y1;m<=r.y2;++m)if(l<=1)G.drawPixel({image:t.image,pos:new K(r.x1,m),color:t.color,blend:a,maskChannel:u,mask:t.mask});else for(let _=0;_<l;_++)G.drawPixel({image:t.image,pos:new K(r.x1-d+_,m),color:t.color,blend:a,maskChannel:u,mask:t.mask});return t.image}else if(r.dy===0){if(r.dx<0)for(let m=r.x2;m<=r.x1;++m)if(l<=1)G.drawPixel({image:t.image,pos:new K(m,r.y1),color:t.color,blend:a,maskChannel:u,mask:t.mask});else for(let _=0;_<l;_++)G.drawPixel({image:t.image,pos:new K(m,r.y1-d+_),color:t.color,blend:a,maskChannel:u,mask:t.mask});else for(let m=r.x1;m<=r.x2;++m)if(l<=1)G.drawPixel({image:t.image,pos:new K(m,r.y1),color:t.color,blend:a,maskChannel:u,mask:t.mask});else for(let _=0;_<l;_++)G.drawPixel({image:t.image,pos:new K(m,r.y1-d+_),color:t.color,blend:a,maskChannel:u,mask:t.mask});return t.image}const c=m=>~m+65536&65535;if(!h){const m=Math.abs(r.dx),_=Math.abs(r.dy);if(_<=m){const x=Math.cos(Math.atan2(_,m));let b=0;x!==0?b=Math.trunc(l/x):b=1,b===0&&(b=1);let p=2*_-m;const w=2*_,C=2*(_-m);let y=0,A=0,B=0,z=0;r.x1>r.x2?(y=r.x2,A=r.y2,B=-1,z=r.x1):(y=r.x1,A=r.y1,B=1,z=r.x2);let U=Math.trunc(A-b/2);for(let P=U;P<U+b;P++)G.drawPixel({image:t.image,pos:new K(y,P),color:t.color,blend:a,maskChannel:u,mask:t.mask});if((r.y2-r.y1)*B>0)for(;y<z;){y++,p<0?p+=w:(A++,p+=C),U=Math.trunc(A-b/2);for(let P=U;P<U+b;P++)G.drawPixel({image:t.image,pos:new K(y,P),color:t.color,blend:a,maskChannel:u,mask:t.mask})}else for(;y<z;){y++,p<0?p+=w:(A--,p+=C),U=Math.trunc(A-b/2);for(let P=U;P<U+b;P++)G.drawPixel({image:t.image,pos:new K(y,P),color:t.color,blend:a,maskChannel:u,mask:t.mask})}}else{const x=Math.sin(Math.atan2(_,m));let b=0;x!==0?b=Math.trunc(l/x):b=1,b===0&&(b=1);let p=2*m-_;const w=2*m,C=2*(m-_);let y=0,A=0,B=0,z=0;r.y1>r.y2?(A=r.y2,y=r.x2,B=r.y1,z=-1):(A=r.y1,y=r.x1,B=r.y2,z=1);let U=Math.trunc(y-b/2);for(let P=U;P<U+b;P++)G.drawPixel({image:t.image,pos:new K(P,A),color:t.color,blend:a,maskChannel:u,mask:t.mask});if((r.x2-r.x1)*z>0)for(;A<B;){A++,p<0?p+=w:(y++,p+=C),U=Math.trunc(y-b/2);for(let P=U;P<U+b;P++)G.drawPixel({image:t.image,pos:new K(P,A),color:t.color,blend:a,maskChannel:u,mask:t.mask})}else for(;A<B;){A++,p<0?p+=w:(y--,p+=C),U=Math.trunc(y-b/2);for(let P=U;P<U+b;P++)G.drawPixel({image:t.image,pos:new K(P,A),color:t.color,blend:a,maskChannel:u,mask:t.mask})}}return t.image}if(l===1)return G.drawLineWu({image:t.image,line:new Wt(r.x1,r.y1,r.x2,r.y2),color:t.color,blend:a});const g=Math.abs(r.dy)<Math.abs(r.dx)?Math.cos(Math.atan2(r.dy,r.dx)):Math.sin(Math.atan2(r.dy,r.dx));let f=0;if(g!==0?f=Math.trunc(Math.abs(l/g)):f=1,f===0&&(f=1),Math.abs(r.dx)>Math.abs(r.dy)){r.dx<0&&(r.flipX(),r.flipY());let m=r.y1;const _=Math.trunc(r.dy*65536/r.dx);let x=0;for(let b=r.x1;b<=r.x2;b++){const p=m-Math.trunc(f/2);for(let w=p;w<p+f;w++)G.drawPixel({image:t.image,pos:new K(b,w),color:t.color,alpha:(x>>>8&255)/255,blend:a,maskChannel:u,mask:t.mask}),G.drawPixel({image:t.image,pos:new K(b,w+1),color:t.color,alpha:(c(x)>>>8&255)/255,blend:a,maskChannel:u,mask:t.mask});x+=_,x>=65536?(x-=65536,m++):x<0&&(x+=65536,m--)}}else{r.dy<0&&(r.flipX(),r.flipY());let m=r.x1;const _=Math.trunc(r.dx*65536/r.dy);let x=0;for(let b=r.y1;b<=r.y2;b++){const p=m-Math.trunc(f/2);for(let w=p;w<p+f;w++)G.drawPixel({image:t.image,pos:new K(w,b),color:t.color,alpha:(x>>>8&255)/255,maskChannel:u,mask:t.mask}),G.drawPixel({image:t.image,pos:new K(w+1,b),color:t.color,alpha:(c(x)>>>8&255)/255,maskChannel:u,mask:t.mask});x+=_,x>=65536?(x-=65536,m++):x<0&&(x+=65536,m--)}}return t.image}static drawPixel(t){var e,i,n,s,a,r;const h=(e=t.blend)!==null&&e!==void 0?e:_t.alpha,l=(i=t.linearBlend)!==null&&i!==void 0?i:!1,u=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance;if(!t.image.isBoundsSafe(t.pos.x,t.pos.y))return t.image;if((h===_t.direct||t.image.hasPalette)&&t.image.isBoundsSafe(t.pos.x,t.pos.y))return t.image.getPixel(t.pos.x,t.pos.y).set(t.color),t.image;const d=(s=t.mask)===null||s===void 0?void 0:s.getPixelSafe(t.pos.x,t.pos.y),c=(a=d?.getChannelNormalized(u))!==null&&a!==void 0?a:1;let g=t.filter!==void 0?t.color.rNormalized*t.filter.rNormalized:t.color.rNormalized,f=t.filter!==void 0?t.color.gNormalized*t.filter.gNormalized:t.color.gNormalized,m=t.filter!==void 0?t.color.bNormalized*t.filter.bNormalized:t.color.bNormalized;const _=(t.color.length<4?1:t.color.aNormalized)*(t.filter===void 0||t.filter.length<4?1:t.filter.aNormalized),x=((r=t.alpha)!==null&&r!==void 0?r:_)*c;if(x===0)return t.image;const b=t.image.getPixel(t.pos.x,t.pos.y),p=b.rNormalized,w=b.gNormalized,C=b.bNormalized,y=b.aNormalized;switch(h){case _t.direct:return t.image;case _t.alpha:break;case _t.lighten:g=Math.max(p,g),f=Math.max(w,f),m=Math.max(C,m);break;case _t.screen:g=1-(1-g)*(1-p),f=1-(1-f)*(1-w),m=1-(1-m)*(1-C);break;case _t.dodge:{const B=x*y,z=g*(1-y)+p*(1-x),U=f*(1-y)+w*(1-x),P=m*(1-y)+C*(1-x),L=B+z,V=B+U,T=B+P,H=k.clamp(g/k.clamp(x,.01,1)*k.step(0,x),0,.99),Y=k.clamp(f/k.clamp(x,.01,1)*k.step(0,x),0,.99),j=k.clamp(m/k.clamp(x,.01,1)*k.step(0,x),0,.99),ut=p*x/(1-H)+z,ct=w*x/(1-Y)+U,ft=C*x/(1-j)+P,at=k.step(g*y+p*x,B),mt=k.step(f*y+w*x,B),xt=k.step(m*y+C*x,B);g=k.mix(L,ut,at),f=k.mix(V,ct,mt),m=k.mix(T,ft,xt)}break;case _t.addition:g=p+g,f=w+f,m=C+m;break;case _t.darken:g=Math.min(p,g),f=Math.min(w,f),m=Math.min(C,m);break;case _t.multiply:g*=p,f*=w,m*=C;break;case _t.burn:g=g!==0?1-(1-p)/g:0,f=f!==0?1-(1-w)/f:0,m=m!==0?1-(1-C)/m:0;break;case _t.overlay:2*p<y?g=2*g*p+g*(1-y)+p*(1-x):g=x*y-2*(y-p)*(x-g)+g*(1-y)+p*(1-x),2*w<y?f=2*f*w+f*(1-y)+w*(1-x):f=x*y-2*(y-w)*(x-f)+f*(1-y)+w*(1-x),2*C<y?m=2*m*C+m*(1-y)+C*(1-x):m=x*y-2*(y-C)*(x-m)+m*(1-y)+C*(1-x);break;case _t.softLight:g=y===0?0:p*(x*(p/y)+2*g*(1-p/y))+g*(1-y)+p*(1-x),f=y===0?0:w*(x*(w/y)+2*f*(1-w/y))+f*(1-y)+w*(1-x),m=y===0?0:C*(x*(C/y)+2*m*(1-C/y))+m*(1-y)+C*(1-x);break;case _t.hardLight:2*g<x?g=2*g*p+g*(1-y)+p*(1-x):g=x*y-2*(y-p)*(x-g)+g*(1-y)+p*(1-x),2*f<x?f=2*f*w+f*(1-y)+w*(1-x):f=x*y-2*(y-w)*(x-f)+f*(1-y)+w*(1-x),2*m<x?m=2*m*C+m*(1-y)+C*(1-x):m=x*y-2*(y-C)*(x-m)+m*(1-y)+C*(1-x);break;case _t.difference:g=Math.abs(g-p),f=Math.abs(f-w),m=Math.abs(m-C);break;case _t.subtract:g=p-g,f=w-f,m=C-m;break;case _t.divide:g=g!==0?p/g:0,f=f!==0?w/f:0,m=m!==0?C/m:0;break}const A=1-x;if(l){const B=Math.pow(p,2.2),z=Math.pow(w,2.2),U=Math.pow(C,2.2),P=Math.pow(g,2.2),L=Math.pow(f,2.2),V=Math.pow(m,2.2),T=Math.pow(P*x+B*y*A,1/2.2),H=Math.pow(L*x+z*y*A,1/2.2),Y=Math.pow(V*x+U*y*A,1/2.2),j=x+y*A;b.rNormalized=T,b.gNormalized=H,b.bNormalized=Y,b.aNormalized=j}else{const B=g*x+p*y*A,z=f*x+w*y*A,U=m*x+C*y*A,P=x+y*A;b.rNormalized=B,b.gNormalized=z,b.bNormalized=U,b.aNormalized=P}return t.image}static drawPolygon(t){var e,i,n,s;const a=(e=t.antialias)!==null&&e!==void 0?e:!1,r=(i=t.thickness)!==null&&i!==void 0?i:1,h=(n=t.blend)!==null&&n!==void 0?n:_t.alpha,l=(s=t.maskChannel)!==null&&s!==void 0?s:X.luminance;if(h===_t.alpha&&t.color.a===0)return t.image;const u=t.vertices,d=u.length;if(d===0)return t.image;if(d===1)return G.drawPixel({image:t.image,pos:u[0],color:t.color,blend:h,maskChannel:l,mask:t.mask});if(d===2)return G.drawLine({image:t.image,line:new Wt(u[0].x,u[0].y,u[1].x,u[1].y),color:t.color,antialias:a,thickness:r,blend:h,maskChannel:l,mask:t.mask});for(let c=0;c<d-1;++c)G.drawLine({image:t.image,line:new Wt(u[c].x,u[c].y,u[c+1].x,u[c+1].y),color:t.color,antialias:a,thickness:r,blend:h,maskChannel:l,mask:t.mask});return G.drawLine({image:t.image,line:new Wt(u[d-1].x,u[d-1].y,u[0].x,u[0].y),color:t.color,antialias:a,thickness:r,blend:h,maskChannel:l,mask:t.mask}),t.image}static drawRect(t){var e,i,n,s;const a=t.rect,r=(e=t.thickness)!==null&&e!==void 0?e:1,h=(i=t.radius)!==null&&i!==void 0?i:0,l=(n=t.blend)!==null&&n!==void 0?n:_t.alpha,u=(s=t.maskChannel)!==null&&s!==void 0?s:X.luminance,d=a.left,c=a.top,g=a.right,f=a.bottom;if(h>0){const y=Math.round(h);G.drawLine({image:t.image,line:new Wt(d+y,c,g-y,c),color:t.color,blend:l}),G.drawLine({image:t.image,line:new Wt(g,c+y,g,f-y),color:t.color,blend:l}),G.drawLine({image:t.image,line:new Wt(d+y,f,g-y,f),color:t.color,blend:l}),G.drawLine({image:t.image,line:new Wt(d,c+y,d,f-y),color:t.color,blend:l});const A=d+y,B=c+y,z=g-y,U=c+y,P=g-y,L=f-y,V=d+y,T=f-y;return G.drawAntialiasCircle({image:t.image,x:A,y:B,radius:y,color:t.color,blend:l,maskChannel:u,quadrants:be.topLeft,mask:t.mask}),G.drawAntialiasCircle({image:t.image,x:z,y:U,radius:y,color:t.color,blend:l,maskChannel:u,quadrants:be.topRight,mask:t.mask}),G.drawAntialiasCircle({image:t.image,x:P,y:L,radius:y,color:t.color,blend:l,maskChannel:u,quadrants:be.bottomRight,mask:t.mask}),G.drawAntialiasCircle({image:t.image,x:V,y:T,radius:y,color:t.color,blend:l,maskChannel:u,quadrants:be.bottomLeft,mask:t.mask}),t.image}const m=r/2;G.drawLine({image:t.image,line:new Wt(d,c,g,c),color:t.color,thickness:r,blend:l,maskChannel:u,mask:t.mask}),G.drawLine({image:t.image,line:new Wt(d,f,g,f),color:t.color,thickness:r,blend:l,maskChannel:u,mask:t.mask});const x=m-Math.trunc(m)===0?1:0,b=Math.ceil(c+m),p=Math.floor(f-m-x),w=Math.floor(d+m),C=Math.ceil(g-m+x);return G.drawLine({image:t.image,line:new Wt(w,b,w,p),color:t.color,thickness:r,blend:l,maskChannel:u,mask:t.mask}),G.drawLine({image:t.image,line:new Wt(C,b,C,p),color:t.color,thickness:r,blend:l,maskChannel:u,mask:t.mask}),t.image}static fillFlood(t){var e,i,n;const s=(e=t.threshold)!==null&&e!==void 0?e:0,a=(i=t.compareAlpha)!==null&&i!==void 0?i:!1,r=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance;if(t.color.a===0)return t.image;const h=new Uint8Array(t.image.width*t.image.height),l=t.image.getPixel(t.start.x,t.start.y);a||(t.color.a=0);let u;if(s>0){const g=E.rgbToLab(l.r,l.g,l.b);a&&g.push(l.a),u=(f,m)=>h[f*t.image.width+m]===0&&G.testPixelLabColorDistance(t.image,m,f,g,s)}else a?u=(g,f)=>h[g*t.image.width+f]===0&&t.image.getPixel(f,g)!==l:u=(g,f)=>h[g*t.image.width+f]===0&&G.setAlpha(t.image.getPixel(f,g),0)!==l;let d;const c=(g,f)=>{if(t.mask!==void 0){const m=t.mask.getPixel(f,g).getChannelNormalized(r);m>0&&(d=t.image.getPixel(f,g,d),d.r=k.mix(d.r,t.color.r,m),d.g=k.mix(d.g,t.color.g,m),d.b=k.mix(d.b,t.color.b,m),d.a=k.mix(d.a,t.color.a,m))}else t.image.setPixel(f,g,t.color);h[g*t.image.width+f]=1};return G.fill4(t.image,t.start.x,t.start.y,u,c,h),t.image}static fillPolygon(t){var e,i;const n=(e=t.blend)!==null&&e!==void 0?e:_t.alpha,s=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;if(n===_t.alpha&&t.color.a===0)return t.image;const a=t.vertices.length;if(a===0)return t.image;if(a===1)return G.drawPixel({image:t.image,pos:t.vertices[0],color:t.color,blend:n,maskChannel:s,mask:t.mask});if(a===2)return G.drawLine({image:t.image,line:new Wt(t.vertices[0].x,t.vertices[0].y,t.vertices[1].x,t.vertices[1].y),color:t.color,blend:n,mask:t.mask,maskChannel:s});let r=0,h=0,l=0,u=0,d=!0;for(const c of t.vertices)d?(r=c.x,h=c.y,l=c.x,u=c.y,d=!1):(r=Math.min(r,c.x),h=Math.min(h,c.y),l=Math.max(l,c.x),u=Math.max(u,c.y));r=Math.max(r,0),h=Math.max(h,0),l=Math.min(l,t.image.width-1),u=Math.min(u,t.image.height-1);for(let c=h,g=h+.5;c<=u;++c,g+=1)for(let f=r,m=r+.5;f<=l;++f,m+=1){let _=0;for(let x=0;x<a;++x){const b=t.vertices[x],p=t.vertices[(x+1)%a];if(b.y<=g&&p.y>g||p.y<=g&&b.y>g){const w=(g-b.y)/(p.y-b.y);m<b.x+w*(p.x-b.x)&&_++}}(_&1)===1&&G.drawPixel({image:t.image,pos:new K(f,c),color:t.color,blend:n,maskChannel:s,mask:t.mask})}return t.image}static fillRect(t){var e,i,n,s,a,r,h;const l=(e=t.radius)!==null&&e!==void 0?e:0,u=(i=t.alphaBlend)!==null&&i!==void 0?i:!0,d=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance;if(u&&t.color.a===0)return t.image;const c=k.clamp(t.rect.left,0,t.image.width-1),g=k.clamp(t.rect.top,0,t.image.height-1),f=k.clamp(t.rect.right,0,t.image.width-1),m=k.clamp(t.rect.bottom,0,t.image.height-1),_=f-c+1,x=m-g+1;if(l>0){const b=Math.round(l),p=b*b,w=c+b,C=g+b,y=f-b+1,A=g+b,B=f-b+1,z=m-b+1,U=c+b,P=m-b+1,L=t.image.getRange(c,g,_,x);let V;for(;V=L.next(),!V.done;){const T=V.value,H=T.x,Y=T.y;let j=1;if(H<w&&Y<C){if(j=Pi.circleTest(T,new K(w,C),p),j===0)continue}else if(H>y&&Y<A){if(j=Pi.circleTest(T,new K(y,A),p),j===0)continue}else if(H>B&&Y>z){if(j=Pi.circleTest(T,new K(B,z),p),j===0)continue}else if(H<U&&Y>P&&(j=Pi.circleTest(T,new K(U,P),p),j===0))continue;j*=t.color.aNormalized;const ut=(a=(s=t.mask)===null||s===void 0?void 0:s.getPixel(T.x,T.y).getChannelNormalized(d))!==null&&a!==void 0?a:1,ct=j*ut,ft=k.mix(T.r,t.color.r,ct),at=k.mix(T.g,t.color.g,ct),mt=k.mix(T.b,t.color.b,ct),xt=T.a*(1-ct)+t.color.a;T.r=ft,T.g=at,T.b=mt,T.a=xt}return t.image}if(!u||t.color.a===t.color.maxChannelValue&&t.mask===void 0){const b=t.image.getRange(c,g,_,x);let p;for(;p=b.next(),!p.done;)p.value.set(t.color)}else{const b=t.color.a/t.color.maxChannelValue,p=t.image.getRange(c,g,_,x);let w;for(;w=p.next(),!w.done;){const C=w.value,y=(h=(r=t.mask)===null||r===void 0?void 0:r.getPixel(C.x,C.y).getChannelNormalized(d))!==null&&h!==void 0?h:1,A=t.color.a*y;C.r=k.mix(C.r,t.color.r,b*y),C.g=k.mix(C.g,t.color.g,b*y),C.b=k.mix(C.b,t.color.b,b*y),C.a=C.a*(1-A)+A}}return t.image}static fill(t){var e;const i=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance;if(t.mask===void 0)return t.image.clear(t.color),t.image;for(const n of t.image){const s=t.mask.getPixel(n.x,n.y).getChannelNormalized(i);n.r=k.mix(n.r,t.color.r,s),n.g=k.mix(n.g,t.color.g,s),n.b=k.mix(n.b,t.color.b,s),n.a=k.mix(n.a,t.color.a,s)}return t.image}static maskFlood(t){var e,i,n;const s=(e=t.threshold)!==null&&e!==void 0?e:0,a=(i=t.compareAlpha)!==null&&i!==void 0?i:!1,r=(n=t.fillValue)!==null&&n!==void 0?n:255,h=new Uint8Array(t.image.width*t.image.height);let l=t.image.getPixel(t.start.x,t.start.y);a||(l=G.setAlpha(l,0));const u=new Uint8Array(t.image.width*t.image.height);let d;if(s>0){const g=E.rgbToLab(l.r,l.g,l.b);a&&g.push(l.a),d=(f,m)=>h[f*t.image.width+m]===0&&(u[f*t.image.width+m]!==0||G.testPixelLabColorDistance(t.image,m,f,g,s))}else a?d=(g,f)=>h[g*t.image.width+f]===0&&(u[g*t.image.width+f]!==0||t.image.getPixel(f,g)!==l):d=(g,f)=>h[g*t.image.width+f]===0&&(u[g*t.image.width+f]!==0||G.setAlpha(t.image.getPixel(f,g),0)!==l);const c=(g,f)=>{u[g*t.image.width+f]=r,h[g*t.image.width+f]=1};return G.fill4(t.image,t.start.x,t.start.y,d,c,h),u}static compositeImage(t){var e,i,n,s,a,r,h,l,u,d,c,g;let f=t.dst,m=(e=t.dstX)!==null&&e!==void 0?e:0,_=(i=t.dstY)!==null&&i!==void 0?i:0;const x=(n=t.srcX)!==null&&n!==void 0?n:0,b=(s=t.srcY)!==null&&s!==void 0?s:0,p=(a=t.srcW)!==null&&a!==void 0?a:t.src.width,w=(r=t.srcH)!==null&&r!==void 0?r:t.src.height,C=(h=t.dstW)!==null&&h!==void 0?h:f.width<t.src.width?f.width:t.src.width,y=(l=t.dstH)!==null&&l!==void 0?l:f.height<t.src.height?f.height:t.src.height,A=(u=t.blend)!==null&&u!==void 0?u:_t.alpha,B=(d=t.linearBlend)!==null&&d!==void 0?d:!1,z=(c=t.center)!==null&&c!==void 0?c:!1,U=(g=t.maskChannel)!==null&&g!==void 0?g:X.luminance;if(z){let H=f.width-t.src.width;H<0&&(H=0),m=Math.trunc(H/2);let Y=f.height-t.src.height;Y<0&&(Y=0),_=Math.trunc(Y/2)}A!==_t.direct&&f.hasPalette&&(f=f.convert({numChannels:f.numChannels}));const P=w/y,L=p/C,V=Array.from({length:y},(H,Y)=>b+Math.trunc(Y*P)),T=Array.from({length:C},(H,Y)=>x+Math.trunc(Y*L));return A===_t.direct?G.imgDirectComposite(t.src,f,m,_,C,y,T,V,U,t.mask):G.imgComposite(t.src,f,m,_,C,y,T,V,A,B,U,t.mask),f}}var wi;(function(o){o[o.none=0]="none",o[o.falseFloydSteinberg=1]="falseFloydSteinberg",o[o.floydSteinberg=2]="floydSteinberg",o[o.stucki=3]="stucki",o[o.atkinson=4]="atkinson"})(wi||(wi={}));const Ss=[[[0,0,0],[0,0,0],[0,0,0]],[[3/8,1,0],[3/8,0,1],[2/8,1,1]],[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]]];var Be;(function(o){o[o.gaussian=0]="gaussian",o[o.uniform=1]="uniform",o[o.saltAndPepper=2]="saltAndPepper",o[o.poisson=3]="poisson",o[o.rice=4]="rice"})(Be||(Be={}));var Gi;(function(o){o[o.upperLeft=0]="upperLeft",o[o.average=1]="average"})(Gi||(Gi={}));var $i;(function(o){o[o.neuralNet=0]="neuralNet",o[o.octree=1]="octree",o[o.binary=2]="binary"})($i||($i={}));class ks{get length(){return this._coefficients.length}constructor(t){this._size=t,this._coefficients=F.fill(2*t+1,0)}reflect(t,e){return e<0?-e:e>=t?t-(e-t)-1:e}applyCoefficientsLine(t,e,i,n,s,a,r){const h=t.getPixelSafe(0,0),l=e.getPixelSafe(0,0);if(!(!h.isValid||!l.isValid))for(let u=0;u<n;u++){let d=0,c=0,g=0,f=0;for(let _=-this._size,x=0;_<=this._size;++_,++x){const b=this._coefficients[x],p=this.reflect(n,u+_);s?h.setPosition(p,i):h.setPosition(i,p),d+=b*h.r,c+=b*h.g,g+=b*h.b,f+=b*h.a}s?l.setPosition(u,i):l.setPosition(i,u);const m=r?.getPixel(l.x,l.y).getChannelNormalized(a);m===void 0?l.setRgba(d,c,g,f):(l.r=k.mix(l.r,d,m),l.g=k.mix(l.g,c,m),l.b=k.mix(l.b,g,m),l.a=k.mix(l.a,f,m))}}getCoefficient(t){return this._coefficients[t]}setCoefficient(t,e){this._coefficients[t]=e}apply(t){var e,i;const n=(e=t.horizontal)!==null&&e!==void 0?e:!0,s=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;if(n)for(let a=0;a<t.src.height;++a)this.applyCoefficientsLine(t.src,t.dst,a,t.src.width,n,s,t.mask);else for(let a=0;a<t.src.width;++a)this.applyCoefficientsLine(t.src,t.dst,a,t.src.height,n,s,t.mask)}scaleCoefficients(t){for(let e=0;e<this._coefficients.length;++e)this._coefficients[e]*=t}}var Wi;(function(o){o[o.highlights=0]="highlights",o[o.shadows=1]="shadows"})(Wi||(Wi={}));class Mn{get palette(){return this._palette}get threshold(){return this._threshold}constructor(t=.5){this._palette=new ne(2,3),this._threshold=t,this._palette.setRgb(1,255,255,255)}getColorIndex(t){return t.luminanceNormalized<this._threshold?0:1}getColorIndexRgb(t,e,i){return E.getLuminanceRgb(t,e,i)<this._threshold?0:1}getQuantizedColor(t){return t.luminanceNormalized<this._threshold?new pi(Math.trunc(this._palette.getRed(0)),Math.trunc(this._palette.getGreen(0)),Math.trunc(this._palette.getBlue(0))):new pi(Math.trunc(this._palette.getRed(1)),Math.trunc(this._palette.getGreen(1)),Math.trunc(this._palette.getBlue(1)))}getIndexImage(t){const e=new tt({width:t.width,height:t.height,numChannels:1,palette:this.palette});e.frameIndex=t.frameIndex,e.frameType=t.frameType,e.frameDuration=t.frameDuration;const i=t[Symbol.iterator](),n=e[Symbol.iterator]();let s,a;for(;s=i.next(),a=n.next(),!s.done&&!a.done;)a.value.setChannel(0,this.getColorIndex(s.value));return e}}var dn;(function(o){o[o.proportional=0]="proportional",o[o.scurve=1]="scurve"})(dn||(dn={}));class kt{static adjustColor(t){var e,i,n,s,a,r,h,l,u,d,c,g,f,m,_,x,b,p,w,C,y,A,B,z;const U=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,P=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance,L=t.contrast!==void 0?k.clamp(t.contrast,0,2):void 0,V=t.brightness!==void 0?t.brightness:void 0,T=t.gamma!==void 0?k.clamp(t.gamma,0,1e3):void 0;let H=t.exposure!==void 0?k.clamp(t.exposure,0,1e3):void 0;const Y=k.clamp((i=t.amount)!==null&&i!==void 0?i:1,0,1e3);if(Y===0)return t.image;const j=.5,ut=.5,ct=.5,ft=t.blacks!==void 0||t.whites!==void 0||t.mids!==void 0;let at=0,mt=0,xt=0,St=0,yt=0,Ct=0,Ut=0,qt=0,Kt=0;ft&&(at=(s=(n=t.blacks)===null||n===void 0?void 0:n.rNormalized)!==null&&s!==void 0?s:0,mt=(r=(a=t.blacks)===null||a===void 0?void 0:a.gNormalized)!==null&&r!==void 0?r:0,xt=(l=(h=t.blacks)===null||h===void 0?void 0:h.bNormalized)!==null&&l!==void 0?l:0,St=(d=(u=t.whites)===null||u===void 0?void 0:u.rNormalized)!==null&&d!==void 0?d:0,yt=(g=(c=t.whites)===null||c===void 0?void 0:c.gNormalized)!==null&&g!==void 0?g:0,Ct=(m=(f=t.whites)===null||f===void 0?void 0:f.bNormalized)!==null&&m!==void 0?m:0,Ut=(x=(_=t.mids)===null||_===void 0?void 0:_.rNormalized)!==null&&x!==void 0?x:0,qt=(p=(b=t.mids)===null||b===void 0?void 0:b.gNormalized)!==null&&p!==void 0?p:0,Kt=(C=(w=t.mids)===null||w===void 0?void 0:w.bNormalized)!==null&&C!==void 0?C:0,Ut=1/(1+2*(Ut-.5)),qt=1/(1+2*(qt-.5)),Kt=1/(1+2*(Kt-.5)));const Et=L!==void 0?1-L:0;H!==void 0&&(H=Math.pow(2,H));const At=[0,0,0];for(const Yt of U.frames)for(const Ft of Yt){const Gt=Ft.rNormalized,Si=Ft.gNormalized,ki=Ft.bNormalized;let Tt=Gt,$t=Si,re=ki;if(ft&&(Tt=Math.pow((Tt+at)*St,Ut),$t=Math.pow(($t+mt)*yt,qt),re=Math.pow((re+xt)*Ct,Kt)),V!==void 0&&V!==1){const Cn=k.clamp(V,0,1e3);Tt*=Cn,$t*=Cn,re*=Cn}(t.saturation!==void 0||t.hue!==void 0)&&(E.rgbToHsv(Tt,$t,re,At),At[0]+=(y=t.hue)!==null&&y!==void 0?y:0,At[1]*=(A=t.saturation)!==null&&A!==void 0?A:1,E.hsvToRgb(At[0],At[1],At[2],At),Tt=At[0],$t=At[1],re=At[2]),L!==void 0&&(Tt=j*Et+Tt*L,$t=ut*Et+$t*L,re=ct*Et+re*L),T!==void 0&&(Tt=Math.pow(Tt,T),$t=Math.pow($t,T),re=Math.pow(re,T)),H!==void 0&&(Tt*=H,$t*=H,re*=H);const pn=((z=(B=t.mask)===null||B===void 0?void 0:B.getPixel(Ft.x,Ft.y).getChannelNormalized(P))!==null&&z!==void 0?z:1)*Y;Tt=k.mix(Gt,Tt,pn),$t=k.mix(Si,$t,pn),re=k.mix(ki,re,pn),Ft.rNormalized=k.clamp(Tt,0,1),Ft.gNormalized=k.clamp($t,0,1),Ft.bNormalized=k.clamp(re,0,1)}return U}static billboard(t){var e,i,n,s;const a=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,r=(e=t.grid)!==null&&e!==void 0?e:10,h=(i=t.amount)!==null&&i!==void 0?i:1,l=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance,u=.2025;for(const d of a.frames){const c=d.width,g=d.height,f=c/g,m=.0015625,_=.0015625*f,x=d.clone({skipAnimation:!0});for(const b of d){const p=b.x/(c-1),w=b.y/(g-1),C=Math.floor(p/(r*m)),y=Math.floor(w/(r*_)),A=Math.floor(C*r*m*(c-1)),B=Math.floor(y*r*_*(g-1));if(A>=c||B>=g)continue;const z=x.getPixel(A,B),U=k.fract(p/(r*m)),P=k.fract(w/(r*_)),L=Math.pow(Math.abs(U-.5),2),V=Math.pow(Math.abs(P-.5),2);let T=z.r/b.maxChannelValue,H=z.g/b.maxChannelValue,Y=z.b/b.maxChannelValue;const j=k.smoothStep(u-.1,u+.1,L+V),ut=(T+H+Y)/3,ct=.3,ft=Math.ceil(ut/ct),at=ct*ft+.3;T=k.mix(at*T,.1,j),H=k.mix(at*H,.1,j),Y=k.mix(at*Y,.1,j);const mt=(s=t.mask)===null||s===void 0?void 0:s.getPixel(b.x,b.y).getChannelNormalized(l),xt=(mt??1)*h;b.r=k.mix(b.r,T*b.maxChannelValue,xt),b.g=k.mix(b.g,H*b.maxChannelValue,xt),b.b=k.mix(b.b,Y*b.maxChannelValue,xt)}}return a}static bleachBypass(t){var e,i,n,s;const a=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,r=(e=t.amount)!==null&&e!==void 0?e:1,h=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance,l=.2125,u=.7154,d=.0721;for(const c of a.frames)for(const g of c){const f=g.rNormalized,m=g.gNormalized,_=g.bNormalized,x=f*l,b=m*u,p=_*d,w=x+b+p,C=k.clamp((w-.45)*10,0,1),y=2*f*w,A=2*m*w,B=2*_*w,z=1-2*(1-f)*(1-w),U=1-2*(1-m)*(1-w),P=1-2*(1-_)*(1-w);if(((s=(n=t.mask)===null||n===void 0?void 0:n.getPixel(g.x,g.y).getChannelNormalized(h))!==null&&s!==void 0?s:1)*r!==1){const T=k.mix(y,z,C)*g.maxChannelValue,H=k.mix(A,U,C)*g.maxChannelValue,Y=k.mix(B,P,C)*g.maxChannelValue;g.r=k.mix(g.r,T,r),g.g=k.mix(g.g,H,r),g.b=k.mix(g.b,Y,r)}else g.rNormalized=k.mix(y,z,C),g.gNormalized=k.mix(A,U,C),g.bNormalized=k.mix(B,P,C)}return a}static bulgeDistortion(t){var e,i,n,s,a,r,h;const l=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,u=(e=t.scale)!==null&&e!==void 0?e:.5,d=(i=t.interpolation)!==null&&i!==void 0?i:Xe.nearest,c=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance;for(const g of l.frames){const f=g.clone({skipAnimation:!0}),m=g.width,_=g.height,x=(s=t.centerX)!==null&&s!==void 0?s:Math.trunc(m/2),b=(a=t.centerY)!==null&&a!==void 0?a:Math.trunc(_/2),p=(r=t.radius)!==null&&r!==void 0?r:Math.trunc(Math.min(m,_)/2),w=p*p;for(const C of g){let y=C.x,A=C.y;const B=x-y,z=b-A,U=B*B+z*z;if(y-=x,A-=b,U<w){const V=1-(w-U)/w*u,T=V*V;y*=T,A*=T}y+=x,A+=b;const P=f.getPixelInterpolate(y,A,d),L=(h=t.mask)===null||h===void 0?void 0:h.getPixel(C.x,C.y).getChannelNormalized(c);L===void 0?C.set(P):(C.r=k.mix(C.r,P.r,L),C.g=k.mix(C.g,P.g,L),C.b=k.mix(C.b,P.b,L),C.a=k.mix(C.a,P.a,L))}}return l}static bumpToNormal(t){var e;const i=(e=t.strength)!==null&&e!==void 0?e:2,n=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):tt.from(t.image),s=t.image.maxChannelValue;for(const a of t.image.frames)for(let r=0;r<a.height;++r)for(let h=0;h<a.width;++h){const l=a.getPixel(h,r).r/s;let u=(l-a.getPixel(h<a.width-1?h+1:h,r).r/s)*i,d=(l-a.getPixel(h,r<a.height-1?r+1:r).r/s)*i;const c=Math.abs(u)+Math.abs(d);c>1&&(u/=c,d/=c);const g=Math.sqrt(1-u*u-d*d),f=u*.5+.5,m=d*.5+.5,_=g;n.frames[a.frameIndex].setPixelRgb(h,r,f*s,m*s,_*s)}return n}static chromaticAberration(t){var e,i,n;const s=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,a=(e=t.shift)!==null&&e!==void 0?e:5,r=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;for(const h of s.frames){const l=h.clone({skipAnimation:!0}),u=h.width-1;for(const d of h){const c=k.clamp(d.x-a,0,u),g=k.clamp(d.x+a,0,u),f=l.getPixel(c,d.y),m=l.getPixel(g,d.y),_=(n=t.mask)===null||n===void 0?void 0:n.getPixel(d.x,d.y).getChannelNormalized(r);_===void 0?(d.r=m.r,d.b=f.b):(d.r=k.mix(d.r,m.r,_),d.b=k.mix(d.b,f.b,_))}}return s}static colorHalftone(t){var e,i,n,s,a,r,h;const l=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,u=(e=t.amount)!==null&&e!==void 0?e:1;let d=(i=t.angle)!==null&&i!==void 0?i:1;const c=(n=t.size)!==null&&n!==void 0?n:5,g=(s=t.maskChannel)!==null&&s!==void 0?s:X.luminance;d*=.0174533;const f=(m,_,x,b,p)=>{const w=3.14159/c,C=Math.sin(p),y=Math.cos(p),A=m-x,B=_-b,z=(y*A-C*B)*w,U=(C*A+y*B)*w;return Math.sin(z)*Math.sin(U)*4};for(const m of l.frames){const _=m.width,x=m.height,b=(a=t.centerX)!==null&&a!==void 0?a:Math.trunc(_/2),p=(r=t.centerY)!==null&&r!==void 0?r:Math.trunc(x/2);for(const w of m){const C=w.x,y=w.y;let A=1-w.rNormalized,B=1-w.gNormalized,z=1-w.bNormalized,U=Math.min(A,Math.min(B,z));A=(A-U)/(1-U),B=(B-U)/(1-U),z=(z-U)/(1-U),A=k.clamp(A*10-3+f(C,y,b,p,d+.26179),0,1),B=k.clamp(B*10-3+f(C,y,b,p,d+1.30899),0,1),z=k.clamp(z*10-3+f(C,y,b,p,d),0,1),U=k.clamp(U*10-5+f(C,y,b,p,d+.78539),0,1);const P=(1-A-U)*w.maxChannelValue,L=(1-B-U)*w.maxChannelValue,V=(1-z-U)*w.maxChannelValue,T=(h=t.mask)===null||h===void 0?void 0:h.getPixel(w.x,w.y).getChannelNormalized(g),H=(T??1)*u;H!==1?(w.r=k.mix(w.r,P,H),w.g=k.mix(w.g,L,H),w.b=k.mix(w.b,V,H)):(w.r=P,w.g=L,w.b=V)}}return l}static colorOffset(t){var e,i,n,s,a,r;const h=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,l=(e=t.red)!==null&&e!==void 0?e:0,u=(i=t.green)!==null&&i!==void 0?i:0,d=(n=t.blue)!==null&&n!==void 0?n:0,c=(s=t.alpha)!==null&&s!==void 0?s:0,g=(a=t.maskChannel)!==null&&a!==void 0?a:X.luminance;for(const f of h.frames)for(const m of f){const _=(r=t.mask)===null||r===void 0?void 0:r.getPixel(m.x,m.y).getChannelNormalized(g);_===void 0?(m.r+=l,m.g+=u,m.b+=d,m.a+=c):(m.r=k.mix(m.r,m.r+l,_),m.g=k.mix(m.g,m.g+u,_),m.b=k.mix(m.b,m.b+d,_),m.a=k.mix(m.a,m.a+c,_))}return h}static contrast(t){var e,i,n;const s=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,a=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance,r=(i=t.mode)!==null&&i!==void 0?i:dn.proportional;if(t.contrast===100)return t.image;if(kt._contrastCache===void 0||t.contrast!==kt._contrastCache.lastContrast)if(kt._contrastCache={lastContrast:t.contrast,contrast:new Uint8Array(256)},r===dn.proportional){const h=t.contrast*t.contrast/1e4;for(let l=0;l<256;++l)kt._contrastCache.contrast[l]=k.clampInt255(((l/255-.5)*h+.5)*255)}else{const h=t.contrast/100-.12;for(let l=0;l<256;++l)kt._contrastCache.contrast[l]=k.clampInt255((Math.tan((l/128-1)*h)+1)/2*255)}for(const h of s.frames)for(const l of h){const u=(n=t.mask)===null||n===void 0?void 0:n.getPixel(l.x,l.y).getChannelNormalized(a),d=Math.trunc(l.r),c=Math.trunc(l.g),g=Math.trunc(l.b);u===void 0?(l.r=kt._contrastCache.contrast[d],l.g=kt._contrastCache.contrast[c],l.b=kt._contrastCache.contrast[g]):(l.r=k.mix(l.r,kt._contrastCache.contrast[d],u),l.g=k.mix(l.g,kt._contrastCache.contrast[c],u),l.b=k.mix(l.b,kt._contrastCache.contrast[g],u))}return s}static convolution(t){var e,i,n,s,a;const r=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,h=(e=t.div)!==null&&e!==void 0?e:1,l=(i=t.offset)!==null&&i!==void 0?i:0,u=(n=t.amount)!==null&&n!==void 0?n:1,d=(s=t.maskChannel)!==null&&s!==void 0?s:X.luminance,c=tt.from(r);for(const g of r.frames){const f=c.frames[g.frameIndex];for(const m of f){let _=0,x=0,b=0;for(let y=0,A=0;y<3;++y){const B=Math.min(Math.max(m.y-1+y,0),r.height-1);for(let z=0;z<3;++z,++A){const U=Math.min(Math.max(m.x-1+z,0),r.width-1),P=f.getPixel(U,B);_+=P.r*t.filter[A],x+=P.g*t.filter[A],b+=P.b*t.filter[A]}}_=k.clampInt255(_/h+l),x=k.clampInt255(x/h+l),b=k.clampInt255(b/h+l);const p=g.getPixel(m.x,m.y),w=(a=t.mask)===null||a===void 0?void 0:a.getPixel(p.x,p.y).getChannelNormalized(d),C=(w??1)*u;p.r=k.mix(p.r,_,C),p.g=k.mix(p.g,x,C),p.b=k.mix(p.b,b,C)}}return r}static copyImageChannels(t){var e,i,n;const s=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,a=(e=t.scaled)!==null&&e!==void 0?e:!1,r=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance,h=t.from.width/s.width,l=t.from.height/s.height,u=t.from.getPixel(0,0);for(const d of s.frames)for(const c of d){a?u.setPosition(Math.floor(c.x*h),Math.floor(c.y*l)):u.setPosition(c.x,c.y);const g=t.red!==void 0?u.getChannelNormalized(t.red):c.rNormalized,f=t.green!==void 0?u.getChannelNormalized(t.green):c.gNormalized,m=t.blue!==void 0?u.getChannelNormalized(t.blue):c.bNormalized,_=t.alpha!==void 0?u.getChannelNormalized(t.alpha):c.aNormalized,x=(n=t.mask)===null||n===void 0?void 0:n.getPixel(c.x,c.y).getChannelNormalized(r);x===void 0?(c.rNormalized=g,c.gNormalized=f,c.bNormalized=m,c.aNormalized=_):(c.rNormalized=k.mix(c.r,g,x),c.gNormalized=k.mix(c.g,f,x),c.bNormalized=k.mix(c.b,m,x),c.aNormalized=k.mix(c.a,_,x))}return s}static ditherImage(t){var e,i,n;const s=(e=t.quantizer)!==null&&e!==void 0?e:new it(t.image),a=(i=t.kernel)!==null&&i!==void 0?i:wi.floydSteinberg,r=(n=t.serpentine)!==null&&n!==void 0?n:!1;if(a===wi.none)return s.getIndexImage(t.image);const h=Ss[a],l=t.image.height,u=t.image.width;let d=r?-1:1;const c=s.palette,g=new tt({width:u,height:l,numChannels:1,palette:c}),f=t.image.clone();for(let m=0;m<l;m++){r&&(d*=-1);const _=d===1?0:u-1,x=d===1?u:0;for(let b=_;b!==x;b+=d){const p=f.getPixel(b,m),w=Math.trunc(p.getChannel(0)),C=Math.trunc(p.getChannel(1)),y=Math.trunc(p.getChannel(2)),A=s.getColorIndexRgb(w,C,y);g.setPixelIndex(b,m,A);const B=c.get(A,0),z=c.get(A,1),U=c.get(A,2),P=w-B,L=C-z,V=y-U;if(P===0&&L===0&&V===0)continue;const T=d===1?0:h.length-1,H=d===1?h.length:0;for(let Y=T;Y!==H;Y+=d){const j=Math.trunc(h[Y][1]),ut=Math.trunc(h[Y][2]);if(j+b>=0&&j+b<u&&ut+m>=0&&ut+m<l){const ct=h[Y][0],ft=b+j,at=m+ut,mt=f.getPixel(ft,at);mt.r+=P*ct,mt.g+=L*ct,mt.b+=V*ct}}}}return g}static dotScreen(t){var e,i,n,s,a,r,h;const l=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,u=(e=t.size)!==null&&e!==void 0?e:5.75,d=(i=t.amount)!==null&&i!==void 0?i:1,c=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance;let g=(s=t.angle)!==null&&s!==void 0?s:180;g*=.0174533;const f=Math.sin(g),m=Math.cos(g);for(const _ of l.frames){const x=_.width-1,b=_.height-1,p=((a=t.centerX)!==null&&a!==void 0?a:Math.trunc(x/2))/x,w=((r=t.centerY)!==null&&r!==void 0?r:Math.trunc(b/2))/b,C=(y,A,B,z)=>{const U=(B-y)*x,P=(z-A)*b,L=(m*U-f*P)*u,V=(f*U+m*P)*u;return Math.sin(L)*Math.sin(V)*4};for(const y of _){const A=y.luminanceNormalized,B=C(p,w,y.x/x,y.y/b),z=(A*10-5+B)*y.maxChannelValue,U=(h=t.mask)===null||h===void 0?void 0:h.getPixel(y.x,y.y).getChannelNormalized(c),P=(U??1)*d;y.r=k.mix(y.r,z,P),y.g=k.mix(y.g,z,P),y.b=k.mix(y.b,z,P)}}return l}static dropShadow(t){var e;const i=t.blur>=0?t.blur:0,n=(e=t.shadowColor)!==null&&e!==void 0?e:new Ci(0,0,0,128),s=t.image.width+i*2,a=t.image.height+i*2;let r=-i,h=-i,l=s,u=a,d=0,c=0;r+t.hShadow<0&&(d=-(r+t.hShadow),r=-r,l=d),h+t.vShadow<0&&(c=-(h+t.vShadow),h=-h,u+=c),s+r+t.hShadow>l&&(l=s+r+t.hShadow),a+h+t.vShadow>u&&(u=a+h+t.vShadow);const g=new tt({width:l,height:u,numChannels:4});return g.clear(new Ci(255,255,255,0)),G.compositeImage({dst:g,src:t.image,dstX:r,dstY:h}),kt.remapColors({image:g,red:X.alpha,green:X.alpha,blue:X.alpha}),kt.scaleRgba({image:g,scale:n}),kt.gaussianBlur({image:g,radius:i}),G.compositeImage({dst:g,src:t.image,dstX:d,dstY:c}),g}static edgeGlow(t){var e,i,n;const s=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,a=(e=t.amount)!==null&&e!==void 0?e:1,r=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;if(a===0)return t.image;for(const h of s.frames){const l=tt.from(h,!0),u=h.width,d=h.height;for(const c of h){const g=k.clamp(c.y-1,0,d-1),f=k.clamp(c.y+1,0,d-1),m=k.clamp(c.x-1,0,u-1),_=k.clamp(c.x+1,0,u-1),x=l.getPixel(m,g),b=l.getPixel(c.x,g),p=l.getPixel(_,g),w=l.getPixel(m,c.y),C=c,y=l.getPixel(_,c.y),A=l.getPixel(m,f),B=l.getPixel(c.x,f),z=l.getPixel(_,f),U=x.rNormalized+2*b.rNormalized+p.rNormalized-A.rNormalized-2*B.rNormalized-z.rNormalized,P=x.gNormalized+2*b.gNormalized+p.gNormalized-A.gNormalized-2*B.gNormalized-z.gNormalized,L=x.bNormalized+2*b.bNormalized+p.bNormalized-A.bNormalized-2*B.bNormalized-z.bNormalized,V=x.rNormalized-p.rNormalized+2*w.rNormalized-2*y.rNormalized+A.rNormalized-z.rNormalized,T=x.gNormalized-p.gNormalized+2*w.gNormalized-2*y.gNormalized+A.gNormalized-z.gNormalized,H=x.bNormalized-p.bNormalized+2*w.bNormalized-2*y.bNormalized+A.bNormalized-z.bNormalized,Y=Math.sqrt(U*U+V*V),j=Math.sqrt(P*P+T*T),ut=Math.sqrt(L*L+H*H),ct=Y*2*C.rNormalized*c.maxChannelValue,ft=j*2*C.gNormalized*c.maxChannelValue,at=ut*2*C.bNormalized*c.maxChannelValue,mt=(n=t.mask)===null||n===void 0?void 0:n.getPixel(c.x,c.y).getChannelNormalized(r),xt=(mt??1)*a;c.r=k.mix(c.r,ct,xt),c.g=k.mix(c.g,ft,xt),c.b=k.mix(c.b,at,xt)}}return s}static emboss(t){var e,i;const n=(e=t.amount)!==null&&e!==void 0?e:1,s=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance,a=[1.5,0,0,0,0,0,0,0,-1.5];return kt.convolution({image:t.image,filter:a,div:1,offset:127,amount:n,mask:t.mask,maskChannel:s})}static gamma(t){var e,i;const n=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,s=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance;for(const a of n.frames)for(const r of a){const h=(i=t.mask)===null||i===void 0?void 0:i.getPixel(r.x,r.y).getChannelNormalized(s);h===void 0?(r.rNormalized=Math.pow(r.rNormalized,t.gamma),r.gNormalized=Math.pow(r.gNormalized,t.gamma),r.bNormalized=Math.pow(r.bNormalized,t.gamma)):(r.rNormalized=k.mix(r.rNormalized,Math.pow(r.rNormalized,t.gamma),h),r.gNormalized=k.mix(r.gNormalized,Math.pow(r.gNormalized,t.gamma),h),r.bNormalized=k.mix(r.bNormalized,Math.pow(r.bNormalized,t.gamma),h))}return n}static gaussianBlur(t){var e;const i=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance;if(t.radius<=0)return t.image;let n;if(kt._gaussianKernelCache.has(t.radius))n=kt._gaussianKernelCache.get(t.radius);else{const s=t.radius*2/3,a=2*s*s;n=new ks(t.radius);let r=0;for(let h=-t.radius;h<=t.radius;++h){const l=Math.exp(-(h*h)/a);r+=l,n.setCoefficient(h+t.radius,l)}n.scaleCoefficients(1/r),kt._gaussianKernelCache.set(t.radius,n)}return kt.separableConvolution({image:t.image,kernel:n,mask:t.mask,maskChannel:i})}static grayscale(t){var e,i,n;const s=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,a=(e=t.amount)!==null&&e!==void 0?e:1,r=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;for(const h of s.frames)if(h.hasPalette){const l=h.palette,u=l.numColors;for(let d=0;d<u;++d){const c=E.getLuminanceRgb(l.getRed(d),l.getGreen(d),l.getBlue(d));if(a!==1){const g=k.mix(l.getRed(d),c,a),f=k.mix(l.getGreen(d),c,a),m=k.mix(l.getBlue(d),c,a);l.setRed(d,g),l.setGreen(d,f),l.setBlue(d,m)}else l.setRed(d,c),l.setGreen(d,c),l.setBlue(d,c)}}else for(const l of h){const u=E.getLuminanceRgb(l.r,l.g,l.b),d=(n=t.mask)===null||n===void 0?void 0:n.getPixel(l.x,l.y).getChannelNormalized(r),c=(d??1)*a;c!==1?(l.r=k.mix(l.r,u,c),l.g=k.mix(l.g,u,c),l.b=k.mix(l.b,u,c)):(l.r=u,l.g=u,l.b=u)}return s}static hdrToLdr(t){const e=(r,h)=>Math.log(r*h+1)/h,i=(r,h)=>{let l=Math.max(0,r*h);return l>1&&(l=1+e(l-1,.184874)),Math.pow(l,.4545)*84.66},n=new tt({width:t.image.width,height:t.image.height,numChannels:t.image.numChannels}),s=t.exposure!==void 0?Math.pow(2,k.clamp(t.exposure+2.47393,-20,20)):1,a=t.image.numChannels;for(let r=0;r<t.image.height;++r)for(let h=0;h<t.image.width;++h){const l=t.image.getPixel(h,r);let u=l.rNormalized,d=a===1?u:l.gNormalized,c=a===1?u:l.bNormalized;(!isFinite(u)||isNaN(u))&&(u=0),(!isFinite(d)||isNaN(d))&&(d=0),(!isFinite(c)||isNaN(c))&&(c=0);let g=0,f=0,m=0;t.exposure!==void 0?(g=i(u,s),f=i(d,s),m=i(c,s)):(g=k.clamp(u,0,1)*255,f=k.clamp(d,0,1)*255,m=k.clamp(c,0,1)*255);const _=Math.max(g,Math.max(f,m));if(_>255&&(g=255*(g/_),f=255*(f/_),m=255*(m/_)),t.image.numChannels>3){let x=l.a;(!isFinite(x)||isNaN(x))&&(x=1),n.setPixelRgba(h,r,k.clampInt255(g),k.clampInt255(f),k.clampInt255(m),k.clampInt255(x*255))}else n.setPixelRgb(h,r,k.clampInt255(g),k.clampInt255(f),k.clampInt255(m))}return n}static hexagonPixelate(t){var e,i,n,s,a,r;const h=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,l=(e=t.size)!==null&&e!==void 0?e:5,u=(i=t.amount)!==null&&i!==void 0?i:1,d=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance;for(const c of h.frames){const g=c.width-1,f=c.height-1,m=((s=t.centerX)!==null&&s!==void 0?s:Math.trunc(c.width/2))/g,_=((a=t.centerY)!==null&&a!==void 0?a:Math.trunc(c.height/2))/f,x=c.clone({skipAnimation:!0});for(const b of c){let p=(b.x-m)/l,w=(b.y-_)/l;w/=.866025404,p-=w*.5;let C=0,y=0;p+w-Math.floor(p)-Math.floor(w)<1?(C=Math.floor(p),y=Math.floor(w)):(C=Math.ceil(p),y=Math.ceil(w));const A=Math.ceil(p),B=Math.floor(w),z=Math.floor(p),U=Math.ceil(w),P=p,L=w,V=1-p-w,T=C,H=y,Y=1-C-y,j=A,ut=B,ct=1-A-B,ft=z,at=U,mt=1-z-U,xt=k.length3(P-T,L-H,V-Y),St=k.length3(P-j,L-ut,V-ct),yt=k.length3(P-ft,L-at,V-mt);let Ct=0,Ut=0;xt<St?xt<yt?(Ct=C,Ut=y):(Ct=z,Ut=U):St<yt?(Ct=A,Ut=B):(Ct=z,Ut=U),Ct+=Ut*.5,Ut*=.866025404,Ct*=l/g,Ut*=l/f;const qt=Ct+m/g,Kt=Ut+_/f,Et=k.clamp(qt*g,0,g),At=k.clamp(Kt*f,0,f),Yt=x.getPixel(Math.floor(Et),Math.floor(At)),Ft=(r=t.mask)===null||r===void 0?void 0:r.getPixel(b.x,b.y).getChannelNormalized(d),Gt=(Ft??1)*u;b.r=k.mix(b.r,Yt.r,Gt),b.g=k.mix(b.g,Yt.g,Gt),b.b=k.mix(b.b,Yt.b,Gt)}}return h}static invert(t){var e,i;const n=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,s=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance,a=n.maxChannelValue;for(const r of n.frames)if(n.hasPalette){const h=r.palette,l=h.numColors;for(let u=0;u<l;++u){const d=a-h.getRed(u),c=a-h.getGreen(u),g=a-h.getBlue(u);h.setRgb(u,d,c,g)}}else if(a!==0)for(const h of r){const l=(i=t.mask)===null||i===void 0?void 0:i.getPixel(h.x,h.y).getChannelNormalized(s);l===void 0?(h.r=a-h.r,h.g=a-h.g,h.b=a-h.b):(h.r=k.mix(h.r,a-h.r,l),h.g=k.mix(h.g,a-h.g,l),h.b=k.mix(h.b,a-h.b,l))}return n}static luminanceThreshold(t){var e,i,n,s,a,r;const h=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,l=(e=t.threshold)!==null&&e!==void 0?e:.5,u=(i=t.outputColor)!==null&&i!==void 0?i:!1,d=(n=t.amount)!==null&&n!==void 0?n:1,c=(s=t.maskChannel)!==null&&s!==void 0?s:X.luminance;for(const g of h.frames)for(const f of g){const m=.3*f.rNormalized+.59*f.gNormalized+.11*f.bNormalized;if(u){const _=Math.max(0,m-l),x=Math.sign(_),b=(a=t.mask)===null||a===void 0?void 0:a.getPixel(f.x,f.y).getChannelNormalized(c),p=(b??1)*d;f.r=k.mix(f.r,f.r*x,p),f.g=k.mix(f.g,f.g*x,p),f.b*=k.mix(f.b,f.b*x,p)}else{const _=m<l?0:f.maxChannelValue,x=(r=t.mask)===null||r===void 0?void 0:r.getPixel(f.x,f.y).getChannelNormalized(c),b=(x??1)*d;f.r=k.mix(f.r,_,b),f.g=k.mix(f.g,_,b),f.b=k.mix(f.b,_,b)}}return h}static monochrome(t){var e,i,n,s,a,r,h,l,u;const d=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,c=(e=t.amount)!==null&&e!==void 0?e:1,g=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;if(c===0)return t.image;const f=(s=(n=t.color)===null||n===void 0?void 0:n.rNormalized)!==null&&s!==void 0?s:.45,m=(r=(a=t.color)===null||a===void 0?void 0:a.gNormalized)!==null&&r!==void 0?r:.6,_=(l=(h=t.color)===null||h===void 0?void 0:h.bNormalized)!==null&&l!==void 0?l:.3;for(const x of d.frames)for(const b of x){const p=b.luminanceNormalized,w=p<.5?2*p*f:1-2*(1-p)*(1-f),C=p<.5?2*p*m:1-2*(1-p)*(1-m),y=p<.5?2*p*_:1-2*(1-p)*(1-_),A=(u=t.mask)===null||u===void 0?void 0:u.getPixel(b.x,b.y).getChannelNormalized(g),B=(A??1)*c;b.r=k.mix(b.r,w*b.maxChannelValue,B),b.g=k.mix(b.g,C*b.maxChannelValue,B),b.b=k.mix(b.b,y*b.maxChannelValue,B)}return d}static noise(t){var e,i,n,s,a,r,h;const l=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,u=(e=t.type)!==null&&e!==void 0?e:Be.gaussian,d=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;let c=t.sigma,g=0,f=0;if(c===0&&u!==Be.poisson)return t.image;if(c<0||u===Be.saltAndPepper){const m=l.getColorExtremes();g=m.min,f=m.max}c<0&&(c=-c*(f-g)/100);for(const m of l.frames)switch(u){case Be.gaussian:for(const _ of m){const x=k.clamp(_.r+c*Vt.grand(),0,_.maxChannelValue),b=k.clamp(_.g+c*Vt.grand(),0,_.maxChannelValue),p=k.clamp(_.b+c*Vt.grand(),0,_.maxChannelValue),w=_.a,C=(n=t.mask)===null||n===void 0?void 0:n.getPixel(_.x,_.y).getChannelNormalized(d);C===void 0?_.setRgba(x,b,p,w):(_.r=k.mix(_.r,x,C),_.g=k.mix(_.g,b,C),_.b=k.mix(_.b,p,C),_.a=k.mix(_.a,w,C))}break;case Be.uniform:for(const _ of m){const x=k.clamp(_.r+c*Vt.crand(),0,_.maxChannelValue),b=k.clamp(_.g+c*Vt.crand(),0,_.maxChannelValue),p=k.clamp(_.b+c*Vt.crand(),0,_.maxChannelValue),w=_.a,C=(s=t.mask)===null||s===void 0?void 0:s.getPixel(_.x,_.y).getChannelNormalized(d);C===void 0?_.setRgba(x,b,p,w):(_.r=k.mix(_.r,x,C),_.g=k.mix(_.g,b,C),_.b=k.mix(_.b,p,C),_.a=k.mix(_.a,w,C))}break;case Be.saltAndPepper:c<0&&(c=-c),f===g&&(g=0,f=255);for(const _ of m)if(Math.random()*100<c){const x=k.clamp(Math.random()<.5?f:g,0,_.maxChannelValue),b=k.clamp(Math.random()<.5?f:g,0,_.maxChannelValue),p=k.clamp(Math.random()<.5?f:g,0,_.maxChannelValue),w=_.a,C=(a=t.mask)===null||a===void 0?void 0:a.getPixel(_.x,_.y).getChannelNormalized(d);C===void 0?_.setRgba(x,b,p,w):(_.r=k.mix(_.r,x,C),_.g=k.mix(_.g,b,C),_.b=k.mix(_.b,p,C),_.a=k.mix(_.a,w,C))}break;case Be.poisson:for(const _ of m){const x=k.clamp(Vt.prand(_.r),0,_.maxChannelValue),b=k.clamp(Vt.prand(_.g),0,_.maxChannelValue),p=k.clamp(Vt.prand(_.b),0,_.maxChannelValue),w=_.a,C=(r=t.mask)===null||r===void 0?void 0:r.getPixel(_.x,_.y).getChannelNormalized(d);C===void 0?_.setRgba(x,b,p,w):(_.r=k.mix(_.r,x,C),_.g=k.mix(_.g,b,C),_.b=k.mix(_.b,p,C),_.a=k.mix(_.a,w,C))}break;case Be.rice:{const _=Math.sqrt(2);for(const x of m){let b=x.r/_,p=b+c*Vt.grand(),w=b+c*Vt.grand(),C=Math.sqrt(p*p+w*w);const y=k.clamp(Math.trunc(C),0,x.maxChannelValue);b=x.g/_,p=b+c*Vt.grand(),w=b+c*Vt.grand(),C=Math.sqrt(p*p+w*w);const A=k.clamp(Math.trunc(C),0,x.maxChannelValue);b=x.b/_,p=b+c*Vt.grand(),w=b+c*Vt.grand(),C=Math.sqrt(p*p+w*w);const B=k.clamp(Math.trunc(C),0,x.maxChannelValue),z=x.a,U=(h=t.mask)===null||h===void 0?void 0:h.getPixel(x.x,x.y).getChannelNormalized(d);U===void 0?x.setRgba(y,A,B,z):(x.r=k.mix(x.r,y,U),x.g=k.mix(x.g,A,U),x.b=k.mix(x.b,B,U),x.a=k.mix(x.a,z,U))}break}}return l}static normalize(t){var e,i;const n=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,s=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance,a=t.min<t.max?t.min:t.max,r=t.min<t.max?t.max:t.min,h=n.getColorExtremes(),l=h.min,u=h.max;if(l===u)return t.image;const d=l,c=u;if(l!==a||u!==r)for(const g of n.frames)for(const f of g){const m=(i=t.mask)===null||i===void 0?void 0:i.getPixel(f.x,f.y).getChannelNormalized(s);if(m===void 0)f.r=(f.r-d)/(c-d)*(r-a)+a,f.g=(f.g-d)/(c-d)*(r-a)+a,f.b=(f.b-d)/(c-d)*(r-a)+a,f.a=(f.a-d)/(c-d)*(r-a)+a;else{const _=(f.r-d)/(c-d)*(r-a)+a,x=(f.g-d)/(c-d)*(r-a)+a,b=(f.b-d)/(c-d)*(r-a)+a,p=(f.a-d)/(c-d)*(r-a)+a;f.r=k.mix(f.r,_,m),f.g=k.mix(f.g,x,m),f.b=k.mix(f.b,b,m),f.a=k.mix(f.a,p,m)}}return n}static pixelate(t){var e,i,n,s,a;const r=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,h=(e=t.mode)!==null&&e!==void 0?e:Gi.upperLeft,l=(i=t.amount)!==null&&i!==void 0?i:1,u=(n=t.maskChannel)!==null&&n!==void 0?n:X.luminance;if(t.size<=1)return t.image;for(const d of r.frames){const c=d.width,g=d.height;switch(h){case Gi.upperLeft:for(const f of d){const m=Math.trunc(f.x/t.size)*t.size,_=Math.trunc(f.y/t.size)*t.size,x=d.getPixel(m,_),b=(s=t.mask)===null||s===void 0?void 0:s.getPixel(f.x,f.y).getChannelNormalized(u),p=(b??1)*l;p===1?f.set(x):(f.r=k.mix(f.r,x.r,p),f.g=k.mix(f.g,x.g,p),f.b=k.mix(f.b,x.b,p),f.a=k.mix(f.a,x.a,p))}break;case Gi.average:{let f=0,m=0,_=0,x=0,b=-1,p=-1;for(const w of d){const C=Math.trunc(w.x/t.size)*t.size,y=Math.trunc(w.y/t.size)*t.size,A=(a=t.mask)===null||a===void 0?void 0:a.getPixel(w.x,w.y).getChannelNormalized(u),B=(A??1)*l;if(C!==b||y<=p){b=C,p=y,f=0,m=0,_=0,x=0;for(let U=0,P=y;U<t.size&&P<g;++U,++P)for(let L=0,V=C;L<t.size&&V<c;++L,++V){const T=d.getPixel(V,P);f+=T.r,m+=T.g,_+=T.b,x+=T.a}const z=t.size*t.size;f/=z,m/=z,_/=z,x/=z}w.r=k.mix(w.r,f,B),w.g=k.mix(w.g,m,B),w.b=k.mix(w.b,_,B),w.a=k.mix(w.a,x,B)}}break}}return r}static quantize(t){var e,i,n,s;const a=(e=t.numberOfColors)!==null&&e!==void 0?e:256,r=(i=t.method)!==null&&i!==void 0?i:$i.neuralNet,h=(n=t.dither)!==null&&n!==void 0?n:wi.none,l=(s=t.ditherSerpentine)!==null&&s!==void 0?s:!1;let u;return r===$i.octree||a<4?u=new yi(t.image,a):r===$i.neuralNet?u=new it(t.image,a):u=new Mn,kt.ditherImage({image:t.image,quantizer:u,kernel:h,serpentine:l})}static reinhardToneMap(t){var e,i;const n=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance,s=[.212671,.71516,.072169];let a=0;for(const h of t.image){const l=h.r,u=h.g,d=h.b,c=s[0]*l+s[1]*u+s[2]*d;c>1e-4&&(a+=Math.log(c))}a=Math.exp(a/(t.image.width*t.image.height));const r=1/(a*a);for(const h of t.image){const l=h.r,u=h.g,d=h.b,c=s[0]*l+s[1]*u+s[2]*d,g=(1+c*r)/(1+c),f=(i=t.mask)===null||i===void 0?void 0:i.getPixel(h.x,h.y).getChannelNormalized(n);f===void 0?(h.r=l*g,h.g=u*g,h.b=d*g):(h.r=k.mix(h.r,l*g,f),h.g=k.mix(h.g,u*g,f),h.b=k.mix(h.b,d*g,f))}return t.image}static remapColors(t){var e,i,n,s;const a=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,r=(e=t.red)!==null&&e!==void 0?e:X.red,h=(i=t.green)!==null&&i!==void 0?i:X.green,l=(n=t.blue)!==null&&n!==void 0?n:X.blue,u=(s=t.alpha)!==null&&s!==void 0?s:X.alpha,d=[0,0,0,0,0];for(const c of a.frames)for(const g of c)d[0]=g.r,d[1]=g.g,d[2]=g.b,d[3]=g.a,(r===X.luminance||h===X.luminance||l===X.luminance||u===X.luminance)&&(d[4]=E.getLuminanceRgb(d[0],d[1],d[2])),g.r=d[r],g.g=d[h],g.b=d[l],g.a=d[u];return a}static scaleRgba(t){var e,i;const n=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,s=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance,a=t.scale.rNormalized,r=t.scale.gNormalized,h=t.scale.bNormalized,l=t.scale.aNormalized;for(const u of n.frames)for(const d of u){const c=(i=t.mask)===null||i===void 0?void 0:i.getPixel(d.x,d.y).getChannelNormalized(s);c===void 0?d.setRgba(d.r*a,d.g*r,d.b*h,d.a*l):(d.r=k.mix(d.r,d.r*a,c),d.g=k.mix(d.g,d.g*r,c),d.b=k.mix(d.b,d.b*h,c),d.a=k.mix(d.a,d.a*l,c))}return n}static separableConvolution(t){var e;const i=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,n=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance,s=tt.from(i);return t.kernel.apply({src:i,dst:s,maskChannel:n,mask:t.mask}),t.kernel.apply({src:s,dst:i,horizontal:!1,maskChannel:n,mask:t.mask}),i}static sepia(t){var e,i,n;const s=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,a=(e=t.amount)!==null&&e!==void 0?e:1,r=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;if(a===0)return t.image;for(const h of s.frames)for(const l of h){const u=l.rNormalized,d=l.gNormalized,c=l.bNormalized,g=E.getLuminanceRgb(u,d,c),f=(n=t.mask)===null||n===void 0?void 0:n.getPixel(l.x,l.y).getChannelNormalized(r),m=(f??1)*a;l.rNormalized=m*(g+.15)+(1-m)*u,l.gNormalized=m*(g+.07)+(1-m)*d,l.bNormalized=m*(g-.12)+(1-m)*c}return s}static sketch(t){var e,i,n;const s=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,a=(e=t.amount)!==null&&e!==void 0?e:1,r=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;if(a===0)return t.image;for(const h of s.frames){const l=h.width,u=h.height,d=tt.from(h,!0);for(const c of h){const g=k.clamp(c.y-1,0,u-1),f=k.clamp(c.y+1,0,u-1),m=k.clamp(c.x-1,0,l-1),_=k.clamp(c.x+1,0,l-1),x=d.getPixel(m,f).luminanceNormalized,b=d.getPixel(m,g).luminanceNormalized,p=d.getPixel(_,f).luminanceNormalized,w=d.getPixel(_,g).luminanceNormalized,C=d.getPixel(m,c.y).luminanceNormalized,y=d.getPixel(_,c.y).luminanceNormalized,A=d.getPixel(c.x,f).luminanceNormalized,B=d.getPixel(c.x,g).luminanceNormalized,z=-b-2*B-w+x+2*A+p,U=-x-2*C-b+p+2*y+w,P=1-Math.sqrt(z*z+U*U),L=k.clamp(P*c.r,0,c.maxChannelValue),V=k.clamp(P*c.g,0,c.maxChannelValue),T=k.clamp(P*c.b,0,c.maxChannelValue),H=(n=t.mask)===null||n===void 0?void 0:n.getPixel(c.x,c.y).getChannelNormalized(r),Y=(H??1)*a;c.r=k.mix(c.r,L,Y),c.g=k.mix(c.g,V,Y),c.b=k.mix(c.b,T,Y)}}return s}static smooth(t){var e;const i=(e=t.maskChannel)!==null&&e!==void 0?e:X.luminance,n=[1,1,1,1,t.weight,1,1,1,1];return kt.convolution({image:t.image,filter:n,div:t.weight+8,offset:0,mask:t.mask,maskChannel:i})}static sobel(t){var e,i,n;const s=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,a=(e=t.amount)!==null&&e!==void 0?e:1,r=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;if(a===0)return t.image;for(const h of s.frames){const l=tt.from(h,!0),u=h.width,d=h.height;for(const c of h){const g=k.clamp(c.y-1,0,d-1),f=k.clamp(c.y+1,0,d-1),m=k.clamp(c.x-1,0,u-1),_=k.clamp(c.x+1,0,u-1),x=l.getPixel(m,f).luminanceNormalized,b=l.getPixel(m,g).luminanceNormalized,p=l.getPixel(_,f).luminanceNormalized,w=l.getPixel(_,g).luminanceNormalized,C=l.getPixel(m,c.y).luminanceNormalized,y=l.getPixel(_,c.y).luminanceNormalized,A=l.getPixel(c.x,f).luminanceNormalized,B=l.getPixel(c.x,g).luminanceNormalized,z=-b-2*B-w+x+2*A+p,U=-x-2*C-b+p+2*y+w,P=Math.sqrt(z*z+U*U)*c.maxChannelValue,L=(n=t.mask)===null||n===void 0?void 0:n.getPixel(c.x,c.y).getChannelNormalized(r),V=(L??1)*a,T=1-V;c.r=P*V+c.r*T,c.g=P*V+c.g*T,c.b=P*V+c.b*T}}return s}static solarize(t){var e;const i=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,n=(e=t.mode)!==null&&e!==void 0?e:Wi.highlights,s=i.maxChannelValue,a=Math.trunc(s*(t.threshold/255));for(const u of i.frames)if(i.hasPalette){const d=u.palette,c=d.numColors;for(let g=0;g<c;++g)if(n===Wi.highlights)if(d.getGreen(g)>a){const f=s-d.getRed(g),m=s-d.getGreen(g),_=s-d.getBlue(g);d.setRgb(g,f,m,_)}else{const f=d.getRed(g),m=d.getGreen(g),_=d.getBlue(g);d.setRgb(g,f,m,_)}else if(d.getGreen(g)<a){const f=s-d.getRed(g),m=s-d.getGreen(g),_=s-d.getBlue(g);d.setRgb(g,f,m,_)}else{const f=d.getRed(g),m=d.getGreen(g),_=d.getBlue(g);d.setRgb(g,f,m,_)}}else if(s!==0)for(const d of u)n===Wi.highlights?d.g>a?(d.r=s-d.r,d.g=s-d.g,d.b=s-d.b):(d.r=d.r,d.g=d.g,d.b=d.b):d.g<a?(d.r=s-d.r,d.g=s-d.g,d.b=s-d.b):(d.r=d.r,d.g=d.g,d.b=d.b);const r=0,h=s,l=i.getColorExtremes();if(l.min===l.max)return i;if(l.min!==r||l.max!==h)for(const u of i.frames)for(const d of u)d.r=(d.r-l.min)/(l.max-l.min)*(h-r)+r,d.g=(d.g-l.min)/(l.max-l.min)*(h-r)+r,d.b=(d.b-l.min)/(l.max-l.min)*(h-r)+r,d.a=(d.a-l.min)/(l.max-l.min)*(h-r)+r;return i}static stretchDistortion(t){var e,i,n,s,a;const r=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,h=(e=t.interpolation)!==null&&e!==void 0?e:Xe.nearest,l=(i=t.maskChannel)!==null&&i!==void 0?i:X.luminance;for(const u of r.frames){const d=u.clone({skipAnimation:!0}),c=u.width-1,g=u.height-1,f=(n=t.centerX)!==null&&n!==void 0?n:Math.trunc(u.width/2),m=(s=t.centerY)!==null&&s!==void 0?s:Math.trunc(u.height/2),_=2*(f/c)-1,x=2*(m/g)-1;for(const b of u){let p=b.x/c*2-1,w=b.y/g*2-1;p-=_,w-=x;const C=Math.sign(p),y=Math.sign(w);p=Math.abs(p),w=Math.abs(w),p=(.5*p+.5*k.smoothStep(.25,.5,p)*p)*C,w=(.5*w+.5*k.smoothStep(.25,.5,w)*w)*y,p+=_,w+=x;const A=k.clamp((p/2+.5)*c,0,c-1),B=k.clamp((w/2+.5)*g,0,g-1),z=d.getPixelInterpolate(A,B,h),U=(a=t.mask)===null||a===void 0?void 0:a.getPixel(b.x,b.y).getChannelNormalized(l);U===void 0?(b.r=z.r,b.g=z.g,b.b=z.b):(b.r=k.mix(b.r,z.r,U),b.g=k.mix(b.g,z.g,U),b.b=k.mix(b.b,z.b,U))}}return r}static vignette(t){var e,i,n,s,a,r,h,l,u,d,c,g,f;const m=t.image.hasPalette?t.image.convert({numChannels:t.image.numChannels}):t.image,_=(e=t.start)!==null&&e!==void 0?e:.3,x=(i=t.end)!==null&&i!==void 0?i:.85,b=(n=t.amount)!==null&&n!==void 0?n:.9,p=(s=t.maskChannel)!==null&&s!==void 0?s:X.luminance,w=m.height-1,C=m.width-1,y=(r=(a=t.color)===null||a===void 0?void 0:a.rNormalized)!==null&&r!==void 0?r:0,A=(l=(h=t.color)===null||h===void 0?void 0:h.gNormalized)!==null&&l!==void 0?l:0,B=(d=(u=t.color)===null||u===void 0?void 0:u.bNormalized)!==null&&d!==void 0?d:0,z=(g=(c=t.color)===null||c===void 0?void 0:c.aNormalized)!==null&&g!==void 0?g:1,U=C/w;for(const P of m.frames)for(const L of P){const V=(.5-L.x/C)*U,T=.5-L.y/w;let H=Math.sqrt(V*V+T*T);H=1-k.smoothStep(x,_,H);const Y=k.mix(L.rNormalized,y,H)*L.maxChannelValue,j=k.mix(L.gNormalized,A,H)*L.maxChannelValue,ut=k.mix(L.bNormalized,B,H)*L.maxChannelValue,ct=k.mix(L.aNormalized,z,H)*L.maxChannelValue,ft=(f=t.mask)===null||f===void 0?void 0:f.getPixel(L.x,L.y).getChannelNormalized(p),at=(ft??1)*b;L.r=k.mix(L.r,Y,at),L.g=k.mix(L.g,j,at),L.b=k.mix(L.b,ut,at),L.a=k.mix(L.a,ct,at)}return m}}kt._gaussianKernelCache=new Map;class bt{get supportsAnimation(){return this._supportsAnimation}constructor(t){var e,i,n,s,a;this._curAccum=0,this._curBits=0,this._nBits=0,this._initBits=0,this._eofCode=0,this._maxCode=0,this._clearCode=0,this._freeEnt=0,this._clearFlag=!1,this._blockSize=0,this._supportsAnimation=!0,this._delay=(e=t?.delay)!==null&&e!==void 0?e:80,this._repeat=(i=t?.repeat)!==null&&i!==void 0?i:0,this._numColors=256,this._quantizerType=_i.neural,this._samplingFactor=(n=t?.samplingFactor)!==null&&n!==void 0?n:10,this._dither=(s=t?.dither)!==null&&s!==void 0?s:wi.floydSteinberg,this._ditherSerpentine=(a=t?.ditherSerpentine)!==null&&a!==void 0?a:!1,this._encodedFrames=0}addImage(t,e,i){if(!t.hasPalette)throw new W("GIF can only encode palette images.");const n=t.palette,s=n.numColors,a=this._outputBuffer;a.writeByte(bt._imageDescRecordType),a.writeUint16(0),a.writeUint16(0),a.writeUint16(e),a.writeUint16(i);const r=n.toUint8Array();a.writeByte(135);const h=n.numChannels;if(h===3)a.writeBytes(r);else if(h===4)for(let l=0,u=0;l<s;++l,u+=4)a.writeByte(r[u]),a.writeByte(r[u+1]),a.writeByte(r[u+2]);else if(h===1||h===2)for(let l=0,u=0;l<s;++l,u+=h){const d=r[u];a.writeByte(d),a.writeByte(d),a.writeByte(d)}for(let l=s;l<256;++l)a.writeByte(0),a.writeByte(0),a.writeByte(0);this.encodeLZW(t)}encodeLZW(t){this._curAccum=0,this._curBits=0,this._blockSize=0,this._block=new Uint8Array(256);const e=8;this._outputBuffer.writeByte(e);const i=new Int32Array(bt._hSize),n=new Int32Array(bt._hSize),s=t[Symbol.iterator]();let a=s.next();this._initBits=e+1,this._nBits=this._initBits,this._maxCode=(1<<this._nBits)-1,this._clearCode=1<<this._initBits-1,this._eofCode=this._clearCode+1,this._clearFlag=!1,this._freeEnt=this._clearCode+2;let r=!1;const h=()=>{if(r)return bt._eof;const g=Math.trunc(a.value.index);return a=s.next(),a.done&&(r=!0),g};let l=h(),u=0;for(let g=bt._hSize;g<65536;g*=2)u++;u=8-u;const d=bt._hSize;for(let g=0;g<d;++g)i[g]=-1;this.output(this._clearCode);let c=!0;for(;c;){c=!1;let g=h();for(;g!==bt._eof;){const f=(g<<bt._bits)+l;let m=g<<u^l;if(i[m]===f){l=n[m],g=h();continue}else if(i[m]>=0){let _=d-m;m===0&&(_=1);do if((m-=_)<0&&(m+=d),i[m]===f){l=n[m],c=!0;break}while(i[m]>=0);if(c)break}if(this.output(l),l=g,this._freeEnt<1<<bt._bits)n[m]=this._freeEnt++,i[m]=f;else{for(let _=0;_<bt._hSize;++_)i[_]=-1;this._freeEnt=this._clearCode+2,this._clearFlag=!0,this.output(this._clearCode)}g=h()}}this.output(l),this.output(this._eofCode),this._outputBuffer.writeByte(0)}output(t){for(this._curAccum&=bt._masks[this._curBits],this._curBits>0?this._curAccum|=t<<this._curBits:this._curAccum=t,this._curBits+=this._nBits;this._curBits>=8;)this.addToBlock(this._curAccum&255),this._curAccum>>>=8,this._curBits-=8;if((this._freeEnt>this._maxCode||this._clearFlag)&&(this._clearFlag?(this._nBits=this._initBits,this._maxCode=(1<<this._nBits)-1,this._clearFlag=!1):(++this._nBits,this._nBits===bt._bits?this._maxCode=1<<bt._bits:this._maxCode=(1<<this._nBits)-1)),t===this._eofCode){for(;this._curBits>0;)this.addToBlock(this._curAccum&255),this._curAccum>>>=8,this._curBits-=8;this.writeBlock()}}writeBlock(){this._blockSize>0&&(this._outputBuffer.writeByte(this._blockSize),this._outputBuffer.writeBytes(this._block,this._blockSize),this._blockSize=0)}addToBlock(t){this._block[this._blockSize++]=t,this._blockSize>=254&&this.writeBlock()}writeApplicationExt(){this._outputBuffer.writeByte(bt._extensionRecordType),this._outputBuffer.writeByte(bt._applicationExt),this._outputBuffer.writeByte(11);const t=Bt.getCodePoints("NETSCAPE2.0");this._outputBuffer.writeBytes(t),this._outputBuffer.writeBytes(new Uint8Array([3,1])),this._outputBuffer.writeUint16(this._repeat),this._outputBuffer.writeByte(0)}writeGraphicsCtrlExt(t){var e;this._outputBuffer.writeByte(bt._extensionRecordType),this._outputBuffer.writeByte(bt._graphicControlExt),this._outputBuffer.writeByte(4);let i=0,n=0;const s=t.palette,a=s.numChannels,r=a-1;if(a===4||a===2){const u=s.toUint8Array(),d=s.numColors;for(let c=0,g=r;c<d;++c,g+=a)if(u[g]===0){n=1,i=c;break}}const l=0|2<<2|0|n;this._outputBuffer.writeByte(l),this._outputBuffer.writeUint16((e=this._lastImageDuration)!==null&&e!==void 0?e:this._delay),this._outputBuffer.writeByte(i),this._outputBuffer.writeByte(0)}writeHeader(t,e){const i=Bt.getCodePoints(bt._gif89Id);this._outputBuffer.writeBytes(i),this._outputBuffer.writeUint16(t),this._outputBuffer.writeUint16(e),this._outputBuffer.writeByte(0),this._outputBuffer.writeByte(0),this._outputBuffer.writeByte(0)}finish(){let t;return this._outputBuffer===void 0||(this._encodedFrames===0&&(this.writeHeader(this._width,this._height),this.writeApplicationExt()),this.writeGraphicsCtrlExt(this._lastImage),this.addImage(this._lastImage,this._width,this._height),this._outputBuffer.writeByte(bt._terminateRecordType),this._lastImage=void 0,this._lastColorMap=void 0,this._encodedFrames=0,t=this._outputBuffer.getBytes(),this._outputBuffer=void 0),t}addFrame(t,e){if(this._outputBuffer===void 0){this._outputBuffer=new Mt,t.hasPalette?this._lastImage=t:(this._quantizerType===_i.neural?this._lastColorMap=new it(t,this._numColors,this._samplingFactor):this._quantizerType===_i.octree?this._lastColorMap=new yi(t,this._numColors):this._lastColorMap=new Mn,this._lastImage=kt.ditherImage({image:t,quantizer:this._lastColorMap,kernel:this._dither,serpentine:this._ditherSerpentine})),this._lastImageDuration=e,this._width=t.width,this._height=t.height;return}this._encodedFrames===0&&(this.writeHeader(this._width,this._height),this.writeApplicationExt()),this.writeGraphicsCtrlExt(this._lastImage),this.addImage(this._lastImage,this._width,this._height),this._encodedFrames++,t.hasPalette?this._lastImage=t:(this._quantizerType===_i.neural?this._lastColorMap=new it(t,this._numColors,this._samplingFactor):this._quantizerType===_i.octree?this._lastColorMap=new yi(t,this._numColors):this._lastColorMap=new Mn,this._lastImage=kt.ditherImage({image:t,quantizer:this._lastColorMap,kernel:this._dither,serpentine:this._ditherSerpentine})),this._lastImageDuration=e}encode(t){var e;const i=t.image,n=(e=t.singleFrame)!==null&&e!==void 0?e:!1;if(!i.hasAnimation||n)return this.addFrame(i),this.finish();this._repeat=i.loopCount;for(const s of i.frames)this.addFrame(s,Math.trunc(s.frameDuration/10));return this.finish()}}bt._gif89Id="GIF89a";bt._imageDescRecordType=44;bt._extensionRecordType=33;bt._terminateRecordType=59;bt._applicationExt=255;bt._graphicControlExt=249;bt._eof=-1;bt._bits=12;bt._hSize=5003;bt._masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];class Ps extends is{constructor(t,e,i=!1){super(i),this._input=t,this._info=e}}class Ms extends es{get height(){return Math.floor(this._height/2)}get ignoreAlphaChannel(){return this.headerSize===40&&this.bitsPerPixel===32?!1:super.ignoreAlphaChannel}}class As{get width(){return this._width}get height(){return this._height}get colorPalette(){return this._colorPalette}get bytesSize(){return this._bytesSize}get bytesOffset(){return this._bytesOffset}get colorPlanes(){return this._colorPlanes}get bitsPerPixel(){return this._bitsPerPixel}constructor(t){this._width=t.width,this._height=t.height,this._colorPalette=t.colorPalette,this._bytesSize=t.bytesSize,this._bytesOffset=t.bytesOffset,this._colorPlanes=t.colorPlanes,this._bitsPerPixel=t.bitsPerPixel}}var An;(function(o){o[o.invalid=0]="invalid",o[o.ico=1]="ico",o[o.cur=2]="cur"})(An||(An={}));const zs=3;class fn{get width(){return this._width}get height(){return this._height}get type(){return this._type}get numFrames(){return this._numFrames}get backgroundColor(){return this._backgroundColor}get images(){return this._images}constructor(t,e,i){this._width=0,this._height=0,this._backgroundColor=void 0,this._type=t,this._numFrames=e,this._images=i}static read(t){if(t.readUint16()!==0)return;const e=t.readUint16();if(e>=zs)return;const i=e;if(i===An.cur)return;const n=t.readUint16(),s=F.generate(n,a=>new As({width:t.read(),height:t.read(),colorPalette:t.read(),colorPlanes:(t.skip(1),t).readUint16(),bitsPerPixel:t.readUint16(),bytesSize:t.readUint32(),bytesOffset:t.readUint32()}));return new fn(i,n,s)}}function Bs(o,t,e,i){const s=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],a=Ds,r=Un;let h=0,l=e<<3,u=0;const d=o.length;if(i===0){for(;h<d;){const C=Math.min(65535,d-h);r(t,l,h+C===d?1:0),l=ns(o,h,C,t,l+8),h+=C}return l>>>3}const c=O.lits,g=O.strt,f=O.prev;let m=0,_=0,x=0,b=0,p=0,w=0;for(d>2&&(w=zn(o,0),g[w]=0),h=0;h<d;h++){if(p=w,h+1<d-2){w=zn(o,h+1);const C=h+1&32767;f[C]=g[w],g[w]=C}if(u<=h){(m>14e3||_>26697)&&d-h>100&&(u<h&&(c[m]=h-u,m+=2,u=h),l=Tn(h===d-1||u===d?1:0,c,m,b,o,x,h-x,t,l),m=_=b=0,x=h);let C=0;if(h<d-2&&(C=Rs(o,h,f,p,Math.min(s[2],d-h),s[3])),C!==0){const y=C>>>16,A=C&65535,B=a(y,O.of0);O.lhst[257+B]++;const z=a(A,O.df0);O.dhst[z]++,b+=O.exb[B]+O.dxb[z],c[m]=y<<23|h-u,c[m+1]=A<<16|B<<8|z,m+=2,u=h+y}else O.lhst[o[h]]++;_++}}for((x!==h||o.length===0)&&(u<h&&(c[m]=h-u,m+=2,u=h),l=Tn(1,c,m,b,o,x,h-x,t,l),m=0,_=0,m=_=b=0,x=h);l&7;)l++;return l>>>3}function Rs(o,t,e,i,n,s){let a=t&32767,r=e[a],h=a-r+32768&32767;if(r===a||i!==zn(o,t-h))return 0;let l=0,u=0;const d=Math.min(32767,t);for(;h<=d&&--s!==0&&r!==a;){if(l===0||o[t+l]===o[t+l-h]){let c=Us(o,t,h);if(c>l){if(l=c,u=h,l>=n)break;h+2<c&&(c=h+2);let g=0;for(let f=0;f<c-2;f++){const m=t-h+f+32768&32767,_=e[m],x=m-_+32768&32767;x>g&&(g=x,r=m)}}}a=r,r=e[a],h+=a-r+32768&32767}return l<<16|u}function Us(o,t,e){if(o[t]!==o[t-e]||o[t+1]!==o[t+1-e]||o[t+2]!==o[t+2-e])return 0;const i=t,n=Math.min(o.length,t+258);for(t+=3;t<n&&o[t]===o[t-e];)t++;return t-i}function zn(o,t){return(o[t]<<8|o[t+1])+(o[t+2]<<4)&65535}function Tn(o,t,e,i,n,s,a,r,h){const l=ss,u=Un;O.lhst[256]++;const d=Is(),c=d[0],g=d[1],f=d[2],m=d[3],_=d[4],x=d[5],b=d[6],p=d[7],w=(h+3&7?8-(h+3&7):0)+32+(a<<3),C=i+qi(O.fltree,O.lhst)+qi(O.fdtree,O.dhst);let y=i+qi(O.ltree,O.lhst)+qi(O.dtree,O.dhst);y+=14+3*x+qi(O.itree,O.ihst)+(O.ihst[16]*2+O.ihst[17]*3+O.ihst[18]*7);for(let B=0;B<286;B++)O.lhst[B]=0;for(let B=0;B<30;B++)O.dhst[B]=0;for(let B=0;B<19;B++)O.ihst[B]=0;const A=w<C&&w<y?0:C<y?1:2;if(l(r,h,o),l(r,h+1,A),h+=3,A===0){for(;h&7;)h++;h=ns(n,s,a,r,h)}else{let B=O.fltree,z=O.fdtree;if(A===2){di(O.ltree,c),ji(O.ltree,c),di(O.dtree,g),ji(O.dtree,g),di(O.itree,f),ji(O.itree,f),B=O.ltree,z=O.dtree,u(r,h,m-257),h+=5,u(r,h,_-1),h+=5,u(r,h,x-4),h+=4;for(let P=0;P<x;P++)u(r,h+P*3,O.itree[(O.ordr[P]<<1)+1]);h+=3*x,h=Vn(b,O.itree,r,h),h=Vn(p,O.itree,r,h)}let U=s;for(let P=0;P<e;P+=2){const L=t[P],V=L>>>23,T=U+(L&(1<<23)-1);for(;U<T;)h=Yi(n[U++],B,r,h);if(V!==0){const H=t[P+1],Y=H>>16,j=H>>8&255,ut=H&255;h=Yi(257+j,B,r,h),u(r,h,V-O.of0[j]),h+=O.exb[j],h=Yi(ut,z,r,h),l(r,h,Y-O.df0[ut]),h+=O.dxb[ut],U+=V}}h=Yi(256,B,r,h)}return h}function ns(o,t,e,i,n){let s=n>>>3;return i[s]=e,i[s+1]=e>>>8,i[s+2]=255-i[s],i[s+3]=255-i[s+1],s+=4,i.set(new Uint8Array(o.buffer,t,e),s),n+(e+4<<3)}function Is(){const o=vn(O.lhst,O.ltree,15),t=vn(O.dhst,O.dtree,15),e=[],i=On(O.ltree,e),n=[],s=On(O.dtree,n);for(let h=0;h<e.length;h+=2)O.ihst[e[h]]++;for(let h=0;h<n.length;h+=2)O.ihst[n[h]]++;const a=vn(O.ihst,O.itree,7);let r=19;for(;r>4&&O.itree[(O.ordr[r-1]<<1)+1]===0;)r--;return[o,t,a,i,s,r,e,n]}function qi(o,t){let e=0;for(let i=0;i<t.length;i++)e+=t[i]*o[(i<<1)+1];return e}function Vn(o,t,e,i){for(let n=0;n<o.length;n+=2){const s=o[n],a=o[n+1];i=Yi(s,t,e,i);const r=s===16?2:s===17?3:7;s>15&&(Un(e,i,a),i+=r)}return i}function On(o,t){let e=o.length;for(;e!==2&&o[e-1]===0;)e-=2;for(let i=0;i<e;i+=2){const n=o[i+1],s=i+3<e?o[i+3]:-1,a=i+5<e?o[i+5]:-1,r=i===0?-1:o[i-1];if(n===0&&s===n&&a===n){let h=i+5;for(;h+2<e&&o[h+2]===n;)h+=2;const l=Math.min(h+1-i>>>1,138);l<11?t.push(17,l-3):t.push(18,l-11),i+=l*2-2}else if(n===r&&s===n&&a===n){let h=i+5;for(;h+2<e&&o[h+2]===n;)h+=2;const l=Math.min(h+1-i>>>1,6);t.push(16,l-3),i+=l*2-2}else t.push(n,0)}return e>>>1}function vn(o,t,e){const i=[],n=o.length,s=t.length;let a=0;for(a=0;a<s;a+=2)t[a]=0,t[a+1]=0;for(a=0;a<n;a++)o[a]!==0&&i.push({lit:a,f:o[a]});const r=i.length;let h=i.slice(0);if(r===0)return 0;if(r===1){const m=i[0].lit;return h=m===0?[{lit:1,f:0}]:[{lit:0,f:0}],t[(m<<1)+1]=1,t[(h[0].lit<<1)+1]=1,1}i.sort((m,_)=>m.f-_.f);let l=i[0],u=i[1],d=0,c=1,g=2;for(i[0]={lit:-1,f:l.f+u.f,l,r:u,d:0};c!==r-1;)d!==c&&(g===r||i[d].f<i[g].f)?l=i[d++]:l=i[g++],d!==c&&(g===r||i[d].f<i[g].f)?u=i[d++]:u=i[g++],i[c++]={lit:-1,f:l.f+u.f,l,r:u};let f=Bn(i[c-1],0);for(f>e&&(Ns(h,e,f),f=e),a=0;a<r;a++)t[(h[a].lit<<1)+1]=h[a].d;return f}function Bn(o,t){return o.lit!==-1?(o.d=t,t):Math.max(Bn(o.l,t+1),Bn(o.r,t+1))}function Ns(o,t,e){let i=0;const n=1<<e-t;let s=0;for(o.sort((a,r)=>r.d===a.d?a.f-r.f:r.d-a.d),i=0;i<o.length&&o[i].d>t;i++){const a=o[i].d;o[i].d=t,s+=n-(1<<e-a)}for(s>>>=e-t;s>0;){const a=o[i].d;a<t?(o[i].d++,s-=1<<t-a-1):i++}for(;i>=0;i--)o[i].d===t&&s<0&&(o[i].d--,s++);s!==0&&console.log("debt left")}function Ds(o,t){let e=0;return t[e|16]<=o&&(e|=16),t[e|8]<=o&&(e|=8),t[e|4]<=o&&(e|=4),t[e|2]<=o&&(e|=2),t[e|1]<=o&&(e|=1),e}function Yi(o,t,e,i){return ss(e,i,t[o<<1]),i+t[(o<<1)+1]}function Ls(o,t){const e=Uint8Array;if(o[0]===3&&o[1]===0)return t||new e(0);const i=Ts,n=as,s=Fs,a=rs,r=t===void 0;r&&(t=new e(o.length>>>2<<3));let h=0,l=0,u=0,d=0,c=0,g=0,f=0,m=0,_=0,x,b;for(;h===0;){if(h=i(o,_,1),l=i(o,_+1,2),_+=3,l===0){_&7&&(_+=8-(_&7));const p=(_>>>3)+4,w=o[p-4]|o[p-3]<<8;r&&(t=Sn(t,m+w)),t.set(new e(o.buffer,o.byteOffset+p,w),m),_=p+w<<3,m+=w;continue}if(r&&(t=Sn(t,m+(1<<17))),l===1&&(x=O.flmap,b=O.fdmap,g=512-1,f=32-1),l===2){u=n(o,_,5)+257,d=n(o,_+5,5)+1,c=n(o,_+10,4)+4,_+=14;for(let y=0;y<38;y+=2)O.itree[y]=0,O.itree[y+1]=0;let p=1;for(let y=0;y<c;y++){const A=n(o,_+y*3,3);O.itree[(O.ordr[y]<<1)+1]=A,A>p&&(p=A)}_+=3*c,di(O.itree,p),Xi(O.itree,p,O.imap),x=O.lmap,b=O.dmap,_=s(O.imap,(1<<p)-1,u+d,o,_,O.ttree);const w=Hn(O.ttree,0,u,O.ltree);g=(1<<w)-1;const C=Hn(O.ttree,u,d,O.dtree);f=(1<<C)-1,di(O.ltree,w),Xi(O.ltree,w,x),di(O.dtree,C),Xi(O.dtree,C,b)}for(;;){const p=x[a(o,_)&g];_+=p&15;const w=p>>>4;if(!(w>>>8))t[m++]=w;else{if(w===256)break;{let C=m+w-254;if(w>264){const U=O.ldef[w-257];C=m+(U>>>3)+n(o,_,U&7),_+=U&7}const y=b[a(o,_)&f];_+=y&15;const A=y>>>4,B=O.ddef[A],z=(B>>>4)+i(o,_,B&15);for(_+=B&15,r&&(t=Sn(t,m+(1<<17)));m<C;)t[m]=t[m++-z],t[m]=t[m++-z],t[m]=t[m++-z],t[m]=t[m++-z];m=C}}}}return t.length===m?t:t.slice(0,m)}function Sn(o,t){const e=o.length;if(t<=e)return o;const i=new Uint8Array(Math.max(e<<1,t));return i.set(o,0),i}function Fs(o,t,e,i,n,s){const a=as,r=rs;let h=0;for(;h<e;){const l=o[r(i,n)&t];n+=l&15;const u=l>>>4;if(u<=15)s[h]=u,h++;else{let d=0,c=0;u===16?(c=3+a(i,n,2),n+=2,d=s[h-1]):u===17?(c=3+a(i,n,3),n+=3):u===18&&(c=11+a(i,n,7),n+=7);const g=h+c;for(;h<g;)s[h]=d,h++}}return n}function Hn(o,t,e,i){let n=0,s=0;const a=i.length>>>1;for(;s<e;){const r=o[s+t];i[s<<1]=0,i[(s<<1)+1]=r,r>n&&(n=r),s++}for(;s<a;)i[s<<1]=0,i[(s<<1)+1]=0,s++;return n}function di(o,t){const e=o.length,i=O.bl_count;for(let a=0;a<=t;a++)i[a]=0;for(let a=1;a<e;a+=2)i[o[a]]++;const n=O.next_code;let s=0;i[0]=0;for(let a=1;a<=t;a++)s=s+i[a-1]<<1,n[a]=s;for(let a=0;a<e;a+=2){const r=o[a+1];r!==0&&(o[a]=n[r],n[r]++)}}function Xi(o,t,e){const i=o.length,n=O.rev15;for(let s=0;s<i;s+=2)if(o[s+1]!==0){const a=s>>1,r=o[s+1],h=a<<4|r,l=t-r;let u=o[s]<<l;const d=u+(1<<l);for(;u!==d;){const c=n[u]>>>15-t;e[c]=h,u++}}}function ji(o,t){const e=O.rev15,i=15-t;for(let n=0;n<o.length;n+=2){const s=o[n]<<t-o[n+1];o[n]=e[s]>>>i}}function Un(o,t,e){e<<=t&7;const i=t>>>3;o[i]|=e,o[i+1]|=e>>>8}function ss(o,t,e){e<<=t&7;const i=t>>>3;o[i]|=e,o[i+1]|=e>>>8,o[i+2]|=e>>>16}function as(o,t,e){return(o[t>>>3]|o[(t>>>3)+1]<<8)>>>(t&7)&(1<<e)-1}function Ts(o,t,e){return(o[t>>>3]|o[(t>>>3)+1]<<8|o[(t>>>3)+2]<<16)>>>(t&7)&(1<<e)-1}function rs(o,t){return(o[t>>>3]|o[(t>>>3)+1]<<8|o[(t>>>3)+2]<<16)>>>(t&7)}const O=function(){const o=Uint16Array,t=Uint32Array;return{next_code:new o(16),bl_count:new o(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new o(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new o(512),fltree:[],fdmap:new o(32),fdtree:[],lmap:new o(32768),ltree:[],ttree:[],dmap:new o(32768),dtree:[],imap:new o(512),itree:[],rev15:new o(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new o(65536),prev:new o(32768)}}();(function(){for(let e=0;e<32768;e++){let i=e;i=(i&2863311530)>>>1|(i&1431655765)<<1,i=(i&3435973836)>>>2|(i&858993459)<<2,i=(i&4042322160)>>>4|(i&252645135)<<4,i=(i&4278255360)>>>8|(i&16711935)<<8,O.rev15[e]=(i>>>16|i<<16)>>>17}function t(e,i,n){for(;i--!==0;)e.push(0,n)}for(let e=0;e<32;e++)O.ldef[e]=O.of0[e]<<3|O.exb[e],O.ddef[e]=O.df0[e]<<4|O.dxb[e];t(O.fltree,144,8),t(O.fltree,255-143,9),t(O.fltree,279-255,7),t(O.fltree,287-279,8),di(O.fltree,9),Xi(O.fltree,9,O.flmap),ji(O.fltree,9),t(O.fdtree,32,5),di(O.fdtree,5),Xi(O.fdtree,5,O.fdmap),ji(O.fdtree,5),t(O.itree,19,0),t(O.ltree,286,0),t(O.dtree,30,0),t(O.ttree,320,0)})();const qn={table:function(){const o=new Uint32Array(256);for(let t=0;t<256;t++){let e=t;for(let i=0;i<8;i++)e&1?e=3988292384^e>>>1:e>>>=1;o[t]=e}return o}(),update:function(o,t,e,i){for(let n=0;n<i;n++)o=qn.table[(o^t[e+n])&255]^o>>>8;return o},crc:function(o,t,e){return qn.update(4294967295,o,t,e)^4294967295}};function Vs(o,t,e){let i=1,n=0,s=t;const a=t+e;for(;s<a;){const r=Math.min(s+5552,a);for(;s<r;)i+=o[s++],n+=i;i%=65521,n%=65521}return n<<16|i}function hs(o,t){t===void 0&&(t={level:6});let e=0;const i=new Uint8Array(50+Math.floor(o.length*1.1));i[e]=120,i[e+1]=156,e+=2,e=Bs(o,i,e,t.level);const n=Vs(o,0,o.length);return i[e+0]=n>>>24&255,i[e+1]=n>>>16&255,i[e+2]=n>>>8&255,i[e+3]=n>>>0&255,new Uint8Array(i.buffer,0,e+4)}function Mi(o,t){return o[0],o[1],Os(new Uint8Array(o.buffer,o.byteOffset+2,o.length-6),t)}function Os(o,t){return Ls(o,t)}class mi{static makeTable(){const t=[];let e=0;for(let i=0;i<256;i++){e=i;for(let n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[i]=e}return t}static getChecksum(t){var e,i,n;const s=mi._crcTable,a=(e=t.length)!==null&&e!==void 0?e:t.buffer.length,r=(i=t.position)!==null&&i!==void 0?i:0,h=r+a;let l=((n=t.baseCrc)!==null&&n!==void 0?n:0)^-1;for(let u=r;u<h;u++)l=l>>>8^s[(l^t.buffer[u])&255];return(l^-1)>>>0}}mi._crcTable=new Uint32Array(mi.makeTable());var Qi;(function(o){o[o.source=0]="source",o[o.over=1]="over"})(Qi||(Qi={}));var Ji;(function(o){o[o.none=0]="none",o[o.background=1]="background",o[o.previous=2]="previous"})(Ji||(Ji={}));class Hs{get fdat(){return this._fdat}get sequenceNumber(){return this._sequenceNumber}get width(){return this._width}get height(){return this._height}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}get delayNum(){return this._delayNum}get delayDen(){return this._delayDen}get dispose(){return this._dispose}get blend(){return this._blend}get delay(){return this._delayNum===void 0||this._delayDen===void 0||this._delayDen===0?0:this._delayNum/this._delayDen}constructor(t){var e,i,n,s,a,r,h,l,u;this._fdat=[],this._sequenceNumber=(e=t?.sequenceNumber)!==null&&e!==void 0?e:0,this._width=(i=t?.width)!==null&&i!==void 0?i:0,this._height=(n=t?.height)!==null&&n!==void 0?n:0,this._xOffset=(s=t?.xOffset)!==null&&s!==void 0?s:0,this._yOffset=(a=t?.yOffset)!==null&&a!==void 0?a:0,this._delayNum=(r=t?.delayNum)!==null&&r!==void 0?r:0,this._delayDen=(h=t?.delayDen)!==null&&h!==void 0?h:0,this._dispose=(l=t?.dispose)!==null&&l!==void 0?l:Ji.none,this._blend=(u=t?.blend)!==null&&u!==void 0?u:Qi.source}}class qs{get width(){return this._width}set width(t){this._width=t}set height(t){this._height=t}get height(){return this._height}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t}get numFrames(){return this._numFrames}set numFrames(t){this._numFrames=t}get bits(){return this._bits}set bits(t){this._bits=t}get colorType(){return this._colorType}set colorType(t){this._colorType=t}get compressionMethod(){return this._compressionMethod}set compressionMethod(t){this._compressionMethod=t}get filterMethod(){return this._filterMethod}set filterMethod(t){this._filterMethod=t}get interlaceMethod(){return this._interlaceMethod}set interlaceMethod(t){this._interlaceMethod=t}get palette(){return this._palette}set palette(t){this._palette=t}get transparency(){return this._transparency}set transparency(t){this._transparency=t}get gamma(){return this._gamma}set gamma(t){this._gamma=t}get iccpName(){return this._iccpName}set iccpName(t){this._iccpName=t}get iccpCompression(){return this._iccpCompression}set iccpCompression(t){this._iccpCompression=t}get iccpData(){return this._iccpData}set iccpData(t){this._iccpData=t}get textData(){return this._textData}get pixelDimensions(){return this._pixelDimensions}set pixelDimensions(t){this._pixelDimensions=t}get repeat(){return this._repeat}set repeat(t){this._repeat=t}get idat(){return this._idat}get frames(){return this._frames}get isAnimated(){return this._frames.length>0}constructor(t){var e,i,n,s,a,r;this._width=0,this._height=0,this._backgroundColor=void 0,this._numFrames=1,this._iccpName="",this._iccpCompression=0,this._textData=new Map,this._repeat=0,this._idat=[],this._frames=[],this._width=(e=t?.width)!==null&&e!==void 0?e:0,this._height=(i=t?.height)!==null&&i!==void 0?i:0,this._bits=(n=t?.bits)!==null&&n!==void 0?n:0,this._colorType=t?.colorType,this._compressionMethod=(s=t?.compressionMethod)!==null&&s!==void 0?s:0,this._filterMethod=(a=t?.filterMethod)!==null&&a!==void 0?a:0,this._interlaceMethod=(r=t?.interlaceMethod)!==null&&r!==void 0?r:0}}var ot;(function(o){o[o.grayscale=0]="grayscale",o[o.rgb=2]="rgb",o[o.indexed=3]="indexed",o[o.grayscaleAlpha=4]="grayscaleAlpha",o[o.rgba=6]="rgba"})(ot||(ot={}));var ei;(function(o){o[o.none=0]="none",o[o.deflate=1]="deflate"})(ei||(ei={}));class tn{get name(){return this._name}get compression(){return this._compression}get data(){return this._data}constructor(t,e,i){this._name=t,this._compression=e,this._data=i}static from(t){return new tn(t._name,t._compression,F.copyUint8(t._data))}compressed(){return this._compression===ei.deflate?this._data:(this._data=hs(this._data),this._compression=ei.deflate,this._data)}decompressed(){return this._compression===ei.none?this._data:(this._data=Mi(this._data),this._compression=ei.none,this._data)}clone(){return tn.from(this)}}var Dt;(function(o){o[o.none=0]="none",o[o.sub=1]="sub",o[o.up=2]="up",o[o.average=3]="average",o[o.paeth=4]="paeth"})(Dt||(Dt={}));class Ze{get xPxPerUnit(){return this._xPxPerUnit}get yPxPerUnit(){return this._yPxPerUnit}get unitSpecifier(){return this._unitSpecifier}constructor(t,e,i){this._xPxPerUnit=t,this._yPxPerUnit=e,this._unitSpecifier=i}static fromDPI(t,e){const i=Math.round(t*Ze._inchesPerM),n=Math.round((e??t)*Ze._inchesPerM),s=Ze.unitMeter;return new Ze(i,n,s)}equals(t){return this._xPxPerUnit===t._xPxPerUnit&&this._yPxPerUnit===t._yPxPerUnit&&this._unitSpecifier===t._unitSpecifier}}Ze._inchesPerM=39.3701;Ze.unitUnknown=0;Ze.unitMeter=1;class De{constructor(){this._info=new qs,this._progressY=0,this._bitBuffer=0,this._bitBufferLen=0}get input(){return this._input}get info(){return this._info}get progressY(){return this._progressY}get bitBuffer(){return this._bitBuffer}get bitBufferLen(){return this._bitBufferLen}get format(){return le.png}get numFrames(){return this._info.numFrames}static unfilter(t,e,i,n){const s=i.length;switch(t){case Dt.none:break;case Dt.sub:for(let a=e;a<s;++a)i[a]=i[a]+i[a-e]&255;break;case Dt.up:for(let a=0;a<s;++a){const r=n!==void 0?n[a]:0;i[a]=i[a]+r&255}break;case Dt.average:for(let a=0;a<s;++a){const r=a<e?0:i[a-e],h=n!==void 0?n[a]:0;i[a]=i[a]+(r+h>>>1)&255}break;case Dt.paeth:for(let a=0;a<s;++a){const r=a<e?0:i[a-e],h=n!==void 0?n[a]:0,l=a<e||n===void 0?0:n[a-e],u=r+h-l,d=Math.abs(u-r),c=Math.abs(u-h),g=Math.abs(u-l);let f=0;d<=c&&d<=g?f=r:c<=g?f=h:f=l,i[a]=i[a]+f&255}break;default:throw new W(`Invalid filter value: ${t}`)}}static crc(t,e){const i=Bt.getCodePoints(t),n=mi.getChecksum({buffer:i});return mi.getChecksum({buffer:e,baseCrc:n})}processPass(t,e,i,n,s,a,r,h){let l=1;this._info.colorType===ot.grayscaleAlpha?l=2:this._info.colorType===ot.rgb?l=3:this._info.colorType===ot.rgba&&(l=4);const u=l*this._info.bits,d=u+7>>>3,c=u*r+7>>>3,g=[void 0,void 0],f=[0,0,0,0];for(let m=0,_=n,x=0;m<h;++m,_+=a,x=1-x,this._progressY++){const b=t.read();g[x]=t.readRange(c).toUint8Array();const p=g[x],w=g[1-x];De.unfilter(b,d,p,w),this.resetBits();const C=new D({buffer:p,bigEndian:!0}),y=s,A=s-i;for(let B=0,z=i;B<r;++B,z+=s)if(this.readPixel(C,f),this.setPixel(e.getPixel(z,_),f),A>1||y>1)for(let U=0;U<y;++U)for(let P=0;P<A;++P)this.setPixel(e.getPixelSafe(z+P,_+U),f)}}process(t,e){let i=1;this._info.colorType===ot.grayscaleAlpha?i=2:this._info.colorType===ot.rgb?i=3:this._info.colorType===ot.rgba&&(i=4);const n=i*this._info.bits,s=this._info.width,a=this._info.height,r=s*n+7>>>3,h=n+7>>>3,l=new Uint8Array(r),u=[l,l],d=[0,0,0,0],c=e[Symbol.iterator]();let g=c.next();for(let f=0,m=0;f<a;++f,m=1-m){const _=t.read();u[m]=t.readRange(r).toUint8Array();const x=u[m],b=u[1-m];De.unfilter(_,h,x,b),this.resetBits();const p=new D({buffer:u[m],bigEndian:!0});for(let w=0;w<s;++w)this.readPixel(p,d),this.setPixel(g.value,d),g=c.next()}}resetBits(){this._bitBuffer=0,this._bitBufferLen=0}readBits(t,e){if(e===0)return 0;if(e===8)return t.read();if(e===16)return t.readUint16();for(;this._bitBufferLen<e;){if(t.isEOS)throw new W("Invalid PNG data.");const s=t.read();this._bitBuffer=s<<this._bitBufferLen,this._bitBufferLen+=8}let i=0;switch(e){case 1:i=1;break;case 2:i=3;break;case 4:i=15;break;case 8:i=255;break;case 16:i=65535;break;default:i=0;break}const n=this._bitBuffer>>>this._bitBufferLen-e&i;return this._bitBufferLen-=e,n}readPixel(t,e){switch(this._info.colorType){case ot.grayscale:e[0]=this.readBits(t,this._info.bits);return;case ot.rgb:e[0]=this.readBits(t,this._info.bits),e[1]=this.readBits(t,this._info.bits),e[2]=this.readBits(t,this._info.bits);return;case ot.indexed:e[0]=this.readBits(t,this._info.bits);return;case ot.grayscaleAlpha:e[0]=this.readBits(t,this._info.bits),e[1]=this.readBits(t,this._info.bits);return;case ot.rgba:e[0]=this.readBits(t,this._info.bits),e[1]=this.readBits(t,this._info.bits),e[2]=this.readBits(t,this._info.bits),e[3]=this.readBits(t,this._info.bits);return}throw new W(`Invalid color type: ${this._info.colorType}.`)}setPixel(t,e){switch(this._info.colorType){case ot.grayscale:if(this._info.transparency!==void 0&&this._info.bits>8){const i=this._info.transparency,n=(i[0]&255)<<24|i[1]&255,s=e[0];t.setRgba(s,s,s,s!==n?t.maxChannelValue:0);return}t.setRgb(e[0],0,0);return;case ot.rgb:{const i=e[0],n=e[1],s=e[2];if(this._info.transparency!==void 0){const a=this._info.transparency,r=(a[0]&255)<<8|a[1]&255,h=(a[2]&255)<<8|a[3]&255,l=(a[4]&255)<<8|a[5]&255;if(e[0]!==r||e[1]!==h||e[2]!==l){t.setRgba(i,n,s,t.maxChannelValue);return}}t.setRgb(i,n,s)}return;case ot.indexed:t.index=e[0];return;case ot.grayscaleAlpha:t.setRgb(e[0],e[1],0);return;case ot.rgba:t.setRgba(e[0],e[1],e[2],e[3]);return}throw new W(`Invalid color type: ${this._info.colorType}.`)}isValidFile(t){this._input=new D({buffer:t,bigEndian:!0});const e=this._input.readRange(8),i=[137,80,78,71,13,10,26,10];for(let n=0;n<8;++n)if(e.get(n)!==i[n])return!1;return!0}startDecode(t){if(!(!this.isValidFile(t)||this._input===void 0)){for(;;){const e=this._input.position;let i=this._input.readUint32();const n=this._input.readString(4);switch(n){case"tEXt":{const s=this._input.readRange(i).toUint8Array(),a=s.length;for(let r=0;r<a;++r)if(s[r]===0){const h=Bt.latin1Decoder.decode(F.copyUint8(s,0,r)),l=Bt.latin1Decoder.decode(F.copyUint8(s,r+1));this._info.textData.set(h,l);break}this._input.skip(4)}break;case"pHYs":{const s=D.from(this._input.readRange(i)),a=s.readUint32(),r=s.readUint32(),h=s.read();this._info.pixelDimensions=new Ze(a,r,h),this._input.skip(4);break}case"IHDR":{const s=D.from(this._input.readRange(i)),a=s.toUint8Array();if(this._info.width=s.readUint32(),this._info.height=s.readUint32(),this._info.bits=s.read(),this._info.colorType=s.read(),this._info.compressionMethod=s.read(),this._info.filterMethod=s.read(),this._info.interlaceMethod=s.read(),this._info.filterMethod!==0)return;switch(this._info.colorType){case ot.grayscale:if(![1,2,4,8,16].includes(this._info.bits))return;break;case ot.rgb:if(![8,16].includes(this._info.bits))return;break;case ot.indexed:if(![1,2,4,8].includes(this._info.bits))return;break;case ot.grayscaleAlpha:if(![8,16].includes(this._info.bits))return;break;case ot.rgba:if(![8,16].includes(this._info.bits))return;break;default:return}const r=this._input.readUint32(),h=De.crc(n,a);if(r!==h)throw new W(`Invalid ${n} checksum`);break}case"PLTE":{this._info.palette=this._input.readRange(i).toUint8Array();const s=this._input.readUint32(),a=De.crc(n,this._info.palette);if(s!==a)throw new W(`Invalid ${n} checksum`);break}case"tRNS":{this._info.transparency=this._input.readRange(i).toUint8Array();const s=this._input.readUint32(),a=De.crc(n,this._info.transparency);if(s!==a)throw new W(`Invalid ${n} checksum`);break}case"IEND":{this._input.skip(4);break}case"gAMA":{if(i!==4)throw new W("Invalid gAMA chunk");const s=this._input.readUint32();this._input.skip(4),s!==1e5&&(this._info.gamma=s/1e5);break}case"IDAT":{this._info.idat.push(e),this._input.skip(i),this._input.skip(4);break}case"acTL":{this._info.numFrames=this._input.readUint32(),this._info.repeat=this._input.readUint32(),this._input.skip(4);break}case"fcTL":{const s=this._input.readUint32(),a=this._input.readUint32(),r=this._input.readUint32(),h=this._input.readUint32(),l=this._input.readUint32(),u=this._input.readUint16(),d=this._input.readUint16(),c=this._input.read(),g=this._input.read();this._input.skip(4);const f=new Hs({sequenceNumber:s,width:a,height:r,xOffset:h,yOffset:l,delayNum:u,delayDen:d,dispose:c,blend:g});this._info.frames.push(f);break}case"fdAT":{this._input.readUint32(),this._info.frames[this._info.frames.length-1].fdat.push(e),this._input.skip(i-4),this._input.skip(4);break}case"bKGD":{if(this._info.colorType===ot.indexed){const s=this._input.read();i--;const a=s*3,r=this._info.palette[a],h=this._info.palette[a+1],l=this._info.palette[a+2];if(this._info.transparency!==void 0){const u=this._info.transparency.includes(s);this._info.backgroundColor=new Ci(r,h,l,u?0:255)}else this._info.backgroundColor=new pi(r,h,l)}else this._info.colorType===ot.grayscale||this._info.colorType===ot.grayscaleAlpha?(this._input.readUint16(),i-=2):(this._info.colorType===ot.rgb||this._info.colorType===ot.rgba)&&(this._input.readUint16(),this._input.readUint16(),this._input.readUint16(),i-=24);i>0&&this._input.skip(i),this._input.skip(4);break}case"iCCP":{this._info.iccpName=this._input.readString(),this._info.iccpCompression=this._input.read(),i-=this._info.iccpName.length+2;const s=this._input.readRange(i);this._info.iccpData=s.toUint8Array(),this._input.skip(4);break}default:{this._input.skip(i),this._input.skip(4);break}}if(n==="IEND")break;if(this._input.isEOS)return}return this._info}}decodeFrame(t){if(this._input===void 0)return;let e,i=this._info.width,n=this._info.height;if(!this._info.isAnimated||t===0){let _=0;const x=this._info.idat.length,b=new Array;for(let w=0;w<x;++w){this._input.offset=this._info.idat[w];const C=this._input.readUint32(),y=this._input.readString(4),A=this._input.readRange(C).toUint8Array();_+=A.length,b.push(A);const B=this._input.readUint32(),z=De.crc(y,A);if(B!==z)throw new W(`Invalid ${y} checksum`)}e=new Uint8Array(_);let p=0;for(const w of b)e.set(w,p),p+=w.length}else{if(t<0||t>=this._info.frames.length)throw new W(`Invalid Frame Number: ${t}`);const _=this._info.frames[t];i=_.width,n=_.height;let x=0;const b=new Array;for(let w=0;w<_.fdat.length;++w){this._input.offset=_.fdat[w];const C=this._input.readUint32();this._input.readString(4),this._input.skip(4);const y=this._input.readRange(C-4).toUint8Array();x+=y.length,b.push(y)}e=new Uint8Array(x);let p=0;for(const w of b)e.set(w,p),p+=w.length}let s=this._info.colorType===ot.indexed||this._info.colorType===ot.grayscale?1:this._info.colorType===ot.grayscaleAlpha?2:this._info.colorType===ot.rgba?4:3,a;try{a=Mi(e)}catch(_){console.error(_);return}const r=new D({buffer:a,bigEndian:!0});this.resetBits();let h;if(this._info.colorType===ot.indexed&&this._info.palette!==void 0){const _=this._info.palette,x=Math.trunc(_.length/3),b=this._info.transparency,p=b!==void 0?b.length:0,w=b!==void 0?4:3;h=new ne(x,w);for(let C=0,y=0;C<x;++C,y+=3){let A=255;w===4&&C<p&&(A=b[C]),h.setRgba(C,_[y],_[y+1],_[y+2],A)}}if(this._info.colorType===ot.grayscale&&this._info.transparency!==void 0&&h===void 0&&this._info.bits<=8){const _=this._info.transparency,x=_.length,b=1<<this._info.bits;h=new ne(b,4);const p=this._info.bits===1?255:this._info.bits===2?85:this._info.bits===4?17:1;for(let w=0;w<b;++w){const C=w*p;h.setRgba(w,C,C,C,255)}for(let w=0;w<x;w+=2){const C=(_[w]&255)<<8|_[w+1]&255;C<b&&h.set(C,3,0)}}const l=this._info.bits===1?v.uint1:this._info.bits===2?v.uint2:this._info.bits===4?v.uint4:this._info.bits===16?v.uint16:v.uint8;this._info.colorType===ot.grayscale&&this._info.transparency!==void 0&&this._info.bits>8&&(s=4),this._info.colorType===ot.rgb&&this._info.transparency!==void 0&&(s=4);const u={width:i,height:n,numChannels:s,palette:h,format:l};this._info.iccpData!==void 0&&(u.iccProfile=new tn(this._info.iccpName,ei.deflate,this._info.iccpData)),this._info.textData.size>0&&(u.textData=new Map(this._info.textData));const d=new tt(u),c=this._info.width,g=this._info.height;this._info.width=i,this._info.height=n;const f=i,m=n;return this._progressY=0,this._info.interlaceMethod!==0?(this.processPass(r,d,0,0,8,8,f+7>>>3,m+7>>>3),this.processPass(r,d,4,0,8,8,f+3>>>3,m+7>>>3),this.processPass(r,d,0,4,4,8,f+3>>>2,m+3>>>3),this.processPass(r,d,2,0,4,4,f+1>>>2,m+3>>>2),this.processPass(r,d,0,2,2,4,f+1>>>1,m+1>>>2),this.processPass(r,d,1,0,2,2,f>>>1,m+1>>>1),this.processPass(r,d,0,1,1,2,f,m>>>1)):this.process(r,d),this._info.width=c,this._info.height=g,d}decode(t){var e,i;const n=t.bytes;if(this.startDecode(n)===void 0)return;if(!this._info.isAnimated||t.frameIndex!==void 0)return this.decodeFrame((e=t.frameIndex)!==null&&e!==void 0?e:0);let s,a;for(let r=0;r<this._info.numFrames;++r){const h=this._info.frames[r],l=this.decodeFrame(r);if(l===void 0)continue;if(s===void 0||a===void 0){s=l.convert({numChannels:l.numChannels}),a=s,a.frameDuration=Math.trunc(h.delay*1e3);continue}const u=this._info.frames[r-1];if(l.width===a.width&&l.height===a.height&&h.xOffset===0&&h.yOffset===0&&h.blend===Qi.source){a=l,a.frameDuration=Math.trunc(h.delay*1e3),s.addFrame(a);continue}a=tt.from(s.getFrame(r-1));const d=u.dispose;if(d===Ji.background)G.fillRect({image:a,rect:new Ki(u.xOffset,u.yOffset,u.xOffset+u.width-1,u.yOffset+u.height-1),color:(i=this._info.backgroundColor)!==null&&i!==void 0?i:new Ci(0,0,0,0),alphaBlend:!1});else if(d===Ji.previous&&r>1){const c=s.getFrame(r-2);a=G.compositeImage({dst:a,src:c,dstX:u.xOffset,dstY:u.yOffset,dstW:u.width,dstH:u.height,srcX:u.xOffset,srcY:u.yOffset,srcW:u.width,srcH:u.height})}a.frameDuration=Math.trunc(h.delay*1e3),a=G.compositeImage({dst:a,src:l,dstX:h.xOffset,dstY:h.yOffset,blend:h.blend===Qi.over?_t.alpha:_t.direct}),s.addFrame(a)}return s}}class In{get format(){return le.ico}get numFrames(){return this._info!==void 0?this._info.numFrames:0}isValidFile(t){return this._input=new D({buffer:t}),this._info=fn.read(this._input),this._info!==void 0}startDecode(t){return this._input=new D({buffer:t}),this._info=fn.read(this._input),this._info}decode(t){var e;const i=t.bytes,n=this.startDecode(i);if(n===void 0)return;if(n.images.length===1||t.frameIndex!==void 0)return this.decodeFrame((e=t.frameIndex)!==null&&e!==void 0?e:0);let s;for(let a=0;a<n.images.length;a++){const r=this.decodeFrame(a);r!==void 0&&(s===void 0?(r.frameType=hi.sequence,s=r):s.addFrame(r))}return s}decodeFrame(t){if(this._input===void 0||this._info===void 0||t>=this._info.numFrames)return;const e=this._info.images[t],i=this._input.buffer.subarray(this._input.start+e.bytesOffset,this._input.start+e.bytesOffset+e.bytesSize),n=new De;if(n.isValidFile(i))return n.decode({bytes:i});const s=new Mt({size:14});s.writeUint16(ti.signature),s.writeUint32(e.bytesSize),s.writeUint32(0),s.writeUint32(0);const a=new Ms(new D({buffer:i}),new ti(new D({buffer:s.getBytes()})));if(a.headerSize!==40&&a.planes!==1)return;let r=0;a.totalColors===0&&a.bitsPerPixel<=8?r=40+4*(1<<a.bitsPerPixel):r=40+4*a.totalColors,a.header.imageOffset=r,s.length-=4,s.writeUint32(r);const h=new D({buffer:i}),u=new Ps(h,a,!0).decodeFrame(0);if(u===void 0||a.bitsPerPixel>=32)return u;const d=32-a.width%32,c=Math.trunc((d===32?a.width:a.width+d)/8);for(let g=0;g<a.height;g++){const f=a.readBottomUp?g:u.height-1-g,m=h.readRange(c),_=u.getPixel(0,f);for(let x=0;x<a.width;){const b=m.read();for(let p=7;p>-1&&x<a.width;p--)b&1<<p&&(_.a=0),_.next(),x++}}return u}decodeImageLargest(t){const e=this.startDecode(t);if(e===void 0)return;let i=0,n=0;for(let s=0;s<e.images.length;s++){const a=e.images[s],r=a.width*a.height;r>n&&(n=r,i=s)}return this.decodeFrame(i)}}class vt{get supportsAnimation(){return this._supportsAnimation}get pixelDimensions(){return this._pixelDimensions}constructor(t){var e,i;this._repeat=0,this._frames=0,this._sequenceNumber=0,this._isAnimated=!1,this._supportsAnimation=!0,this._filter=(e=t?.filter)!==null&&e!==void 0?e:Dt.paeth,this._level=(i=t?.level)!==null&&i!==void 0?i:6,this._pixelDimensions=t?.pixelDimensions}static crc(t,e){const i=Bt.getCodePoints(t),n=mi.getChecksum({buffer:i});return mi.getChecksum({buffer:e,baseCrc:n})}static writeChunk(t,e,i){t.writeUint32(i.length);const n=Bt.getCodePoints(e);t.writeBytes(n),t.writeBytes(i);const s=vt.crc(e,i);t.writeUint32(s)}static write(t,e,i,n,s){let a=t,r=s;for(a--;a>=0;)n[r++]=e[i+a],a--;return r}static filterSub(t,e,i,n,s){let a=s;n[a++]=Dt.sub;for(let h=0;h<i;h+=e)a=vt.write(e,t,h,n,a);const r=t.length;for(let h=i;h<r;h+=e)for(let l=0,u=e-1;l<e;++l,--u)n[a++]=t[h+u]-t[h+u-i]&255;return a}static filterUp(t,e,i,n,s){let a=n;i[a++]=Dt.up;const r=t.length;for(let h=0;h<r;h+=e)for(let l=0,u=e-1;l<e;++l,--u){const d=s!==void 0?s[h+u]:0;i[a++]=t[h+u]-d&255}return a}static filterAverage(t,e,i,n,s,a){let r=s;n[r++]=Dt.average;const h=t.length;for(let l=0;l<h;l+=e)for(let u=0,d=e-1;u<e;++u,--d){const c=l+d,g=c<i?0:t[c-i],f=a===void 0?0:a[c],m=t[c];n[r++]=m-(g+f>>>1)}return r}static paethPredictor(t,e,i){const n=t+e-i,s=n>t?n-t:t-n,a=n>e?n-e:e-n,r=n>i?n-i:i-n;return s<=a&&s<=r?t:a<=r?e:i}static filterPaeth(t,e,i,n,s,a){let r=s;n[r++]=Dt.paeth;const h=t.length;for(let l=0;l<h;l+=e)for(let u=0,d=e-1;u<e;++u,--d){const c=l+d,g=c<i?0:t[c-i],f=a===void 0?0:a[c],m=c<i||a===void 0?0:a[c-i],_=t[c],x=vt.paethPredictor(g,f,m);n[r++]=_-x&255}return r}static filterNone(t,e,i,n){let s=n;if(i[s++]=Dt.none,e===1){const a=t.length;for(let r=0;r<a;++r)i[s++]=t[r]}else{const a=t.length;for(let r=0;r<a;r+=e)s=vt.write(e,t,r,i,s)}return s}static numChannels(t){return t.hasPalette?1:t.numChannels}writeHeader(t){this._output.writeBytes(new Uint8Array([137,80,78,71,13,10,26,10]));const e=new Mt({bigEndian:!0});e.writeUint32(t.width),e.writeUint32(t.height),e.writeByte(t.bitsPerChannel),e.writeByte(t.hasPalette?ot.indexed:t.numChannels===1?ot.grayscale:t.numChannels===2?ot.grayscaleAlpha:t.numChannels===3?ot.rgb:ot.rgba),e.writeByte(0),e.writeByte(0),e.writeByte(0),vt.writeChunk(this._output,"IHDR",e.getBytes())}writeICCPChunk(t){const e=new Mt({bigEndian:!0}),i=Bt.getCodePoints(t.name);e.writeBytes(i),e.writeByte(0),e.writeByte(0),e.writeBytes(t.compressed()),vt.writeChunk(this._output,"iCCP",e.getBytes())}writeAnimationControlChunk(){const t=new Mt({bigEndian:!0});t.writeUint32(this._frames),t.writeUint32(this._repeat),vt.writeChunk(this._output,"acTL",t.getBytes())}writeFrameControlChunk(t){const e=new Mt({bigEndian:!0});e.writeUint32(this._sequenceNumber),e.writeUint32(t.width),e.writeUint32(t.height),e.writeUint32(0),e.writeUint32(0),e.writeUint16(t.frameDuration),e.writeUint16(1e3),e.writeByte(1),e.writeByte(0),vt.writeChunk(this._output,"fcTL",e.getBytes())}writePalette(t){if(t.format===v.uint8&&t.numChannels===3&&t.numColors===256)vt.writeChunk(this._output,"PLTE",t.toUint8Array());else{const e=new Mt({size:t.numColors*3,bigEndian:!0}),i=t.numColors;for(let n=0;n<i;++n)e.writeByte(Math.trunc(t.getRed(n))),e.writeByte(Math.trunc(t.getGreen(n))),e.writeByte(Math.trunc(t.getBlue(n)));vt.writeChunk(this._output,"PLTE",e.getBytes())}if(t.numChannels===4){const e=new Mt({size:t.numColors,bigEndian:!0}),i=t.numColors;for(let n=0;n<i;++n){const s=Math.trunc(t.getAlpha(n));e.writeByte(s)}vt.writeChunk(this._output,"tRNS",e.getBytes())}}writeTextChunk(t,e){const i=new Mt({bigEndian:!0}),n=Bt.getCodePoints(t),s=Bt.getCodePoints(e);i.writeBytes(n),i.writeByte(0),i.writeBytes(s),vt.writeChunk(this._output,"tEXt",i.getBytes())}filter(t,e){let i=0;const n=t.hasPalette?Dt.none:this._filter,s=t.buffer,a=t.data.rowStride,h=vt.numChannels(t)*t.bitsPerChannel+7>>>3,l=t.bitsPerChannel+7>>>3;let u=0,d;for(let c=0;c<t.height;++c){const g=s!==void 0?new Uint8Array(s,u,a):new Uint8Array;switch(u+=a,n){case Dt.sub:i=vt.filterSub(g,l,h,e,i);break;case Dt.up:i=vt.filterUp(g,l,e,i,d);break;case Dt.average:i=vt.filterAverage(g,l,h,e,i,d);break;case Dt.paeth:i=vt.filterPaeth(g,l,h,e,i,d);break;default:i=vt.filterNone(g,l,e,i);break}d=g}}addFrame(t){let e=t;(e.isHdrFormat&&e.format!==v.uint16||e.bitsPerChannel<8&&!e.hasPalette&&e.numChannels>1)&&(e=e.convert({format:v.uint8})),this._output===void 0&&(this._output=new Mt({bigEndian:!0}),this.writeHeader(e),e.iccProfile!==void 0&&this.writeICCPChunk(e.iccProfile),e.hasPalette&&(this._globalQuantizer!==void 0?this.writePalette(this._globalQuantizer.palette):this.writePalette(e.palette)),this._isAnimated&&this.writeAnimationControlChunk());const i=vt.numChannels(e),n=e.format===v.uint16?2:1,s=new Uint8Array(e.width*e.height*i*n+t.height);this.filter(e,s);const a=hs(s,{level:this._level});if(e.textData!==void 0)for(const[r,h]of e.textData)this.writeTextChunk(r,h);if(this._pixelDimensions!==void 0){const r=new Mt({bigEndian:!0});r.writeUint32(this._pixelDimensions.xPxPerUnit),r.writeUint32(this._pixelDimensions.yPxPerUnit),r.writeByte(this._pixelDimensions.unitSpecifier),vt.writeChunk(this._output,"pHYs",r.getBytes())}if(this._isAnimated&&(this.writeFrameControlChunk(e),this._sequenceNumber++),this._sequenceNumber<=1)vt.writeChunk(this._output,"IDAT",a);else{const r=new Mt({bigEndian:!0});r.writeUint32(this._sequenceNumber),r.writeBytes(a),vt.writeChunk(this._output,"fdAT",r.getBytes()),this._sequenceNumber++}}start(t){this._frames=t,this._isAnimated=t>1}finish(){let t;return this._output===void 0||(vt.writeChunk(this._output,"IEND",new Uint8Array),this._sequenceNumber=0,t=this._output.getBytes(),this._output=void 0),t}encode(t){var e;const i=t.image,n=(e=t.singleFrame)!==null&&e!==void 0?e:!1;if(!i.hasAnimation||n)this.start(1),this.addFrame(i);else{if(this.start(i.frames.length),this._repeat=i.loopCount,i.hasPalette){const s=new it(i);this._globalQuantizer=s;for(const a of i.frames)a!==i&&s.addImage(a)}for(const s of i.frames)if(this._globalQuantizer!==void 0){const a=this._globalQuantizer.getIndexImage(s);this.addFrame(a)}else this.addFrame(s)}return this.finish()}}class Es{constructor(){this._type=0,this._supportsAnimation=!0}get type(){return this._type}get supportsAnimation(){return this._supportsAnimation}colorPlanesOrXHotSpot(t){return 0}bitsPerPixelOrYHotSpot(t){return 0}encode(t){var e;const i=t.image,n=(e=t.singleFrame)!==null&&e!==void 0?e:!1;return i.hasAnimation&&!n?this.encodeImages(i.frames):this.encodeImages([i])}encodeImages(t){const e=t.length,i=new Mt;i.writeUint16(0),i.writeUint16(this._type),i.writeUint16(e);let n=6+e*16;const s=[];let a=0;for(const r of t){if(r.width>256||r.height>256)throw new W("ICO and CUR support only sizes until 256");i.writeByte(r.width),i.writeByte(r.height),i.writeByte(0),i.writeByte(0),i.writeUint16(this.colorPlanesOrXHotSpot(a)),i.writeUint16(this.bitsPerPixelOrYHotSpot(a));const h=new vt().encode({image:r});i.writeUint32(h.length),i.writeUint32(n),n+=h.length,a++,s.push(h)}for(const r of s)i.writeBytes(r);return i.getBytes()}}class ls extends Es{constructor(){super(...arguments),this._type=1}colorPlanesOrXHotSpot(t){return 0}bitsPerPixelOrYHotSpot(t){return 32}}class Ys{get hSamples(){return this._hSamples}get maxHSamples(){return this._maxHSamples}get vSamples(){return this._vSamples}get maxVSamples(){return this._maxVSamples}get lines(){return this._lines}get hScaleShift(){return this._hScaleShift}get vScaleShift(){return this._vScaleShift}constructor(t,e,i,n,s){this._hSamples=t,this._maxHSamples=e,this._vSamples=i,this._maxVSamples=n,this._lines=s,this._hScaleShift=this._hSamples===this._maxHSamples?0:this._hSamples===1&&this._maxHSamples===4?2:1,this._vScaleShift=this._vSamples===this._maxVSamples?0:this._vSamples===1&&this._maxVSamples===4?2:1}}class Gs{get version(){return this._version}get flags0(){return this._flags0}get flags1(){return this._flags1}get transformCode(){return this._transformCode}constructor(t,e,i,n){this._version=t,this._flags0=e,this._flags1=i,this._transformCode=n}}class $s{get hSamples(){return this._hSamples}get vSamples(){return this._vSamples}get blocks(){return this._blocks}get blocksPerLine(){return this._blocksPerLine}get blocksPerColumn(){return this._blocksPerColumn}set huffmanTableDC(t){this._huffmanTableDC=t}get huffmanTableDC(){return this._huffmanTableDC}set huffmanTableAC(t){this._huffmanTableAC=t}get huffmanTableAC(){return this._huffmanTableAC}set pred(t){this._pred=t}get pred(){return this._pred}get quantizationTable(){return this._quantizationTableList[this._quantizationIndex]}constructor(t,e,i,n){this._blocks=new Array,this._blocksPerLine=0,this._blocksPerColumn=0,this._huffmanTableDC=[],this._huffmanTableAC=[],this._pred=0,this._hSamples=t,this._vSamples=e,this._quantizationTableList=i,this._quantizationIndex=n}setBlocks(t,e,i){this._blocks=t,this._blocksPerLine=e,this._blocksPerColumn=i}}class Ws{get components(){return this._components}get componentsOrder(){return this._componentsOrder}get extended(){return this._extended}get progressive(){return this._progressive}get precision(){return this._precision}get scanLines(){return this._scanLines}get samplesPerLine(){return this._samplesPerLine}get maxHSamples(){return this._maxHSamples}get maxVSamples(){return this._maxVSamples}get mcusPerLine(){return this._mcusPerLine}get mcusPerColumn(){return this._mcusPerColumn}constructor(t,e,i,n,s,a,r){this._maxHSamples=0,this._maxVSamples=0,this._mcusPerLine=0,this._mcusPerColumn=0,this._components=t,this._componentsOrder=e,this._extended=i,this._progressive=n,this._precision=s,this._scanLines=a,this._samplesPerLine=r}prepare(){for(const[t,e]of this._components)this._maxHSamples=Math.max(this._maxHSamples,e.hSamples),this._maxVSamples=Math.max(this._maxVSamples,e.vSamples);this._mcusPerLine=Math.ceil(this._samplesPerLine/8/this._maxHSamples),this._mcusPerColumn=Math.ceil(this._scanLines/8/this._maxVSamples);for(const[t,e]of this._components){const i=Math.ceil(Math.ceil(this._samplesPerLine/8)*e.hSamples/this._maxHSamples),n=Math.ceil(Math.ceil(this._scanLines/8)*e.vSamples/this.maxVSamples),s=this._mcusPerLine*e.hSamples,a=this._mcusPerColumn*e.vSamples,r=F.generate(a,h=>F.generate(s,l=>new Int32Array(64)));e.setBlocks(r,i,n)}}}class kn{constructor(){this._children=[],this._index=0}get children(){return this._children}get index(){return this._index}incrementIndex(){this._index++}}class Xs{constructor(){this._width=0,this._height=0,this._numFrames=1,this._backgroundColor=void 0,this._numComponents=0}get width(){return this._width}get height(){return this._height}get numFrames(){return this._numFrames}get backgroundColor(){return this._backgroundColor}get numComponents(){return this._numComponents}set numComponents(t){this._numComponents=t}setSize(t,e){this._width=t,this._height=e}}class js{get thumbWidth(){return this._thumbWidth}get thumbHeight(){return this._thumbHeight}get majorVersion(){return this._majorVersion}get minorVersion(){return this._minorVersion}get densityUnits(){return this._densityUnits}get xDensity(){return this._xDensity}get yDensity(){return this._yDensity}get thumbData(){return this._thumbData}constructor(t,e,i,n,s,a,r,h){this._thumbWidth=t,this._thumbHeight=e,this._majorVersion=i,this._minorVersion=n,this._densityUnits=s,this._xDensity=a,this._yDensity=r,this._thumbData=h}}class he{static createDctClip(){const t=new Uint8Array(he._dctClipLength);let e=0;for(e=-256;e<0;++e)t[he._dctClipOffset+e]=0;for(e=0;e<256;++e)t[he._dctClipOffset+e]=e;for(e=256;e<512;++e)t[he._dctClipOffset+e]=255;return t}static quantizeAndInverse(t,e,i,n){const s=n,a=4017,r=799,h=3406,l=2276,u=1567,d=3784,c=5793,g=2896;for(let m=0;m<64;m++)s[m]=e[m]*t[m];let f=0;for(let m=0;m<8;++m,f+=8){if(s[1+f]===0&&s[2+f]===0&&s[3+f]===0&&s[4+f]===0&&s[5+f]===0&&s[6+f]===0&&s[7+f]===0){const z=q.sshR(c*s[0+f]+512,10);s[f+0]=z,s[f+1]=z,s[f+2]=z,s[f+3]=z,s[f+4]=z,s[f+5]=z,s[f+6]=z,s[f+7]=z;continue}let _=q.sshR(c*s[0+f]+128,8),x=q.sshR(c*s[4+f]+128,8),b=s[2+f],p=s[6+f],w=q.sshR(g*(s[1+f]-s[7+f])+128,8),C=q.sshR(g*(s[1+f]+s[7+f])+128,8),y=s[3+f]<<4,A=s[5+f]<<4,B=q.sshR(_-x+1,1);_=q.sshR(_+x+1,1),x=B,B=q.sshR(b*d+p*u+128,8),b=q.sshR(b*u-p*d+128,8),p=B,B=q.sshR(w-A+1,1),w=q.sshR(w+A+1,1),A=B,B=q.sshR(C+y+1,1),y=q.sshR(C-y+1,1),C=B,B=q.sshR(_-p+1,1),_=q.sshR(_+p+1,1),p=B,B=q.sshR(x-b+1,1),x=q.sshR(x+b+1,1),b=B,B=q.sshR(w*l+C*h+2048,12),w=q.sshR(w*h-C*l+2048,12),C=B,B=q.sshR(y*r+A*a+2048,12),y=q.sshR(y*a-A*r+2048,12),A=B,s[0+f]=_+C,s[7+f]=_-C,s[1+f]=x+A,s[6+f]=x-A,s[2+f]=b+y,s[5+f]=b-y,s[3+f]=p+w,s[4+f]=p-w}for(let m=0;m<8;++m){const _=m;if(s[1*8+_]===0&&s[2*8+_]===0&&s[3*8+_]===0&&s[4*8+_]===0&&s[5*8+_]===0&&s[6*8+_]===0&&s[7*8+_]===0){const U=q.sshR(c*n[m]+8192,14);s[0*8+_]=U,s[1*8+_]=U,s[2*8+_]=U,s[3*8+_]=U,s[4*8+_]=U,s[5*8+_]=U,s[6*8+_]=U,s[7*8+_]=U;continue}let x=q.sshR(c*s[0*8+_]+2048,12),b=q.sshR(c*s[4*8+_]+2048,12),p=s[2*8+_],w=s[6*8+_],C=q.sshR(g*(s[1*8+_]-s[7*8+_])+2048,12),y=q.sshR(g*(s[1*8+_]+s[7*8+_])+2048,12),A=s[3*8+_],B=s[5*8+_],z=q.sshR(x-b+1,1);x=q.sshR(x+b+1,1),b=z,z=q.sshR(p*d+w*u+2048,12),p=q.sshR(p*u-w*d+2048,12),w=z,z=q.sshR(C-B+1,1),C=q.sshR(C+B+1,1),B=z,z=q.sshR(y+A+1,1),A=q.sshR(y-A+1,1),y=z,z=q.sshR(x-w+1,1),x=q.sshR(x+w+1,1),w=z,z=q.sshR(b-p+1,1),b=q.sshR(b+p+1,1),p=z,z=q.sshR(C*l+y*h+2048,12),C=q.sshR(C*h-y*l+2048,12),y=z,z=q.sshR(A*r+B*a+2048,12),A=q.sshR(A*a-B*r+2048,12),B=z,s[0*8+_]=x+y,s[7*8+_]=x-y,s[1*8+_]=b+B,s[6*8+_]=b-B,s[2*8+_]=p+A,s[5*8+_]=p-A,s[3*8+_]=w+C,s[4*8+_]=w-C}for(let m=0;m<64;++m){const _=he._dctClipOffset+128+q.sshR(s[m]+8,4);if(_<0)break;i[m]=he._dctClip[_]}}static getImageFromJpeg(t){const e=t.exifData.imageIfd.hasOrientation?t.exifData.imageIfd.orientation:0,i=t.width,n=t.height,s=e>=5&&e<=8,a=s?n:i,r=s?i:n,h=new tt({width:a,height:r});h.exifData=me.from(t.exifData),h.exifData.imageIfd.orientation=void 0;let l,u,d,c,g,f,m,_,x=!1;const b=n-1,p=i-1;switch(t.components.length){case 1:{l=t.components[0];const w=l.lines,C=l.hScaleShift,y=l.vScaleShift;for(let A=0;A<n;A++){const B=A>>>y;g=w[B];for(let z=0;z<i;z++){const U=z>>>C,P=g[U];e===2?h.setPixelRgb(p-z,A,P,P,P):e===3?h.setPixelRgb(p-z,b-A,P,P,P):e===4?h.setPixelRgb(z,b-A,P,P,P):e===5?h.setPixelRgb(A,z,P,P,P):e===6?h.setPixelRgb(b-A,z,P,P,P):e===7?h.setPixelRgb(b-A,p-z,P,P,P):e===8?h.setPixelRgb(A,p-z,P,P,P):h.setPixelRgb(z,A,P,P,P)}}}break;case 2:break;case 3:{x=!0,l=t.components[0],u=t.components[1],d=t.components[2];const w=l.lines,C=u.lines,y=d.lines,A=l.hScaleShift,B=l.vScaleShift,z=u.hScaleShift,U=u.vScaleShift,P=d.hScaleShift,L=d.vScaleShift;for(let V=0;V<n;V++){const T=V>>>B,H=V>>>U,Y=V>>>L;g=w[T],f=C[H],m=y[Y];for(let j=0;j<i;j++){const ut=j>>>A,ct=j>>>z,ft=j>>>P,at=g[ut]<<8,mt=f[ct]-128,xt=m[ft]-128;let St=at+359*xt+128,yt=at-88*mt-183*xt+128,Ct=at+454*mt+128;St=k.clampInt255(q.sshR(St,8)),yt=k.clampInt255(q.sshR(yt,8)),Ct=k.clampInt255(q.sshR(Ct,8)),e===2?h.setPixelRgb(p-j,V,St,yt,Ct):e===3?h.setPixelRgb(p-j,b-V,St,yt,Ct):e===4?h.setPixelRgb(j,b-V,St,yt,Ct):e===5?h.setPixelRgb(V,j,St,yt,Ct):e===6?h.setPixelRgb(b-V,j,St,yt,Ct):e===7?h.setPixelRgb(b-V,p-j,St,yt,Ct):e===8?h.setPixelRgb(V,p-j,St,yt,Ct):h.setPixelRgb(j,V,St,yt,Ct)}}}break;case 4:{if(t.adobe===void 0)throw new W("Unsupported color mode (4 components)");x=!1,t.adobe.transformCode!==0&&(x=!0),l=t.components[0],u=t.components[1],d=t.components[2],c=t.components[3];const w=l.lines,C=u.lines,y=d.lines,A=c.lines,B=l.hScaleShift,z=l.vScaleShift,U=u.hScaleShift,P=u.vScaleShift,L=d.hScaleShift,V=d.vScaleShift,T=c.hScaleShift,H=c.vScaleShift;for(let Y=0;Y<t.height;Y++){const j=Y>>>z,ut=Y>>>P,ct=Y>>>V,ft=Y>>>H;g=w[j],f=C[ut],m=y[ct],_=A[ft];for(let at=0;at<t.width;at++){const mt=at>>>B,xt=at>>>U,St=at>>>L,yt=at>>>T;let Ct=0,Ut=0,qt=0,Kt=0;if(!x)Ct=g[mt],Ut=f[xt],qt=m[St],Kt=_[yt];else{qt=g[mt];const Ft=f[xt],Gt=m[St];Kt=_[yt],Ct=255-k.clampInt255(qt+1.402*(Gt-128)),Ut=255-k.clampInt255(qt-.3441363*(Ft-128)-.71413636*(Gt-128)),qt=255-k.clampInt255(qt+1.772*(Ft-128))}const Et=q.sshR(Ct*Kt,8),At=q.sshR(Ut*Kt,8),Yt=q.sshR(qt*Kt,8);e===2?h.setPixelRgb(p-at,Y,Et,At,Yt):e===3?h.setPixelRgb(p-at,b-Y,Et,At,Yt):e===4?h.setPixelRgb(at,b-Y,Et,At,Yt):e===5?h.setPixelRgb(Y,at,Et,At,Yt):e===6?h.setPixelRgb(b-Y,at,Et,At,Yt):e===7?h.setPixelRgb(b-Y,p-at,Et,At,Yt):e===8?h.setPixelRgb(Y,p-at,Et,At,Yt):h.setPixelRgb(at,Y,Et,At,Yt)}}}break;default:throw new W("Unsupported color mode")}return t.iccProfile!==void 0&&(h.iccProfile=t.iccProfile),h}}he._dctClipOffset=256;he._dctClipLength=768;he._dctClip=he.createDctClip();class os{}class gn extends os{get children(){return this._children}constructor(t){super(),this._children=t}}class us extends os{get value(){return this._value}constructor(t){super(),this._value=t}}var Z;(function(o){o[o.sof0=192]="sof0",o[o.sof1=193]="sof1",o[o.sof2=194]="sof2",o[o.sof3=195]="sof3",o[o.sof5=197]="sof5",o[o.sof6=198]="sof6",o[o.sof7=199]="sof7",o[o.jpg=200]="jpg",o[o.sof9=201]="sof9",o[o.sof10=202]="sof10",o[o.sof11=203]="sof11",o[o.sof13=205]="sof13",o[o.sof14=206]="sof14",o[o.sof15=207]="sof15",o[o.dht=196]="dht",o[o.dac=204]="dac",o[o.rst0=208]="rst0",o[o.rst1=209]="rst1",o[o.rst2=210]="rst2",o[o.rst3=211]="rst3",o[o.rst4=212]="rst4",o[o.rst5=213]="rst5",o[o.rst6=214]="rst6",o[o.rst7=215]="rst7",o[o.soi=216]="soi",o[o.eoi=217]="eoi",o[o.sos=218]="sos",o[o.dqt=219]="dqt",o[o.dnl=220]="dnl",o[o.dri=221]="dri",o[o.dhp=222]="dhp",o[o.exp=223]="exp",o[o.app0=224]="app0",o[o.app1=225]="app1",o[o.app2=226]="app2",o[o.app3=227]="app3",o[o.app4=228]="app4",o[o.app5=229]="app5",o[o.app6=230]="app6",o[o.app7=231]="app7",o[o.app8=232]="app8",o[o.app9=233]="app9",o[o.app10=234]="app10",o[o.app11=235]="app11",o[o.app12=236]="app12",o[o.app13=237]="app13",o[o.app14=238]="app14",o[o.app15=239]="app15",o[o.jpg0=240]="jpg0",o[o.jpg13=253]="jpg13",o[o.com=254]="com",o[o.tem=1]="tem",o[o.error=256]="error"})(Z||(Z={}));class Zs{get input(){return this._input}get frame(){return this._frame}get precision(){return this._precision}get samplesPerLine(){return this._samplesPerLine}get scanLines(){return this._scanLines}get mcusPerLine(){return this._mcusPerLine}get progressive(){return this._progressive}get maxH(){return this._maxH}get maxV(){return this._maxV}get components(){return this._components}get resetInterval(){return this._resetInterval}get spectralStart(){return this._spectralStart}get spectralEnd(){return this._spectralEnd}get successivePrev(){return this._successivePrev}get successive(){return this._successive}get bitsData(){return this._bitsData}get bitsCount(){return this._bitsCount}get eobrun(){return this._eobrun}get successiveACState(){return this._successiveACState}get successiveACNextValue(){return this._successiveACNextValue}constructor(t,e,i,n,s,a,r,h){this._bitsData=0,this._bitsCount=0,this._eobrun=0,this._successiveACState=0,this._successiveACNextValue=0,this._input=t,this._frame=e,this._precision=e.precision,this._samplesPerLine=e.samplesPerLine,this._scanLines=e.scanLines,this._mcusPerLine=e.mcusPerLine,this._progressive=e.progressive,this._maxH=e.maxHSamples,this._maxV=e.maxVSamples,this._components=i,this._resetInterval=h,this._spectralStart=n,this._spectralEnd=s,this._successivePrev=a,this._successive=r}readBit(){if(this.bitsCount>0)return this._bitsCount--,this._bitsData>>>this._bitsCount&1;if(!this._input.isEOS&&(this._bitsData=this._input.read(),!(this._bitsData===255&&this.input.read()!==0)))return this._bitsCount=7,this._bitsData>>>7&1}decodeHuffman(t){let e=new gn(t),i;for(;(i=this.readBit())!==void 0;)if(e instanceof gn&&(e=e.children[i]),e instanceof us)return e.value}receive(t){let e=0,i=t;for(;i>0;){const n=this.readBit();if(n===void 0)return;e=e<<1|n,i--}return e}receiveAndExtend(t){if(t===void 0)return 0;if(t===1)return this.readBit()===1?1:-1;const e=this.receive(t);return e===void 0?0:e>=1<<(t??0)-1?e:e+(-1<<(t??0))+1}decodeBaseline(t,e){const i=this.decodeHuffman(t.huffmanTableDC),n=i===0?0:this.receiveAndExtend(i);t.pred+=n,e[0]=t.pred;let s=1;for(;s<64;){const a=this.decodeHuffman(t.huffmanTableAC);if(a===void 0)break;let r=a&15;const h=a>>>4;if(r===0){if(h<15)break;s+=16;continue}s+=h,r=this.receiveAndExtend(r);const l=zt.dctZigZag[s];e[l]=r,s++}}decodeDCFirst(t,e){const i=this.decodeHuffman(t.huffmanTableDC),n=i===0?0:this.receiveAndExtend(i)<<this._successive;t.pred+=n,e[0]=t.pred}decodeDCSuccessive(t,e){e[0]|=this.readBit()<<this._successive}decodeACFirst(t,e){if(this._eobrun>0){this._eobrun--;return}let i=this._spectralStart;const n=this._spectralEnd;for(;i<=n;){const s=this.decodeHuffman(t.huffmanTableAC),a=s&15,r=s>>>4;if(a===0){if(r<15){this._eobrun=this.receive(r)+(1<<r)-1;break}i+=16;continue}i+=r;const h=zt.dctZigZag[i];e[h]=this.receiveAndExtend(a)*(1<<this._successive),i++}}decodeACSuccessive(t,e){let i=this._spectralStart;const n=this._spectralEnd;let s=0,a=0;for(;i<=n;){const r=zt.dctZigZag[i];switch(this._successiveACState){case 0:{const h=this.decodeHuffman(t.huffmanTableAC);if(h===void 0)throw new W("Invalid progressive encoding");if(s=h&15,a=h>>>4,s===0)a<15?(this._eobrun=this.receive(a)+(1<<a),this._successiveACState=4):(a=16,this._successiveACState=1);else{if(s!==1)throw new W("invalid ACn encoding");this._successiveACNextValue=this.receiveAndExtend(s),this._successiveACState=a!==0?2:3}continue}case 1:case 2:{e[r]!==0?e[r]+=this.readBit()<<this._successive:(a--,a===0&&(this._successiveACState=this._successiveACState===2?3:0));break}case 3:{e[r]!==0?e[r]+=this.readBit()<<this._successive:(e[r]=this._successiveACNextValue<<this._successive,this._successiveACState=0);break}case 4:{e[r]!==0&&(e[r]+=this.readBit()<<this._successive);break}}i++}this._successiveACState===4&&(this._eobrun--,this._eobrun===0&&(this._successiveACState=0))}decodeMcu(t,e,i,n,s){const a=Math.floor(i/this._mcusPerLine),r=i%this._mcusPerLine,h=a*t.vSamples+n,l=r*t.hSamples+s;if(h>=t.blocks.length)return;const u=t.blocks[h].length;l>=u||e.call(this,t,t.blocks[h][l])}decodeBlock(t,e,i){const n=Math.floor(i/t.blocksPerLine),s=i%t.blocksPerLine;e.call(this,t,t.blocks[n][s])}decode(){const t=this._components.length;let e,i;this._progressive?this._spectralStart===0?i=this._successivePrev===0?this.decodeDCFirst:this.decodeDCSuccessive:i=this._successivePrev===0?this.decodeACFirst:this.decodeACSuccessive:i=this.decodeBaseline;let n=0,s;t===1?s=this._components[0].blocksPerLine*this._components[0].blocksPerColumn:s=this._mcusPerLine*this._frame.mcusPerColumn,(this._resetInterval===void 0||this._resetInterval===0)&&(this._resetInterval=s);let a,r;for(;n<s;){for(let u=0;u<t;u++)this._components[u].pred=0;if(this._eobrun=0,t===1){e=this._components[0];for(let u=0;u<this._resetInterval;u++)this.decodeBlock(e,i,n),n++}else for(let u=0;u<this._resetInterval;u++){for(let d=0;d<t;d++){e=this.components[d],a=e.hSamples,r=e.vSamples;for(let c=0;c<r;c++)for(let g=0;g<a;g++)this.decodeMcu(e,i,n,c,g)}n++}this._bitsCount=0;const h=this._input.get(0),l=this._input.get(1);if(h===255)if(l>=Z.rst0&&l<=Z.rst7)this._input.skip(2);else break}}}class zt{constructor(){this._exifData=new me,this._quantizationTables=F.fill(zt.numQuantizationTables,void 0),this._frames=new Array,this._huffmanTablesAC=[],this._huffmanTablesDC=[],this._components=new Array}get input(){return this._input}get jfif(){return this._jfif}get adobe(){return this._adobe}get frame(){return this._frame}get resetInterval(){return this._resetInterval}get comment(){return this._comment}get iccProfile(){return this._iccProfile}get exifData(){return this._exifData}get quantizationTables(){return this._quantizationTables}get frames(){return this._frames}get huffmanTablesAC(){return this._huffmanTablesAC}get huffmanTablesDC(){return this._huffmanTablesDC}get components(){return this._components}get width(){return this._frame.samplesPerLine}get height(){return this._frame.scanLines}readMarkers(){let t=this.nextMarker();if(t!==Z.soi)throw new W("Start Of Image marker not found.");for(t=this.nextMarker();t!==Z.eoi&&!this._input.isEOS;){const e=this.readBlock();switch(t){case Z.app0:case Z.app1:case Z.app2:case Z.app3:case Z.app4:case Z.app5:case Z.app6:case Z.app7:case Z.app8:case Z.app9:case Z.app10:case Z.app11:case Z.app12:case Z.app13:case Z.app14:case Z.app15:case Z.com:this.readAppData(t,e);break;case Z.dqt:this.readDQT(e);break;case Z.sof0:case Z.sof1:case Z.sof2:this.readFrame(t,e);break;case Z.sof3:case Z.sof5:case Z.sof6:case Z.sof7:case Z.jpg:case Z.sof9:case Z.sof10:case Z.sof11:case Z.sof13:case Z.sof14:case Z.sof15:throw new W(`Unhandled frame type ${t.toString(16)}`);case Z.dht:this.readDHT(e);break;case Z.dri:this.readDRI(e);break;case Z.sos:this.readSOS(e);break;case 255:this._input.get(0)!==255&&this._input.skip(-1);break;default:if(this._input.get(-3)===255&&this._input.get(-2)>=192&&this._input.get(-2)<=254){this._input.skip(-3);break}if(t!==0)throw new W(`Unknown JPEG marker ${t.toString(16)}`);break}t=this.nextMarker()}}skipBlock(){const t=this._input.readUint16();if(t<2)throw new W("Invalid Block");this._input.skip(t-2)}validate(t){this._input=new D({buffer:t,bigEndian:!0});const e=this._input.peek(2);if(e.get(0)!==255||e.get(1)!==216)return!1;let i=this.nextMarker();if(i!==Z.soi)return!1;let n=!1,s=!1;for(i=this.nextMarker();i!==Z.eoi&&!this._input.isEOS;){const a=this._input.readUint16();if(a<2)break;switch(this._input.skip(a-2),i){case Z.sof0:case Z.sof1:case Z.sof2:n=!0;break;case Z.sos:s=!0;break}i=this.nextMarker()}return n&&s}readInfo(t){this._input=new D({buffer:t,bigEndian:!0});let e=this.nextMarker();if(e!==Z.soi)return;const i=new Xs;let n=!1,s=!1;for(e=this.nextMarker();e!==Z.eoi&&!this._input.isEOS;){switch(e){case Z.sof0:case Z.sof1:case Z.sof2:n=!0,this.readFrame(e,this.readBlock());break;case Z.sos:s=!0,this.skipBlock();break;default:this.skipBlock();break}e=this.nextMarker()}return this._frame!==void 0&&(i.setSize(this._frame.samplesPerLine,this._frame.scanLines),i.numComponents=this._frame.components.size,this._frame=void 0),this.frames.length=0,n&&s?i:void 0}read(t){if(this._input=new D({buffer:t,bigEndian:!0}),this.readMarkers(),this._frames.length!==1)throw new W("Only single frame JPEGs supported");if(this._frame!==void 0)for(let e=0;e<this._frame.componentsOrder.length;++e){const i=this._frame.components.get(this._frame.componentsOrder[e]);i!==void 0&&this.components.push(new Ys(i.hSamples,this._frame.maxHSamples,i.vSamples,this._frame.maxVSamples,zt.buildComponentData(i)))}}getImage(){return he.getImageFromJpeg(this)}static buildHuffmanTable(t,e){let i=0;const n=new Array;let s=16;for(;s>0&&t[s-1]===0;)s--;n.push(new kn);let a=n[0];for(let r=0;r<s;r++){for(let h=0;h<t[r];h++){for(a=n.pop(),a.children.length<=a.index&&(a.children.length=a.index+1),a.children[a.index]=new us(e[i]);a.index>0;)a=n.pop();for(a.incrementIndex(),n.push(a);n.length<=r;){const l=new kn;n.push(l),a.children.length<=a.index&&(a.children.length=a.index+1),a.children[a.index]=new gn(l.children),a=l}i++}if(r+1<s){const h=new kn;n.push(h),a.children.length<=a.index&&(a.children.length=a.index+1),a.children[a.index]=new gn(h.children),a=h}}return n[0].children}static buildComponentData(t){const e=t.blocksPerLine,i=t.blocksPerColumn,n=e<<3,s=new Int32Array(64),a=new Uint8Array(64),r=F.fill(i*8,void 0);let h=0;for(let l=0;l<i;l++){const u=l<<3;for(let d=0;d<8;d++)r[h++]=new Uint8Array(n);for(let d=0;d<e;d++){he.quantizeAndInverse(t.quantizationTable,t.blocks[l][d],a,s);let c=0;const g=d<<3;for(let f=0;f<8;f++){const m=r[u+f];for(let _=0;_<8;_++)m[g+_]=a[c++]}}}return r}static toFix(t){return Math.trunc(t*1048576)&4294967295}readBlock(){const t=this._input.readUint16();if(t<2)throw new W("Invalid Block");return this._input.readRange(t-2)}nextMarker(){let t=0;if(this._input.isEOS)return t;do{do t=this._input.read();while(t!==255&&!this._input.isEOS);if(this._input.isEOS)return t;do t=this._input.read();while(t===255&&!this._input.isEOS)}while(t===0&&!this._input.isEOS);return t}readIccProfile(t){const e=[73,67,67,95,80,82,79,70,73,76,69,0];for(let n=0;n<e.length;n++)if(t.read()!==e[n])return;const i=t.toUint8Array();this._iccProfile=new tn("ICC_PROFILE",ei.none,i)}readExifData(t){t.readUint32()===1165519206&&t.readUint16()===0&&this.exifData.read(t)}readAppData(t,e){const i=e;if(t===Z.app0){if(i.get(0)===74&&i.get(1)===70&&i.get(2)===73&&i.get(3)===70&&i.get(4)===0){const n=i.get(5),s=i.get(6),a=i.get(7),r=i.get(8)<<8|i.get(9),h=i.get(10)<<8|i.get(11),l=i.get(12),u=i.get(13),d=3*l*u,c=i.subarray(14+d,void 0,14);this._jfif=new js(l,u,n,s,a,r,h,c)}}else if(t===Z.app1)this.readExifData(i);else if(t===Z.app2)this.readIccProfile(i);else if(t===Z.app14){if(i.get(0)===65&&i.get(1)===100&&i.get(2)===111&&i.get(3)===98&&i.get(4)===101&&i.get(5)===0){const n=i.get(6),s=i.get(7)<<8|i.get(8),a=i.get(9)<<8|i.get(10),r=i.get(11);this._adobe=new Gs(n,s,a,r)}}else if(t===Z.com)try{this._comment=i.readStringUtf8()}catch{}}readDQT(t){for(;!t.isEOS;){let e=t.read();const i=e>>>4;if(e&=15,e>=zt.numQuantizationTables)throw new W("Invalid number of quantization tables");this._quantizationTables[e]===void 0&&(this._quantizationTables[e]=new Int16Array(64));const n=this._quantizationTables[e];if(n!==void 0)for(let s=0;s<zt.dctSize2;s++){const a=i!==0?t.readUint16():t.read();n[zt.dctZigZag[s]]=a}}if(!t.isEOS)throw new W("Bad length for DQT block")}readFrame(t,e){if(this._frame!==void 0)throw new W("Duplicate JPG frame data found.");const i=t===Z.sof1,n=t===Z.sof2,s=e.read(),a=e.readUint16(),r=e.readUint16(),h=e.read(),l=new Map,u=new Array;for(let d=0;d<h;d++){const c=e.read(),g=e.read(),f=g>>>4&15,m=g&15,_=e.read();u.push(c);const x=new $s(f,m,this._quantizationTables,_);l.set(c,x)}this._frame=new Ws(l,u,i,n,s,a,r),this._frame.prepare(),this.frames.push(this._frame)}readDHT(t){for(;!t.isEOS;){let e=t.read();const i=new Uint8Array(16);let n=0;for(let r=0;r<16;r++)i[r]=t.read(),n+=i[r];const s=t.readRange(n).toUint8Array();let a=[];e&16?(e-=16,a=this._huffmanTablesAC):a=this._huffmanTablesDC,a.length<=e&&(a.length=e+1),a[e]=zt.buildHuffmanTable(i,s)}}readDRI(t){this._resetInterval=t.readUint16()}readSOS(t){const e=t.read();if(e<1||e>zt.maxCompsInScan)throw new W("Invalid SOS block");const i=new Array;for(let u=0;u<e;u++){const d=t.read(),c=t.read();if(!this._frame.components.has(d))throw new W("Invalid Component in SOS block");const g=this._frame.components.get(d);if(g!==void 0){const f=c>>>4&15,m=c&15;f<this._huffmanTablesDC.length&&(g.huffmanTableDC=this._huffmanTablesDC[f]),m<this._huffmanTablesAC.length&&(g.huffmanTableAC=this._huffmanTablesAC[m]),i.push(g)}}const n=t.read(),s=t.read(),a=t.read(),r=a>>>4&15,h=a&15;new Zs(this._input,this._frame,i,n,s,r,h,this._resetInterval).decode()}}zt.dctZigZag=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63];zt.dctSize=8;zt.dctSize2=64;zt.numQuantizationTables=4;zt.numHuffmanTables=4;zt.numArithTables=16;zt.maxCompsInScan=4;zt.maxSamplingFactor=4;class cs{get format(){return le.jpg}get numFrames(){return this._info!==void 0?this._info.numFrames:0}isValidFile(t){return new zt().validate(t)}startDecode(t){return this._input=new D({buffer:t,bigEndian:!0}),this._info=new zt().readInfo(t),this._info}decodeFrame(t){if(this._input===void 0)return;const e=new zt;if(e.read(this._input.buffer),e.frames.length!==1)throw new W("Only single frame JPEGs supported.");return e.getImage()}decode(t){const e=t.bytes,i=new zt;if(i.read(e),i.frames.length!==1)throw new W("Only single frame JPEGs supported.");return i.getImage()}}var Ri;(function(o){o[o.yuv444=0]="yuv444",o[o.yuv420=1]="yuv420"})(Ri||(Ri={}));class nt{get supportsAnimation(){return this._supportsAnimation}constructor(t=100){this._tableY=new Uint8Array(64),this._tableUv=new Uint8Array(64),this._fdTableY=new Float32Array(64),this._fdTableUv=new Float32Array(64),this._bitCode=F.fill(65535,void 0),this._category=F.fill(65535,void 0),this._outputfDCTQuant=F.fill(64,void 0),this._du=F.fill(64,void 0),this._tableRgbYuv=new Int32Array(2048),this._byteNew=0,this._bytePos=7,this._supportsAnimation=!1,this.initHuffmanTable(),this.initCategoryNumber(),this.initRgbYuvTable(),this.setQuality(t)}static computeHuffmanTable(t,e){let i=0,n=0;const s=new Array;for(let a=1;a<=16;a++){for(let r=1;r<=t[a];r++){const h=e[n];s.length<=h&&(s.length=h+1),s[h]=[i,a],n++,i++}i*=2}return s}static downsampleDU(t,e,i,n,s){for(let a=0;a<64;a++){const r=a<32?a%8<4?e:i:a%8<4?n:s,h=(Math.trunc(a%32/8)<<4)+(a%4<<1);t[a]=(r[h]+r[h+1]+r[h+8]+r[h+9])/4}}static writeMarker(t,e){t.writeByte(255),t.writeByte(e&255)}static writeAPP0(t){nt.writeMarker(t,Z.app0),t.writeUint16(16),t.writeByte(74),t.writeByte(70),t.writeByte(73),t.writeByte(70),t.writeByte(0),t.writeByte(1),t.writeByte(1),t.writeByte(0),t.writeUint16(1),t.writeUint16(1),t.writeByte(0),t.writeByte(0)}static writeExif(t,e){if(e.isEmpty)return;const i=new Mt;e.write(i);const n=i.getBytes();this.writeMarker(t,Z.app1);const s=1165519206;t.writeUint16(n.length+8),t.writeUint32(s),t.writeUint16(0),t.writeBytes(n)}static writeICCProfile(t,e){this.writeMarker(t,Z.app2);const i=e.decompressed(),n=12+2+i.length,s=new Uint8Array([73,67,67,95,80,82,79,70,73,76,69,0]);t.writeUint16(n),t.writeBytes(s),t.writeBytes(i)}static writeSOF0(t,e,i,n){nt.writeMarker(t,Z.sof0),t.writeUint16(17),t.writeByte(8),t.writeUint16(i),t.writeUint16(e),t.writeByte(3),t.writeByte(1),t.writeByte(n===Ri.yuv444?17:34),t.writeByte(0),t.writeByte(2),t.writeByte(17),t.writeByte(1),t.writeByte(3),t.writeByte(17),t.writeByte(1)}static writeSOS(t){nt.writeMarker(t,Z.sos),t.writeUint16(12),t.writeByte(3),t.writeByte(1),t.writeByte(0),t.writeByte(2),t.writeByte(17),t.writeByte(3),t.writeByte(17),t.writeByte(0),t.writeByte(63),t.writeByte(0)}static writeDHT(t){nt.writeMarker(t,Z.dht),t.writeUint16(418),t.writeByte(0);for(let e=0;e<16;e++)t.writeByte(nt._stdDcLuminanceNrCodes[e+1]);for(let e=0;e<=11;e++)t.writeByte(nt._stdDcLuminanceValues[e]);t.writeByte(16);for(let e=0;e<16;e++)t.writeByte(nt._stdAcLuminanceNrCodes[e+1]);for(let e=0;e<=161;e++)t.writeByte(nt._stdAcLuminanceValues[e]);t.writeByte(1);for(let e=0;e<16;e++)t.writeByte(nt._stdDcChrominanceNrCodes[e+1]);for(let e=0;e<=11;e++)t.writeByte(nt._stdDcChrominanceValues[e]);t.writeByte(17);for(let e=0;e<16;e++)t.writeByte(nt._stdAcChrominanceNrCodes[e+1]);for(let e=0;e<=161;e++)t.writeByte(nt._stdAcChrominanceValues[e])}calculateYUV(t,e,i,n,s,a,r,h,l){for(let u=0;u<64;u++){const d=u>>>3,c=u&7;let g=i+d,f=e+c;g>=s&&(g-=i+1+d-s),f>=n&&(f-=e+c-n+1);let m=t.getPixel(f,g);if(m.format!==v.uint8&&(m=m.convert({format:v.uint8})),m.length>3){const p=m.aNormalized,w=1-p;m.r=Math.round(m.r*p+l.r*w),m.g=Math.round(m.g*p+l.g*w),m.b=Math.round(m.b*p+l.b*w)}const _=Math.trunc(m.r),x=Math.trunc(m.g),b=Math.trunc(m.b);a[u]=(this._tableRgbYuv[_]+this._tableRgbYuv[x+256]+this._tableRgbYuv[b+512]>>>16)-128,r[u]=(this._tableRgbYuv[_+768]+this._tableRgbYuv[x+1024]+this._tableRgbYuv[b+1280]>>>16)-128,h[u]=(this._tableRgbYuv[_+1280]+this._tableRgbYuv[x+1536]+this._tableRgbYuv[b+1792]>>>16)-128}}initHuffmanTable(){this._ydcHuffman=nt.computeHuffmanTable(nt._stdDcLuminanceNrCodes,nt._stdDcLuminanceValues),this._uvdcHuffman=nt.computeHuffmanTable(nt._stdDcChrominanceNrCodes,nt._stdDcChrominanceValues),this._yacHuffman=nt.computeHuffmanTable(nt._stdAcLuminanceNrCodes,nt._stdAcLuminanceValues),this._uvacHuffman=nt.computeHuffmanTable(nt._stdAcChrominanceNrCodes,nt._stdAcChrominanceValues)}initCategoryNumber(){let t=1,e=2;for(let i=1;i<=15;i++){for(let n=t;n<e;n++)this._category[32767+n]=i,this._bitCode[32767+n]=[n,i];for(let n=-(e-1);n<=-t;n++)this._category[32767+n]=i,this._bitCode[32767+n]=[e-1+n,i];t<<=1,e<<=1}}initRgbYuvTable(){for(let t=0;t<256;t++)this._tableRgbYuv[t]=19595*t,this._tableRgbYuv[t+256]=38470*t,this._tableRgbYuv[t+512]=7471*t+32768,this._tableRgbYuv[t+768]=-11059*t,this._tableRgbYuv[t+1024]=-21709*t,this._tableRgbYuv[t+1280]=32768*t+8421375,this._tableRgbYuv[t+1536]=-27439*t,this._tableRgbYuv[t+1792]=-5329*t}setQuality(t){const e=k.clampInt(t,1,100);if(this._currentQuality===e)return;let i=0;e<50?i=Math.floor(5e3/e):i=Math.floor(200-e*2),this.initQuantTables(i),this._currentQuality=e}initQuantTables(t){const e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(let a=0;a<64;a++){let r=Math.floor((e[a]*t+50)/100);r<1?r=1:r>255&&(r=255),this._tableY[nt._zigzag[a]]=r}const i=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(let a=0;a<64;a++){let r=Math.floor((i[a]*t+50)/100);r<1?r=1:r>255&&(r=255),this._tableUv[nt._zigzag[a]]=r}const n=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379];let s=0;for(let a=0;a<8;a++)for(let r=0;r<8;r++)this._fdTableY[s]=1/(this._tableY[nt._zigzag[s]]*n[a]*n[r]*8),this._fdTableUv[s]=1/(this._tableUv[nt._zigzag[s]]*n[a]*n[r]*8),s++}fDCTQuant(t,e){let i=0;for(let n=0;n<8;++n){const s=t[i],a=t[i+1],r=t[i+2],h=t[i+3],l=t[i+4],u=t[i+5],d=t[i+6],c=t[i+7],g=s+c,f=s-c,m=a+d,_=a-d,x=r+u,b=r-u,p=h+l,w=h-l;let C=g+p;const y=g-p;let A=m+x,B=m-x;t[i]=C+A,t[i+4]=C-A;const z=(B+y)*.707106781;t[i+2]=y+z,t[i+6]=y-z,C=w+b,A=b+_,B=_+f;const U=(C-B)*.382683433,P=.5411961*C+U,L=1.306562965*B+U,V=A*.707106781,T=f+V,H=f-V;t[i+5]=H+P,t[i+3]=H-P,t[i+1]=T+L,t[i+7]=T-L,i+=8}i=0;for(let n=0;n<8;++n){const s=t[i],a=t[i+8],r=t[i+16],h=t[i+24],l=t[i+32],u=t[i+40],d=t[i+48],c=t[i+56],g=s+c,f=s-c,m=a+d,_=a-d,x=r+u,b=r-u,p=h+l,w=h-l;let C=g+p;const y=g-p;let A=m+x,B=m-x;t[i]=C+A,t[i+32]=C-A;const z=(B+y)*.707106781;t[i+16]=y+z,t[i+48]=y-z,C=w+b,A=b+_,B=_+f;const U=(C-B)*.382683433,P=.5411961*C+U,L=1.306562965*B+U,V=A*.707106781,T=f+V,H=f-V;t[i+40]=H+P,t[i+24]=H-P,t[i+8]=T+L,t[i+56]=T-L,i++}for(let n=0;n<64;++n){const s=t[n]*e[n];this._outputfDCTQuant[n]=s>0?Math.trunc(s+.5):Math.trunc(s-.5)}return this._outputfDCTQuant}writeDQT(t){nt.writeMarker(t,Z.dqt),t.writeUint16(132),t.writeByte(0);for(let e=0;e<64;e++)t.writeByte(this._tableY[e]);t.writeByte(1);for(let e=0;e<64;e++)t.writeByte(this._tableUv[e])}writeBits(t,e){const i=e[0];let n=e[1]-1;for(;n>=0;)i&1<<n&&(this._byteNew|=1<<this._bytePos),n--,this._bytePos--,this._bytePos<0&&(this._byteNew===255?(t.writeByte(255),t.writeByte(0)):t.writeByte(this._byteNew),this._bytePos=7,this._byteNew=0)}resetBits(){this._byteNew=0,this._bytePos=7}processDU(t,e,i,n,s,a){const r=s[0],h=s[240],l=16,u=63,d=64,c=this.fDCTQuant(e,i);let g=n,f=0;for(let b=0;b<d;++b)this._du[nt._zigzag[b]]=c[b];const m=this._du[0]-g;g=this._du[0],m===0?this.writeBits(t,a[0]):(f=32767+m,this.writeBits(t,a[this._category[f]]),this.writeBits(t,this._bitCode[f]));let _=63;for(;_>0&&this._du[_]===0;_--);if(_===0)return this.writeBits(t,r),g;let x=1;for(;x<=_;){const b=x;for(;this._du[x]===0&&x<=_;++x);let p=x-b;if(p>=l){const w=p>>>4;for(let C=1;C<=w;++C)this.writeBits(t,h);p&=15}f=32767+this._du[x],this.writeBits(t,s[(p<<4)+this._category[f]]),this.writeBits(t,this._bitCode[f]),x++}return _!==u&&this.writeBits(t,r),g}encode(t){var e,i,n;const s=(e=t.skipExif)!==null&&e!==void 0?e:!1,a=t.image,r=(i=t.chroma)!==null&&i!==void 0?i:Ri.yuv444,h=new Mt({bigEndian:!0});nt.writeMarker(h,Z.soi),nt.writeAPP0(h),s||nt.writeExif(h,a.exifData),a.iccProfile!==void 0&&nt.writeICCProfile(h,a.iccProfile),this.writeDQT(h),nt.writeSOF0(h,a.width,a.height,r),nt.writeDHT(h),nt.writeSOS(h),this.resetBits();const l=a.width,u=a.height,d=(n=a.backgroundColor)!==null&&n!==void 0?n:nt._backgroundColor;let c=0,g=0,f=0;if(r===Ri.yuv444){const m=new Float32Array(64),_=new Float32Array(64),x=new Float32Array(64);for(let b=0;b<u;b+=8)for(let p=0;p<l;p+=8)this.calculateYUV(a,p,b,l,u,m,_,x,d),c=this.processDU(h,m,this._fdTableY,c,this._yacHuffman,this._ydcHuffman),g=this.processDU(h,_,this._fdTableUv,g,this._uvacHuffman,this._uvdcHuffman),f=this.processDU(h,x,this._fdTableUv,f,this._uvacHuffman,this._uvdcHuffman)}else{const m=F.generate(4,w=>new Float32Array(64)),_=F.generate(4,w=>new Float32Array(64)),x=F.generate(4,w=>new Float32Array(64)),b=new Float32Array(64),p=new Float32Array(64);for(let w=0;w<u;w+=16)for(let C=0;C<l;C+=16)this.calculateYUV(a,C,w,l,u,m[0],_[0],x[0],d),this.calculateYUV(a,C+8,w,l,u,m[1],_[1],x[1],d),this.calculateYUV(a,C,w+8,l,u,m[2],_[2],x[2],d),this.calculateYUV(a,C+8,w+8,l,u,m[3],_[3],x[3],d),nt.downsampleDU(b,_[0],_[1],_[2],_[3]),nt.downsampleDU(p,x[0],x[1],x[2],x[3]),c=this.processDU(h,m[0],this._fdTableY,c,this._yacHuffman,this._ydcHuffman),c=this.processDU(h,m[1],this._fdTableY,c,this._yacHuffman,this._ydcHuffman),c=this.processDU(h,m[2],this._fdTableY,c,this._yacHuffman,this._ydcHuffman),c=this.processDU(h,m[3],this._fdTableY,c,this._yacHuffman,this._ydcHuffman),g=this.processDU(h,b,this._fdTableUv,g,this._uvacHuffman,this._uvdcHuffman),f=this.processDU(h,p,this._fdTableUv,f,this._uvacHuffman,this._uvdcHuffman)}if(this._bytePos>=0){const m=[(1<<this._bytePos+1)-1,this._bytePos+1];this.writeBits(h,m)}return nt.writeMarker(h,Z.eoi),h.getBytes()}}nt._zigzag=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];nt._stdDcLuminanceNrCodes=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];nt._stdDcLuminanceValues=[0,1,2,3,4,5,6,7,8,9,10,11];nt._stdAcLuminanceNrCodes=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];nt._stdAcLuminanceValues=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];nt._stdDcChrominanceNrCodes=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];nt._stdDcChrominanceValues=[0,1,2,3,4,5,6,7,8,9,10,11];nt._stdAcChrominanceNrCodes=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];nt._stdAcChrominanceValues=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];nt._backgroundColor=new pi(255,255,255);var Ne;(function(o){o[o.none=0]="none",o[o.palette=1]="palette",o[o.rgb=2]="rgb",o[o.gray=3]="gray",o[o.reserved4=4]="reserved4",o[o.reserved5=5]="reserved5",o[o.reserved6=6]="reserved6",o[o.reserved7=7]="reserved7",o[o.reserved8=8]="reserved8",o[o.paletteRle=9]="paletteRle",o[o.rgbRle=10]="rgbRle",o[o.grayRle=11]="grayRle"})(Ne||(Ne={}));const Ks=12;class En{constructor(){this._numFrames=1,this._backgroundColor=void 0,this._idLength=0,this._colorMapType=0,this._imageType=Ne.none,this._colorMapOrigin=0,this._colorMapLength=0,this._colorMapDepth=0,this._offsetX=0,this._offsetY=0,this._width=0,this._height=0,this._pixelDepth=0,this._flags=0,this._screenOrigin=0,this._imageOffset=0}get numFrames(){return this._numFrames}get backgroundColor(){return this._backgroundColor}get idLength(){return this._idLength}get colorMapType(){return this._colorMapType}get imageType(){return this._imageType}get colorMapOrigin(){return this._colorMapOrigin}get colorMapLength(){return this._colorMapLength}get colorMapDepth(){return this._colorMapDepth}get offsetX(){return this._offsetX}get offsetY(){return this._offsetY}get width(){return this._width}get height(){return this._height}get pixelDepth(){return this._pixelDepth}get flags(){return this._flags}get colorMap(){return this._colorMap}set colorMap(t){this._colorMap=t}get screenOrigin(){return this._screenOrigin}get imageOffset(){return this._imageOffset}set imageOffset(t){this._imageOffset=t}get hasColorMap(){return this._imageType===Ne.palette||this._imageType===Ne.paletteRle}read(t){if(t.length<18)return;this._idLength=t.read(),this._colorMapType=t.read();const e=t.read();this._imageType=e<Ks?e:Ne.none,this._colorMapOrigin=t.readUint16(),this._colorMapLength=t.readUint16(),this._colorMapDepth=t.read(),this._offsetX=t.readUint16(),this._offsetY=t.readUint16(),this._width=t.readUint16(),this._height=t.readUint16(),this._pixelDepth=t.read(),this._flags=t.read(),this._screenOrigin=(this._flags&48)>>>4}isValid(){if(this._pixelDepth!==8&&this._pixelDepth!==16&&this._pixelDepth!==24&&this._pixelDepth!==32)return!1;if(this.hasColorMap){if(this._colorMapLength>256||this._colorMapType!==1||this._colorMapDepth!==16&&this._colorMapDepth!==24&&this._colorMapDepth!==32)return!1}else if(this._colorMapType===1)return!1;return!0}}class Qs{constructor(){this._input=void 0,this._info=void 0}get format(){return le.tga}get numFrames(){return this._info!==void 0?1:0}decodeColorMap(t,e){if(this._info===void 0||this._input===void 0)return;const i=new D({buffer:t});if(this._info.colorMapDepth===16){const n=this._input.readUint16(),s=(n&31744)>>>7,a=(n&992)>>>2,r=(n&31)<<3,h=n&32768?0:255;for(let l=0;l<this._info.colorMapLength;++l)e.setRed(l,s),e.setGreen(l,a),e.setBlue(l,r),e.setAlpha(l,h)}else{const n=this._info.colorMapDepth===32;for(let s=0;s<this._info.colorMapLength;++s){const a=i.read(),r=i.read(),h=i.read(),l=n?i.read():255;e.setRed(s,h),e.setGreen(s,r),e.setBlue(s,a),e.setAlpha(s,l)}}}decodeRle(){if(this._info===void 0||this._input===void 0)return;const t=this._info.pixelDepth,e=t===16||t===32,i=new tt({width:this._info.width,height:this._info.height,numChannels:e?4:3,withPalette:this._info.hasColorMap}),n=128,s=127;i.palette!==void 0&&this._info.colorMap!==void 0&&this.decodeColorMap(this._info.colorMap,i.palette);const a=i.width;let h=i.height-1,l=0;for(;!this._input.isEOS&&h>=0;){const u=this._input.read(),d=(u&s)+1;if(u&n)if(t===8){const c=this._input.read();for(let g=0;g<d&&(i.setPixelR(l++,h,c),!(l>=a&&(l=0,h--,h<0)));++g);}else if(t===16){const c=this._input.readUint16(),g=(c&31744)>>>7,f=(c&992)>>>2,m=(c&31)<<3,_=c&32768?0:255;for(let x=0;x<d&&(i.setPixelRgba(l++,h,g,f,m,_),!(l>=a&&(l=0,h--,h<0)));++x);}else{const c=this._input.read(),g=this._input.read(),f=this._input.read(),m=e?this._input.read():255;for(let _=0;_<d&&(i.setPixelRgba(l++,h,f,g,c,m),!(l>=a&&(l=0,h--,h<0)));++_);}else if(t===8)for(let c=0;c<d;++c){const g=this._input.read();if(i.setPixelR(l++,h,g),l>=a&&(l=0,h--,h<0))break}else if(t===16)for(let c=0;c<d;++c){const g=this._input.readUint16(),f=(g&31744)>>>7,m=(g&992)>>>2,_=(g&31)<<3,x=g&32768?0:255;if(i.setPixelRgba(l++,h,f,m,_,x),this._input.isEOS||l>=a&&(l=0,h--,h<0))break}else for(let c=0;c<d;++c){const g=this._input.read(),f=this._input.read(),m=this._input.read(),_=e?this._input.read():255;if(i.setPixelRgba(l++,h,m,f,g,_),l>=a&&(l=0,h--,h<0))break}if(l>=a&&(l=0,h--,h<0))break}return i}decodeRgb(){if(this._info===void 0||this._input===void 0)return;this._input.offset=this._info.imageOffset;const t=this._info.pixelDepth,e=t===16||t===32||this._info.hasColorMap&&(this._info.colorMapDepth===16||this._info.colorMapDepth===32),i=new tt({width:this._info.width,height:this._info.height,numChannels:e?4:3,withPalette:this._info.hasColorMap});if(this._info.hasColorMap&&this.decodeColorMap(this._info.colorMap,i.palette),t===8)for(let n=i.height-1;n>=0;--n)for(let s=0;s<i.width;++s){const a=this._input.read();i.setPixelR(s,n,a)}else if(t===16)for(let n=i.height-1;n>=0;--n)for(let s=0;s<i.width;++s){const a=this._input.readUint16(),r=(a&31744)>>>7,h=(a&992)>>>2,l=(a&31)<<3,u=a&32768?0:255;i.setPixelRgba(s,n,r,h,l,u)}else for(let n=i.height-1;n>=0;--n)for(let s=0;s<i.width;++s){const a=this._input.read(),r=this._input.read(),h=this._input.read(),l=e?this._input.read():255;i.setPixelRgba(s,n,h,r,a,l)}return i}isValidFile(t){const e=new D({buffer:t});return this._info=new En,this._info.read(e),this._info.isValid()}startDecode(t){this._info=new En,this._input=new D({buffer:t});const e=this._input.readRange(18);if(this._info.read(e),!!this._info.isValid()){if(this._input.skip(this._info.idLength),this._info.hasColorMap){const i=this._info.colorMapLength*(this._info.colorMapDepth>>>3);this._info.colorMap=this._input.readRange(i).toUint8Array()}return this._info.imageOffset=this._input.offset,this._info}}decode(t){var e;const i=t.bytes;if(this.startDecode(i)!==void 0)return this.decodeFrame((e=t.frameIndex)!==null&&e!==void 0?e:0)}decodeFrame(t){if(!(this._info===void 0||this._input===void 0)){if(this._info.imageType===Ne.rgb)return this.decodeRgb();if(this._info.imageType===Ne.rgbRle||this._info.imageType===Ne.paletteRle)return this.decodeRle();if(this._info.imageType===Ne.palette)return this.decodeRgb()}}}class Js{constructor(){this._supportsAnimation=!1}get supportsAnimation(){return this._supportsAnimation}encode(t){var e,i;const n=t.image,s=new Mt({bigEndian:!0}),a=new Uint8Array(18);a.fill(0),a[2]=2,a[12]=n.width&255,a[13]=n.width>>>8&255,a[14]=n.height&255,a[15]=n.height>>>8&255;const r=(i=(e=n.palette)===null||e===void 0?void 0:e.numChannels)!==null&&i!==void 0?i:n.numChannels;if(a[16]=r===3?24:32,s.writeBytes(a),r===4)for(let h=n.height-1;h>=0;--h)for(let l=0;l<n.width;++l){const u=n.getPixel(l,h);s.writeByte(Math.trunc(u.b)),s.writeByte(Math.trunc(u.g)),s.writeByte(Math.trunc(u.r)),s.writeByte(Math.trunc(u.a))}else for(let h=n.height-1;h>=0;--h)for(let l=0;l<n.width;++l){const u=n.getPixel(l,h);s.writeByte(Math.trunc(u.b)),s.writeByte(Math.trunc(u.g)),s.writeByte(Math.trunc(u.r))}return s.getBytes()}}class en{constructor(t){this._bitBuffer=0,this._bitPosition=0,this._input=t}readBits(t){let e=t;if(e===0)return 0;this._bitPosition===0&&(this._bitPosition=8,this._bitBuffer=this._input.read());let i=0;for(;e>this._bitPosition;)i=(i<<this._bitPosition)+(this._bitBuffer&en._bitMask[this._bitPosition]),e-=this._bitPosition,this._bitPosition=8,this._bitBuffer=this._input.read();return e>0&&(this._bitPosition===0&&(this._bitPosition=8,this._bitBuffer=this._input.read()),i=(i<<e)+(this._bitBuffer>>>this._bitPosition-e&en._bitMask[e]),this._bitPosition-=e),i}readByte(){return this.readBits(8)}flushByte(){return this._bitPosition=0}}en._bitMask=[0,1,3,7,15,31,63,127,255];var Nt;(function(o){o[o.none=1]="none",o[o.ccittRle=2]="ccittRle",o[o.ccittFax3=3]="ccittFax3",o[o.ccittFax4=4]="ccittFax4",o[o.lzw=5]="lzw",o[o.oldJpeg=6]="oldJpeg",o[o.jpeg=7]="jpeg",o[o.next=32766]="next",o[o.ccittRlew=32771]="ccittRlew",o[o.packBits=32773]="packBits",o[o.thunderScan=32809]="thunderScan",o[o.it8ctpad=32895]="it8ctpad",o[o.tt8lw=32896]="tt8lw",o[o.it8mp=32897]="it8mp",o[o.it8bl=32898]="it8bl",o[o.pixarFilm=32908]="pixarFilm",o[o.pixarLog=32909]="pixarLog",o[o.deflate=32946]="deflate",o[o.zip=8]="zip",o[o.dcs=32947]="dcs",o[o.jbig=34661]="jbig",o[o.sgiLog=34676]="sgiLog",o[o.sgiLog24=34677]="sgiLog24",o[o.jp2000=34712]="jp2000"})(Nt||(Nt={}));class ta{get tag(){return this._tag}get type(){return this._type}get count(){return this._count}get valueOffset(){return this._valueOffset}get value(){return this._value}get p(){return this._p}get isValid(){return this._type!==N.none}get typeSize(){return this.isValid?_n[this._type]:0}get isString(){return this._type===N.ascii}constructor(t){this._tag=t.tag,this._type=t.type,this._count=t.count,this._p=t.p,this._valueOffset=t.valueOffset}read(){if(this._value!==void 0)return this._value;this._p.offset=this._valueOffset;const t=this.p.readRange(this._count*this.typeSize);switch(this._type){case N.byte:return this._value=Qe.data(t,this._count);case N.ascii:return this._value=Zt.data(t,this._count);case N.undefined:return this._value=Qe.data(t,this._count);case N.short:return this._value=ue.data(t,this._count);case N.long:return this._value=ze.data(t,this._count);case N.rational:return this._value=ce.data(t,this._count);case N.single:return this._value=ri.data(t,this._count);case N.double:return this._value=Ie.data(t,this._count);case N.sByte:return this._value=ii.data(t,this._count);case N.sShort:return this._value=si.data(t,this._count);case N.sLong:return this._value=ai.data(t,this._count);case N.sRational:return this._value=Ue.data(t,this._count);default:case N.ifd:case N.none:return}}toString(){const t=Rn.get(this._tag);return t!==void 0?`${t.name}: ${this._type} ${this._count}`:`${this.constructor.name} (<${this._tag}>: ${this._type} ${this._count})`}}class dt{get width(){return this._width}get height(){return this._height}get fillOrder(){return this._fillOrder}constructor(t){this._changingElemSize=0,this._bitPointer=0,this._bytePointer=0,this._lastChangingElement=0,this._compression=2,this._uncompressedMode=0,this._fillBits=0,this._oneD=0,this._fillOrder=t.fillOrder,this._width=t.width,this._height=t.height,this._prevChangingElements=new Array(this._width),this._prevChangingElements.fill(0),this._currChangingElements=new Array(this._width),this._currChangingElements.fill(0)}nextNBits(t){let e=0,i=0,n=0;const s=this._data.length-1,a=this._bytePointer;if(this._fillOrder===1)e=this._data.get(a),a===s?(i=0,n=0):a+1===s?(i=this._data.get(a+1),n=0):(i=this._data.get(a+1),n=this._data.get(a+2));else if(this._fillOrder===2)e=dt._flipTable[this._data.get(a)&255],a===s?(i=0,n=0):a+1===s?(i=dt._flipTable[this._data.get(a+1)&255],n=0):(i=dt._flipTable[this._data.get(a+1)&255],n=dt._flipTable[this._data.get(a+2)&255]);else throw new W("TIFFFaxDecoder7");const r=8-this._bitPointer;let h=t-r,l=0;h>8&&(l=h-8,h=8),this._bytePointer=this._bytePointer+1;const u=(e&dt._table1[r])<<t-r;let d=(i&dt._table2[h])>>>8-h,c=0;return l!==0?(d<<=l,c=(n&dt._table2[l])>>>8-l,d|=c,this._bytePointer+=1,this._bitPointer=l):h===8?(this._bitPointer=0,this._bytePointer+=1):this._bitPointer=h,u|d}nextLesserThan8Bits(t){let e=0,i=0;const n=this._data.length-1,s=this._bytePointer;if(this._fillOrder===1)e=this._data.get(s),s===n?i=0:i=this._data.get(s+1);else if(this._fillOrder===2)e=dt._flipTable[this._data.get(s)&255],s===n?i=0:i=dt._flipTable[this._data.get(s+1)&255];else throw new W("TIFFFaxDecoder7");const a=8-this._bitPointer,r=t-a,h=a-t;let l=0,u=0;return h>=0?(l=(e&dt._table1[a])>>>h,this._bitPointer+=t,this._bitPointer===8&&(this._bitPointer=0,this._bytePointer+=1)):(l=(e&dt._table1[a])<<-h,u=(i&dt._table2[r])>>>8-r,l|=u,this._bytePointer+=1,this._bitPointer=r),l}updatePointer(t){const e=this._bitPointer-t;e<0?(this._bytePointer-=1,this._bitPointer=8+e):this._bitPointer=e}advancePointer(){return this._bitPointer!==0&&(this._bytePointer+=1,this._bitPointer=0),!0}setToBlack(t,e,i,n){let s=8*e+i;const a=s+n;let r=s>>>3;const h=s&7;if(h>0){let l=1<<7-h,u=t.get(r);for(;l>0&&s<a;)u|=l,l>>>=1,++s;t.set(r,u)}for(r=s>>>3;s<a-7;)t.set(r++,255),s+=8;for(;s<a;)r=s>>>3,t.set(r,t.get(r)|1<<7-(s&7)),++s}decodeNextScanline(t,e,i){let n=i,s=0,a=0,r=0,h=0,l=0,u=0,d=!0;for(this._changingElemSize=0;n<this._width;){for(;d;)if(h=this.nextNBits(10),l=dt._white[h],r=l&1,s=l>>>1&15,s===12)u=this.nextLesserThan8Bits(2),h=h<<2&12|u,l=dt._additionalMakeup[h],s=l>>>1&7,a=l>>>4&4095,n+=a,this.updatePointer(4-s);else{if(s===0)throw new W("TIFFFaxDecoder0");if(s===15)throw new W("TIFFFaxDecoder1");a=l>>>5&2047,n+=a,this.updatePointer(10-s),r===0&&(d=!1,this._currChangingElements[this._changingElemSize++]=n)}if(n===this._width){this._compression===2&&this.advancePointer();break}for(;d===!1;)if(h=this.nextLesserThan8Bits(4),l=dt._initBlack[h],r=l&1,s=l>>>1&15,a=l>>>5&2047,a===100)if(h=this.nextNBits(9),l=dt._black[h],r=l&1,s=l>>>1&15,a=l>>>5&2047,s===12)this.updatePointer(5),h=this.nextLesserThan8Bits(4),l=dt._additionalMakeup[h],s=l>>>1&7,a=l>>>4&4095,this.setToBlack(t,e,n,a),n+=a,this.updatePointer(4-s);else{if(s===15)throw new W("TIFFFaxDecoder2");this.setToBlack(t,e,n,a),n+=a,this.updatePointer(9-s),r===0&&(d=!0,this._currChangingElements[this._changingElemSize++]=n)}else a===200?(h=this.nextLesserThan8Bits(2),l=dt._twoBitBlack[h],a=l>>>5&2047,s=l>>>1&15,this.setToBlack(t,e,n,a),n+=a,this.updatePointer(2-s),d=!0,this._currChangingElements[this._changingElemSize++]=n):(this.setToBlack(t,e,n,a),n+=a,this.updatePointer(4-s),d=!0,this._currChangingElements[this._changingElemSize++]=n);if(n===this._width){this._compression===2&&this.advancePointer();break}}this._currChangingElements[this._changingElemSize++]=n}readEOL(){if(this._fillBits===0){if(this.nextNBits(12)!==1)throw new W("TIFFFaxDecoder6")}else if(this._fillBits===1){const t=8-this._bitPointer;if(this.nextNBits(t)!==0)throw new W("TIFFFaxDecoder8");if(t<4&&this.nextNBits(8)!==0)throw new W("TIFFFaxDecoder8");let e=0;for(;(e=this.nextNBits(8))!==1;)if(e!==0)throw new W("TIFFFaxDecoder8")}return this._oneD===0?1:this.nextLesserThan8Bits(1)}getNextChangingElement(t,e,i){const n=this._prevChangingElements,s=this._changingElemSize;let a=this._lastChangingElement>0?this._lastChangingElement-1:0;e?a&=-2:a|=1;let r=a;for(;r<s;r+=2){const h=n[r];if(h>t){this._lastChangingElement=r,i[0]=h;break}}r+1<s&&(i[1]=n[r+1])}decodeWhiteCodeWord(){let t=0,e=0,i=0,n=0,s=0,a=-1,r=0,h=!0;for(;h;)if(t=this.nextNBits(10),e=dt._white[t],n=e&1,i=e>>>1&15,i===12)s=this.nextLesserThan8Bits(2),t=t<<2&12|s,e=dt._additionalMakeup[t],i=e>>>1&7,a=e>>>4&4095,r+=a,this.updatePointer(4-i);else{if(i===0)throw new W("TIFFFaxDecoder0");if(i===15)throw new W("TIFFFaxDecoder1");a=e>>>5&2047,r+=a,this.updatePointer(10-i),n===0&&(h=!1)}return r}decodeBlackCodeWord(){let t=0,e=0,i=0,n=0,s=-1,a=0,r=!1;for(;!r;)if(t=this.nextLesserThan8Bits(4),e=dt._initBlack[t],n=e&1,i=e>>>1&15,s=e>>>5&2047,s===100)if(t=this.nextNBits(9),e=dt._black[t],n=e&1,i=e>>>1&15,s=e>>>5&2047,i===12)this.updatePointer(5),t=this.nextLesserThan8Bits(4),e=dt._additionalMakeup[t],i=e>>>1&7,s=e>>>4&4095,a+=s,this.updatePointer(4-i);else{if(i===15)throw new W("TIFFFaxDecoder2");a+=s,this.updatePointer(9-i),n===0&&(r=!0)}else s===200?(t=this.nextLesserThan8Bits(2),e=dt._twoBitBlack[t],s=e>>>5&2047,a+=s,i=e>>>1&15,this.updatePointer(2-i),r=!0):(a+=s,this.updatePointer(4-i),r=!0);return a}decode1D(t,e,i,n){this._data=e,this._bitPointer=0,this._bytePointer=0;let s=0;const a=Math.trunc((this._width+7)/8);for(let r=0;r<n;r++)this.decodeNextScanline(t,s,i),s+=a}decode2D(t,e,i,n,s){this._data=e,this._compression=3,this._bitPointer=0,this._bytePointer=0;const a=Math.trunc((this._width+7)/8);let r=0,h=0,l=0,u=0,d=0,c=!1,g=0,f;const m=new Array(2);if(m.fill(0),this._oneD=s&1,this._uncompressedMode=(s&2)>>>1,this._fillBits=(s&4)>>>2,this.readEOL()!==1)throw new W("TIFFFaxDecoder3");let _=0,x=0;this.decodeNextScanline(t,_,i),_+=a;for(let b=1;b<n;b++){if(this.readEOL()===0){for(f=this._prevChangingElements,this._prevChangingElements=this._currChangingElements,this._currChangingElements=f,g=0,r=-1,c=!0,x=i,this._lastChangingElement=0;x<this._width;){this.getNextChangingElement(r,c,m);const p=m[0],w=m[1];if(l=this.nextLesserThan8Bits(7),l=dt._twoDCodes[l]&255,u=(l&120)>>>3,d=l&7,u===0)c||this.setToBlack(t,_,x,w-x),r=w,x=r,this.updatePointer(7-d);else if(u===1){this.updatePointer(7-d);let C=0;c?(C=this.decodeWhiteCodeWord(),x+=C,this._currChangingElements[g++]=x,C=this.decodeBlackCodeWord(),this.setToBlack(t,_,x,C),x+=C,this._currChangingElements[g++]=x):(C=this.decodeBlackCodeWord(),this.setToBlack(t,_,x,C),x+=C,this._currChangingElements[g++]=x,C=this.decodeWhiteCodeWord(),x+=C,this._currChangingElements[g++]=x),r=x}else if(u<=8)h=p+(u-5),this._currChangingElements[g++]=h,c||this.setToBlack(t,_,x,h-x),r=h,x=r,c=!c,this.updatePointer(7-d);else throw new W("TIFFFaxDecoder4")}this._currChangingElements[g++]=x,this._changingElemSize=g}else this.decodeNextScanline(t,_,i);_+=a}}decodeT6(t,e,i,n,s){this._data=e,this._compression=4,this._bitPointer=0,this._bytePointer=0;const a=Math.trunc((this._width+7)/8);let r=0,h=0,l=0,u=0,d=0,c=0,g=0,f=!1,m=0,_;const x=new Array(2);x.fill(0),this._uncompressedMode=(s&2)>>>1;let b=this._currChangingElements;this._changingElemSize=0,b[this._changingElemSize++]=this._width,b[this._changingElemSize++]=this._width;let p=0,w=0;for(let C=0;C<n;C++){for(r=-1,f=!0,_=this._prevChangingElements,this._prevChangingElements=this._currChangingElements,b=this._currChangingElements=_,m=0,w=i,this._lastChangingElement=0;w<this._width;)if(this.getNextChangingElement(r,f,x),l=x[0],u=x[1],d=this.nextLesserThan8Bits(7),d=dt._twoDCodes[d]&255,c=(d&120)>>>3,g=d&7,c===0)f||this.setToBlack(t,p,w,u-w),r=u,w=r,this.updatePointer(7-g);else if(c===1){this.updatePointer(7-g);let y=0;f?(y=this.decodeWhiteCodeWord(),w+=y,b[m++]=w,y=this.decodeBlackCodeWord(),this.setToBlack(t,p,w,y),w+=y,b[m++]=w):(y=this.decodeBlackCodeWord(),this.setToBlack(t,p,w,y),w+=y,b[m++]=w,y=this.decodeWhiteCodeWord(),w+=y,b[m++]=w),r=w}else if(c<=8)h=l+(c-5),b[m++]=h,f||this.setToBlack(t,p,w,h-w),r=h,w=r,f=!f,this.updatePointer(7-g);else if(c===11){if(this.nextLesserThan8Bits(3)!==7)throw new W("TIFFFaxDecoder5");let y=0,A=!1;for(;!A;){for(;this.nextLesserThan8Bits(1)!==1;)y++;y>5&&(y-=6,!f&&y>0&&(b[m++]=w),w+=y,y>0&&(f=!0),this.nextLesserThan8Bits(1)===0?(f||(b[m++]=w),f=!0):(f&&(b[m++]=w),f=!1),A=!0),y===5?(f||(b[m++]=w),w+=y,f=!0):(w+=y,b[m++]=w,this.setToBlack(t,p,w,1),++w,f=!1)}}else throw new W(`TIFFFaxDecoder5 ${c}`);b[m++]=w,this._changingElemSize=m,p+=a}}}dt._table1=[0,1,3,7,15,31,63,127,255];dt._table2=[0,128,192,224,240,248,252,254,255];dt._flipTable=[0,-128,64,-64,32,-96,96,-32,16,-112,80,-48,48,-80,112,-16,8,-120,72,-56,40,-88,104,-24,24,-104,88,-40,56,-72,120,-8,4,-124,68,-60,36,-92,100,-28,20,-108,84,-44,52,-76,116,-12,12,-116,76,-52,44,-84,108,-20,28,-100,92,-36,60,-68,124,-4,2,-126,66,-62,34,-94,98,-30,18,-110,82,-46,50,-78,114,-14,10,-118,74,-54,42,-86,106,-22,26,-102,90,-38,58,-70,122,-6,6,-122,70,-58,38,-90,102,-26,22,-106,86,-42,54,-74,118,-10,14,-114,78,-50,46,-82,110,-18,30,-98,94,-34,62,-66,126,-2,1,-127,65,-63,33,-95,97,-31,17,-111,81,-47,49,-79,113,-15,9,-119,73,-55,41,-87,105,-23,25,-103,89,-39,57,-71,121,-7,5,-123,69,-59,37,-91,101,-27,21,-107,85,-43,53,-75,117,-11,13,-115,77,-51,45,-83,109,-19,29,-99,93,-35,61,-67,125,-3,3,-125,67,-61,35,-93,99,-29,19,-109,83,-45,51,-77,115,-13,11,-117,75,-53,43,-85,107,-21,27,-101,91,-37,59,-69,123,-5,7,-121,71,-57,39,-89,103,-25,23,-105,87,-41,55,-73,119,-9,15,-113,79,-49,47,-81,111,-17,31,-97,95,-33,63,-65,127,-1];dt._white=[6430,6400,6400,6400,3225,3225,3225,3225,944,944,944,944,976,976,976,976,1456,1456,1456,1456,1488,1488,1488,1488,718,718,718,718,718,718,718,718,750,750,750,750,750,750,750,750,1520,1520,1520,1520,1552,1552,1552,1552,428,428,428,428,428,428,428,428,428,428,428,428,428,428,428,428,654,654,654,654,654,654,654,654,1072,1072,1072,1072,1104,1104,1104,1104,1136,1136,1136,1136,1168,1168,1168,1168,1200,1200,1200,1200,1232,1232,1232,1232,622,622,622,622,622,622,622,622,1008,1008,1008,1008,1040,1040,1040,1040,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,396,396,396,396,396,396,396,396,396,396,396,396,396,396,396,396,1712,1712,1712,1712,1744,1744,1744,1744,846,846,846,846,846,846,846,846,1264,1264,1264,1264,1296,1296,1296,1296,1328,1328,1328,1328,1360,1360,1360,1360,1392,1392,1392,1392,1424,1424,1424,1424,686,686,686,686,686,686,686,686,910,910,910,910,910,910,910,910,1968,1968,1968,1968,2e3,2e3,2e3,2e3,2032,2032,2032,2032,16,16,16,16,10257,10257,10257,10257,12305,12305,12305,12305,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,362,878,878,878,878,878,878,878,878,1904,1904,1904,1904,1936,1936,1936,1936,-18413,-18413,-16365,-16365,-14317,-14317,-10221,-10221,590,590,590,590,590,590,590,590,782,782,782,782,782,782,782,782,1584,1584,1584,1584,1616,1616,1616,1616,1648,1648,1648,1648,1680,1680,1680,1680,814,814,814,814,814,814,814,814,1776,1776,1776,1776,1808,1808,1808,1808,1840,1840,1840,1840,1872,1872,1872,1872,6157,6157,6157,6157,6157,6157,6157,6157,6157,6157,6157,6157,6157,6157,6157,6157,-12275,-12275,-12275,-12275,-12275,-12275,-12275,-12275,-12275,-12275,-12275,-12275,-12275,-12275,-12275,-12275,14353,14353,14353,14353,16401,16401,16401,16401,22547,22547,24595,24595,20497,20497,20497,20497,18449,18449,18449,18449,26643,26643,28691,28691,30739,30739,-32749,-32749,-30701,-30701,-28653,-28653,-26605,-26605,-24557,-24557,-22509,-22509,-20461,-20461,8207,8207,8207,8207,8207,8207,8207,8207,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,4107,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,266,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,298,524,524,524,524,524,524,524,524,524,524,524,524,524,524,524,524,556,556,556,556,556,556,556,556,556,556,556,556,556,556,556,556,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,460,460,460,460,460,460,460,460,460,460,460,460,460,460,460,460,492,492,492,492,492,492,492,492,492,492,492,492,492,492,492,492,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,2059,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232];dt._additionalMakeup=[28679,28679,31752,-32759,-31735,-30711,-29687,-28663,29703,29703,30727,30727,-27639,-26615,-25591,-24567];dt._initBlack=[3226,6412,200,168,38,38,134,134,100,100,100,100,68,68,68,68];dt._twoBitBlack=[292,260,226,226];dt._black=[62,62,30,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,3225,588,588,588,588,588,588,588,588,1680,1680,20499,22547,24595,26643,1776,1776,1808,1808,-24557,-22509,-20461,-18413,1904,1904,1936,1936,-16365,-14317,782,782,782,782,814,814,814,814,-12269,-10221,10257,10257,12305,12305,14353,14353,16403,18451,1712,1712,1744,1744,28691,30739,-32749,-30701,-28653,-26605,2061,2061,2061,2061,2061,2061,2061,2061,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,424,750,750,750,750,1616,1616,1648,1648,1424,1424,1456,1456,1488,1488,1520,1520,1840,1840,1872,1872,1968,1968,8209,8209,524,524,524,524,524,524,524,524,556,556,556,556,556,556,556,556,1552,1552,1584,1584,2e3,2e3,2032,2032,976,976,1008,1008,1040,1040,1072,1072,1296,1296,1328,1328,718,718,718,718,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,456,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,326,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,358,490,490,490,490,490,490,490,490,490,490,490,490,490,490,490,490,4113,4113,6161,6161,848,848,880,880,912,912,944,944,622,622,622,622,654,654,654,654,1104,1104,1136,1136,1168,1168,1200,1200,1232,1232,1264,1264,686,686,686,686,1360,1360,1392,1392,12,12,12,12,12,12,12,12,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390,390];dt._twoDCodes=[80,88,23,71,30,30,62,62,4,4,4,4,4,4,4,4,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,51,51,51,51,51,51,51,51,51,51,51,51,51,51,51,51,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41];var rt;(function(o){o[o.invalid=0]="invalid",o[o.uint=1]="uint",o[o.int=2]="int",o[o.float=3]="float"})(rt||(rt={}));var It;(function(o){o[o.bilevel=0]="bilevel",o[o.gray4bit=1]="gray4bit",o[o.gray=2]="gray",o[o.grayAlpha=3]="grayAlpha",o[o.palette=4]="palette",o[o.rgb=5]="rgb",o[o.rgba=6]="rgba",o[o.yCbCrSub=7]="yCbCrSub",o[o.generic=8]="generic",o[o.invalid=9]="invalid"})(It||(It={}));class Ae{constructor(){this._buffer=new Uint8Array(4096),this._bitsToGet=9,this._bytePointer=0,this._nextData=0,this._nextBits=0}addString(t,e){this._table[this._tableIndex]=e,this._prefix[this._tableIndex]=t,this._tableIndex=this._tableIndex+1,this._tableIndex===511?this._bitsToGet=10:this._tableIndex===1023?this._bitsToGet=11:this._tableIndex===2047&&(this._bitsToGet=12)}getString(t){this._bufferLength=0;let e=t;for(this._buffer[this._bufferLength++]=this._table[e],e=this._prefix[e];e!==Ae._noSuchCode;)this._buffer[this._bufferLength++]=this._table[e],e=this._prefix[e]}getNextCode(){if(this._bytePointer>=this._dataLength)return 257;for(;this._nextBits<this._bitsToGet;){if(this._bytePointer>=this._dataLength)return 257;this._nextData=(this._nextData<<8)+this._data[this._bytePointer++]&4294967295,this._nextBits+=8}return this._nextBits-=this._bitsToGet,this._nextData>>>this._nextBits&Ae._andTable[this._bitsToGet-9]}initializeStringTable(){this._table=new Uint8Array(Ae._lzMaxCode+1),this._prefix=new Uint32Array(Ae._lzMaxCode+1),this._prefix.fill(Ae._noSuchCode,0,this._prefix.length);for(let t=0;t<256;t++)this._table[t]=t;this._bitsToGet=9,this._tableIndex=258}decode(t,e){this._out=e;const i=e.length;if(this._outPointer=0,this._data=t.buffer,this._dataLength=this._data.length,this._bytePointer=t.offset,this._data[0]===0&&this._data[1]===1)throw new W("Invalid LZW Data");this.initializeStringTable(),this._nextData=0,this._nextBits=0;let n=0,s=this.getNextCode();for(;s!==257&&this._outPointer<i;){if(s===256){if(this.initializeStringTable(),s=this.getNextCode(),this._bufferLength=0,s===257)break;this._out[this._outPointer++]=s,n=s}else if(s<this._tableIndex){this.getString(s);for(let a=this._bufferLength-1;a>=0;--a)this._out[this._outPointer++]=this._buffer[a];this.addString(n,this._buffer[this._bufferLength-1]),n=s}else{this.getString(n);for(let a=this._bufferLength-1;a>=0;--a)this._out[this._outPointer++]=this._buffer[a];this._out[this._outPointer++]=this._buffer[this._bufferLength-1],this.addString(n,this._buffer[this._bufferLength-1]),n=s}s=this.getNextCode()}}}Ae._lzMaxCode=4095;Ae._noSuchCode=4098;Ae._andTable=[511,1023,2047,4095];var Rt;(function(o){o[o.whiteIsZero=0]="whiteIsZero",o[o.blackIsZero=1]="blackIsZero",o[o.rgb=2]="rgb",o[o.palette=3]="palette",o[o.transparencyMask=4]="transparencyMask",o[o.cmyk=5]="cmyk",o[o.yCbCr=6]="yCbCr",o[o.reserved7=7]="reserved7",o[o.cieLab=8]="cieLab",o[o.iccLab=9]="iccLab",o[o.ituLab=10]="ituLab",o[o.logL=11]="logL",o[o.logLuv=12]="logLuv",o[o.colorFilterArray=13]="colorFilterArray",o[o.linearRaw=14]="linearRaw",o[o.depth=15]="depth",o[o.unknown=16]="unknown"})(Rt||(Rt={}));const ea=17;class ia{get tags(){return this._tags}get width(){return this._width}get height(){return this._height}get photometricType(){return this._photometricType}get compression(){return this._compression}get bitsPerSample(){return this._bitsPerSample}get samplesPerPixel(){return this._samplesPerPixel}get channelsPerPixel(){return this._channelsPerPixel}get sampleFormat(){return this._sampleFormat}get imageType(){return this._imageType}get isWhiteZero(){return this._isWhiteZero}get predictor(){return this._predictor}get chromaSubH(){return this._chromaSubH}get chromaSubV(){return this._chromaSubV}get tiled(){return this._tiled}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get tileOffsets(){return this._tileOffsets}get tileByteCounts(){return this._tileByteCounts}get tilesX(){return this._tilesX}get tilesY(){return this._tilesY}get tileSize(){return this._tileSize}get fillOrder(){return this._fillOrder}get t4Options(){return this._t4Options}get t6Options(){return this._t6Options}get extraSamples(){return this._extraSamples}get colorMapSamples(){return this._colorMapSamples}get colorMap(){return this._colorMap}get isValid(){return this._width!==0&&this._height!==0}constructor(t){var e,i,n,s,a,r,h,l,u,d,c,g,f,m;this._tags=new Map,this._width=0,this._height=0,this._photometricType=Rt.unknown,this._compression=1,this._bitsPerSample=1,this._samplesPerPixel=1,this._channelsPerPixel=1,this._sampleFormat=rt.uint,this._imageType=It.invalid,this._isWhiteZero=!1,this._predictor=1,this._chromaSubH=0,this._chromaSubV=0,this._tiled=!1,this._tileWidth=0,this._tileHeight=0,this._tilesX=0,this._tilesY=0,this._fillOrder=1,this._t4Options=0,this._t6Options=0,this._colorMapSamples=0,this._colorMapRed=0,this._colorMapGreen=0,this._colorMapBlue=0;const _=D.from(t),x=t.readUint16();for(let b=0;b<x;++b){const p=t.readUint16(),w=t.readUint16(),C=t.readUint32();if(w>13||w<0){t.skip(4);continue}const y=w,A=_n[w];let B=0;C*A>4?B=t.readUint32():(B=t.offset,t.skip(4));const z=new ta({tag:p,type:y,count:C,p:_,valueOffset:B});if(this._tags.set(z.tag,z),p===pt.get("ImageWidth"))this._width=(i=(e=z.read())===null||e===void 0?void 0:e.toInt())!==null&&i!==void 0?i:0;else if(p===pt.get("ImageLength"))this._height=(s=(n=z.read())===null||n===void 0?void 0:n.toInt())!==null&&s!==void 0?s:0;else if(p===pt.get("PhotometricInterpretation")){const U=z.read();if(U===void 0)this._photometricType=Rt.unknown;else{const P=U.toInt();P<ea?this._photometricType=P:this._photometricType=Rt.unknown}}else if(p===pt.get("Compression"))this._compression=(r=(a=z.read())===null||a===void 0?void 0:a.toInt())!==null&&r!==void 0?r:0;else if(p===pt.get("BitsPerSample"))this._bitsPerSample=(l=(h=z.read())===null||h===void 0?void 0:h.toInt())!==null&&l!==void 0?l:0;else if(p===pt.get("SamplesPerPixel"))this._samplesPerPixel=(d=(u=z.read())===null||u===void 0?void 0:u.toInt())!==null&&d!==void 0?d:0;else if(p===pt.get("Predictor"))this._predictor=(g=(c=z.read())===null||c===void 0?void 0:c.toInt())!==null&&g!==void 0?g:0;else if(p===pt.get("SampleFormat")){const U=(m=(f=z.read())===null||f===void 0?void 0:f.toInt())!==null&&m!==void 0?m:0;this._sampleFormat=U}else if(p===pt.get("ColorMap")){const U=z.read();U!==void 0&&(this._colorMap=new Uint16Array(U.toData().buffer),this._colorMapRed=0,this._colorMapGreen=Math.trunc(this._colorMap.length/3),this._colorMapBlue=this._colorMapGreen*2)}}if(this._colorMap!==void 0&&this._photometricType===Rt.palette&&(this._colorMapSamples=3,this._samplesPerPixel=1),!(this._width===0||this._height===0)){if(this._colorMap!==void 0&&this._bitsPerSample===8){const b=this._colorMap,p=b.length;for(let w=0;w<p;++w)b[w]>>>=8}if(this._photometricType===Rt.whiteIsZero&&(this._isWhiteZero=!0),this._channelsPerPixel=this._samplesPerPixel,this.hasTag(pt.get("TileOffsets")))this._tiled=!0,this._tileWidth=this.readTag(pt.get("TileWidth")),this._tileHeight=this.readTag(pt.get("TileLength")),this._tileOffsets=this.readTagList(pt.get("TileOffsets")),this._tileByteCounts=this.readTagList(pt.get("TileByteCounts"));else{if(this._tiled=!1,this._tileWidth=this.readTag(pt.get("TileWidth"),this._width),!this.hasTag(pt.get("RowsPerStrip")))this._tileHeight=this.readTag(pt.get("TileLength"),this._height);else{const b=this.readTag(pt.get("RowsPerStrip"));let p=1;p=(p<<32)-1,b===p?this._tileHeight=this._height:this._tileHeight=b}this._tileOffsets=this.readTagList(pt.get("StripOffsets")),this._tileByteCounts=this.readTagList(pt.get("StripByteCounts"))}switch(this._tilesX=Math.trunc((this._width+this._tileWidth-1)/this._tileWidth),this._tilesY=Math.trunc((this._height+this._tileHeight-1)/this._tileHeight),this._tileSize=this._tileWidth*this._tileHeight*this._samplesPerPixel,this._fillOrder=this.readTag(pt.get("FillOrder"),1),this._t4Options=this.readTag(pt.get("T4Options")),this._t6Options=this.readTag(pt.get("T6Options")),this._extraSamples=this.readTag(pt.get("ExtraSamples")),this._photometricType){case Rt.whiteIsZero:case Rt.blackIsZero:this._bitsPerSample===1&&this._samplesPerPixel===1?this._imageType=It.bilevel:this._bitsPerSample===4&&this._samplesPerPixel===1?this._imageType=It.gray4bit:this._bitsPerSample%8===0&&(this._samplesPerPixel===1?this._imageType=It.gray:this._samplesPerPixel===2?this._imageType=It.grayAlpha:this._imageType=It.generic);break;case Rt.rgb:this._bitsPerSample%8===0&&(this._samplesPerPixel===3?this._imageType=It.rgb:this._samplesPerPixel===4?this._imageType=It.rgba:this._imageType=It.generic);break;case Rt.palette:this._samplesPerPixel===1&&this._colorMap!==void 0&&(this._bitsPerSample===4||this._bitsPerSample===8||this._bitsPerSample===16)&&(this._imageType=It.palette);break;case Rt.transparencyMask:this._bitsPerSample===1&&this._samplesPerPixel===1&&(this._imageType=It.bilevel);break;case Rt.yCbCr:if(this._compression===Nt.jpeg&&this._bitsPerSample===8&&this._samplesPerPixel===3)this._imageType=It.rgb;else{if(this.hasTag(pt.get("YCbCrSubSampling"))){const b=pt.get("YCbCrSubSampling"),p=this._tags.get(b).read();this._chromaSubH=p.toInt(),this._chromaSubV=p.toInt(1)}else this._chromaSubH=2,this._chromaSubV=2;this._chromaSubH*this._chromaSubV===1?this._imageType=It.generic:this._bitsPerSample===8&&this._samplesPerPixel===3&&(this._imageType=It.yCbCrSub)}break;case Rt.cmyk:this._bitsPerSample%8===0&&(this._imageType=It.generic),this._samplesPerPixel===4?this._channelsPerPixel=3:this._samplesPerPixel===5&&(this._channelsPerPixel=4);break;default:this._bitsPerSample%8===0&&(this._imageType=It.generic);break}}}readTag(t,e=0){var i,n;return this.hasTag(t)?(n=(i=this._tags.get(t).read())===null||i===void 0?void 0:i.toInt())!==null&&n!==void 0?n:0:e}readTagList(t){if(!this.hasTag(t))return;const e=this._tags.get(t),i=e.read();return F.generate(e.count,n=>i.toInt(n))}decodeBilevelTile(t,e,i,n){const s=n*this._tilesX+i;t.offset=this._tileOffsets[s];const a=i*this._tileWidth,r=n*this._tileHeight,h=this._tileByteCounts[s];let l;if(this._compression===Nt.packBits){let f=0;this._tileWidth%8===0?f=Math.trunc(this._tileWidth/8)*this._tileHeight:f=(Math.trunc(this._tileWidth/8)+1)*this._tileHeight,l=new D({buffer:new Uint8Array(this._tileWidth*this._tileHeight)}),this.decodePackBits(t,f,l.buffer)}else if(this._compression===Nt.lzw){if(l=new D({buffer:new Uint8Array(this._tileWidth*this._tileHeight)}),new Ae().decode(D.from(t,0,h),l.buffer),this._predictor===2){let m=0;for(let _=0;_<this._height;_++){m=this._samplesPerPixel*(_*this._width+1);for(let x=this._samplesPerPixel;x<this._width*this._samplesPerPixel;x++){const b=l.get(m)+l.get(m-this._samplesPerPixel);l.set(m,b),m++}}}}else if(this._compression===Nt.ccittRle){l=new D({buffer:new Uint8Array(this._tileWidth*this._tileHeight)});try{new dt({fillOrder:this._fillOrder,width:this._tileWidth,height:this._tileHeight}).decode1D(l,t,0,this._tileHeight)}catch{}}else if(this._compression===Nt.ccittFax3){l=new D({buffer:new Uint8Array(this._tileWidth*this._tileHeight)});try{new dt({fillOrder:this._fillOrder,width:this._tileWidth,height:this._tileHeight}).decode2D(l,t,0,this._tileHeight,this._t4Options)}catch{}}else if(this._compression===Nt.ccittFax4){l=new D({buffer:new Uint8Array(this._tileWidth*this._tileHeight)});try{new dt({fillOrder:this._fillOrder,width:this._tileWidth,height:this._tileHeight}).decodeT6(l,t,0,this._tileHeight,this._t6Options)}catch{}}else if(this._compression===Nt.zip){const f=t.toUint8Array(0,h),m=Mi(f);l=new D({buffer:m})}else if(this._compression===Nt.deflate){const f=t.toUint8Array(0,h),m=Mi(f);l=new D({buffer:m})}else if(this._compression===Nt.none)l=t;else throw new W(`Unsupported Compression Type: ${this._compression}`);const u=new en(l),d=e.maxChannelValue,c=this._isWhiteZero?d:0,g=this._isWhiteZero?0:d;for(let f=0,m=r;f<this._tileHeight;++f,++m){for(let _=0,x=a;_<this._tileWidth&&!(m>=e.height||x>=e.width);++_,++x)u.readBits(1)===0?e.setPixelRgb(x,m,c,0,0):e.setPixelRgb(x,m,g,0,0);u.flushByte()}}decodeTile(t,e,i,n){if(this._imageType===It.bilevel){this.decodeBilevelTile(t,e,i,n);return}const s=n*this._tilesX+i;t.offset=this._tileOffsets[s];const a=i*this._tileWidth,r=n*this._tileHeight,h=this._tileByteCounts[s];let l=this._tileWidth*this._tileHeight*this._samplesPerPixel;this._bitsPerSample===16?l*=2:this._bitsPerSample===32&&(l*=4);let u;if(this._bitsPerSample===8||this._bitsPerSample===16||this._bitsPerSample===32||this._bitsPerSample===64){if(this._compression===Nt.none)u=t;else if(this._compression===Nt.lzw){u=new D({buffer:new Uint8Array(l)});const c=new Ae;try{c.decode(D.from(t,0,h),u.buffer)}catch{}if(this._predictor===2){let g=0;for(let f=0;f<this._tileHeight;f++){g=this._samplesPerPixel*(f*this._tileWidth+1);const m=this._tileWidth*this._samplesPerPixel;for(let _=this._samplesPerPixel;_<m;_++)u.set(g,u.get(g)+u.get(g-this._samplesPerPixel)),g++}}}else if(this._compression===Nt.packBits)u=new D({buffer:new Uint8Array(l)}),this.decodePackBits(t,l,u.buffer);else if(this._compression===Nt.deflate){const c=t.toUint8Array(0,h),g=Mi(c);u=new D({buffer:g})}else if(this._compression===Nt.zip){const c=t.toUint8Array(0,h),g=Mi(c);u=new D({buffer:g})}else if(this._compression===Nt.oldJpeg||this._compression===Nt.jpeg){const c=t.toUint8Array(0,h),g=new cs().decode({bytes:c});g!==void 0&&this.jpegToImage(g,e,a,r,this._tileWidth,this._tileHeight);return}else throw new W(`Unsupported Compression Type: ${this._compression}`);const d=[0,0,0];for(let c=0,g=r;c<this._tileHeight;++c,++g)for(let f=0,m=a;f<this._tileWidth&&!(u.isEOS||m>=this._width||g>=this._height);++f,++m)if(this._samplesPerPixel===1)if(this._sampleFormat===rt.float){let _=0;this._bitsPerSample===32?_=u.readFloat32():this._bitsPerSample===64?_=u.readFloat64():this._bitsPerSample===16&&(_=$.float16ToDouble(u.readUint16())),e.setPixelR(m,g,_)}else{let _=0;this._bitsPerSample===8?_=this._sampleFormat===rt.int?u.readInt8():u.read():this._bitsPerSample===16?_=this._sampleFormat===rt.int?u.readInt16():u.readUint16():this._bitsPerSample===32&&(_=this._sampleFormat===rt.int?u.readInt32():u.readUint32()),this._photometricType===Rt.whiteIsZero&&(_=Math.trunc(e.maxChannelValue)-_),e.setPixelR(m,g,_)}else if(this._samplesPerPixel===2){let _=0,x=0;this._bitsPerSample===8?(_=this._sampleFormat===rt.int?u.readInt8():u.read(),x=this._sampleFormat===rt.int?u.readInt8():u.read()):this._bitsPerSample===16?(_=this._sampleFormat===rt.int?u.readInt16():u.readUint16(),x=this._sampleFormat===rt.int?u.readInt16():u.readUint16()):this._bitsPerSample===32&&(_=this._sampleFormat===rt.int?u.readInt32():u.readUint32(),x=this._sampleFormat===rt.int?u.readInt32():u.readUint32()),e.setPixelRgb(m,g,_,x,0)}else if(this._samplesPerPixel===3)if(this._sampleFormat===rt.float){let _=0,x=0,b=0;this._bitsPerSample===32?(_=u.readFloat32(),x=u.readFloat32(),b=u.readFloat32()):this._bitsPerSample===64?(_=u.readFloat64(),x=u.readFloat64(),b=u.readFloat64()):this._bitsPerSample===16&&(_=$.float16ToDouble(u.readUint16()),x=$.float16ToDouble(u.readUint16()),b=$.float16ToDouble(u.readUint16())),e.setPixelRgb(m,g,_,x,b)}else{let _=0,x=0,b=0;this._bitsPerSample===8?(_=this._sampleFormat===rt.int?u.readInt8():u.read(),x=this._sampleFormat===rt.int?u.readInt8():u.read(),b=this._sampleFormat===rt.int?u.readInt8():u.read()):this._bitsPerSample===16?(_=this._sampleFormat===rt.int?u.readInt16():u.readUint16(),x=this._sampleFormat===rt.int?u.readInt16():u.readUint16(),b=this._sampleFormat===rt.int?u.readInt16():u.readUint16()):this._bitsPerSample===32&&(_=this._sampleFormat===rt.int?u.readInt32():u.readUint32(),x=this._sampleFormat===rt.int?u.readInt32():u.readUint32(),b=this._sampleFormat===rt.int?u.readInt32():u.readUint32()),e.setPixelRgb(m,g,_,x,b)}else if(this._samplesPerPixel>=4)if(this._sampleFormat===rt.float){let _=0,x=0,b=0,p=0;this._bitsPerSample===32?(_=u.readFloat32(),x=u.readFloat32(),b=u.readFloat32(),p=u.readFloat32()):this._bitsPerSample===64?(_=u.readFloat64(),x=u.readFloat64(),b=u.readFloat64(),p=u.readFloat64()):this._bitsPerSample===16&&(_=$.float16ToDouble(u.readUint16()),x=$.float16ToDouble(u.readUint16()),b=$.float16ToDouble(u.readUint16()),p=$.float16ToDouble(u.readUint16())),e.setPixelRgba(m,g,_,x,b,p)}else{let _=0,x=0,b=0,p=0,w=e.maxChannelValue;this._bitsPerSample===8?(_=this._sampleFormat===rt.int?u.readInt8():u.read(),x=this._sampleFormat===rt.int?u.readInt8():u.read(),b=this._sampleFormat===rt.int?u.readInt8():u.read(),p=this._sampleFormat===rt.int?u.readInt8():u.read(),this._samplesPerPixel===5&&(w=this._sampleFormat===rt.int?u.readInt8():u.read())):this._bitsPerSample===16?(_=this._sampleFormat===rt.int?u.readInt16():u.readUint16(),x=this._sampleFormat===rt.int?u.readInt16():u.readUint16(),b=this._sampleFormat===rt.int?u.readInt16():u.readUint16(),p=this._sampleFormat===rt.int?u.readInt16():u.readUint16(),this._samplesPerPixel===5&&(w=this._sampleFormat===rt.int?u.readInt16():u.readUint16())):this._bitsPerSample===32&&(_=this._sampleFormat===rt.int?u.readInt32():u.readUint32(),x=this._sampleFormat===rt.int?u.readInt32():u.readUint32(),b=this._sampleFormat===rt.int?u.readInt32():u.readUint32(),p=this._sampleFormat===rt.int?u.readInt32():u.readUint32(),this._samplesPerPixel===5&&(w=this._sampleFormat===rt.int?u.readInt32():u.readUint32())),this._photometricType===Rt.cmyk&&(E.cmykToRgb(_,x,b,p,d),_=d[0],x=d[1],b=d[2],p=w),e.setPixelRgba(m,g,_,x,b,p)}}else throw new W(`Unsupported bitsPerSample: ${this._bitsPerSample}`)}jpegToImage(t,e,i,n,s,a){const r=s,h=a;for(let l=0;l<h;l++)for(let u=0;u<r;u++)e.setPixel(u+i,l+n,t.getPixel(u,l))}decodePackBits(t,e,i){let n=0,s=0;for(;s<e;){const a=q.uint8ToInt8(t.get(n++));if(a>=0&&a<=127)for(let r=0;r<a+1;++r)i[s++]=t.get(n++);else if(a<=-1&&a>=-127){const r=t.get(n++);for(let h=0;h<-a+1;++h)i[s++]=r}else n++}}decode(t){const e=this._sampleFormat===rt.float,i=this._sampleFormat===rt.int,n=this._bitsPerSample===1?v.uint1:this._bitsPerSample===2?v.uint2:this._bitsPerSample===4?v.uint4:e&&this._bitsPerSample===16?v.float16:e&&this._bitsPerSample===32?v.float32:e&&this._bitsPerSample===64?v.float64:i&&this._bitsPerSample===8?v.int8:i&&this._bitsPerSample===16?v.int16:i&&this._bitsPerSample===32?v.int32:this._bitsPerSample===16?v.uint16:this._bitsPerSample===32?v.uint32:v.uint8,s=this._colorMap!==void 0&&this._photometricType===Rt.palette,a=s?3:this._channelsPerPixel,r=new tt({width:this._width,height:this._height,format:n,numChannels:a,withPalette:s,paletteFormat:n});if(s){const h=r.palette,l=this._colorMap,u=3,d=Math.trunc(l.length/u);let c=this._colorMapRed,g=this._colorMapGreen,f=this._colorMapBlue;const m=l.length;for(let _=0;_<d&&!(f>=m);++_,++c,++g,++f)h.setRgb(_,l[c],l[g],l[f])}for(let h=0,l=0;h<this._tilesY;++h)for(let u=0;u<this._tilesX;++u,++l)this.decodeTile(t,r,u,h);return r}hasTag(t){return this._tags.has(t)}}class na{get bigEndian(){return this._bigEndian}get signature(){return this._signature}get ifdOffset(){return this._ifdOffset}get images(){return this._images}get width(){return this._width}get height(){return this._height}get backgroundColor(){throw this._backgroundColor}get numFrames(){return this._images.length}constructor(t){this._images=[],this._width=0,this._height=0,this._backgroundColor=void 0,this._bigEndian=t.bigEndian,this._signature=t.signature,this._ifdOffset=t.ifdOffset,this._images=t.images,this._images.length>0&&(this._width=this._images[0].width,this._height=this._images[0].height)}}class Ke{constructor(){this._info=void 0,this._exifData=void 0}get info(){return this._info}get exifData(){return this._exifData}get format(){return le.tiff}get numFrames(){return this._info!==void 0?this._info.images.length:0}readHeader(t){const e=t.readUint16();if(e!==Ke._tiffLittleEndian&&e!==Ke._tiffBigEndian)return;let i=!1;e===Ke._tiffBigEndian?(t.bigEndian=!0,i=!0):(t.bigEndian=!1,i=!1);let n=0;if(n=t.readUint16(),n!==Ke._tiffSignature)return;let s=t.readUint32();const a=s,r=D.from(t);r.offset=s;const h=[];for(;s!==0;){let l;try{if(l=new ia(r),!l.isValid)break}catch{break}h.push(l),s=r.readUint32(),s!==0&&(r.offset=s)}return h.length>0?new na({bigEndian:i,signature:n,ifdOffset:a,images:h}):void 0}isValidFile(t){const e=new D({buffer:t});return this.readHeader(e)!==void 0}startDecode(t){if(this._input=new D({buffer:t}),this._info=this.readHeader(this._input),this.info!==void 0){const e=new D({buffer:t});this._exifData=me.fromInputBuffer(e)}return this._info}decodeFrame(t){if(this._info===void 0)return;const e=this._info.images[t].decode(this._input);return this._exifData!==void 0&&(e.exifData=this._exifData),e}decode(t){const e=t.bytes;if(this._input=new D({buffer:e}),this._info=this.readHeader(this._input),this._info===void 0)return;const i=this.numFrames;if(t.frameIndex!==void 0){if(t.frameIndex>=i)throw new W(`Invalid value: frameIndex is not in range 0..${i-1}, inclusive.`);return this.decodeFrame(t.frameIndex)}const n=this.decodeFrame(0);if(n!==void 0){n.exifData=me.fromInputBuffer(new D({buffer:e})),n.frameType=hi.page;for(let s=1;s<i;++s){const a=this.decodeFrame(s);n.addFrame(a)}return n}}}Ke._tiffSignature=42;Ke._tiffLittleEndian=18761;Ke._tiffBigEndian=19789;class sa{constructor(){this._supportsAnimation=!1}get supportsAnimation(){return this._supportsAnimation}getSampleFormat(t){switch(t.formatType){case wt.uint:return rt.uint;case wt.int:return rt.int;case wt.float:return rt.float}throw new W("Unknown TIFF format type.")}encode(t){var e;const i=(e=t.skipExif)!==null&&e!==void 0?e:!1;let n=t.image;const s=new Mt,a=new me;n.exifData.size>0&&!i&&a.imageIfd.copyFrom(n.exifData.imageIfd),n.isHdrFormat&&(n=n.convert({format:v.uint8}));const r=n.numChannels===1?Rt.blackIsZero:n.hasPalette?Rt.palette:Rt.rgb,h=n.numChannels,l=a.imageIfd;if(l.set("ImageWidth",n.width),l.set("ImageHeight",n.height),l.set("BitsPerSample",n.bitsPerChannel),l.set("SampleFormat",this.getSampleFormat(n)),l.set("SamplesPerPixel",n.hasPalette?1:h),l.set("Compression",Nt.none),l.set("PhotometricInterpretation",r),l.set("RowsPerStrip",n.height),l.set("PlanarConfiguration",1),l.set("TileWidth",n.width),l.set("TileLength",n.height),l.set("StripByteCounts",n.byteLength),l.set("StripOffsets",new ni(n.toUint8Array())),n.hasPalette){const u=n.palette,d=3,c=u.numColors,g=new Uint16Array(c*d);for(let f=0,m=0;f<d;++f)for(let _=0;_<c;++_)g[m++]=Math.trunc(u.get(_,f))<<8;l.set("ColorMap",g)}return a.write(s),s.getBytes()}}class fi{constructor(t){this._eof=!1,this._input=t,this._range=255-1,this._value=0,this._bits=-8}loadFinalBytes(){this._input.isEOS?this._eof||(this._value<<=8,this._bits+=8,this._eof=!0):(this._value=this._input.read()|this._value<<8,this._bits+=8)}loadNewBytes(){if(this._input.length>=1){const t=this._input.read();this._value=t|this._value<<8,this._bits+=8}else this.loadFinalBytes()}bitUpdate(t){this._bits<0&&this.loadNewBytes();const e=this._bits;return this._value>>>e>t?(this._range-=t+1,this._value-=t+1<<e,1):(this._range=t,0)}shift(){const t=fi.log2Range[this._range];this._range=fi.newRange[this._range],this._bits-=t}getBit(t){const e=this._range*t>>>8,i=this.bitUpdate(e);return this._range<=126&&this.shift(),i}getValue(t){let e=t,i=0;for(;e-- >0;)i|=this.getBit(128)<<e;return i}get(){return this.getValue(1)}getSigned(t){const e=this._range>>>1,i=this.bitUpdate(e);return this.shift(),i!==0?-t:t}getSignedValue(t){const e=this.getValue(t);return this.get()===1?-e:e}}fi.log2Range=[7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0];fi.newRange=[127,127,191,127,159,191,223,127,143,159,175,191,207,223,239,127,135,143,151,159,167,175,183,191,199,207,215,223,231,239,247,127,131,135,139,143,147,151,155,159,163,167,171,175,179,183,187,191,195,199,203,207,211,215,219,223,227,231,235,239,243,247,251,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,127];class Yn{constructor(){this.fLimit=0,this.fInnerLevel=0,this.fInner=!1,this.hevThresh=0}}var M;class Ht{constructor(){M.initTables()}static mul(t,e){const i=t*e;return q.sshR(i,16)}static store(t,e,i,n,s){t.set(e+i+n*S.bps,M.clip8b(t.get(e+i+n*S.bps)+q.sshR(s,3)))}static store2(t,e,i,n,s){M.store(t,0,0,e,i+n),M.store(t,0,1,e,i+s),M.store(t,0,2,e,i-s),M.store(t,0,3,e,i-n)}static initTables(){if(!this.tablesInitialized){for(let t=-255;t<=255;++t)this.abs0[255+t]=t<0?-t:t,this.abs1[255+t]=this.abs0[255+t]>>>1;for(let t=-1020;t<=1020;++t)this.sclip1[1020+t]=t<-128?-128:t>127?127:t;for(let t=-112;t<=112;++t)this.sclip2[112+t]=t<-16?-16:t>15?15:t;for(let t=-255;t<=255+255;++t)this.clip1[255+t]=t<0?0:t>255?255:t;this.tablesInitialized=!0}}static clip8b(t){return t&-256?t<0?0:255:t}static avg3(t,e,i){return q.sshR(t+2*e+i+2,2)}static avg2(t,e){return q.sshR(t+e+1,1)}static ve4(t){const e=-S.bps,i=new Uint8Array([M.avg3(t.get(e-1),t.get(e),t.get(e+1)),M.avg3(t.get(e),t.get(e+1),t.get(e+2)),M.avg3(t.get(e+1),t.get(e+2),t.get(e+3)),M.avg3(t.get(e+2),t.get(e+3),t.get(e+4))]);for(let n=0;n<4;++n)t.memcpy(n*S.bps,4,i)}static he4(t){const e=t.get(-1-S.bps),i=t.get(-1),n=t.get(-1+S.bps),s=t.get(-1+2*S.bps),a=t.get(-1+3*S.bps),r=D.from(t);r.toUint32Array()[0]=16843009*M.avg3(e,i,n),r.offset+=S.bps,r.toUint32Array()[0]=16843009*M.avg3(i,n,s),r.offset+=S.bps,r.toUint32Array()[0]=16843009*M.avg3(n,s,a),r.offset+=S.bps,r.toUint32Array()[0]=16843009*M.avg3(s,a,a)}static dc4(t){let e=4;for(let i=0;i<4;++i)e+=t.get(i-S.bps)+t.get(-1+i*S.bps);e>>>=3;for(let i=0;i<4;++i)t.memset(i*S.bps,4,e)}static trueMotion(t,e){const i=-S.bps,n=255-t.get(i-1);let s=0;for(let a=0;a<e;++a){const r=n+t.get(s-1);for(let h=0;h<e;++h)t.set(s+h,M.clip1[r+t.get(i+h)]);s+=S.bps}}static tm4(t){M.trueMotion(t,4)}static tm8uv(t){M.trueMotion(t,8)}static tm16(t){M.trueMotion(t,16)}static dst(t,e){return t+e*S.bps}static rd4(t){const e=t.get(-1+0*S.bps),i=t.get(-1+Number(S.bps)),n=t.get(-1+2*S.bps),s=t.get(-1+3*S.bps),a=t.get(-1-S.bps),r=t.get(0-S.bps),h=t.get(1-S.bps),l=t.get(2-S.bps),u=t.get(3-S.bps);t.set(M.dst(0,3),M.avg3(i,n,s)),t.set(M.dst(0,2),t.set(M.dst(1,3),M.avg3(e,i,n))),t.set(M.dst(0,1),t.set(M.dst(1,2),t.set(M.dst(2,3),M.avg3(a,e,i)))),t.set(M.dst(0,0),t.set(M.dst(1,1),t.set(M.dst(2,2),t.set(M.dst(3,3),M.avg3(r,a,e))))),t.set(M.dst(1,0),t.set(M.dst(2,1),t.set(M.dst(3,2),M.avg3(h,r,a)))),t.set(M.dst(2,0),t.set(M.dst(3,1),M.avg3(l,h,r))),t.set(M.dst(3,0),M.avg3(u,l,h))}static ld4(t){const e=t.get(0-S.bps),i=t.get(1-S.bps),n=t.get(2-S.bps),s=t.get(3-S.bps),a=t.get(4-S.bps),r=t.get(5-S.bps),h=t.get(6-S.bps),l=t.get(7-S.bps);t.set(M.dst(0,0),M.avg3(e,i,n)),t.set(M.dst(1,0),t.set(M.dst(0,1),M.avg3(i,n,s))),t.set(M.dst(2,0),t.set(M.dst(1,1),t.set(M.dst(0,2),M.avg3(n,s,a)))),t.set(M.dst(3,0),t.set(M.dst(2,1),t.set(M.dst(1,2),t.set(M.dst(0,3),M.avg3(s,a,r))))),t.set(M.dst(3,1),t.set(M.dst(2,2),t.set(M.dst(1,3),M.avg3(a,r,h)))),t.set(M.dst(3,2),t.set(M.dst(2,3),M.avg3(r,h,l))),t.set(M.dst(3,3),M.avg3(h,l,l))}static vr4(t){const e=t.get(-1+0*S.bps),i=t.get(-1+Number(S.bps)),n=t.get(-1+2*S.bps),s=t.get(-1-S.bps),a=t.get(0-S.bps),r=t.get(1-S.bps),h=t.get(2-S.bps),l=t.get(3-S.bps);t.set(M.dst(0,0),t.set(M.dst(1,2),M.avg2(s,a))),t.set(M.dst(1,0),t.set(M.dst(2,2),M.avg2(a,r))),t.set(M.dst(2,0),t.set(M.dst(3,2),M.avg2(r,h))),t.set(M.dst(3,0),M.avg2(h,l)),t.set(M.dst(0,3),M.avg3(n,i,e)),t.set(M.dst(0,2),M.avg3(i,e,s)),t.set(M.dst(0,1),t.set(M.dst(1,3),M.avg3(e,s,a))),t.set(M.dst(1,1),t.set(M.dst(2,3),M.avg3(s,a,r))),t.set(M.dst(2,1),t.set(M.dst(3,3),M.avg3(a,r,h))),t.set(M.dst(3,1),M.avg3(r,h,l))}static vl4(t){const e=t.get(0-S.bps),i=t.get(1-S.bps),n=t.get(2-S.bps),s=t.get(3-S.bps),a=t.get(4-S.bps),r=t.get(5-S.bps),h=t.get(6-S.bps),l=t.get(7-S.bps);t.set(M.dst(0,0),M.avg2(e,i)),t.set(M.dst(1,0),t.set(M.dst(0,2),M.avg2(i,n))),t.set(M.dst(2,0),t.set(M.dst(1,2),M.avg2(n,s))),t.set(M.dst(3,0),t.set(M.dst(2,2),M.avg2(s,a))),t.set(M.dst(0,1),M.avg3(e,i,n)),t.set(M.dst(1,1),t.set(M.dst(0,3),M.avg3(i,n,s))),t.set(M.dst(2,1),t.set(M.dst(1,3),M.avg3(n,s,a))),t.set(M.dst(3,1),t.set(M.dst(2,3),M.avg3(s,a,r))),t.set(M.dst(3,2),M.avg3(a,r,h)),t.set(M.dst(3,3),M.avg3(r,h,l))}static hu4(t){const e=t.get(-1+0*S.bps),i=t.get(-1+Number(S.bps)),n=t.get(-1+2*S.bps),s=t.get(-1+3*S.bps);t.set(M.dst(0,0),M.avg2(e,i)),t.set(M.dst(2,0),t.set(M.dst(0,1),M.avg2(i,n))),t.set(M.dst(2,1),t.set(M.dst(0,2),M.avg2(n,s))),t.set(M.dst(1,0),M.avg3(e,i,n)),t.set(M.dst(3,0),t.set(M.dst(1,1),M.avg3(i,n,s))),t.set(M.dst(3,1),t.set(M.dst(1,2),M.avg3(n,s,s))),t.set(M.dst(3,2),t.set(M.dst(2,2),t.set(M.dst(0,3),t.set(M.dst(1,3),t.set(M.dst(2,3),t.set(M.dst(3,3),s))))))}static hd4(t){const e=t.get(-1+0*S.bps),i=t.get(-1+Number(S.bps)),n=t.get(-1+2*S.bps),s=t.get(-1+3*S.bps),a=t.get(-1-S.bps),r=t.get(0-S.bps),h=t.get(1-S.bps),l=t.get(2-S.bps);t.set(M.dst(0,0),t.set(M.dst(2,1),M.avg2(e,a))),t.set(M.dst(0,1),t.set(M.dst(2,2),M.avg2(i,e))),t.set(M.dst(0,2),t.set(M.dst(2,3),M.avg2(n,i))),t.set(M.dst(0,3),M.avg2(s,n)),t.set(M.dst(3,0),M.avg3(r,h,l)),t.set(M.dst(2,0),M.avg3(a,r,h)),t.set(M.dst(1,0),t.set(M.dst(3,1),M.avg3(e,a,r))),t.set(M.dst(1,1),t.set(M.dst(3,2),M.avg3(i,e,a))),t.set(M.dst(1,2),t.set(M.dst(3,3),M.avg3(n,i,e))),t.set(M.dst(1,3),M.avg3(s,n,i))}filterLoop26(t,e,i,n,s,a,r){let h=n;const l=D.from(t);for(;h-- >0;)this.needsFilter2(l,e,s,a)&&(this.hev(l,e,r)?this.doFilter2(l,e):this.doFilter6(l,e)),l.offset+=i}filterLoop24(t,e,i,n,s,a,r){let h=n;const l=D.from(t);for(;h-- >0;)this.needsFilter2(l,e,s,a)&&(this.hev(l,e,r)?this.doFilter2(l,e):this.doFilter4(l,e)),l.offset+=i}doFilter2(t,e){const i=t.get(-2*e),n=t.get(-e),s=t.get(0),a=t.get(e),r=3*(s-n)+M.sclip1[1020+i-a],h=M.sclip2[112+q.sshR(r+4,3)],l=M.sclip2[112+q.sshR(r+3,3)];t.set(-e,M.clip1[255+n+l]),t.set(0,M.clip1[255+s-h])}doFilter4(t,e){const i=t.get(-2*e),n=t.get(-e),s=t.get(0),a=t.get(e),r=3*(s-n),h=M.sclip2[112+q.sshR(r+4,3)],l=M.sclip2[112+q.sshR(r+3,3)],u=q.sshR(h+1,1);t.set(-2*e,M.clip1[255+i+u]),t.set(-e,M.clip1[255+n+l]),t.set(0,M.clip1[255+s-h]),t.set(e,M.clip1[255+a-u])}doFilter6(t,e){const i=t.get(-3*e),n=t.get(-2*e),s=t.get(-e),a=t.get(0),r=t.get(e),h=t.get(2*e),l=M.sclip1[1020+3*(a-s)+M.sclip1[1020+n-r]],u=q.sshR(27*l+63,7),d=q.sshR(18*l+63,7),c=q.sshR(9*l+63,7);t.set(-3*e,M.clip1[255+i+c]),t.set(-2*e,M.clip1[255+n+d]),t.set(-e,M.clip1[255+s+u]),t.set(0,M.clip1[255+a-u]),t.set(e,M.clip1[255+r-d]),t.set(2*e,M.clip1[255+h-c])}hev(t,e,i){const n=t.get(-2*e),s=t.get(-e),a=t.get(0),r=t.get(e);return M.abs0[255+n-s]>i||M.abs0[255+r-a]>i}needsFilter(t,e,i){const n=t.get(-2*e),s=t.get(-e),a=t.get(0),r=t.get(e);return 2*M.abs0[255+s-a]+M.abs1[255+n-r]<=i}needsFilter2(t,e,i,n){const s=t.get(-4*e),a=t.get(-3*e),r=t.get(-2*e),h=t.get(-e),l=t.get(0),u=t.get(e),d=t.get(2*e),c=t.get(3*e);return 2*M.abs0[255+h-l]+M.abs1[255+r-u]>i?!1:M.abs0[255+s-a]<=n&&M.abs0[255+a-r]<=n&&M.abs0[255+r-h]<=n&&M.abs0[255+c-d]<=n&&M.abs0[255+d-u]<=n&&M.abs0[255+u-l]<=n}simpleVFilter16(t,e,i){const n=D.from(t);for(let s=0;s<16;++s)n.offset=t.offset+s,this.needsFilter(n,e,i)&&this.doFilter2(n,e)}simpleHFilter16(t,e,i){const n=D.from(t);for(let s=0;s<16;++s)n.offset=t.offset+s*e,this.needsFilter(n,1,i)&&this.doFilter2(n,1)}simpleVFilter16i(t,e,i){const n=D.from(t);for(let s=3;s>0;--s)n.offset+=4*e,this.simpleVFilter16(n,e,i)}simpleHFilter16i(t,e,i){const n=D.from(t);for(let s=3;s>0;--s)n.offset+=4,this.simpleHFilter16(n,e,i)}vFilter16(t,e,i,n,s){this.filterLoop26(t,e,1,16,i,n,s)}hFilter16(t,e,i,n,s){this.filterLoop26(t,1,e,16,i,n,s)}vFilter16i(t,e,i,n,s){const a=D.from(t);for(let r=3;r>0;--r)a.offset+=4*e,this.filterLoop24(a,e,1,16,i,n,s)}hFilter16i(t,e,i,n,s){const a=D.from(t);for(let r=3;r>0;--r)a.offset+=4,this.filterLoop24(a,1,e,16,i,n,s)}vFilter8(t,e,i,n,s,a){this.filterLoop26(t,i,1,8,n,s,a),this.filterLoop26(e,i,1,8,n,s,a)}hFilter8(t,e,i,n,s,a){this.filterLoop26(t,1,i,8,n,s,a),this.filterLoop26(e,1,i,8,n,s,a)}vFilter8i(t,e,i,n,s,a){const r=D.from(t,4*i),h=D.from(e,4*i);this.filterLoop24(r,i,1,8,n,s,a),this.filterLoop24(h,i,1,8,n,s,a)}hFilter8i(t,e,i,n,s,a){const r=D.from(t,4),h=D.from(e,4);this.filterLoop24(r,1,i,8,n,s,a),this.filterLoop24(h,1,i,8,n,s,a)}transformOne(t,e){const i=new Int32Array(16);let n=0,s=0,a=0;for(let r=0;r<4;++r){const h=t.get(n)+t.get(n+8),l=t.get(n)-t.get(n+8),u=M.mul(t.get(n+4),M.kC2)-M.mul(t.get(n+12),M.kC1),d=M.mul(t.get(n+4),M.kC1)+M.mul(t.get(n+12),M.kC2);i[a++]=h+d,i[a++]=l+u,i[a++]=l-u,i[a++]=h-d,n++}a=0;for(let r=0;r<4;++r){const h=i[a]+4,l=h+i[a+8],u=h-i[a+8],d=M.mul(i[a+4],M.kC2)-M.mul(i[a+12],M.kC1),c=M.mul(i[a+4],M.kC1)+M.mul(i[a+12],M.kC2);M.store(e,s,0,0,l+c),M.store(e,s,1,0,u+d),M.store(e,s,2,0,u-d),M.store(e,s,3,0,l-c),a++,s+=S.bps}}transform(t,e,i){this.transformOne(t,e),i&&this.transformOne(D.from(t,16),D.from(e,4))}transformUV(t,e){this.transform(t,e,!0),this.transform(D.from(t,2*16),D.from(e,4*S.bps),!0)}transformDC(t,e){const i=t.get(0)+4;for(let n=0;n<4;++n)for(let s=0;s<4;++s)M.store(e,0,s,n,i)}transformDCUV(t,e){t.get(0*16)!==0&&this.transformDC(t,e),t.get(1*16)!==0&&this.transformDC(D.from(t,1*16),D.from(e,4)),t.get(2*16)!==0&&this.transformDC(D.from(t,2*16),D.from(e,4*S.bps)),t.get(3*16)!==0&&this.transformDC(D.from(t,3*16),D.from(e,4*S.bps+4))}transformAC3(t,e){const i=t.get(0)+4,n=M.mul(t.get(4),M.kC2),s=M.mul(t.get(4),M.kC1),a=M.mul(t.get(1),M.kC2),r=M.mul(t.get(1),M.kC1);M.store2(e,0,i+s,r,a),M.store2(e,1,i+n,r,a),M.store2(e,2,i-n,r,a),M.store2(e,3,i-s,r,a)}static ve16(t){for(let e=0;e<16;++e)t.memcpy(e*S.bps,16,t,-S.bps)}static he16(t){let e=0;for(let i=16;i>0;--i)t.memset(e,16,t.get(e-1)),e+=S.bps}static put16(t,e){for(let i=0;i<16;++i)e.memset(i*S.bps,16,t)}static dc16(t){let e=16;for(let i=0;i<16;++i)e+=t.get(-1+i*S.bps)+t.get(i-S.bps);M.put16(e>>>5,t)}static dc16NoTop(t){let e=8;for(let i=0;i<16;++i)e+=t.get(-1+i*S.bps);M.put16(e>>>4,t)}static dc16NoLeft(t){let e=8;for(let i=0;i<16;++i)e+=t.get(i-S.bps);M.put16(e>>>4,t)}static dc16NoTopLeft(t){M.put16(128,t)}static ve8uv(t){for(let e=0;e<8;++e)t.memcpy(e*S.bps,8,t,-S.bps)}static he8uv(t){let e=0;for(let i=0;i<8;++i)t.memset(e,8,t.get(e-1)),e+=S.bps}static put8x8uv(t,e){for(let i=0;i<8;++i)e.memset(i*S.bps,8,t)}static dc8uv(t){let e=8;for(let i=0;i<8;++i)e+=t.get(i-S.bps)+t.get(-1+i*S.bps);M.put8x8uv(e>>>4,t)}static dc8uvNoLeft(t){let e=4;for(let i=0;i<8;++i)e+=t.get(i-S.bps);M.put8x8uv(e>>>3,t)}static dc8uvNoTop(t){let e=4;for(let i=0;i<8;++i)e+=t.get(-1+i*S.bps);M.put8x8uv(e>>>3,t)}static dc8uvNoTopLeft(t){M.put8x8uv(128,t)}}M=Ht;Ht.kC1=20091+65536;Ht.kC2=35468;Ht.abs0=new Uint8Array(255+255+1);Ht.abs1=new Uint8Array(255+255+1);Ht.sclip1=new Int8Array(1020+1020+1);Ht.sclip2=new Int8Array(112+112+1);Ht.clip1=new Uint8Array(255+510+1);Ht.tablesInitialized=!1;Ht.predLuma4=[M.dc4,M.tm4,M.ve4,M.he4,M.rd4,M.vr4,M.ld4,M.vl4,M.hd4,M.hu4];Ht.predLuma16=[M.dc16,M.tm16,M.ve16,M.he16,M.dc16NoTop,M.dc16NoLeft,M.dc16NoTopLeft];Ht.predChroma8=[M.dc8uv,M.tm8uv,M.ve8uv,M.he8uv,M.dc8uvNoTop,M.dc8uvNoLeft,M.dc8uvNoTopLeft];class aa{constructor(){this.simple=!1,this.level=0,this.sharpness=0,this.useLfDelta=!1,this.refLfDelta=new Int32Array(S.numRefLfDeltas),this.modeLfDelta=new Int32Array(S.numModeLfDeltas)}}class ra{constructor(){this.keyFrame=!1,this.profile=0,this.show=0,this.partitionLength=0}}class ha{constructor(){this.nz=0,this.nzDc=0}}class la{constructor(){this.coeffs=new Int16Array(384),this.isIntra4x4=!1,this.imodes=new Uint8Array(16),this.uvmode=0,this.nonZeroY=0,this.nonZeroUV=0,this.dither=0}}class oa{constructor(){this.width=0,this.height=0,this.xscale=0,this.yscale=0,this.colorspace=0,this.clampType=0}}class ua{constructor(){this.probas=F.generate(S.numCtx,()=>new Uint8Array(S.numProbas))}}class ca{constructor(){this.segments=new Uint8Array(S.mbFeatureTreeProbs),this.bands=F.generate(S.numTypes,()=>F.generate(S.numBands,()=>new ua)),this.segments.fill(255,0,this.segments.length)}}class da{constructor(){this.y1Mat=new Int32Array(2),this.y2Mat=new Int32Array(2),this.uvMat=new Int32Array(2),this.uvQuant=0,this.dither=0}}class fa{constructor(){this.useSegment=!1,this.updateMap=!1,this.absoluteDelta=!0,this.quantizer=new Int8Array(S.numMbSegments),this.filterStrength=new Int8Array(S.numMbSegments)}}class ga{constructor(){this.y=new Uint8Array(16),this.u=new Uint8Array(8),this.v=new Uint8Array(8)}}var de;(function(o){o[o.predictor=0]="predictor",o[o.crossColor=1]="crossColor",o[o.subtractGreen=2]="subtractGreen",o[o.colorIndexing=3]="colorIndexing"})(de||(de={}));class ee{get bitPos(){return this._bitPos}set bitPos(t){this._bitPos=t}get isEOS(){return this._input.isEOS&&this._bitPos>=ee.lBits}constructor(t){this._bitPos=0,this._input=t,this._buffer=new Uint32Array(2),this._buffer8=new Uint8Array(this._buffer.buffer);for(let e=0;e<8;e++)this._buffer8[e]=this._input.read()}shiftBytes(){for(;this._bitPos>=8&&!this._input.isEOS;){const t=this._input.read();this._buffer[0]=(this._buffer[0]>>>8)+(this._buffer[1]&255)*16777216,this._buffer[1]>>>=8,this._buffer[1]|=t*16777216,this._bitPos-=8}}prefetchBits(){let t=0;return this._bitPos<32?t=(this._buffer[0]>>>this._bitPos)+(this._buffer[1]&ee.bitMask[this._bitPos])*(ee.bitMask[32-this._bitPos]+1):this._bitPos===32?t=this._buffer[1]:t=this._buffer[1]>>>this._bitPos-32,t}fillBitWindow(){this._bitPos>=ee.wBits&&this.shiftBytes()}readBits(t){if(!this.isEOS&&t<ee.maxNumBitRead){const e=this.prefetchBits()&ee.bitMask[t];return this._bitPos+=t,this.shiftBytes(),e}else throw new W("Not enough data in input.")}}ee.valueSize=8;ee.maxNumBitRead=25;ee.lBits=64;ee.wBits=32;ee.log8WBits=4;ee.bitMask=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647,4294967295];class bn{constructor(t){this._colors=new Uint32Array(1<<t),this._hashShift=32-t}insert(t){const i=(t*bn.hashMultiplier&4294967295)>>>this._hashShift;this._colors[i]=t}lookup(t){return this._colors[t]}}bn.hashMultiplier=506832829;class ma{constructor(){this._data=new Uint8Array(3)}get greenToRed(){return this._data[0]}set greenToRed(t){this._data[0]=t}get greenToBlue(){return this._data[1]}set greenToBlue(t){this._data[1]=t}get redToBlue(){return this._data[2]}set redToBlue(t){this._data[2]=t}get colorCode(){return 4278190080|this._data[2]<<16|this._data[1]<<8|this._data[0]}set colorCode(t){this._data[0]=t>>>0&255,this._data[1]=t>>>8&255,this._data[2]=t>>>16&255}clear(){this._data[0]=0,this._data[1]=0,this._data[2]=0}transformColor(t,e){const i=t>>>8&255,n=t>>>16&255;let s=n,a=t&255;if(e){const h=this.colorTransformDelta(this.greenToRed,i);s=s+h&4294967295,s&=255,a=a+this.colorTransformDelta(this.greenToBlue,i)&4294967295,a=a+this.colorTransformDelta(this.redToBlue,s)&4294967295,a&=255}else s-=this.colorTransformDelta(this.greenToRed,i),s&=255,a-=this.colorTransformDelta(this.greenToBlue,i),a-=this.colorTransformDelta(this.redToBlue,n),a&=255;return t&4278255360|s<<16&4294967295|a}colorTransformDelta(t,e){const i=q.uint8ToInt8(t),n=q.uint8ToInt8(e);return q.int32ToUint32(i*n)>>>5}}var ht;class Nn{constructor(){this._type=de.predictor,this._xsize=0,this._ysize=0,this._bits=0}get type(){return this._type}set type(t){this._type=t}get xsize(){return this._xsize}set xsize(t){this._xsize=t}get ysize(){return this._ysize}set ysize(t){this._ysize=t}get data(){return this._data}set data(t){this._data=t}get bits(){return this._bits}set bits(t){this._bits=t}inverseTransform(t,e,i,n,s,a){const r=this._xsize;switch(this._type){case de.subtractGreen:this.addGreenToBlueAndRed(s,a,a+(e-t)*r);break;case de.predictor:if(this.predictorInverseTransform(t,e,s,a),e!==this._ysize){const h=a-r,l=h+r,u=a+(e-t-1)*r;F.copyRange(i,u,s,h,l-h)}break;case de.crossColor:this.colorSpaceInverseTransform(t,e,s,a);break;case de.colorIndexing:if(n===a&&this._bits>0){const h=(e-t)*r,l=(e-t)*sn.subSampleSize(this._xsize,this._bits),u=a+h-l;F.copyRange(i,a,s,u,l),this.colorIndexInverseTransform(t,e,i,u,s,a)}else this.colorIndexInverseTransform(t,e,i,n,s,a);break}}colorIndexInverseTransformAlpha(t,e,i,n){const s=8>>>this._bits,a=this._xsize,r=this._data;if(s<8){const l=(1<<this._bits)-1,u=(1<<s)-1;for(let d=t;d<e;++d){let c=0;for(let g=0;g<a;++g){g&l||(c=ht.getAlphaIndex(i.get(0)),i.offset++);const f=ht.getAlphaValue(r[c&u]);n.set(0,f),n.offset++,c>>>=s}}}else for(let h=t;h<e;++h)for(let l=0;l<a;++l){const u=ht.getAlphaIndex(i.get(0));i.offset++,n.set(0,ht.getAlphaValue(r[u])),n.offset++}}colorIndexInverseTransform(t,e,i,n,s,a){let r=n,h=a;const l=8>>>this._bits,u=this._xsize,d=this._data;if(l<8){const g=(1<<this._bits)-1,f=(1<<l)-1;for(let m=t;m<e;++m){let _=0;for(let x=0;x<u;++x)x&g||(_=ht.getARGBIndex(i[r++])),s[h++]=ht.getARGBValue(d[_&f]),_>>>=l}}else for(let c=t;c<e;++c)for(let g=0;g<u;++g)s[h++]=ht.getARGBValue(d[ht.getARGBIndex(i[r++])])}colorSpaceInverseTransform(t,e,i,n){let s=n;const a=this._xsize,r=(1<<this._bits)-1,h=sn.subSampleSize(a,this._bits);let l=t,u=(l>>>this._bits)*h;for(;l<e;){let d=u;const c=new ma;for(let g=0;g<a;++g)g&r||(c.colorCode=this._data[d++]),i[s+g]=c.transformColor(i[s+g],!0);s+=a,++l,l&r||(u+=h)}}predictorInverseTransform(t,e,i,n){let s=n,a=t;const r=this._xsize;if(a===0){const c=ht.predictor0(i,i[s-1],0);ht.addPixelsEq(i,s,c);for(let g=1;g<r;++g){const f=ht.predictor1(i,i[s+g-1],0);ht.addPixelsEq(i,s+g,f)}s+=r,++a}let h=a;const l=(1<<this._bits)-1,u=sn.subSampleSize(r,this._bits);let d=(h>>>this._bits)*u;for(;h<e;){const c=ht.predictor2(i,i[s-1],s-r);let g=d;ht.addPixelsEq(i,s,c);const f=this._data[g++]>>>8&15;let m=ht.predictors[f];for(let _=1;_<r;++_){if(!(_&l)){const p=this._data[g++]>>>8&15;m=ht.predictors[p]}const x=i[s+_-1],b=m.call(this,i,x,s+_-r);ht.addPixelsEq(i,s+_,b)}s+=r,++h,h&l||(d+=u)}}addGreenToBlueAndRed(t,e,i){let n=e;for(;n<i;){const s=t[n],a=s>>>8&255;let r=s&16711935;r+=a<<16|a,r&=16711935,t[n++]=s&4278255360|r}}static getARGBIndex(t){return t>>>8&255}static getAlphaIndex(t){return t}static getARGBValue(t){return t}static getAlphaValue(t){return t>>>8&255}static addPixelsEq(t,e,i){const n=t[e],s=(n&4278255360)+(i&4278255360),a=(n&16711935)+(i&16711935);t[e]=s&4278255360|a&16711935}static average2(t,e){return(((t^e)&4278124286)>>>1)+(t&e)}static average3(t,e,i){return this.average2(this.average2(t,i),e)}static average4(t,e,i,n){return this.average2(this.average2(t,e),this.average2(i,n))}static clip255(t){return t<0?0:t>255?255:t}static addSubtractComponentFull(t,e,i){return this.clip255(t+e-i)}static clampedAddSubtractFull(t,e,i){const n=this.addSubtractComponentFull(t>>>24,e>>>24,i>>>24),s=this.addSubtractComponentFull(t>>>16&255,e>>>16&255,i>>>16&255),a=this.addSubtractComponentFull(t>>>8&255,e>>>8&255,i>>>8&255),r=this.addSubtractComponentFull(t&255,e&255,i&255);return n<<24|s<<16|a<<8|r}static addSubtractComponentHalf(t,e){return this.clip255(t+Math.trunc((t-e)/2))}static clampedAddSubtractHalf(t,e,i){const n=this.average2(t,e),s=this.addSubtractComponentHalf(n>>>24,i>>>24),a=this.addSubtractComponentHalf(n>>>16&255,i>>>16&255),r=this.addSubtractComponentHalf(n>>>8&255,i>>>8&255),h=this.addSubtractComponentHalf(n>>>0&255,i>>>0&255);return s<<24|a<<16|r<<8|h}static sub3(t,e,i){const n=e-i,s=t-i;return Math.abs(n)-Math.abs(s)}static select(t,e,i){return this.sub3(t>>>24,e>>>24,i>>>24)+this.sub3(t>>>16&255,e>>>16&255,i>>>16&255)+this.sub3(t>>>8&255,e>>>8&255,i>>>8&255)+this.sub3(t&255,e&255,i&255)<=0?t:e}static predictor0(t,e,i){return I.argbBlack}static predictor1(t,e,i){return e}static predictor2(t,e,i){return t[i]}static predictor3(t,e,i){return t[i+1]}static predictor4(t,e,i){return t[i-1]}static predictor5(t,e,i){return ht.average3(e,t[i],t[i+1])}static predictor6(t,e,i){return ht.average2(e,t[i-1])}static predictor7(t,e,i){return ht.average2(e,t[i])}static predictor8(t,e,i){return ht.average2(t[i-1],t[i])}static predictor9(t,e,i){return ht.average2(t[i],t[i+1])}static predictor10(t,e,i){return ht.average4(e,t[i-1],t[i],t[i+1])}static predictor11(t,e,i){return ht.select(t[i],e,t[i-1])}static predictor12(t,e,i){return ht.clampedAddSubtractFull(e,t[i],t[i-1])}static predictor13(t,e,i){return ht.clampedAddSubtractHalf(e,t[i],t[i-1])}}ht=Nn;Nn.predictors=[ht.predictor0,ht.predictor1,ht.predictor2,ht.predictor3,ht.predictor4,ht.predictor5,ht.predictor6,ht.predictor7,ht.predictor8,ht.predictor9,ht.predictor10,ht.predictor11,ht.predictor12,ht.predictor13,ht.predictor0,ht.predictor0];var Ot;(function(o){o[o.undefined=0]="undefined",o[o.lossy=1]="lossy",o[o.lossless=2]="lossless",o[o.animated=3]="animated"})(Ot||(Ot={}));class Dn{constructor(t=0,e=0){this.bits=t,this.value=e}static from(t){return new Dn(t.bits,t.value)}}class vi{get length(){return this._htree.length-this._offset}constructor(t,e=0){this._htree=t,this._offset=e}static sized(t){return new vi(F.generate(t,()=>new Dn),0)}static from(t,e){return new vi(t._htree,t._offset+e)}get(t){return this._htree[this._offset+t]}set(t,e){const i=this._htree[this._offset+t];i.bits=e.bits,i.value=e.value}}class _a{constructor(){this.bits=0,this.value=0}}class gi{constructor(){this.isTrivialLiteral=!1,this.literalArb=0,this.isTrivialCode=!1,this.usePackedTable=!1,this.htrees=F.generate(I.huffmanCodesPerMetaCode,()=>vi.sized(0)),this.packedTable=F.generate(I.huffmanPackedTableSize,()=>new _a)}get(t){return this.htrees[t]}readSymbol(t,e){let i=e.prefetchBits(),n=i&gi._huffmanTableMask;const s=this.htrees[t].get(n).bits-gi._huffmanTableBits;return s>0&&(e.bitPos+=gi._huffmanTableBits,i=e.prefetchBits(),n+=this.htrees[t].get(n).value,n+=i&(1<<s)-1),e.bitPos+=this.htrees[t].get(n).bits,this.htrees[t].get(n).value}}gi._huffmanTableBits=8;gi._huffmanTableMask=(1<<gi._huffmanTableBits)-1;class ds{constructor(){this.currentOffset=0,this.size=0}}class Gn{constructor(t){this.root=new ds,this.currentSegment=this.root;const e=vi.sized(t);this.root.size=t,this.root.start=e,this.root.currentTable=e,this.root.next=void 0}}class I{get webp(){return this._webp}constructor(t,e){this._htreeGroups=[],this._transforms=[],this._ioWidth=0,this._ioHeight=0,this._colorCacheSize=0,this._huffmanMask=0,this._huffmanSubsampleBits=0,this._huffmanXsize=0,this._numHtreeGroups=0,this._transformsSeen=0,this._argbCache=0,this._lastPixel=0,this._lastRow=0,this._input=t,this._webp=e,this._br=new ee(t)}decodeHeader(){if(this._br.readBits(8)!==I.vp8lMagicByte)return!1;const e=this._br.readBits(14)+1,i=this._br.readBits(14)+1,n=this._br.readBits(1)!==0;return this._ioWidth=e,this._ioHeight=i,this._webp.format=Ot.lossless,this._webp.width=e,this._webp.height=i,this._webp.hasAlpha=n,this._br.readBits(3)===I.vp8lVersion}decode(){if(this._lastPixel=0,!!this.decodeHeader()&&(this.decodeImageStream(this._ioWidth,this._ioHeight,!0),this.allocateInternalBuffers32b(this._ioWidth),this._image=new tt({width:this._ioWidth,height:this._ioHeight,numChannels:4}),!!this.decodeImageData(this._pixels,this._webp.width,this._webp.height,this._webp.height,(t,e)=>this.processRows(t,e)))){if(this._webp.exifData.length>0){const t=new D({buffer:Bt.getCodePoints(this._webp.exifData)});this._image.exifData=me.fromInputBuffer(t)}return this._image}}allocateInternalBuffers32b(t){const e=this._webp.width*this._webp.height,i=t,n=t*I.numArgbCacheRows,s=e+i+n,a=new Uint32Array(s);return this._pixels=a,this._pixels8=new Uint8Array(a.buffer),this._argbCache=e+i,!0}allocateInternalBuffers8b(){const t=this._webp.width*this._webp.height;this._argbCache=0;const e=t+(4-t%4);return this._pixels8=new Uint8Array(e),this._pixels=new Uint32Array(this._pixels8.buffer),!0}decodeImageStream(t,e,i){let n=t,s=e,a=0;if(i)for(;this._br.readBits(1)!==0;){const u=[n,s];if(!this.readTransform(u))throw new W("Invalid Transform");n=u[0],s=u[1]}if(this._br.readBits(1)!==0&&(a=this._br.readBits(4),!(a>=1&&a<=I.maxCacheBits)))throw new W("Invalid Color Cache");if(!this.readHuffmanCodes(n,s,a,i))throw new W("Invalid Huffman Codes");a>0?(this._colorCacheSize=1<<a,this._colorCache=new bn(a)):this._colorCacheSize=0,this._webp.width=n,this._webp.height=s;const r=this._huffmanSubsampleBits;if(this._huffmanXsize=I.subSampleSize(n,r),this._huffmanMask=r===0?-1:(1<<r)-1,i){this._lastPixel=0;return}const h=n*s,l=new Uint32Array(h);if(!this.decodeImageData(l,n,s,s,void 0))throw new W("Failed to decode image data.");return this._lastPixel=0,l}decodeImageData(t,e,i,n,s){let a=Math.trunc(this._lastPixel/e),r=this._lastPixel%e,h=this.getHtreeGroupForPos(r,a),l=this._lastPixel,u=l;const d=e*i,c=e*n,g=I.numLiteralCodes+I.numLengthCodes,f=g+this._colorCacheSize,m=this._colorCacheSize>0?this._colorCache:void 0,_=this._huffmanMask;for(;l<c;){if(r&_||(h=this.getHtreeGroupForPos(r,a)),h.isTrivialCode){if(t[l]=h.literalArb,++l,++r,r>=e&&(r=0,++a,s!==void 0&&a<=n&&s(a,!0),m!==void 0))for(;u<l;)m.insert(t[u]),u++;continue}this._br.fillBitWindow();let x=0;if(h.usePackedTable){const b=this._br.prefetchBits()&I.huffmanPackedTableSize-1,p=h.packedTable[b];if(p.bits<I.bitsSpecialMarker?(this._br.bitPos+=p.bits,t[l]=p.value,x=I.packedNonLiteralCode):(this._br.bitPos+=p.bits-I.bitsSpecialMarker,x=p.value),this._br.isEOS)break;if(x===I.packedNonLiteralCode){if(++l,++r,r>=e&&(r=0,++a,s!==void 0&&a<=n&&s(a,!0),m!==void 0))for(;u<l;)m.insert(t[u]),u++;continue}}else x=h.readSymbol(I.green,this._br);if(x<I.numLiteralCodes){if(h.isTrivialLiteral)t[l]=h.literalArb|x<<8;else{const b=h.readSymbol(I.red,this._br),p=x;this._br.fillBitWindow();const w=h.readSymbol(I.blue,this._br),C=h.readSymbol(I.alpha,this._br),y=E.rgbaToUint32(w,p,b,C);t[l]=y}if(++l,++r,r>=e&&(r=0,++a,s!==void 0&&a<=n&&s(a,!0),m!==void 0))for(;u<l;)m.insert(t[u]),u++}else if(x<g){const b=x-I.numLiteralCodes,p=this.getCopyLength(b),w=h.readSymbol(I.dist,this._br);this._br.fillBitWindow();const C=this.getCopyDistance(w),y=this.planeCodeToDistance(e,C);if(this._br.isEOS)break;if(l<y||d-l<p)return!1;{const A=l-y;for(let B=0;B<p;++B)t[l+B]=t[A+B]}for(l+=p,r+=p;r>=e;)r-=e,++a,s!==void 0&&a<=n&&s(a,!0);if(r&_&&(h=this.getHtreeGroupForPos(r,a)),m!==void 0)for(;u<l;)m.insert(t[u]),u++}else if(x<f){const b=x-g;for(;u<l;)m.insert(t[u]),u++;if(t[l]=m.lookup(b),++l,++r,r>=e)for(r=0,++a,s!==void 0&&a<=n&&s(a,!0);u<l;)m.insert(t[u]),u++}else return!1}return s!==void 0&&s(a>n?n:a,!1),this._lastPixel=l,!0}readTransform(t){let e=!0;const i=this._br.readBits(2);if(this._transformsSeen&1<<i)return!1;this._transformsSeen|=1<<i;const n=new Nn;switch(this._transforms.push(n),n.type=i,n.xsize=t[0],n.ysize=t[1],n.type){case de.predictor:case de.crossColor:n.bits=this._br.readBits(3)+2,n.data=this.decodeImageStream(I.subSampleSize(n.xsize,n.bits),I.subSampleSize(n.ysize,n.bits),!1);break;case de.colorIndexing:{const s=this._br.readBits(8)+1,a=s>16?0:s>4?1:s>2?2:3;t[0]=I.subSampleSize(n.xsize,a),n.bits=a,n.data=this.decodeImageStream(s,1,!1),e=this.expandColorMap(s,n);break}case de.subtractGreen:break;default:throw new W("Invalid WebP transform type: $type")}return e}expandColorMap(t,e){const i=1<<(8>>>e.bits),n=new Uint32Array(i),s=new Uint8Array(e.data.buffer),a=new Uint8Array(n.buffer);n[0]=e.data[0];let r=4*t,h=0;for(h=4;h<r;++h)a[h]=s[h]+a[h-4]&255;for(r=4*i;h<r;++h)a[h]=0;return e.data=n,!0}getMetaIndex(t,e,i,n,s){return i===0||t===void 0?0:t[e*(s>>>i)+(n>>>i)]}getHtreeGroupForPos(t,e){const i=this.getMetaIndex(this._huffmanImage,this._huffmanXsize,this._huffmanSubsampleBits,t,e);return this._htreeGroups[i]}applyInverseTransforms(t,e,i){let n=this._transforms.length;const s=this._webp.width*e,a=t+e;let r=i;const h=this._argbCache;for(;n-- >0;)this._transforms[n].inverseTransform(t,a,this._pixels,r,this._pixels,h),r=h;r!==h&&F.copyRange(this._pixels,r,this._pixels,h,s)}processRows(t,e){const i=this._webp.width*this._lastRow;if(e&&t%I.numArgbCacheRows!==0)return;const n=t-this._lastRow;if(n<=0){this._lastRow=t;return}this.applyInverseTransforms(this._lastRow,n,i);for(let s=0,a=this._argbCache,r=this._lastRow;s<n;++s,++r)for(let h=0;h<this._ioWidth;++h,++a){const l=this._pixels[a],u=E.uint32ToRed(l),d=E.uint32ToGreen(l),c=E.uint32ToBlue(l),g=E.uint32ToAlpha(l);this._image.setPixelRgba(h,r,c,d,u,g)}this._lastRow=t}readHuffmanCodes(t,e,i,n){let s,a=1,r=1,h;if(n&&this._br.readBits(1)!==0){const u=I.minHuffmanBits+this._br.readBits(I.numHuffmanBits),d=I.subSampleSize(t,u),c=I.subSampleSize(e,u),g=d*c;if(s=this.decodeImageStream(d,c,!1),s===void 0)return!1;this._huffmanSubsampleBits=u;for(let f=0;f<g;++f){const m=s[f]>>>8&65535;s[f]=m,m>=r&&(r=m+1)}if(r>1e3||r>t*e){h=new Int32Array(a),h.fill(255,0,a),a=0;for(let f=0;f<g;++f){const m=s[f];h[m]===-1&&(h[m]=a++),s[f]=h[m]}}else a=r}if(this._br.isEOS)return!1;const l=this.readHuffmanCodesHelper(i,a,r,h);return l===void 0?!1:(this._huffmanImage=s,this._numHtreeGroups=a,this._htreeGroups=l,!0)}readHuffmanCode(t,e,i){let n=0,s=!1;const a=this._br.readBits(1);if(e.fill(0,0,t),a!==0){const r=this._br.readBits(1)+1,h=this._br.readBits(1);let l=this._br.readBits(h===0?1:8);e[l]=1,r===2&&(l=this._br.readBits(8),e[l]=1),s=!0}else{const r=new Int32Array(I.numCodeLengthCodes),h=this._br.readBits(4)+4;for(let l=0;l<h;++l)r[I.codeLengthCodeOrder[l]]=this._br.readBits(3);s=this.readHuffmanCodeLengths(r,t,e)}return s=s&&!this._br.isEOS,s&&(n=this.vp8lBuildHuffmanTable(i,I.huffmanTableBits,e,t)),n}readHuffmanCodeLengths(t,e,i){let n=I.defaultCodeLength;const s=new Gn(1<<I.lengthsTableBits);if(this.vp8lBuildHuffmanTable(s,I.lengthsTableBits,t,I.numCodeLengthCodes)===0)return!1;let a=0;if(this._br.readBits(1)!==0){const h=2+2*this._br.readBits(3);if(a=2+this._br.readBits(h),a>e)return!1}else a=e;let r=0;for(;r<e&&a--!==0;){this._br.fillBitWindow();const h=s.currentSegment.start.get(this._br.prefetchBits()&I.lengthsTableMask);this._br.bitPos+=h.bits;const l=h.value;if(l<I.codeLengthLiterals)i[r++]=l,l!==0&&(n=l);else{const u=l===I.codeLengthRepeatCode,d=l-I.codeLengthLiterals,c=I.codeLengthExtraBits[d],g=I.codeLengthRepeatOffsets[d];let f=this._br.readBits(c)+g;if(r+f>e)return!1;const m=u?n:0;for(;f-- >0;)i[r++]=m}}return!0}readHuffmanCodesHelper(t,e,i,n){const s=I.alphabetSize[0]+(t>0?1<<t:0),a=I.tableSize[t];if(n===void 0&&e!==i)return;const r=new Int32Array(s),h=F.generate(e,l=>new gi);this._huffmanTables=new Gn(e*a);for(let l=0;l<i;++l)if(n!==void 0&&n[l]===-1)for(let u=0;u<I.huffmanCodesPerMetaCode;++u){let d=I.alphabetSize[u];if(u===0&&t>0&&(d+=1<<t),this.readHuffmanCode(d,r,void 0)===0)return}else{let u=0,d=!0,c=0;const g=h[n===void 0?l:n[l]],f=g.htrees;for(let m=0;m<I.huffmanCodesPerMetaCode;++m){let _=I.alphabetSize[m];m===0&&t>0&&(_+=1<<t);const x=this.readHuffmanCode(_,r,this._huffmanTables);if(f[m]=this._huffmanTables.currentSegment.currentTable,x===0)return;if(d&&I.literalMap[m]===1&&(d=f[m].get(0).bits===0),c+=f[m].get(0).bits,this._huffmanTables.currentSegment.currentOffset+=x,this._huffmanTables.currentSegment.currentTable=vi.from(this._huffmanTables.currentSegment.currentTable,x),m<=I.alpha){let b=r[0];for(let p=1;p<_;++p)r[p]>b&&(b=r[p]);u+=b}}if(g.isTrivialLiteral=d,g.isTrivialCode=!1,d){const m=f[I.red].get(0).value,_=f[I.blue].get(0).value,x=f[I.alpha].get(0).value;g.literalArb=x<<24|m<<16|_,c===0&&f[I.green].get(0).value<I.numLengthCodes&&(g.isTrivialCode=!0,g.literalArb|=f[I.green].get(0).value<<8)}g.usePackedTable=!g.isTrivialCode&&u<I.huffmanPackedBits,g.usePackedTable&&this.buildPackedTable(g)}return h}buildPackedTable(t){for(let e=0;e<I.huffmanPackedTableSize;++e){let i=e;const n=t.packedTable[i],s=t.htrees[I.green].get(i);s.value>=I.numLiteralCodes?(n.bits=s.bits+I.bitsSpecialMarker,n.value=s.value):(n.bits=0,n.value=0,i>>=this.accumulateHCode(s,8,n),i>>=this.accumulateHCode(t.htrees[I.red].get(i),16,n),i>>=this.accumulateHCode(t.htrees[I.blue].get(i),0,n),i>>=this.accumulateHCode(t.htrees[I.alpha].get(i),24,n))}}accumulateHCode(t,e,i){return i.bits+=t.bits,i.value|=t.value<<e,t.bits}getCopyDistance(t){if(t<4)return t+1;const e=t-2>>>1;return(2+(t&1)<<e)+this._br.readBits(e)+1}getCopyLength(t){return this.getCopyDistance(t)}planeCodeToDistance(t,e){if(e>I.codeToPlaneCodes)return e-I.codeToPlaneCodes;{const i=I.codeToPlane[e-1],n=i>>>4,s=8-(i&15),a=n*t+s;return a>=1?a:1}}is8bOptimizable(){if(this._colorCacheSize>0)return!1;for(let t=0;t<this._numHtreeGroups;++t){const e=this._htreeGroups[t].htrees;if(e[I.red].get(0).bits>0||e[I.blue].get(0).bits>0||e[I.alpha].get(0).bits>0)return!1}return!0}extractPalettedAlphaRows(t){const e=t-this._lastRow,i=new D({buffer:this._pixels8,offset:this._webp.width*this._lastRow});e>0&&this.applyInverseTransformsAlpha(e,i),this._lastRow=t}applyInverseTransformsAlpha(t,e){const i=this._lastRow,n=i+t,s=new D({buffer:this._opaque,offset:this._ioWidth*i});this._transforms[0].colorIndexInverseTransformAlpha(i,n,e,s)}extractAlphaRows(t,e){if(e&&t%I.numArgbCacheRows!==0)return;let i=this._lastRow,n=t-i,s=this._ioWidth*i;for(;n>0;){const a=n>I.numArgbCacheRows?I.numArgbCacheRows:n,r=this._ioWidth,h=r*a,l=r*i,u=this._argbCache;this.applyInverseTransforms(i,a,s);for(let d=0;d<h;++d)this._opaque[l+d]=this._pixels[u+d]>>8&255;n-=a,s+=a*this._ioWidth,i+=a}this._lastRow=t}decodeAlphaData(t,e,i){let n=Math.trunc(this._lastPixel/t),s=this._lastPixel%t,a=this.getHtreeGroupForPos(s,n),r=this._lastPixel;const h=t*e,l=t*i,u=I.numLiteralCodes+I.numLengthCodes,d=this._huffmanMask;for(;!this._br.isEOS&&r<l;){s&d||(a=this.getHtreeGroupForPos(s,n)),this._br.fillBitWindow();const c=a.readSymbol(I.green,this._br);if(c<I.numLiteralCodes)this._pixels8[r]=c,++r,++s,s>=t&&(s=0,++n,n%I.numArgbCacheRows===0&&this.extractPalettedAlphaRows(n));else if(c<u){const g=c-I.numLiteralCodes,f=this.getCopyLength(g),m=a.readSymbol(I.dist,this._br);this._br.fillBitWindow();const _=this.getCopyDistance(m),x=this.planeCodeToDistance(t,_);if(r>=x&&h-r>=f)for(let b=0;b<f;++b)this._pixels8[r+b]=this._pixels8[r+b-x];else return this._lastPixel=r,!0;for(r+=f,s+=f;s>=t;)s-=t,++n,n%I.numArgbCacheRows===0&&this.extractPalettedAlphaRows(n);r<l&&s&d&&(a=this.getHtreeGroupForPos(s,n))}else return!1}return this.extractPalettedAlphaRows(n),this._lastPixel=r,!0}replicateValue(t,e,i,n,s,a){let r=n;do r-=i,t.get(e+r).bits=s,t.get(e+r).value=a;while(r>0)}nextTableBitSize(t,e,i){let n=e,s=1<<n-i;for(;n<I.maxAllowedCodeLength&&(s-=t[n],!(s<=0));)++n,s<<=1;return n-i}getNextKey(t,e){let i=1<<e-1;for(;t&i;)i>>=1;return i!==0?(t&i-1)+i:t}buildHuffmanTable(t,e,i,n,s){let a=1<<e;const r=new Int32Array(I.maxAllowedCodeLength+1),h=new Int32Array(I.maxAllowedCodeLength+1);let l=0;for(let u=0;u<n;++u){if(i[u]>I.maxAllowedCodeLength)return 0;++r[i[u]]}if(r[0]===n)return 0;h[1]=0;for(let u=1;u<I.maxAllowedCodeLength;++u){if(r[u]>1<<u)return 0;h[u+1]=h[u]+r[u]}for(let u=0;u<n;++u){const d=i[u];if(i[u]>0)if(s!==void 0){if(h[d]>=n)return 0;s[h[d]++]=u}else h[d]++}if(h[I.maxAllowedCodeLength]===1)return s!==void 0&&this.replicateValue(t,0,1,a,0,s[0]),a;{let u=4294967295;const d=a-1;let c=0,g=1,f=1,m=e,_=1<<m,x=0;for(let b=1,p=2;b<=e;++b,p<<=1){if(f<<=1,g+=f,f-=r[b],f<0)return 0;if(t!==void 0)for(;r[b]>0;--r[b]){const w=b&255,C=s[x++];this.replicateValue(t,l+c,p,_,w,C),c=this.getNextKey(c,b)}}for(let b=e+1,p=2;b<=I.maxAllowedCodeLength;++b,p<<=1){if(f<<=1,g+=f,f-=r[b],f<0)return 0;for(;r[b]>0;--r[b]){if((c&d)!==u&&(t!==void 0&&(l+=_),m=this.nextTableBitSize(r,b,e),_=1<<m,a+=_,u=c&d,t!==void 0)){const w=m+e&255,C=l-u;t.get(u).bits=w,t.get(u).value=C}if(t!==void 0){const w=b-e&255,C=s[x++];this.replicateValue(t,l+(c>>e),p,_,w,C)}c=this.getNextKey(c,b)}}if(g!==2*h[I.maxAllowedCodeLength]-1)return 0}return a}vp8lBuildHuffmanTable(t,e,i,n){const s=this.buildHuffmanTable(void 0,e,i,n,void 0);if(s===0||t===void 0)return s;if(t.currentSegment.currentOffset+s>=t.currentSegment.size){const r=t.currentSegment.size,h=new ds;{const l=s>r?s:r,u=vi.sized(l);h.size=l,h.start=u}h.currentTable=h.start,h.next=void 0,t.currentSegment.next=h,t.currentSegment=h}const a=new Uint16Array(n);return this.buildHuffmanTable(t.currentSegment.currentTable,e,i,n,a),s}static subSampleSize(t,e){return t+(1<<e)-1>>>e}}I.green=0;I.red=1;I.blue=2;I.alpha=3;I.dist=4;I.numArgbCacheRows=16;I.numCodeLengthCodes=19;I.codeLengthCodeOrder=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15];I.huffmanTableBits=8;I.codeToPlaneCodes=120;I.codeToPlane=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112];I.lengthsTableBits=7;I.lengthsTableMask=(1<<I.lengthsTableBits)-1;I.codeLengthLiterals=16;I.codeLengthRepeatCode=16;I.codeLengthExtraBits=[2,3,7];I.codeLengthRepeatOffsets=[3,3,11];I.argbBlack=4278190080;I.maxCacheBits=11;I.huffmanCodesPerMetaCode=5;I.huffmanPackedBits=6;I.huffmanPackedTableSize=1<<I.huffmanPackedBits;I.minHuffmanBits=2;I.numHuffmanBits=3;I.defaultCodeLength=8;I.maxAllowedCodeLength=15;I.numLiteralCodes=256;I.numLengthCodes=24;I.numDistanceCodes=40;I.codeLengthCodes=19;I.packedNonLiteralCode=0;I.bitsSpecialMarker=256;I.alphabetSize=[I.numLiteralCodes+I.numLengthCodes,I.numLiteralCodes,I.numLiteralCodes,I.numLiteralCodes,I.numDistanceCodes];I.fixedTableSize=630*3+410;I.tableSize=[I.fixedTableSize+654,I.fixedTableSize+656,I.fixedTableSize+658,I.fixedTableSize+662,I.fixedTableSize+670,I.fixedTableSize+686,I.fixedTableSize+718,I.fixedTableSize+782,I.fixedTableSize+912,I.fixedTableSize+1168,I.fixedTableSize+1680,I.fixedTableSize+2704];I.literalMap=[0,1,1,1,0];I.vp8lMagicByte=47;I.vp8lVersion=0;class sn extends I{get transforms(){return this._transforms}get pixels(){return this._pixels}get opaque(){return this._opaque}set opaque(t){this._opaque=t}get ioWidth(){return this._ioWidth}set ioWidth(t){this._ioWidth=t}get ioHeight(){return this._ioHeight}set ioHeight(t){this._ioHeight=t}decodeImageData(t,e,i,n,s){return super.decodeImageData(t,e,i,n,s)}decodeImageStream(t,e,i){return super.decodeImageStream(t,e,i)}allocateInternalBuffers32b(t){return super.allocateInternalBuffers32b(t)}allocateInternalBuffers8b(){return super.allocateInternalBuffers8b()}decodeAlphaData(t,e,i){return super.decodeAlphaData(t,e,i)}is8bOptimizable(){return super.is8bOptimizable()}extractAlphaRows(t,e){return super.extractAlphaRows(t,e)}static subSampleSize(t,e){return I.subSampleSize(t,e)}}class Pt{static predictLine(t,e,i,n,s){if(s)for(let a=0;a<n;++a)i.set(a,t.get(a)+e.get(a));else for(let a=0;a<n;++a)i.set(a,t.get(a)-e.get(a))}static doHorizontalFilter(t,e,i,n,s,a,r,h){let l=s;const u=l*n,d=l+a,c=new D({buffer:t,offset:u}),g=new D({buffer:t,offset:u}),f=D.from(r?g:c);for(l===0&&(g.set(0,c.get(0)),this.predictLine(D.from(c,1),f,D.from(g,1),e-1,r),l=1,f.offset+=n,c.offset+=n,g.offset+=n);l<d;)this.predictLine(c,D.from(f,-n),g,1,r),this.predictLine(D.from(c,1),f,D.from(g,1),e-1,r),++l,f.offset+=n,c.offset+=n,g.offset+=n}static doVerticalFilter(t,e,i,n,s,a,r,h){let l=s;const u=l*n,d=l+a,c=new D({buffer:t,offset:u}),g=new D({buffer:h,offset:u}),f=D.from(r?g:c);for(l===0?(g.set(0,c.get(0)),this.predictLine(D.from(c,1),f,D.from(g,1),e-1,r),l=1,c.offset+=n,g.offset+=n):f.offset-=n;l<d;)this.predictLine(c,f,g,e,r),++l,f.offset+=n,c.offset+=n,g.offset+=n}static gradientPredictor(t,e,i){const n=t+e-i;return n&-256?n<0?0:255:n}static doGradientFilter(t,e,i,n,s,a,r,h){let l=s;const u=l*n,d=l+a,c=new D({buffer:t,offset:u}),g=new D({buffer:h,offset:u}),f=D.from(r?g:c);for(l===0&&(g.set(0,c.get(0)),this.predictLine(D.from(c,1),f,D.from(g,1),e-1,r),l=1,f.offset+=n,c.offset+=n,g.offset+=n);l<d;){this.predictLine(c,D.from(f,-n),g,1,r);for(let m=1;m<e;++m){const _=this.gradientPredictor(f.get(m-1),f.get(m-n),f.get(m-n-1));g.set(m,c.get(m)+(r?_:-_))}++l,f.offset+=n,c.offset+=n,g.offset+=n}}static horizontalFilter(t,e,i,n,s){Pt.doHorizontalFilter(t,e,i,n,0,i,!1,s)}static horizontalUnfilter(t,e,i,n,s,a){Pt.doHorizontalFilter(a,t,e,i,n,s,!0,a)}static verticalFilter(t,e,i,n,s){Pt.doVerticalFilter(t,e,i,n,0,i,!1,s)}static verticalUnfilter(t,e,i,n,s,a){Pt.doVerticalFilter(a,t,e,i,n,s,!0,a)}static gradientFilter(t,e,i,n,s){Pt.doGradientFilter(t,e,i,n,0,i,!1,s)}static gradientUnfilter(t,e,i,n,s,a){Pt.doGradientFilter(a,t,e,i,n,s,!0,a)}}Pt.filterNone=0;Pt.filterHorizontal=1;Pt.filterVertical=2;Pt.filterGradient=3;Pt.filterLast=Pt.filterGradient+1;Pt.filterBest=5;Pt.filterFast=6;Pt.filters=[void 0,Pt.horizontalFilter,Pt.verticalFilter,Pt.gradientFilter];Pt.unfilters=[void 0,Pt.horizontalUnfilter,Pt.verticalUnfilter,Pt.gradientUnfilter];class fs{constructor(){this._width=0,this._height=0,this._hasAlpha=!1,this._format=Ot.undefined,this._hasAnimation=!1,this._exifData="",this._xmpData="",this._animLoopCount=0,this._frames=[]}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t}get hasAlpha(){return this._hasAlpha}set hasAlpha(t){this._hasAlpha=t}get format(){return this._format}set format(t){this._format=t}get hasAnimation(){return this._hasAnimation}set hasAnimation(t){this._hasAnimation=t}get iccpData(){return this._iccpData}set iccpData(t){this._iccpData=t}get exifData(){return this._exifData}set exifData(t){this._exifData=t}get xmpData(){return this._xmpData}set xmpData(t){this._xmpData=t}get animLoopCount(){return this._animLoopCount}set animLoopCount(t){this._animLoopCount=t}get frames(){return this._frames}get numFrames(){return this._frames.length}}class oe{get input(){return this._input}get width(){return this._width}get height(){return this._height}get method(){return this._method}get filter(){return this._filter}get preProcessing(){return this._preProcessing}get rsrv(){return this._rsrv}get isAlphaDecoded(){return this._isAlphaDecoded}get vp8l(){return this._vp8l}get use8bDecode(){return this._use8bDecode}get isValid(){return!(this._method<oe.alphaNoCompression||this._method>oe.alphaLosslessCompression||this._filter>=Pt.filterLast||this._preProcessing>oe.alphaPreprocessedLevels||this._rsrv!==0)}constructor(t,e,i){this._width=0,this._height=0,this._method=0,this._filter=0,this._preProcessing=0,this._rsrv=1,this._isAlphaDecoded=!1,this._use8bDecode=!1,this._input=t,this._width=e,this._height=i;const n=t.read();if(this._method=n&3,this._filter=n>>>2&3,this._preProcessing=n>>>4&3,this._rsrv=n>>>6&3,this.isValid)if(this._method===oe.alphaNoCompression){const s=e*i;t.length<s&&(this._rsrv=1)}else this._method===oe.alphaLosslessCompression?this.decodeAlphaHeader()||(this._rsrv=1):this._rsrv=1}dequantizeLevels(t,e,i,n,s){return!(e<=0||i<=0||n<0||s<0||n+s>i)}decodeAlphaImageStream(t,e){return this._vp8l.opaque=e,this._use8bDecode?this._vp8l.decodeAlphaData(this._vp8l.webp.width,this._vp8l.webp.height,t):this._vp8l.decodeImageData(this._vp8l.pixels,this._vp8l.webp.width,this._vp8l.webp.height,t,(i,n)=>this._vp8l.extractAlphaRows(i,n))}decodeAlphaHeader(){const t=new fs;return t.width=this._width,t.height=this._height,this._vp8l=new sn(this._input,t),this._vp8l.ioWidth=this._width,this._vp8l.ioHeight=this._height,this._vp8l.decodeImageStream(t.width,t.height,!0),this._vp8l.transforms.length===1&&this._vp8l.transforms[0].type===de.colorIndexing&&this._vp8l.is8bOptimizable()?(this._use8bDecode=!0,this._vp8l.allocateInternalBuffers8b()):(this._use8bDecode=!1,this._vp8l.allocateInternalBuffers32b(this._width)),!0}decode(t,e,i){if(!this.isValid)return!1;const n=Pt.unfilters[this._filter];if(this._method===oe.alphaNoCompression){const s=t*this._width,a=e*this._width;F.copyRange(this._input.buffer,this._input.position+s,i,s,a)}else if(!this.decodeAlphaImageStream(t+e,i))return!1;return n!==void 0&&n(this._width,this._height,this._width,t,e,i),this._preProcessing===oe.alphaPreprocessedLevels&&!this.dequantizeLevels(i,this._width,this._height,t,e)?!1:(t+e>=this._height&&(this._isAlphaDecoded=!0),!0)}}oe.alphaNoCompression=0;oe.alphaLosslessCompression=1;oe.alphaPreprocessedLevels=1;class S{get webp(){return this._webp}constructor(t,e){this._frameHeader=new ra,this._picHeader=new oa,this._filterHeader=new aa,this._segmentHeader=new fa,this._cropLeft=0,this._cropRight=0,this._cropTop=0,this._cropBottom=0,this._mbWidth=0,this._mbHeight=0,this._tlMbX=0,this._tlMbY=0,this._brMbX=0,this._brMbY=0,this._numPartitions=0,this._partitions=F.fill(S.maxNumPartitions,void 0),this._useSkipProba=!1,this._skipP=0,this._dqm=F.fill(S.numMbSegments,void 0),this._segment=0,this._intraL=new Uint8Array(4),this._mbX=0,this._mbY=0,this._dither=!1,this._input=t,this._webp=e}decode(){if(this.getHeaders()&&(this._output=new tt({width:this._webp.width,height:this._webp.height,numChannels:4}),!!this.initFrame()&&this.parseFrame())){if(this._webp.exifData.length>0){const t=new D({buffer:Bt.getCodePoints(this._webp.exifData)});this._output.exifData=me.fromInputBuffer(t)}return this._output}}decodeHeader(){const t=this._input.readUint24();return!((t&1)===0)||(t>>>1&7)>3||!(t>>>4&1)||(this._frameHeader.keyFrame=(t&1)===0,this._frameHeader.profile=t>>>1&7,this._frameHeader.show=t>>>4&1,this._frameHeader.partitionLength=t>>>5,this._input.readUint24()!==S.vp8Signature)?!1:(this._webp.width=this._input.readUint16(),this._webp.height=this._input.readUint16(),!0)}macroBlockVPos(t){return t*16}getHeaders(){if(!this.decodeHeader())return!1;this._proba=new ca;for(let t=0;t<S.numMbSegments;++t)this._dqm[t]=new da;return this._picHeader.width=this._webp.width,this._picHeader.height=this._webp.height,this._picHeader.xscale=this._webp.width>>>8>>>6,this._picHeader.yscale=this._webp.height>>>8>>>6,this._cropTop=0,this._cropLeft=0,this._cropRight=this._webp.width,this._cropBottom=this._webp.height,this._mbWidth=this._webp.width+15>>>4,this._mbHeight=this._webp.height+15>>>4,this._segment=0,this._br=new fi(this._input.subarray(this._frameHeader.partitionLength)),this._input.skip(this._frameHeader.partitionLength),this._picHeader.colorspace=this._br.get(),this._picHeader.clampType=this._br.get(),!this.parseSegmentHeader(this._segmentHeader,this._proba)||!this.parseFilterHeader()||!this.parsePartitions(this._input)?!1:(this.parseQuant(),this._br.get(),this.parseProba(),!0)}parseSegmentHeader(t,e){if(t.useSegment=this._br.get()!==0,t.useSegment){if(t.updateMap=this._br.get()!==0,this._br.get()!==0){t.absoluteDelta=this._br.get()!==0;for(let i=0;i<S.numMbSegments;++i)t.quantizer[i]=this._br.get()!==0?this._br.getSignedValue(7):0;for(let i=0;i<S.numMbSegments;++i)t.filterStrength[i]=this._br.get()!==0?this._br.getSignedValue(6):0}if(t.updateMap)for(let i=0;i<S.mbFeatureTreeProbs;++i)e.segments[i]=this._br.get()!==0?this._br.getValue(8):255}else t.updateMap=!1;return!0}parseFilterHeader(){const t=this._filterHeader;if(this._filterHeader.simple=this._br.get()!==0,this._filterHeader.level=this._br.getValue(6),this._filterHeader.sharpness=this._br.getValue(3),this._filterHeader.useLfDelta=this._br.get()!==0,t.useLfDelta&&this._br.get()!==0){for(let e=0;e<S.numRefLfDeltas;++e)this._br.get()!==0&&(t.refLfDelta[e]=this._br.getSignedValue(6));for(let e=0;e<S.numModeLfDeltas;++e)this._br.get()!==0&&(t.modeLfDelta[e]=this._br.getSignedValue(6))}return this._filterType=t.level===0?0:t.simple?1:2,!0}parsePartitions(t){let e=0;const i=t.length;this._numPartitions=1<<this._br.getValue(2);const n=this._numPartitions-1;let s=n*3;if(i<s)return!1;for(let r=0;r<n;++r){const h=t.peek(3,e),l=h.get(0)|h.get(1)<<8|h.get(2)<<16;let u=s+l;u>i&&(u=i);const d=t.subarray(u-s,s);this._partitions[r]=new fi(d),s=u,e+=3}const a=t.subarray(i-s,t.position+s);return this._partitions[n]=new fi(a),s<i}parseQuant(){const t=this._br.getValue(7),e=this._br.get()!==0?this._br.getSignedValue(4):0,i=this._br.get()!==0?this._br.getSignedValue(4):0,n=this._br.get()!==0?this._br.getSignedValue(4):0,s=this._br.get()!==0?this._br.getSignedValue(4):0,a=this._br.get()!==0?this._br.getSignedValue(4):0,r=this._segmentHeader;for(let h=0;h<S.numMbSegments;++h){let l=0;if(r.useSegment)l=r.quantizer[h],r.absoluteDelta||(l+=t);else if(h>0){this._dqm[h]=this._dqm[0];continue}else l=t;const u=this._dqm[h];u.y1Mat[0]=S.dcTable[S.clip(l+e,127)],u.y1Mat[1]=S.acTable[S.clip(l+0,127)],u.y2Mat[0]=S.dcTable[S.clip(l+i,127)]*2,u.y2Mat[1]=S.acTable[S.clip(l+n,127)]*101581>>>16,u.y2Mat[1]<8&&(u.y2Mat[1]=8),u.uvMat[0]=S.dcTable[S.clip(l+s,117)],u.uvMat[1]=S.acTable[S.clip(l+a,127)],u.uvQuant=l+a}}parseProba(){const t=this._proba;for(let e=0;e<S.numTypes;++e)for(let i=0;i<S.numBands;++i)for(let n=0;n<S.numCtx;++n)for(let s=0;s<S.numProbas;++s){const a=this._br.getBit(S.coeffsUpdateProba[e][i][n][s])!==0?this._br.getValue(8):S.coeffsProba0[e][i][n][s];t.bands[e][i].probas[n][s]=a}this._useSkipProba=this._br.get()!==0,this._useSkipProba&&(this._skipP=this._br.getValue(8))}initFrame(){this._webp.alphaData!==void 0&&(this._alphaData=this._webp.alphaData),this._fStrengths=F.generate(S.numMbSegments,()=>[new Yn,new Yn]),this._yuvT=F.generate(this._mbWidth,()=>new ga),this._yuvBlock=new Uint8Array(S.yuvSize),this._intraT=new Uint8Array(4*this._mbWidth),this._cacheYStride=16*this._mbWidth,this._cacheUVStride=8*this._mbWidth;const t=S.filterExtraRows[this._filterType],e=t*this._cacheYStride,i=Math.trunc(t/2)*this._cacheUVStride;this._cacheY=new D({buffer:new Uint8Array(16*this._cacheYStride+e),offset:e}),this._cacheU=new D({buffer:new Uint8Array(8*this._cacheUVStride+i),offset:i}),this._cacheV=new D({buffer:new Uint8Array(8*this._cacheUVStride+i),offset:i}),this._tmpY=new D({buffer:new Uint8Array(this._webp.width)});const n=this._webp.width+1>>>1;this._tmpU=new D({buffer:new Uint8Array(n)}),this._tmpV=new D({buffer:new Uint8Array(n)});const s=S.filterExtraRows[this._filterType];return this._filterType===2?(this._tlMbX=0,this._tlMbY=0):(this._tlMbX=Math.trunc((this._cropLeft-s)/16),this._tlMbY=Math.trunc((this._cropTop-s)/16),this._tlMbX<0&&(this._tlMbX=0),this._tlMbY<0&&(this._tlMbY=0)),this._brMbY=Math.trunc((this._cropBottom+15+s)/16),this._brMbX=Math.trunc((this._cropRight+15+s)/16),this._brMbX>this._mbWidth&&(this._brMbX=this._mbWidth),this._brMbY>this._mbHeight&&(this._brMbY=this._mbHeight),this._mbInfo=F.generate(this._mbWidth+1,()=>new ha),this._mbData=F.generate(this._mbWidth,()=>new la),this._fInfo=F.fill(this._mbWidth,void 0),this.precomputeFilterStrengths(),this._dsp=new Ht,!0}precomputeFilterStrengths(){if(this._filterType>0){const t=this._filterHeader;for(let e=0;e<S.numMbSegments;++e){let i=0;this._segmentHeader.useSegment?(i=this._segmentHeader.filterStrength[e],this._segmentHeader.absoluteDelta||(i+=t.level)):i=t.level;for(let n=0;n<=1;++n){const s=this._fStrengths[e][n];let a=i;if(t.useLfDelta&&(a+=t.refLfDelta[0],n!==0&&(a+=t.modeLfDelta[0])),a=a<0?0:a>63?63:a,a>0){let r=a;t.sharpness>0&&(t.sharpness>4?r>>>=2:r>>>=1,r>9-t.sharpness&&(r=9-t.sharpness)),r<1&&(r=1),s.fInnerLevel=r,s.fLimit=2*a+r,s.hevThresh=a>=40?2:a>=15?1:0}else s.fLimit=0;s.fInner=n!==0}}}}parseFrame(){for(this._mbY=0;this._mbY<this._brMbY;++this._mbY){const t=this._partitions[this._mbY&this._numPartitions-1];for(;this._mbX<this._mbWidth;++this._mbX)if(!this.decodeMB(t))return!1;if(this._mbInfo[0].nz=0,this._mbInfo[0].nzDc=0,this._intraL.fill(S.bDcPred),this._mbX=0,!this.processRow())return!1}return!0}processRow(){this.reconstructRow();const t=this._filterType>0&&this._mbY>=this._tlMbY&&this._mbY<=this._brMbY;return this.finishRow(t)}reconstructRow(){const t=this._mbY,e=new D({buffer:this._yuvBlock,offset:S.yOffset}),i=new D({buffer:this._yuvBlock,offset:S.uOffset}),n=new D({buffer:this._yuvBlock,offset:S.vOffset});for(let s=0;s<this._mbWidth;++s){const a=this._mbData[s];if(s>0){for(let x=-1;x<16;++x)e.memcpy(x*S.bps-4,4,e,x*S.bps+12);for(let x=-1;x<8;++x)i.memcpy(x*S.bps-4,4,i,x*S.bps+4),n.memcpy(x*S.bps-4,4,n,x*S.bps+4)}else{for(let x=0;x<16;++x)e.set(x*S.bps-1,129);for(let x=0;x<8;++x)i.set(x*S.bps-1,129),n.set(x*S.bps-1,129);t>0&&e.set(-1-S.bps,i.set(-1-S.bps,n.set(-1-S.bps,129)))}const r=this._yuvT[s],h=a.coeffs;let l=a.nonZeroY;if(t>0?(e.memcpy(-S.bps,16,r.y),i.memcpy(-S.bps,8,r.u),n.memcpy(-S.bps,8,r.v)):s===0&&(e.memset(-S.bps-1,16+4+1,127),i.memset(-S.bps-1,8+1,127),n.memset(-S.bps-1,8+1,127)),a.isIntra4x4){const x=D.from(e,-S.bps+16),b=x.toUint32Array();t>0&&(s>=this._mbWidth-1?x.memset(0,4,r.y[15]):x.memcpy(0,4,this._yuvT[s+1].y));const p=b[0];b[3*S.bps]=p,b[2*S.bps]=p,b[S.bps]=p;for(let w=0;w<16;++w,l=l<<2&4294967295){const C=D.from(e,S.kScan[w]);Ht.predLuma4[a.imodes[w]](C),this.doTransform(l,new D({buffer:h,offset:w*16}),C)}}else{const x=S.checkMode(s,t,a.imodes[0]);if(Ht.predLuma16[x](e),l!==0)for(let b=0;b<16;++b,l=l<<2&4294967295){const p=D.from(e,S.kScan[b]);this.doTransform(l,new D({buffer:h,offset:b*16}),p)}}const u=a.nonZeroUV,d=S.checkMode(s,t,a.uvmode);Ht.predChroma8[d](i),Ht.predChroma8[d](n);const c=new D({buffer:h,offset:16*16});this.doUVTransform(u,c,i);const g=new D({buffer:h,offset:20*16});this.doUVTransform(u>>>8,g,n),t<this._mbHeight-1&&(F.copyRange(e.toUint8Array(),15*S.bps,r.y,0,16),F.copyRange(i.toUint8Array(),7*S.bps,r.u,0,8),F.copyRange(n.toUint8Array(),7*S.bps,r.v,0,8));const f=s*16,m=s*8,_=s*8;for(let x=0;x<16;++x)this._cacheY.memcpy(f+x*this._cacheYStride,16,e,x*S.bps);for(let x=0;x<8;++x){let b=m+x*this._cacheUVStride;this._cacheU.memcpy(b,8,i,x*S.bps),b=_+x*this._cacheUVStride,this._cacheV.memcpy(b,8,n,x*S.bps)}}}doFilter(t,e){const i=this._cacheYStride,n=this._fInfo[t],s=D.from(this._cacheY,t*16),a=n.fInnerLevel,r=n.fLimit;if(r!==0)if(this._filterType===1)t>0&&this._dsp.simpleHFilter16(s,i,r+4),n.fInner&&this._dsp.simpleHFilter16i(s,i,r),e>0&&this._dsp.simpleVFilter16(s,i,r+4),n.fInner&&this._dsp.simpleVFilter16i(s,i,r);else{const h=this._cacheUVStride,l=D.from(this._cacheU,t*8),u=D.from(this._cacheV,t*8),d=n.hevThresh;t>0&&(this._dsp.hFilter16(s,i,r+4,a,d),this._dsp.hFilter8(l,u,h,r+4,a,d)),n.fInner&&(this._dsp.hFilter16i(s,i,r,a,d),this._dsp.hFilter8i(l,u,h,r,a,d)),e>0&&(this._dsp.vFilter16(s,i,r+4,a,d),this._dsp.vFilter8(l,u,h,r+4,a,d)),n.fInner&&(this._dsp.vFilter16i(s,i,r,a,d),this._dsp.vFilter8i(l,u,h,r,a,d))}}filterRow(){for(let t=this._tlMbX;t<this._brMbX;++t)this.doFilter(t,this._mbY)}ditherRow(){}finishRow(t){const e=S.kFilterExtraRows[this._filterType],i=e*this._cacheYStride,n=Math.trunc(e/2)*this._cacheUVStride,s=D.from(this._cacheY,-i),a=D.from(this._cacheU,-n),r=D.from(this._cacheV,-n),h=this._mbY,l=h===0,u=h>=this._brMbY-1;let d=this.macroBlockVPos(h),c=this.macroBlockVPos(h+1);if(t&&this.filterRow(),this._dither&&this.ditherRow(),l?(this._y=D.from(this._cacheY),this._u=D.from(this._cacheU),this._v=D.from(this._cacheV)):(d-=e,this._y=D.from(s),this._u=D.from(a),this._v=D.from(r)),u||(c-=e),c>this._cropBottom&&(c=this._cropBottom),this._a=void 0,this._alphaData!==void 0&&d<c&&(this._a=this.decompressAlphaRows(d,c-d),this._a===void 0))return!1;if(d<this._cropTop){const g=this._cropTop-d;d=this._cropTop,this._y.offset+=this._cacheYStride*g,this._u.offset+=this._cacheUVStride*(g>>>1),this._v.offset+=this._cacheUVStride*(g>>>1),this._a!==void 0&&(this._a.offset+=this._webp.width*g)}return d<c&&(this._y.offset+=this._cropLeft,this._u.offset+=this._cropLeft>>>1,this._v.offset+=this._cropLeft>>>1,this._a!==void 0&&(this._a.offset+=this._cropLeft),this.put(d-this._cropTop,this._cropRight-this._cropLeft,c-d)),u||(this._cacheY.memcpy(-i,i,s,16*this._cacheYStride),this._cacheU.memcpy(-n,n,a,8*this._cacheUVStride),this._cacheV.memcpy(-n,n,r,8*this._cacheUVStride)),!0}put(t,e,i){return e<=0||i<=0?!1:(this.emitFancyRGB(t,e,i),this.emitAlphaRGB(t,e,i),!0)}emitAlphaRGB(t,e,i){if(this._a===void 0)return;const n=D.from(this._a);let s=t,a=i;s===0?--a:(--s,n.offset-=this.webp.width),this._cropTop+t+i===this._cropBottom&&(a=this._cropBottom-this._cropTop-s);for(let r=0;r<a;++r){for(let h=0;h<e;++h)this._output.getPixel(h,r+s).a=n.get(h);n.offset+=this.webp.width}}emitFancyRGB(t,e,i){let n=i;const s=new Uint8Array(this._output.buffer),a=new D({buffer:s,offset:t*this.webp.width*4}),r=D.from(this._y),h=D.from(this._u),l=D.from(this._v);let u=t;const d=t+i,c=e+1>>>1,g=this.webp.width*4,f=D.from(this._tmpU),m=D.from(this._tmpV);for(u===0?this.upSample(r,void 0,h,l,h,l,a,void 0,e):(this.upSample(this._tmpY,r,f,m,h,l,D.from(a,-g),a,e),++n),f.buffer=h.buffer,m.buffer=l.buffer;u+2<d;u+=2)f.offset=h.offset,m.offset=l.offset,h.offset+=this._cacheUVStride,l.offset+=this._cacheUVStride,a.offset+=2*g,r.offset+=2*this._cacheYStride,this.upSample(D.from(r,-this._cacheYStride),r,f,m,h,l,D.from(a,-g),a,e);return r.offset+=this._cacheYStride,this._cropTop+d<this._cropBottom?(this._tmpY.memcpy(0,e,r),this._tmpU.memcpy(0,c,h),this._tmpV.memcpy(0,c,l),n--):d&1||this.upSample(r,void 0,h,l,h,l,D.from(a,g),void 0,e),n}decompressAlphaRows(t,e){const i=this.webp.width,n=this.webp.height;if(!(t<0||e<=0||t+e>n)&&(t===0&&(this._alphaPlane=new Uint8Array(i*n),this._alpha=new oe(this._alphaData,i,n)),!(this._alpha!==void 0&&!this._alpha.isAlphaDecoded&&!this._alpha.decode(t,e,this._alphaPlane))))return new D({buffer:this._alphaPlane,offset:t*i})}decodeMB(t){const e=this._mbInfo[0],i=this._mbInfo[1+this._mbX],n=this._mbData[this._mbX];let s=!1;if(this._segmentHeader.updateMap&&(this._segment=this._br.getBit(this._proba.segments[0])===0?this._br.getBit(this._proba.segments[1]):2+this._br.getBit(this._proba.segments[2])),s=this._useSkipProba&&this._br.getBit(this._skipP)!==0,this.parseIntraMode(),s?(i.nz=0,e.nz=i.nz,n.isIntra4x4||(i.nzDc=0,e.nzDc=i.nzDc),n.nonZeroY=0,n.nonZeroUV=0):s=this.parseResiduals(i,t),this._filterType>0){this._fInfo[this._mbX]=this._fStrengths[this._segment][n.isIntra4x4?1:0];const a=this._fInfo[this._mbX];a.fInner=a.fInner||!s}return!0}parseResiduals(t,e){const i=this._proba.bands,n=this._dqm[this._segment],s=this._mbData[this._mbX],a=new D({buffer:s.coeffs}),r=this._mbInfo[0];let h=0,l=0,u=0,d=0,c=0,g=0,f=0;a.memset(0,a.length,0);let m=[];if(s.isIntra4x4)f=0,m=i[3];else{const _=new D({buffer:new Int16Array(16)}),x=t.nzDc+r.nzDc,b=this.getCoeffs(e,i[1],x,n.y2Mat,0,_);if(r.nzDc=b>0?1:0,t.nzDc=r.nzDc,b>1)this.transformWHT(_,a);else{const p=_.get(0)+3>>>3;for(let w=0;w<16*16;w+=16)a.set(w,p)}f=1,m=i[0]}h=t.nz&15,l=r.nz&15;for(let _=0;_<4;++_){let x=l&1,b=0;for(let p=0;p<4;++p){const w=x+(h&1),C=this.getCoeffs(e,m,w,n.y1Mat,f,a);x=C>f?1:0,h=h>>>1|x<<7,b=this.nzCodeBits(b,C,a.get(0)!==0?1:0),a.offset+=16}h>>>=4,l=l>>>1|x<<7,u=(u<<8|b)>>>0}c=h,g=l>>>4;for(let _=0;_<4;_+=2){let x=0;h=t.nz>>>4+_,l=r.nz>>>4+_;for(let b=0;b<2;++b){let p=l&1;for(let w=0;w<2;++w){const C=p+(h&1),y=this.getCoeffs(e,i[2],C,n.uvMat,0,a);p=y>0?1:0,h=h>>>1|p<<3,x=this.nzCodeBits(x,y,a.get(0)!==0?1:0),a.offset+=16}h>>>=2,l=l>>>1|p<<5}d|=x<<4*_,c|=h<<4<<_,g|=(l&240)<<_}return t.nz=c,r.nz=g,s.nonZeroY=u,s.nonZeroUV=d,s.dither=d&43690?0:n.dither,(u|d)===0}parseIntraMode(){const t=4*this._mbX,e=0,i=this._intraT,n=this._intraL,s=this._mbData[this._mbX];if(s.isIntra4x4=this._br.getBit(145)===0,s.isIntra4x4){const a=s.imodes;let r=0;for(let h=0;h<4;++h){let l=n[h];for(let u=0;u<4;++u){const d=S.kBModesProba[i[t+u]][l],c=this._br.getBit(d[0]);let g=S.kYModesIntra4[c];for(;g>0;)g=S.kYModesIntra4[2*g+this._br.getBit(d[g])];l=-g,i[t+u]=l}F.copyRange(i,t,a,r,4),r+=4,n[h]=l}}else{const a=this._br.getBit(156)!==0?this._br.getBit(128)!==0?S.tmPred:S.hPred:this._br.getBit(163)!==0?S.vPred:S.dcPred;s.imodes[0]=a,i.fill(a,t,t+4),n.fill(a,e,e+4)}s.uvmode=this._br.getBit(142)===0?S.dcPred:this._br.getBit(114)===0?S.vPred:this._br.getBit(183)!==0?S.tmPred:S.hPred}doTransform(t,e,i){switch(t>>>30){case 3:this._dsp.transform(e,i,!1);break;case 2:this._dsp.transformAC3(e,i);break;case 1:this._dsp.transformDC(e,i);break}}doUVTransform(t,e,i){t&255&&(t&170?this._dsp.transformUV(e,i):this._dsp.transformDCUV(e,i))}transformWHT(t,e){const i=new Int32Array(16);let n=0;for(let s=0;s<4;++s){const a=t.get(0+s)+t.get(12+s),r=t.get(4+s)+t.get(8+s),h=t.get(4+s)-t.get(8+s),l=t.get(0+s)-t.get(12+s);i[0+s]=a+r,i[8+s]=a-r,i[4+s]=l+h,i[12+s]=l-h}for(let s=0;s<4;++s){const a=i[0+s*4]+3,r=a+i[3+s*4],h=i[1+s*4]+i[2+s*4],l=i[1+s*4]-i[2+s*4],u=a-i[3+s*4];e.set(n+0,r+h>>>3),e.set(n+16,u+l>>>3),e.set(n+32,r-h>>>3),e.set(n+48,u-l>>>3),n+=64}}nzCodeBits(t,e,i){let n=t;return n<<=2,n|=e>3?3:e>1?2:i,n}getLargeValue(t,e){let i=0;if(t.getBit(e[3])===0)i=t.getBit(e[4])===0?2:3+t.getBit(e[5]);else if(t.getBit(e[6])===0)i=t.getBit(e[7])===0?5+t.getBit(159):7+2*t.getBit(165)+t.getBit(145);else{const n=t.getBit(e[8]),s=t.getBit(e[9+n]),a=2*n+s;i=0;const r=S.kCat3456[a],h=r.length;for(let l=0;l<h;++l)i+=i+t.getBit(r[l]);i+=3+(8<<a)}return i}getCoeffs(t,e,i,n,s,a){let r=s,h=e[r].probas[i];for(;r<16;++r){if(t.getBit(h[0])===0)return r;for(;t.getBit(h[1])===0;)if(h=e[S.kBands[++r]].probas[0],r===16)return 16;{const l=e[S.kBands[r+1]].probas;let u=0;t.getBit(h[2])===0?(u=1,h=l[1]):(u=this.getLargeValue(t,h),h=l[2]),a.set(S.kZigzag[r],t.getSigned(u)*n[r>0?1:0])}}return 16}static clip(t,e){return t<0?0:t>e?e:t}static checkMode(t,e,i){return i===S.bDcPred?t===0?e===0?S.bDcPredNoTopLeft:S.bDcPredNoLeft:e===0?S.bDcPredNoTop:S.bDcPred:i}clip8(t){return t&S.xorYuvMask2?t<0?0:255:t>>>S.yuvFix2}yuvToR(t,e){return this.clip8(S.kYScale*t+S.kVToR*e+S.kRCst)}yuvToG(t,e,i){return this.clip8(S.kYScale*t-S.kUToG*e-S.kVToG*i+S.kGCst)}yuvToB(t,e){return this.clip8(S.kYScale*t+S.kUToB*e+S.kBCst)}yuvToRgb(t,e,i,n){n.set(0,this.yuvToR(t,i)),n.set(1,this.yuvToG(t,e,i)),n.set(2,this.yuvToB(t,e))}yuvToRgba(t,e,i,n){this.yuvToRgb(t,e,i,n),n.set(3,255)}upSample(t,e,i,n,s,a,r,h,l){const u=(m,_)=>m|_<<16,d=l-1>>>1;let c=u(i.get(0),n.get(0)),g=u(s.get(0),a.get(0)),f=3*c+g+131074>>>2;this.yuvToRgba(t.get(0),f&255,f>>>16,r),e!==void 0&&(f=3*g+c+131074>>>2,this.yuvToRgba(e.get(0),f&255,f>>>16,h));for(let m=1;m<=d;++m){const _=u(i.get(m),n.get(m)),x=u(s.get(m),a.get(m)),b=c+_+g+x+524296,p=b+2*(_+g)>>>3,w=b+2*(c+x)>>>3;let C=p+c>>>1,y=w+_>>>1;this.yuvToRgba(t.get(2*m-1),C&255,C>>>16,D.from(r,(2*m-1)*4)),this.yuvToRgba(t.get(2*m),y&255,y>>>16,D.from(r,2*m*4)),e!==void 0&&(C=w+g>>>1,y=p+x>>>1,this.yuvToRgba(e.get(2*m-1),C&255,C>>>16,D.from(h,(2*m-1)*4)),this.yuvToRgba(e.get(2*m),y&255,y>>>16,D.from(h,(2*m+0)*4))),c=_,g=x}l&1||(f=3*c+g+131074>>>2,this.yuvToRgba(t.get(l-1),f&255,f>>>16,D.from(r,(l-1)*4)),e!==void 0&&(f=3*g+c+131074>>>2,this.yuvToRgba(e.get(l-1),f&255,f>>>16,D.from(h,(l-1)*4))))}}S.filterExtraRows=[0,2,8];S.vp8Signature=2752925;S.mbFeatureTreeProbs=3;S.numMbSegments=4;S.numRefLfDeltas=4;S.numModeLfDeltas=4;S.maxNumPartitions=8;S.bDcPred=0;S.bTmPred=1;S.bVePred=2;S.bHePred=3;S.bRdPred=4;S.bVrPred=5;S.bLdPred=6;S.bVlPred=7;S.bHdPred=8;S.bHuPred=9;S.numBModes=S.bHuPred+1-S.bDcPred;S.dcPred=S.bDcPred;S.vPred=S.bVePred;S.hPred=S.bHePred;S.tmPred=S.bTmPred;S.bPred=S.numBModes;S.bDcPredNoTop=4;S.bDcPredNoLeft=5;S.bDcPredNoTopLeft=6;S.numBDcModes=7;S.numTypes=4;S.numBands=8;S.numCtx=3;S.numProbas=11;S.bps=32;S.yuvSize=S.bps*17+S.bps*9;S.ySize=S.bps*17;S.yOffset=Number(S.bps)+8;S.uOffset=S.yOffset+S.bps*16+S.bps;S.vOffset=S.uOffset+16;S.yuvFix=16;S.yuvHalf=1<<S.yuvFix-1;S.yuvMask=(256<<S.yuvFix)-1;S.yuvRangeMin=-227;S.yuvRangeMax=256+226;S.yuvFix2=14;S.yuvHalf2=1<<S.yuvFix2-1;S.yuvMask2=(256<<S.yuvFix2)-1;S.xorYuvMask2=-S.yuvMask2-1;S.kYScale=19077;S.kVToR=26149;S.kUToG=6419;S.kVToG=13320;S.kUToB=33050;S.kRCst=-S.kYScale*16-S.kVToR*128+S.yuvHalf2;S.kGCst=-S.kYScale*16+S.kUToG*128+S.kVToG*128+S.yuvHalf2;S.kBCst=-S.kYScale*16-S.kUToB*128+S.yuvHalf2;S.kYModesIntra4=[-S.bDcPred,1,-S.bTmPred,2,-S.bVePred,3,4,6,-S.bHePred,5,-S.bRdPred,-S.bVrPred,-S.bLdPred,7,-S.bVlPred,8,-S.bHdPred,-S.bHuPred];S.kBModesProba=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]];S.coeffsProba0=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]];S.coeffsUpdateProba=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]];S.dcTable=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157];S.acTable=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284];S.kScan=[0+0*S.bps,4+0*S.bps,8+0*S.bps,12+0*S.bps,0+4*S.bps,4+4*S.bps,8+4*S.bps,12+4*S.bps,0+8*S.bps,4+8*S.bps,8+8*S.bps,12+8*S.bps,0+12*S.bps,4+12*S.bps,8+12*S.bps,12+12*S.bps];S.kBands=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0];S.kCat3=[173,148,140];S.kCat4=[176,155,140,135];S.kCat5=[180,157,141,134,130];S.kCat6=[254,254,243,230,196,177,153,140,133,130,129];S.kCat3456=[S.kCat3,S.kCat4,S.kCat5,S.kCat6];S.kZigzag=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15];S.kFilterExtraRows=[0,2,8];class wn{get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}get duration(){return this._duration}get framePosition(){return this._framePosition}get frameSize(){return this._frameSize}get clearFrame(){return this._clearFrame}get isValid(){return this._reserved===0}constructor(t,e){this._reserved=1,this._x=t.readUint24()*2,this._y=t.readUint24()*2,this._width=t.readUint24()+1,this._height=t.readUint24()+1,this._duration=t.readUint24();const i=t.read();this._reserved=(i&127)>>>7,this._clearFrame=(i&1)!==0,this._framePosition=t.position,this._frameSize=e-wn.animFrameHeaderSize}}wn.animFrameHeaderSize=16;class $n extends fs{constructor(){super(...arguments),this._frameCount=0,this._frame=0,this._alphaSize=0,this._vp8Position=0,this._vp8Size=0}get frameCount(){return this._frameCount}set frameCount(t){this._frameCount=t}get frame(){return this._frame}set frame(t){this._frame=t}get alphaData(){return this._alphaData}set alphaData(t){this._alphaData=t}get alphaSize(){return this._alphaSize}set alphaSize(t){this._alphaSize=t}get vp8Position(){return this._vp8Position}set vp8Position(t){this._vp8Position=t}get vp8Size(){return this._vp8Size}set vp8Size(t){this._vp8Size=t}}class xa{get info(){return this._info}get format(){return le.webp}get numFrames(){return this._info!==void 0?this._info.numFrames:0}constructor(t){t!==void 0&&this.startDecode(t)}decodeFrameInternal(t,e=0){const i=new $n;if(this.getInfo(t,i)&&i.format!==Ot.undefined)if(i.frame=e,i.frameCount=this._info.numFrames,i.hasAnimation){if(e>=i.frames.length||e<0)return;const n=i.frames[e],s=t.subarray(n.frameSize,n.framePosition);return this.decodeFrameInternal(s,e)}else{const n=t.subarray(i.vp8Size,i.vp8Position);if(i.format===Ot.lossless)return new I(n,i).decode();if(i.format===Ot.lossy)return new S(n,i).decode()}}getHeader(t){let e=t.readString(4);return!(e!=="RIFF"||(t.readUint32(),e=t.readString(4),e!=="WEBP"))}getInfo(t,e){for(;!t.isEOS;){const i=t.readString(4),n=t.readUint32(),s=n+1>>>1<<1,a=t.position;switch(i){case"VP8X":if(!this.getVp8xInfo(t,e))return!1;break;case"VP8 ":e.vp8Position=t.position,e.vp8Size=n,e.format=Ot.lossy;break;case"VP8L":e.vp8Position=t.position,e.vp8Size=n,e.format=Ot.lossless;break;case"ALPH":e.alphaData=new D({buffer:t.buffer,bigEndian:t.bigEndian}),e.alphaData.offset=t.offset,e.alphaSize=n,t.skip(s);break;case"ANIM":if(e.format=Ot.animated,!this.getAnimInfo(t,e))return!1;break;case"ANMF":if(!this.getAnimFrameInfo(t,e,n))return!1;break;case"ICCP":e.iccpData=t.readRange(n).toUint8Array();break;case"EXIF":e.exifData=t.readString(n);break;case"XMP ":e.xmpData=t.readString(n);break;default:t.skip(s);break}const r=s-(t.position-a);r>0&&t.skip(r)}return e.hasAlpha||(e.hasAlpha=e.alphaData!==void 0),e.format!==Ot.undefined}getVp8xInfo(t,e){const i=t.read();if(i&192)return!1;const n=i>>>4&1,s=i>>>1&1;if(i&1||t.readUint24()!==0)return!1;const a=t.readUint24()+1,r=t.readUint24()+1;return e.width=a,e.height=r,e.hasAnimation=s!==0,e.hasAlpha=n!==0,!0}getAnimInfo(t,e){const i=t.readUint32(),n=i&255,s=i>>>8&255,a=i>>>16&255,r=i>>>24&255;return e.backgroundColor=new Ci(s,a,r,n),e.animLoopCount=t.readUint16(),!0}getAnimFrameInfo(t,e,i){const n=new wn(t,i);return n.isValid?(e.frames.push(n),!0):!1}isValidFile(t){return this._input=new D({buffer:t}),!!this.getHeader(this._input)}startDecode(t){if(this._input=new D({buffer:t}),!!this.getHeader(this._input)&&(this._info=new $n,!!this.getInfo(this._input,this._info)))switch(this._info.format){case Ot.animated:return this._info.frameCount=this._info.frames.length,this._info;case Ot.lossless:return this._input.offset=this._info.vp8Position,new I(this._input,this._info).decodeHeader()?(this._info.frameCount=this._info.frames.length,this._info):void 0;case Ot.lossy:return this._input.offset=this._info.vp8Position,new S(this._input,this._info).decodeHeader()?(this._info.frameCount=this._info.frames.length,this._info):void 0;case Ot.undefined:throw new W("Unknown format for WebP")}}decode(t){var e;if(this.startDecode(t.bytes)===void 0)return;if(!this._info.hasAnimation||t.frameIndex!==void 0)return this.decodeFrame((e=t.frameIndex)!==null&&e!==void 0?e:0);let i,n;for(let s=0;s<this._info.numFrames;++s){this._info.frame=s;const a=this._info.frames[s],r=this.decodeFrame(s);r!==void 0&&(r.frameDuration=a.duration,i===void 0||n===void 0?(i=new tt({width:this._info.width,height:this._info.height,numChannels:r.numChannels,format:r.format,frameDuration:r.frameDuration}),n=i):(n=tt.from(n),a.clearFrame&&n.clear()),G.compositeImage({dst:n,src:r,dstX:a.x,dstY:a.y}),i.addFrame(n))}return i}decodeFrame(t){if(!(this._input===void 0||this._info===void 0)){if(this._info.hasAnimation){if(t>=this._info.frames.length||t<0)return;const e=this._info.frames[t],i=this._input.subarray(e.frameSize,e.framePosition);return this.decodeFrameInternal(i,t)}if(this._info.format===Ot.lossless){const e=this._input.subarray(this._info.vp8Size,this._info.vp8Position);return new I(e,this._info).decode()}else if(this._info.format===Ot.lossy){const e=this._input.subarray(this._info.vp8Size,this._info.vp8Position);return new S(e,this._info).decode()}}}}var jt;(function(o){o[o.invalid=0]="invalid",o[o.pbm=1]="pbm",o[o.pgm2=2]="pgm2",o[o.pgm5=3]="pgm5",o[o.ppm3=4]="ppm3",o[o.ppm6=5]="ppm6"})(jt||(jt={}));class Ei{get width(){return this._width}set width(t){this._width=t}set height(t){this._height=t}get height(){return this._height}get backgroundColor(){return this._backgroundColor}get numFrames(){return this._numFrames}get format(){return this._format}constructor(t){this._width=0,this._height=0,this._backgroundColor=void 0,this._numFrames=1,this._format=jt.invalid,this._format=t}}class ba{constructor(){this._tokens=[]}get input(){return this._input}get info(){return this._info}get format(){return le.pnm}get numFrames(){return this._info!==void 0?1:0}getNextToken(){var t;if(this._input===void 0)return"";if(this._tokens.length>0)return this._tokens.shift();let e=this._input.readStringLine().trim();if(e.length===0)return"";for(;e.startsWith("#");)e=this._input.readStringLine(70).trim();const i=e.split(" ").filter(n=>n.length>0);for(let n=0;n<i.length;++n)if(i[n].startsWith("#")){i.length=n;break}return this._tokens.push(...i),(t=this._tokens.shift())!==null&&t!==void 0?t:""}parseNextInt(){const t=this.getNextToken();if(t.length===0)return 0;const e=parseInt(t);return isNaN(e)?0:e}formatFromMaxValue(t){return t>255?v.uint16:t>15?v.uint8:t>3?v.uint4:t>1?v.uint2:v.uint1}readValue(t,e){return t===jt.pgm5||t===jt.ppm6?this.input.read():this.parseNextInt()}isValidFile(t){this._input=new D({buffer:t});const e=this.getNextToken();return e==="P1"||e==="P2"||e==="P5"||e==="P3"||e==="P6"}startDecode(t){this._input=new D({buffer:t});const e=this.getNextToken();if(e==="P1")this._info=new Ei(jt.pbm);else if(e==="P2")this._info=new Ei(jt.pgm2);else if(e==="P5")this._info=new Ei(jt.pgm5);else if(e==="P3")this._info=new Ei(jt.ppm3);else if(e==="P6")this._info=new Ei(jt.ppm6);else{this._input=void 0;return}if(this._info.width=this.parseNextInt(),this._info.height=this.parseNextInt(),this._info.width===0||this._info.height===0){this._input=void 0,this._info=void 0;return}return this._info}decode(t){var e;if(this.startDecode(t.bytes)!==void 0)return this.decodeFrame((e=t.frameIndex)!==null&&e!==void 0?e:0)}decodeFrame(t){if(this._info!==void 0){if(this._info.format===jt.pbm){const e=new tt({width:this._info.width,height:this._info.height,numChannels:1,format:v.uint1});for(const i of e)this.getNextToken()==="1"?i.setRgb(1,1,1):i.setRgb(0,0,0);return e}else if(this._info.format===jt.pgm2||this._info.format===jt.pgm5){const e=this.parseNextInt();if(e===0)return;const i=new tt({width:this._info.width,height:this._info.height,numChannels:1,format:this.formatFromMaxValue(e)});for(const n of i){const s=this.readValue(this._info.format,e);n.setRgb(s,s,s)}return i}else if(this._info.format===jt.ppm3||this._info.format===jt.ppm6){const e=this.parseNextInt();if(e===0)return;const i=new tt({width:this._info.width,height:this._info.height,format:this.formatFromMaxValue(e)});for(const n of i){const s=this.readValue(this._info.format,e),a=this.readValue(this._info.format,e),r=this.readValue(this._info.format,e);n.setRgb(s,a,r)}return i}}}}class st{get value(){return this._value}constructor(t){this._value=t}}st.passThrough=1885434739;st.normal=1852797549;st.dissolve=1684632435;st.darken=1684107883;st.multiply=1836411936;st.colorBurn=1768188278;st.linearBurn=1818391150;st.darkenColor=1684751212;st.lighten=1818850405;st.screen=1935897198;st.colorDodge=1684633120;st.linearDodge=1818518631;st.lighterColor=1818706796;st.overlay=1870030194;st.softLight=1934387572;st.hardLight=1749838196;st.vividLight=1984719220;st.linearLight=1816947060;st.pinLight=1884055924;st.hardMix=1749903736;st.difference=1684629094;st.exclusion=1936553316;st.subtract=1718842722;st.divide=1717856630;st.hue=1752524064;st.saturation=1935766560;st.color=1668246642;st.luminosity=1819634976;class Lt{get id(){return this._id}get dataLength(){return this._dataLength}get data(){return this._data}constructor(t,e){this._id=t,this._dataLength=e}static read(t){const e=new Lt(t.id);return e.readPlane({input:t.input,width:t.width,height:t.height,bitDepth:t.bitDepth,compression:t.compression,lineLengths:t.lineLengths,planeNumber:t.planeNumber}),e}readLineLengths(t,e){const i=new Uint16Array(e);for(let n=0;n<e;++n)i[n]=t.readUint16();return i}readPlaneUncompressed(t,e,i,n){let s=e*i;if(n===16&&(s*=2),s>t.length){this._data=new Uint8Array(s),this._data.fill(255,0,s);return}const a=t.readRange(s);this._data=a.toUint8Array()}readPlaneRleCompressed(t,e,i,n,s,a){let r=e*i;n===16&&(r*=2),this._data=new Uint8Array(r);let h=0,l=a*i;if(l>=s.length){this._data.fill(255,0,this._data.length);return}for(let u=0;u<i;++u){const d=s[l++],c=t.readRange(d);this.decodeRLE(c,this._data,h),h+=e}}decodeRLE(t,e,i){let n=i;for(;!t.isEOS;){let s=t.readInt8();if(s<0){if(s=1-s,t.isEOS)break;const a=t.read();n+s>e.length&&(s=e.length-n);for(let r=0;r<s;++r)e[n++]=a}else{s++,n+s>e.length&&(s=e.length-n),s=Math.min(s,t.length);for(let a=0;a<s;++a)e[n++]=t.read()}}}readPlane(t){var e,i,n;if(t.input.length<2)return;const s=(e=t.planeNumber)!==null&&e!==void 0?e:0;switch((i=t.compression)!==null&&i!==void 0?i:t.input.readUint16()){case Lt.compressNone:{this.readPlaneUncompressed(t.input,t.width,t.height,t.bitDepth);break}case Lt.compressRle:{const r=(n=t.lineLengths)!==null&&n!==void 0?n:this.readLineLengths(t.input,t.height);this.readPlaneRleCompressed(t.input,t.width,t.height,t.bitDepth,r,s);break}default:throw new W("Unsupported compression: $compression")}}}Lt.red=0;Lt.green=1;Lt.blue=2;Lt.black=3;Lt.alpha=-1;Lt.mask=-2;Lt.realMask=-3;Lt.compressNone=0;Lt.compressRle=1;Lt.compressZip=2;Lt.compressZipPredictor=3;var Ai;(function(o){o[o.bitmap=0]="bitmap",o[o.grayscale=1]="grayscale",o[o.indexed=2]="indexed",o[o.rgb=3]="rgb",o[o.cmyk=4]="cmyk",o[o.multiChannel=5]="multiChannel",o[o.duoTone=6]="duoTone",o[o.lab=7]="lab"})(Ai||(Ai={}));class wa{get id(){return this._id}get name(){return this._name}get data(){return this._data}constructor(t,e,i){this._id=t,this._name=e,this._data=i}}class Vi{get version(){return this._version}get enabled(){return this._enabled}constructor(t){this._version=t.version,this._enabled=t.enabled}}class pa extends Vi{get angle(){return this._angle}get strength(){return this._strength}get blur(){return this._blur}get highlightBlendMode(){return this._highlightBlendMode}get shadowBlendMode(){return this._shadowBlendMode}get highlightColor(){return this._highlightColor}get shadowColor(){return this._shadowColor}get bevelStyle(){return this._bevelStyle}get highlightOpacity(){return this._highlightOpacity}get shadowOpacity(){return this._shadowOpacity}get globalAngle(){return this._globalAngle}get upOrDown(){return this._upOrDown}get realHighlightColor(){return this._realHighlightColor}get realShadowColor(){return this._realShadowColor}constructor(t){super(t),this._angle=t.angle,this._strength=t.strength,this._blur=t.angle,this._highlightBlendMode=t.highlightBlendMode,this._shadowBlendMode=t.shadowBlendMode,this._highlightColor=t.highlightColor,this._shadowColor=t.shadowColor,this._bevelStyle=t.bevelStyle,this._highlightOpacity=t.highlightOpacity,this._shadowOpacity=t.shadowOpacity,this._globalAngle=t.globalAngle,this._upOrDown=t.upOrDown,this._realHighlightColor=t.realHighlightColor,this._realShadowColor=t.realShadowColor}}class Ca extends Vi{get blur(){return this._blur}get intensity(){return this._intensity}get angle(){return this._angle}get distance(){return this._distance}get color(){return this._color}get blendMode(){return this._blendMode}get globalAngle(){return this._globalAngle}get opacity(){return this._opacity}get nativeColor(){return this._nativeColor}constructor(t){super(t),this._blur=t.blur,this._intensity=t.intensity,this._angle=t.angle,this._distance=t.distance,this._color=t.color,this._blendMode=t.blendMode,this._globalAngle=t.globalAngle,this._opacity=t.opacity,this._nativeColor=t.nativeColor}}class ya extends Vi{get blur(){return this._blur}get intensity(){return this._intensity}get color(){return this._color}get blendMode(){return this._blendMode}get opacity(){return this._opacity}get invert(){return this._invert}get nativeColor(){return this._nativeColor}constructor(t){super(t),this._blur=t.blur,this._intensity=t.intensity,this._color=t.color,this._blendMode=t.blendMode,this._opacity=t.opacity,this._invert=t.invert,this._nativeColor=t.nativeColor}}class va extends Vi{get blur(){return this._blur}get intensity(){return this._intensity}get angle(){return this._angle}get distance(){return this._distance}get color(){return this._color}get blendMode(){return this._blendMode}get globalAngle(){return this._globalAngle}get opacity(){return this._opacity}get nativeColor(){return this._nativeColor}constructor(t){super(t),this._blur=t.blur,this._intensity=t.intensity,this._angle=t.angle,this._distance=t.distance,this._color=t.color,this._blendMode=t.blendMode,this._globalAngle=t.globalAngle,this._opacity=t.opacity,this._nativeColor=t.nativeColor}}class Sa extends Vi{get blur(){return this._blur}get intensity(){return this._intensity}get color(){return this._color}get blendMode(){return this._blendMode}get opacity(){return this._opacity}get nativeColor(){return this._nativeColor}constructor(t){super(t),this._blur=t.blur,this._intensity=t.intensity,this._color=t.color,this._blendMode=t.blendMode,this._opacity=t.opacity,this._nativeColor=t.nativeColor}}class ka extends Vi{get blendMode(){return this._blendMode}get color(){return this._color}get opacity(){return this._opacity}get nativeColor(){return this._nativeColor}constructor(t){super(t),this._blendMode=t.blendMode,this._color=t.color,this._opacity=t.opacity,this._nativeColor=t.nativeColor}}class gs{get tag(){return this._tag}constructor(t){this._tag=t}}class Pa extends gs{get data(){return this._data}constructor(t,e){super(t),this._data=e}}class se extends gs{get type(){return this._type}get key(){return this._key}get subType(){return this._subType}constructor(t,e){super(t),this._type=0,this._subType=se.subTypeNormal;const i=e.length;if(this._type=e.readUint32(),i>=12){if(e.readString(4)!=="8BIM")throw new W("Invalid key in layer additional data");this._key=e.readString(4)}i>=16&&(this._subType=e.readUint32())}}se.tagName="lsct";se.normal=0;se.openFolder=1;se.closedFolder=2;se.sectionDivider=3;se.subTypeNormal=0;se.subTypeGroup=1;class Ma{static createLayerData(t,e){switch(t){case se.tagName:return new se(t,e);default:return new Pa(t,e)}}}class Aa{get grayBlackSrc(){return this._grayBlackSrc}get grayWhiteSrc(){return this._grayWhiteSrc}get grayBlackDst(){return this._grayBlackDst}get grayWhiteDst(){return this._grayWhiteDst}get blackSrc(){return this._blackSrc}get whiteSrc(){return this._whiteSrc}get blackDst(){return this._blackDst}get whiteDst(){return this._whiteDst}constructor(t){this._grayBlackSrc=0,this._grayWhiteSrc=0,this._grayBlackDst=0,this._grayWhiteDst=0,this._grayBlackSrc=t.readUint16(),this._grayWhiteSrc=t.readUint16(),this._grayBlackDst=t.readUint16(),this._grayWhiteDst=t.readUint16();const e=t.length,i=Math.trunc(e/8);if(i>0){this._blackSrc=new Uint16Array(i),this._whiteSrc=new Uint16Array(i),this._blackDst=new Uint16Array(i),this._whiteDst=new Uint16Array(i);for(let n=0;n<i;++n)this._blackSrc[n]=t.readUint16(),this._whiteSrc[n]=t.readUint16(),this._blackDst[n]=t.readUint16(),this._whiteDst[n]=t.readUint16()}}}class Oi{get value(){return this._value}constructor(t){this._value=t}}Oi.transparencyProtected=1;Oi.hidden=2;Oi.obsolete=4;Oi.photoshop5=8;Oi.pixelDataIrrelevantToAppearance=16;class za{get top(){return this._top}get left(){return this._left}get right(){return this._right}get bottom(){return this._bottom}get defaultColor(){return this._defaultColor}get flags(){return this._flags}get params(){return this._params}get relative(){return(this._flags&1)!==0}get disabled(){return(this._flags&2)!==0}get invert(){return(this._flags&4)!==0}constructor(t){this._top=0,this._left=0,this._right=0,this._bottom=0,this._defaultColor=0,this._flags=0,this._params=0;const e=t.length;this._top=t.readUint32(),this._left=t.readUint32(),this._right=t.readUint32(),this._bottom=t.readUint32(),this._defaultColor=t.read(),this._flags=t.read(),e===20?t.skip(2):(this._flags=t.read(),this._defaultColor=t.read(),this._top=t.readUint32(),this._left=t.readUint32(),this._right=t.readUint32(),this._bottom=t.readUint32())}}class nn{get top(){return this._top}get left(){return this._left}get bottom(){return this._bottom}get right(){return this._right}get width(){return this._width}get height(){return this._height}get blendMode(){return this._blendMode}get opacity(){return this._opacity}get clipping(){return this._clipping}get flags(){return this._flags}get compression(){return this._compression}get name(){return this._name}get channels(){return this._channels}get mask(){return this._mask}get blendingRanges(){return this._blendingRanges}get additionalData(){return this._additionalData}get children(){return this._children}get parent(){return this._parent}get layerImage(){return this._layerImage}get effects(){return this._effects}get isVisible(){return(this._flags&Oi.hidden)===0}get type(){return this._additionalData.has(se.tagName)?this._additionalData.get(se.tagName).type:se.normal}constructor(t){this._additionalData=new Map,this._children=[],this._effects=[],this._top=t.readInt32(),this._left=t.readInt32(),this._bottom=t.readInt32(),this._right=t.readInt32(),this._width=this._right-this._left,this._height=this._bottom-this._top,this._channels=[];const e=t.readUint16();for(let r=0;r<e;++r){const h=t.readInt16(),l=t.readUint32();this._channels.push(new Lt(h,l))}const i=t.readUint32();if(i!==nn.signature)throw new W(`Invalid PSD layer signature: ${i.toString(16)}`);if(this._blendMode=t.readUint32(),this._opacity=t.read(),this._clipping=t.read(),this._flags=t.read(),t.read()!==0)throw new W("Invalid PSD layer data");let s=t.readUint32();const a=t.readRange(s);if(s>0){if(s=a.readUint32(),s>0){const h=a.readRange(s);this._mask=new za(h)}if(s=a.readUint32(),s>0){const h=a.readRange(s);this._blendingRanges=new Aa(h)}s=a.read(),this._name=a.readString(s);const r=4-s%4-1;for(r>0&&a.skip(r);!a.isEOS;){const h=a.readUint32();if(h!==nn.signature)throw new W(`PSD invalid signature for layer additional data: ${h.toString(16)}`);const l=a.readString(4);s=a.readUint32();const u=a.readRange(s);if((s&1)===1&&a.skip(1),this._additionalData.set(l,Ma.createLayerData(l,u)),l==="lrFX"){const d=this._additionalData.get("lrFX"),c=D.from(d.data);c.readUint16();const g=c.readUint16();for(let f=0;f<g;++f){c.readString(4);const m=c.readString(4),_=c.readUint32();if(m==="dsdw"){const x=c.readUint32(),b=c.readUint32(),p=c.readUint32(),w=c.readUint32(),C=c.readUint32(),y=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()],A=c.readString(8),B=c.read()!==0,z=c.read()!==0,U=c.read(),P=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()];this._effects.push(new Ca({version:x,blur:b,intensity:p,angle:w,distance:C,color:y,blendMode:A,enabled:B,globalAngle:z,opacity:U,nativeColor:P}))}else if(m==="isdw"){const x=c.readUint32(),b=c.readUint32(),p=c.readUint32(),w=c.readUint32(),C=c.readUint32(),y=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()],A=c.readString(8),B=c.read()!==0,z=c.read()!==0,U=c.read(),P=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()];this._effects.push(new va({version:x,blur:b,intensity:p,angle:w,distance:C,color:y,blendMode:A,enabled:B,globalAngle:z,opacity:U,nativeColor:P}))}else if(m==="oglw"){const x=c.readUint32(),b=c.readUint32(),p=c.readUint32(),w=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()],C=c.readString(8),y=c.read()!==0,A=c.read();let B;x===2&&(B=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()]),this._effects.push(new Sa({version:x,blur:b,intensity:p,color:w,blendMode:C,enabled:y,opacity:A,nativeColor:B}))}else if(m==="iglw"){const x=c.readUint32(),b=c.readUint32(),p=c.readUint32(),w=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()],C=c.readString(8),y=c.read()!==0,A=c.read();let B,z;x===2&&(B=c.read()!==0,z=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()]),this._effects.push(new ya({version:x,blur:b,intensity:p,color:w,blendMode:C,enabled:y,opacity:A,invert:B,nativeColor:z}))}else if(m==="bevl"){const x=c.readUint32(),b=c.readUint32(),p=c.readUint32(),w=c.readUint32(),C=c.readString(8),y=c.readString(8),A=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()],B=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()],z=c.read(),U=c.read(),P=c.read(),L=c.read()!==0,V=c.read()!==0,T=c.read();let H,Y;x===2&&(H=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()],Y=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()]),this._effects.push(new pa({version:x,angle:b,strength:p,blur:w,highlightBlendMode:C,shadowBlendMode:y,highlightColor:A,shadowColor:B,bevelStyle:z,highlightOpacity:U,shadowOpacity:P,enabled:L,globalAngle:V,upOrDown:T,realHighlightColor:H,realShadowColor:Y}))}else if(m==="sofi"){const x=c.readUint32(),b=c.readString(4),p=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()],w=c.read(),C=c.read()!==0,y=[c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16(),c.readUint16()];this._effects.push(new ka({version:x,blendMode:b,color:p,opacity:w,enabled:C,nativeColor:y}))}else c.skip(_)}}}}}getChannel(t){for(let e=0;e<this._channels.length;++e)if(this._channels[e].id===t)return this._channels[e]}readImageData(t,e){for(let i=0;i<this._channels.length;++i)this._channels[i].readPlane({input:t,width:this._width,height:this._height,bitDepth:e.depth});this._layerImage=Q.createImageFromChannels(this._width,this._height,this._channels,e.colorMode,e.depth)}}nn.signature=943868237;class Q{get input(){return this._input}get width(){return this._width}get height(){return this._height}get backgroundColor(){return this._backgroundColor}get numFrames(){return this._numFrames}get signature(){return this._signature}get version(){return this._version}get channels(){return this._channels}get depth(){return this._depth}get colorMode(){return this._colorMode}get layers(){return this._layers}get mergeImageChannels(){return this._mergeImageChannels}get mergedImage(){return this._mergedImage}get imageResources(){return this._imageResources}get hasAlpha(){return this._hasAlpha}get isValid(){return this._signature===Q.psdSignature}constructor(t){if(this._width=0,this._height=0,this._backgroundColor=void 0,this._numFrames=1,this._imageResources=new Map,this._hasAlpha=!1,this._input=new D({buffer:t,bigEndian:!0}),this.readHeader(),!this.isValid)return;let e=this._input.readUint32();this._input.readRange(e),e=this._input.readUint32(),this._imageResourceData=this._input.readRange(e),e=this._input.readUint32(),this._layerAndMaskData=this._input.readRange(e),this._imageData=this._input.readRange(this._input.length)}static blendLighten(t,e){return Math.max(t,e)}static blendDarken(t,e){return Math.min(t,e)}static blendMultiply(t,e){return t*e>>8}static blendOverlay(t,e,i,n){const s=t/255,a=e/255,r=i/255,h=n/255;let l=0;return 2*s<r?l=2*a*s+a*(1-r)+s*(1-h):l=h*r-2*(r-s)*(h-a)+a*(1-r)+s*(1-h),k.clampInt255(l*255)}static blendColorBurn(t,e){if(e===0)return 0;const i=Math.trunc(255*(1-(1-t/255)/(e/255)));return k.clampInt255(i)}static blendLinearBurn(t,e){return k.clampInt255(t+e-255)}static blendScreen(t,e){return k.clampInt255(255-(255-e)*(255-t))}static blendColorDodge(t,e){return e===255?255:k.clampInt255(t/255/(1-e/255)*255)}static blendLinearDodge(t,e){return e+t>255?255:t+e}static blendSoftLight(t,e){const i=t/255,n=e/255;return Math.round(255*((1-n)*n*i+n*(1-(1-n)*(1-i))))}static blendHardLight(t,e){const i=e/255,n=t/255;return n<.5?Math.round(255*2*i*n):Math.round(255*(1-2*(1-i)*(1-n)))}static blendVividLight(t,e){return e<128?this.blendColorBurn(t,2*e):this.blendColorDodge(t,2*(e-128))}static blendLinearLight(t,e){return e<128?this.blendLinearBurn(t,2*e):this.blendLinearDodge(t,2*(e-128))}static blendPinLight(t,e){return e<128?this.blendDarken(t,2*e):this.blendLighten(t,2*(e-128))}static blendHardMix(t,e){return e<255-t?0:255}static blendDifference(t,e){return Math.abs(e-t)}static blendExclusion(t,e){return Math.round(e+t-2*e*t/255)}static ch(t,e,i){return t===void 0?0:i===1?t[e]:(t[e]<<8|t[e+1])>>8}static createImageFromChannels(t,e,i,n,s){const a=new Map;for(const _ of i)a.set(_.id,_);const r=i.length,h=s===8?1:s===16?2:-1,l=new tt({width:t,height:e,numChannels:r});if(h===-1)throw new W(`PSD: unsupported bit depth: ${s}`);const u=a.get(0),d=a.get(1),c=a.get(2),g=a.get(-1),f=[0,0,0];let m=-h;for(const _ of l)switch(m+=h,n){case Ai.rgb:{_.r=this.ch(u.data,m,h),_.g=this.ch(d.data,m,h),_.b=this.ch(c.data,m,h),_.a=r>=4?this.ch(g.data,m,h):255,_.a!==0&&(_.r=(_.r+_.a-255)*255/_.a,_.g=(_.g+_.a-255)*255/_.a,_.b=(_.b+_.a-255)*255/_.a);break}case Ai.lab:{const x=this.ch(u.data,m,h)*100>>8,b=this.ch(d.data,m,h)-128,p=this.ch(c.data,m,h)-128,w=r>=4?this.ch(g.data,m,h):255,C=E.labToRgb(x,b,p);_.r=C[0],_.g=C[1],_.b=C[2],_.a=w;break}case Ai.grayscale:{const x=this.ch(u.data,m,h),b=r>=2?this.ch(g.data,m,h):255;_.r=x,_.g=x,_.b=x,_.a=b;break}case Ai.cmyk:{const x=this.ch(u.data,m,h),b=this.ch(d.data,m,h),p=this.ch(c.data,m,h),w=this.ch(a.get(r===4?-1:3).data,m,h),C=r>=5?this.ch(g.data,m,h):255;E.cmykToRgb(255-x,255-b,255-p,255-w,f),_.r=f[0],_.g=f[1],_.b=f[2],_.a=C;break}default:throw new W(`Unhandled color mode: ${n}`)}return l}blend(t,e,i,n,s,a,r,h,l,u,d){let c=s,g=a,f=r,m=h;const _=h/255*u;switch(l){case st.passThrough:c=t,g=e,f=i,m=n;break;case st.normal:break;case st.dissolve:break;case st.darken:c=Q.blendDarken(t,s),g=Q.blendDarken(e,a),f=Q.blendDarken(i,r);break;case st.multiply:c=Q.blendMultiply(t,s),g=Q.blendMultiply(e,a),f=Q.blendMultiply(i,r);break;case st.colorBurn:c=Q.blendColorBurn(t,s),g=Q.blendColorBurn(e,a),f=Q.blendColorBurn(i,r);break;case st.linearBurn:c=Q.blendLinearBurn(t,s),g=Q.blendLinearBurn(e,a),f=Q.blendLinearBurn(i,r);break;case st.darkenColor:break;case st.lighten:c=Q.blendLighten(t,s),g=Q.blendLighten(e,a),f=Q.blendLighten(i,r);break;case st.screen:c=Q.blendScreen(t,s),g=Q.blendScreen(e,a),f=Q.blendScreen(i,r);break;case st.colorDodge:c=Q.blendColorDodge(t,s),g=Q.blendColorDodge(e,a),f=Q.blendColorDodge(i,r);break;case st.linearDodge:c=Q.blendLinearDodge(t,s),g=Q.blendLinearDodge(e,a),f=Q.blendLinearDodge(i,r);break;case st.lighterColor:break;case st.overlay:c=Q.blendOverlay(t,s,n,h),g=Q.blendOverlay(e,a,n,h),f=Q.blendOverlay(i,r,n,h);break;case st.softLight:c=Q.blendSoftLight(t,s),g=Q.blendSoftLight(e,a),f=Q.blendSoftLight(i,r);break;case st.hardLight:c=Q.blendHardLight(t,s),g=Q.blendHardLight(e,a),f=Q.blendHardLight(i,r);break;case st.vividLight:c=Q.blendVividLight(t,s),g=Q.blendVividLight(e,a),f=Q.blendVividLight(i,r);break;case st.linearLight:c=Q.blendLinearLight(t,s),g=Q.blendLinearLight(e,a),f=Q.blendLinearLight(i,r);break;case st.pinLight:c=Q.blendPinLight(t,s),g=Q.blendPinLight(e,a),f=Q.blendPinLight(i,r);break;case st.hardMix:c=Q.blendHardMix(t,s),g=Q.blendHardMix(e,a),f=Q.blendHardMix(i,r);break;case st.difference:c=Q.blendDifference(t,s),g=Q.blendDifference(e,a),f=Q.blendDifference(i,r);break;case st.exclusion:c=Q.blendExclusion(t,s),g=Q.blendExclusion(e,a),f=Q.blendExclusion(i,r);break}d.r=Math.trunc(t*(1-_)+c*_),d.g=Math.trunc(e*(1-_)+g*_),d.b=Math.trunc(i*(1-_)+f*_),d.a=Math.trunc(n*(1-_)+m*_)}readHeader(){if(this._signature=this._input.readUint32(),this._version=this._input.readUint16(),this.version!==1){this._signature=0;return}const t=this._input.readRange(6);for(let e=0;e<6;++e)if(t.get(e)!==0){this._signature=0;return}this._channels=this._input.readUint16(),this._height=this._input.readUint32(),this._width=this._input.readUint32(),this._depth=this._input.readUint16(),this._colorMode=this._input.readUint16()}readColorModeData(){}readImageResources(){for(this._imageResourceData.rewind();!this._imageResourceData.isEOS;){const t=this._imageResourceData.readUint32(),e=this._imageResourceData.readUint16();let i=this._imageResourceData.read();const n=this._imageResourceData.readString(i);i&1||this._imageResourceData.skip(1),i=this._imageResourceData.readUint32();const s=this._imageResourceData.readRange(i);(i&1)===1&&this._imageResourceData.skip(1),t===Q.resourceBlockSignature&&this._imageResources.set(e,new wa(e,n,s))}}readLayerAndMaskData(){this._layerAndMaskData.rewind();let t=this._layerAndMaskData.readUint32();t&1&&t++;const e=this._layerAndMaskData.readRange(t);if(this._layers=[],t>0){let n=e.readInt16();n<0&&(this._hasAlpha=!0,n=-n);for(let s=0;s<n;++s){const a=new nn(e);this._layers.push(a)}}for(let n=0;n<this._layers.length;++n)this._layers[n].readImageData(e,this);t=this._layerAndMaskData.readUint32();const i=this._layerAndMaskData.readRange(t);t>0&&(i.readUint16(),i.readUint16(),i.readUint16(),i.readUint16(),i.readUint16(),i.readUint16(),i.read())}readMergeImageData(){this._imageData.rewind();const t=this._imageData.readUint16();let e;if(t===Lt.compressRle){const i=this._height*this._channels;e=new Uint16Array(i);for(let n=0;n<i;++n)e[n]=this._imageData.readUint16()}this._mergeImageChannels=[];for(let i=0;i<this._channels;++i)this._mergeImageChannels.push(Lt.read({input:this._imageData,id:i===3?-1:i,width:this._width,height:this._height,bitDepth:this._depth,compression:t,planeNumber:i,lineLengths:e}));this._mergedImage=Q.createImageFromChannels(this._width,this._height,this._mergeImageChannels,this._colorMode,this._depth)}decode(){return!this.isValid||this._input===void 0?!1:(this.readColorModeData(),this.readImageResources(),this.readLayerAndMaskData(),this.readMergeImageData(),this._input=void 0,this._imageResourceData=void 0,this._layerAndMaskData=void 0,this._imageData=void 0,!0)}decodeImage(){if(this.decode())return this.renderImage()}renderImage(){if(this._mergedImage!==void 0)return this._mergedImage;this._mergedImage=new tt({width:this._width,height:this._height,numChannels:4}),this._mergedImage.clear();for(let t=0;t<this._layers.length;++t){const e=this._layers[t];if(!e.isVisible)continue;const i=e.opacity/255,n=e.blendMode,s=e.layerImage;for(let a=0,r=e.top;a<e.height;++a,++r){const h=e.top+a;for(let l=0,u=e.left;l<e.width;++l,++u){const d=s.getPixel(l,a),c=Math.trunc(d.r),g=Math.trunc(d.g),f=Math.trunc(d.b),m=Math.trunc(d.a);if(u>=0&&u<this._width&&r>=0&&r<this._height){const _=e.left+l,x=this._mergedImage.getPixel(_,h),b=Math.trunc(x.r),p=Math.trunc(x.g),w=Math.trunc(x.b),C=Math.trunc(x.a);this.blend(b,p,w,C,c,g,f,m,n,i,x)}}}}return this._mergedImage}}Q.psdSignature=943870035;Q.resourceBlockSignature=943868237;class Ba{get info(){return this._info}get format(){return le.psd}get numFrames(){var t,e;return(e=(t=this._info)===null||t===void 0?void 0:t.numFrames)!==null&&e!==void 0?e:0}decodePsd(t){const e=new Q(t);return e.decode()?e:void 0}isValidFile(t){return new Q(t).isValid}startDecode(t){return this._info=new Q(t),this._info}decode(t){var e;if(this.startDecode(t.bytes)===void 0)return;const i=this.numFrames;if(i===1||t.frameIndex!==void 0)return this.decodeFrame((e=t.frameIndex)!==null&&e!==void 0?e:0);let n;for(let s=0;s<i;++s){const a=this.decodeFrame(s);a!==void 0&&(n===void 0?(n=a,a.frameType=hi.page):n.addFrame(a))}return n}decodeFrame(t){var e;return(e=this._info)===null||e===void 0?void 0:e.decodeImage()}}class J{static isPowerOf2(t){return(t&t-1)===0}static rotateRight(t,e){return t>>e|t<<32-e}}J.bitScale5To8=[0,8,16,24,32,41,49,57,65,74,82,90,98,106,115,123,131,139,148,156,164,172,180,189,197,205,213,222,230,238,246,255];J.bitScale4To8=[0,17,34,51,68,85,102,119,136,153,170,187,204,221,238,255];J.bitScale3To8=[0,36,72,109,145,182,218,255];J.bitScale8To5Floor=[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,31];J.bitScale8To4Floor=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15];J.bitScale8To3Floor=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7];J.bitScale8To5Ceil=[0,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31];J.bitScale8To4Ceil=[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15];J.bitScale8To3Ceil=[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];class Wn{get min(){return this._min}get max(){return this._max}constructor(t,e){this._min=t.copy(),this._max=e.copy()}add(t){this._min.setMin(t),this._max.setMax(t)}}class fe{get r(){return this._r}get g(){return this._g}get b(){return this._b}constructor(t=0,e=0,i=0){this._r=t,this._g=e,this._b=i}static from(t){return new fe(t._r,t._g,t._b)}copy(){return fe.from(this)}setMin(t){t._r<this._r&&(this._r=t._r),t._g<this._g&&(this._g=t._g),t._b<this._b&&(this._b=t._b)}setMax(t){t._r>this._r&&(this._r=t._r),t._g>this._g&&(this._g=t._g),t._b>this._b&&(this._b=t._b)}mul(t){return new fe(this._r*t,this._g*t,this._b*t)}add(t){return new fe(this._r+t._r,this._g+t._g,this._b+t._b)}sub(t){return new fe(this._r-t._r,this._g-t._g,this._b-t._b)}dotProd(t){return this._r*t._r+this._g*t._g+this._b*t._b}}class ge{get r(){return this._r}get g(){return this._g}get b(){return this._b}get a(){return this._a}constructor(t=0,e=0,i=0,n=0){this._r=t,this._g=e,this._b=i,this._a=n}static from(t){return new ge(t._r,t._g,t._b,t._a)}copy(){return ge.from(this)}setMin(t){t._r<this._r&&(this._r=t._r),t._g<this._g&&(this._g=t._g),t._b<this._b&&(this._b=t._b),t._a<this._a&&(this._a=t._a)}setMax(t){t._r>this._r&&(this._r=t._r),t._g>this._g&&(this._g=t._g),t._b>this._b&&(this._b=t._b),t._a>this._a&&(this._a=t._a)}mul(t){return new ge(this._r*t,this._g*t,this._b*t,this._a*t)}add(t){return new ge(this._r+t._r,this._g+t._g,this._b+t._b,this._a+t._a)}sub(t){return new ge(this._r-t._r,this._g-t._g,this._b-t._b,this._a-t._a)}dotProd(t){return this._r*t._r+this._g*t._g+this._b*t._b+this._a*t._a}}var Re;(function(o){o[o.auto=0]="auto",o[o.rgb2=1]="rgb2",o[o.rgba2=2]="rgba2",o[o.rgb4=3]="rgb4",o[o.rgba4=4]="rgba4"})(Re||(Re={}));class gt{get rawData(){return this._rawData}get index(){return this._index}get modulationData(){return this._rawData[this._index]}set modulationData(t){this._rawData[this._index]=t}get colorData(){return this._rawData[this._index+1]}set colorData(t){this._rawData[this._index+1]=t}get usePunchthroughAlpha(){return this._usePunchthroughAlpha}set usePunchthroughAlpha(t){this._usePunchthroughAlpha=t,this.colorData=this.getColorData()}get colorA(){return this._colorA}set colorA(t){this._colorA=t,this.colorData=this.getColorData()}get colorAIsOpaque(){return this._colorAIsOpaque}set colorAIsOpaque(t){this._colorAIsOpaque=t,this.colorData=this.getColorData()}get colorB(){return this._colorB}set colorB(t){this._colorB=t,this.colorData=this.getColorData()}get colorBIsOpaque(){return this._colorBIsOpaque}set colorBIsOpaque(t){this._colorBIsOpaque=t,this.colorData=this.getColorData()}constructor(t){this._index=0,this._usePunchthroughAlpha=!1,this._colorA=0,this._colorAIsOpaque=!1,this._colorB=0,this._colorBIsOpaque=!1,this._rawData=new Uint32Array(t.buffer)}static getMortonNumber(t,e){return this.mortonTable[t>>8]<<17|this.mortonTable[e>>8]<<16|this.mortonTable[t&255]<<1|this.mortonTable[e&255]}getColorData(){return(this.usePunchthroughAlpha?1:0)|(this.colorA&gt.bits14)<<1|(this.colorAIsOpaque?1:0)<<15|(this.colorB&gt.bits15)<<16|(this.colorBIsOpaque?1:0)<<31}update(){const t=this.colorData;this.usePunchthroughAlpha=(t&1)===1,this.colorA=t>>1&gt.bits14,this.colorAIsOpaque=(t>>15&1)===1,this.colorB=t>>16&gt.bits15,this.colorBIsOpaque=(t>>31&1)===1}setBlock(t,e){this.setIndex(gt.getMortonNumber(t,e))}setIndex(t){this._index=t<<1,this.update()}setColorRgbA(t){const e=J.bitScale8To5Floor[t.r],i=J.bitScale8To5Floor[t.g],n=J.bitScale8To4Floor[t.b];this.colorA=e<<9|i<<4|n,this.colorAIsOpaque=!0}setColorRgbaA(t){const e=J.bitScale8To3Floor[t.a];if(e===7){const i=J.bitScale8To5Floor[t.r],n=J.bitScale8To5Floor[t.g],s=J.bitScale8To4Floor[t.b];this.colorA=i<<9|n<<4|s,this.colorAIsOpaque=!0}else{const i=J.bitScale8To4Floor[t.r],n=J.bitScale8To4Floor[t.g],s=J.bitScale8To3Floor[t.b];this.colorA=e<<11|i<<7|n<<3|s,this.colorAIsOpaque=!1}}setColorRgbB(t){const e=J.bitScale8To5Ceil[t.r],i=J.bitScale8To5Ceil[t.g],n=J.bitScale8To5Ceil[t.b];this.colorB=e<<10|i<<5|n,this.colorBIsOpaque=!1}setColorRgbaB(t){const e=J.bitScale8To3Ceil[t.a];if(e===7){const i=J.bitScale8To5Ceil[t.r],n=J.bitScale8To5Ceil[t.g],s=J.bitScale8To5Ceil[t.b];this.colorB=i<<10|n<<5|s,this.colorBIsOpaque=!0}else{const i=J.bitScale8To4Ceil[t.r],n=J.bitScale8To4Ceil[t.g],s=J.bitScale8To4Ceil[t.b];this.colorB=e<<12|i<<8|n<<4|s,this.colorBIsOpaque=!1}}getColorRgbA(){if(this.colorAIsOpaque){const t=this.colorA>>9,e=this.colorA>>4&31,i=this.colorA&15;return new fe(J.bitScale5To8[t],J.bitScale5To8[e],J.bitScale4To8[i])}else{const t=this.colorA>>7&15,e=this.colorA>>3&15,i=this.colorA&7;return new fe(J.bitScale4To8[t],J.bitScale4To8[e],J.bitScale3To8[i])}}getColorRgbaA(){if(this.colorAIsOpaque){const t=this.colorA>>9,e=this.colorA>>4&31,i=this.colorA&15;return new ge(J.bitScale5To8[t],J.bitScale5To8[e],J.bitScale4To8[i],255)}else{const t=this.colorA>>11&7,e=this.colorA>>7&15,i=this.colorA>>3&15,n=this.colorA&7;return new ge(J.bitScale4To8[e],J.bitScale4To8[i],J.bitScale3To8[n],J.bitScale3To8[t])}}getColorRgbB(){if(this.colorBIsOpaque){const t=this.colorB>>10,e=this.colorB>>5&31,i=this.colorB&31;return new fe(J.bitScale5To8[t],J.bitScale5To8[e],J.bitScale5To8[i])}else{const t=this.colorB>>8&15,e=this.colorB>>4&15,i=this.colorB&15;return new fe(J.bitScale4To8[t],J.bitScale4To8[e],J.bitScale4To8[i])}}getColorRgbaB(){if(this.colorBIsOpaque){const t=this.colorB>>10,e=this.colorB>>5&31,i=this.colorB&31;return new ge(J.bitScale5To8[t],J.bitScale5To8[e],J.bitScale5To8[i],255)}else{const t=this.colorB>>12&7,e=this.colorB>>8&15,i=this.colorB>>4&15,n=this.colorB&15;return new ge(J.bitScale4To8[e],J.bitScale4To8[i],J.bitScale4To8[n],J.bitScale3To8[t])}}}gt.bits14=16384-1;gt.bits15=32768-1;gt.mortonTable=[0,1,4,5,16,17,20,21,64,65,68,69,80,81,84,85,256,257,260,261,272,273,276,277,320,321,324,325,336,337,340,341,1024,1025,1028,1029,1040,1041,1044,1045,1088,1089,1092,1093,1104,1105,1108,1109,1280,1281,1284,1285,1296,1297,1300,1301,1344,1345,1348,1349,1360,1361,1364,1365,4096,4097,4100,4101,4112,4113,4116,4117,4160,4161,4164,4165,4176,4177,4180,4181,4352,4353,4356,4357,4368,4369,4372,4373,4416,4417,4420,4421,4432,4433,4436,4437,5120,5121,5124,5125,5136,5137,5140,5141,5184,5185,5188,5189,5200,5201,5204,5205,5376,5377,5380,5381,5392,5393,5396,5397,5440,5441,5444,5445,5456,5457,5460,5461,16384,16385,16388,16389,16400,16401,16404,16405,16448,16449,16452,16453,16464,16465,16468,16469,16640,16641,16644,16645,16656,16657,16660,16661,16704,16705,16708,16709,16720,16721,16724,16725,17408,17409,17412,17413,17424,17425,17428,17429,17472,17473,17476,17477,17488,17489,17492,17493,17664,17665,17668,17669,17680,17681,17684,17685,17728,17729,17732,17733,17744,17745,17748,17749,20480,20481,20484,20485,20496,20497,20500,20501,20544,20545,20548,20549,20560,20561,20564,20565,20736,20737,20740,20741,20752,20753,20756,20757,20800,20801,20804,20805,20816,20817,20820,20821,21504,21505,21508,21509,21520,21521,21524,21525,21568,21569,21572,21573,21584,21585,21588,21589,21760,21761,21764,21765,21776,21777,21780,21781,21824,21825,21828,21829,21840,21841,21844,21845];gt.bilinearFactors=[[4,4,4,4],[2,6,2,6],[8,0,8,0],[6,2,6,2],[2,2,6,6],[1,3,3,9],[4,0,12,0],[3,1,9,3],[8,8,0,0],[4,12,0,0],[16,0,0,0],[12,4,0,0],[6,6,2,2],[3,9,1,3],[12,0,4,0],[9,3,3,1]];gt.weights=[[8,0,8,0],[5,3,5,3],[3,5,3,5],[0,8,0,8],[8,0,8,0],[4,4,4,4],[4,4,0,0],[0,8,0,8]];class mn{get supportsAnimation(){return this._supportsAnimation}constructor(t=Re.auto){this._supportsAnimation=!1,this._format=t}static calculateBoundingBoxRgb(t,e,i){const n=(a,r)=>{const h=t.getPixel(e+a,i+r);return new fe(Math.trunc(h.r),Math.trunc(h.g),Math.trunc(h.b))},s=new Wn(n(0,0),n(0,0));return s.add(n(1,0)),s.add(n(2,0)),s.add(n(3,0)),s.add(n(0,1)),s.add(n(1,1)),s.add(n(1,2)),s.add(n(1,3)),s.add(n(2,0)),s.add(n(2,1)),s.add(n(2,2)),s.add(n(2,3)),s.add(n(3,0)),s.add(n(3,1)),s.add(n(3,2)),s.add(n(3,3)),s}static calculateBoundingBoxRgba(t,e,i){const n=(a,r)=>{const h=t.getPixel(e+a,i+r);return new ge(Math.trunc(h.r),Math.trunc(h.g),Math.trunc(h.b),Math.trunc(h.a))},s=new Wn(n(0,0),n(0,0));return s.add(n(1,0)),s.add(n(2,0)),s.add(n(3,0)),s.add(n(0,1)),s.add(n(1,1)),s.add(n(1,2)),s.add(n(1,3)),s.add(n(2,0)),s.add(n(2,1)),s.add(n(2,2)),s.add(n(2,3)),s.add(n(3,0)),s.add(n(3,1)),s.add(n(3,2)),s.add(n(3,3)),s}encode(t){const e=new Mt;let i=this._format,n;switch(i){case Re.auto:t.image.numChannels===3?(n=this.encodeRgb4bpp(t.image),i=Re.rgb4):(n=this.encodeRgba4bpp(t.image),i=Re.rgba4);break;case Re.rgb2:n=this.encodeRgb4bpp(t.image);break;case Re.rgba2:n=this.encodeRgba4bpp(t.image);break;case Re.rgb4:n=this.encodeRgb4bpp(t.image);break;case Re.rgba4:n=this.encodeRgba4bpp(t.image);break}const s=55727696,a=0,r=i-1,h=0,l=0,u=0,d=t.image.height,c=t.image.width,g=1,f=1,m=1,_=1,x=0;return e.writeUint32(s),e.writeUint32(a),e.writeUint32(r),e.writeUint32(h),e.writeUint32(l),e.writeUint32(u),e.writeUint32(d),e.writeUint32(c),e.writeUint32(g),e.writeUint32(f),e.writeUint32(m),e.writeUint32(_),e.writeUint32(x),e.writeBytes(n),e.getBytes()}encodeRgb4bpp(t){if(t.width!==t.height)throw new W("PVRTC requires a square image.");if(!J.isPowerOf2(t.width))throw new W("PVRTC requires a power-of-two sized image.");const e=t.width,i=Math.trunc(e/4),n=i-1,s=new Uint8Array(Math.trunc(t.width*t.height/2)),a=new gt(s),r=new gt(s),h=new gt(s),l=new gt(s),u=new gt(s);for(let c=0;c<i;++c)for(let g=0;g<i;++g){const f=mn.calculateBoundingBoxRgb(t,g,c);a.setBlock(g,c),a.usePunchthroughAlpha=!1,a.setColorRgbA(f.min),a.setColorRgbB(f.max)}const d=gt.bilinearFactors;for(let c=0,g=0;c<i;++c,g+=4)for(let f=0,m=0;f<i;++f,m+=4){let _=0,x=0;for(let b=0;b<4;++b){const p=b<2?-1:0,w=c+p&n,C=w+1&n;for(let y=0;y<4;++y){const A=y<2?-1:0,B=f+A&n,z=B+1&n;r.setBlock(B,w),h.setBlock(z,w),l.setBlock(B,C),u.setBlock(z,C);const U=r.getColorRgbA().mul(d[_][0]).add(h.getColorRgbA().mul(d[_][1]).add(l.getColorRgbA().mul(d[_][2]).add(u.getColorRgbA().mul(d[_][3])))),P=r.getColorRgbB().mul(d[_][0]).add(h.getColorRgbB().mul(d[_][1]).add(l.getColorRgbB().mul(d[_][2]).add(u.getColorRgbB().mul(d[_][3])))),L=t.getPixel(m+y,g+b),V=Math.trunc(L.r),T=Math.trunc(L.g),H=Math.trunc(L.b),Y=P.sub(U),ct=new fe(V*16,T*16,H*16).sub(U).dotProd(Y)*16,ft=Y.dotProd(Y);ct>3*ft&&x++,ct>8*ft&&x++,ct>13*ft&&x++,x=J.rotateRight(x,2),_++}}a.setBlock(f,c),a.modulationData=x}return s}encodeRgba4bpp(t){if(t.width!==t.height)throw new W("PVRTC requires a square image.");if(!J.isPowerOf2(t.width))throw new W("PVRTC requires a power-of-two sized image.");const e=t.width,i=Math.trunc(e/4),n=i-1,s=new Uint8Array(Math.trunc(t.width*t.height/2)),a=new gt(s),r=new gt(s),h=new gt(s),l=new gt(s),u=new gt(s);for(let c=0,g=0;c<i;++c,g+=4)for(let f=0,m=0;f<i;++f,m+=4){const _=mn.calculateBoundingBoxRgba(t,m,g);a.setBlock(f,c),a.usePunchthroughAlpha=!1,a.setColorRgbaA(_.min),a.setColorRgbaB(_.max)}const d=gt.bilinearFactors;for(let c=0,g=0;c<i;++c,g+=4)for(let f=0,m=0;f<i;++f,m+=4){let _=0,x=0;for(let b=0;b<4;++b){const p=b<2?-1:0,w=c+p&n,C=w+1&n;for(let y=0;y<4;++y){const A=y<2?-1:0,B=f+A&n,z=B+1&n;r.setBlock(B,w),h.setBlock(z,w),l.setBlock(B,C),u.setBlock(z,C);const U=r.getColorRgbaA().mul(d[_][0]).add(h.getColorRgbaA().mul(d[_][1]).add(l.getColorRgbaA().mul(d[_][2]).add(u.getColorRgbaA().mul(d[_][3])))),P=r.getColorRgbaB().mul(d[_][0]).add(h.getColorRgbaB().mul(d[_][1]).add(l.getColorRgbaB().mul(d[_][2]).add(u.getColorRgbaB().mul(d[_][3])))),L=t.getPixel(m+y,g+b),V=Math.trunc(L.r),T=Math.trunc(L.g),H=Math.trunc(L.b),Y=Math.trunc(L.a),j=P.sub(U),ft=new ge(V*16,T*16,H*16,Y*16).sub(U).dotProd(j)*16,at=j.dotProd(j);ft>3*at&&x++,ft>8*at&&x++,ft>13*at&&x++,x=J.rotateRight(x,2),_++}}a.setBlock(f,c),a.modulationData=x}return s}}class Xn{get backgroundColor(){return this._backgroundColor}get numFrames(){return this._numFrames}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get mipCount(){return this._mipCount}get flags(){return this._flags}get texDataSize(){return this._texDataSize}get bitsPerPixel(){return this._bitsPerPixel}set bitsPerPixel(t){this._bitsPerPixel=t}get redMask(){return this._redMask}get greenMask(){return this._greenMask}get blueMask(){return this._blueMask}get magic(){return this._magic}constructor(t){this._backgroundColor=void 0,this._numFrames=1,this._width=0,this._height=0,this._mipCount=0,this._flags=0,this._texDataSize=0,this._bitsPerPixel=0,this._redMask=0,this._greenMask=0,this._blueMask=0,this._magic=0,this._width=t.width,this._height=t.height,this._mipCount=t.mipCount,this._flags=t.flags,this._texDataSize=t.texDataSize,this._bitsPerPixel=t.bitsPerPixel,this._redMask=t.redMask,this._greenMask=t.greenMask,this._blueMask=t.blueMask,this._magic=t.magic}}class jn{get backgroundColor(){return this._backgroundColor}get numFrames(){return this._numFrames}get width(){return this._width}get height(){return this._height}get mipCount(){return this._mipCount}get flags(){return this._flags}get texDataSize(){return this._texDataSize}get bitsPerPixel(){return this._bitsPerPixel}get redMask(){return this._redMask}get greenMask(){return this._greenMask}get blueMask(){return this._blueMask}get alphaMask(){return this._alphaMask}get magic(){return this._magic}get numTex(){return this._numTex}constructor(t){this._backgroundColor=void 0,this._numFrames=1,this._width=0,this._height=0,this._mipCount=0,this._flags=0,this._texDataSize=0,this._bitsPerPixel=0,this._redMask=0,this._greenMask=0,this._blueMask=0,this._alphaMask=0,this._magic=0,this._numTex=0,this._width=t.width,this._height=t.height,this._mipCount=t.mipCount,this._flags=t.flags,this._texDataSize=t.texDataSize,this._bitsPerPixel=t.bitsPerPixel,this._redMask=t.redMask,this._greenMask=t.greenMask,this._blueMask=t.blueMask,this._alphaMask=t.alphaMask,this._magic=t.magic,this._numTex=t.numTex}}class Pn{get backgroundColor(){return this._backgroundColor}get numFrames(){return this._numFrames}get width(){return this._width}get height(){return this._height}get mipCount(){return this._mipCount}get flags(){return this._flags}get format(){return this._format}get order(){return this._order}get colorSpace(){return this._colorSpace}get channelType(){return this._channelType}get depth(){return this._depth}get numSurfaces(){return this._numSurfaces}get numFaces(){return this._numFaces}get metadataSize(){return this._metadataSize}constructor(t){this._backgroundColor=void 0,this._numFrames=1,this._width=0,this._height=0,this._mipCount=0,this._flags=0,this._format=0,this._order=[0,0,0,0],this._colorSpace=0,this._channelType=0,this._depth=0,this._numSurfaces=0,this._numFaces=0,this._metadataSize=0,this._width=t.width,this._height=t.height,this._mipCount=t.mipCount,this._flags=t.flags,this._format=t.format,this._order=t.order,this._colorSpace=t.colorSpace,this._channelType=t.channelType,this._depth=t.depth,this._numSurfaces=t.numSurfaces,this._numFaces=t.numFaces,this._metadataSize=t.metadataSize}}class Le{get format(){return le.pvr}get numFrames(){return 1}decodePvr3Header(t){const e=new D({buffer:t});if(e.readUint32()!==Le.pvrHeaderSize||e.readUint32()!==55727696)return;const a=e.readUint32(),r=e.readUint32(),h=[e.read(),e.read(),e.read(),e.read()],l=e.readUint32(),u=e.readUint32(),d=e.readUint32(),c=e.readUint32(),g=e.readUint32(),f=e.readUint32(),m=e.readUint32(),_=e.readUint32(),x=e.readUint32();return new Pn({flags:a,format:r,order:h,colorSpace:l,channelType:u,height:d,width:c,depth:g,numSurfaces:f,numFaces:m,mipCount:_,metadataSize:x})}decodePvr2Header(t){const e=new D({buffer:t});if(e.readUint32()!==Le.pvrHeaderSize)return;const n=e.readUint32(),s=e.readUint32(),a=e.readUint32(),r=e.readUint32(),h=e.readUint32(),l=e.readUint32(),u=e.readUint32(),d=e.readUint32(),c=e.readUint32(),g=e.readUint32(),f=e.readUint32(),m=e.readUint32(),_=new jn({height:n,width:s,mipCount:a,flags:r,texDataSize:h,bitsPerPixel:l,redMask:u,greenMask:d,blueMask:c,alphaMask:g,magic:f,numTex:m}),x=559044176;if(_.magic===x)return _}decodeApplePvrtcHeader(t){const e=t.length,i=new D({buffer:t});if(i.readUint32()!==0)return;let s=i.readUint32(),a=i.readUint32();const r=i.readUint32(),h=i.readUint32(),l=i.readUint32(),u=i.readUint32(),d=i.readUint32(),c=i.readUint32(),g=i.readUint32(),f=i.readUint32(),m=new Xn({height:s,width:a,mipCount:r,flags:h,texDataSize:l,bitsPerPixel:u,redMask:d,greenMask:c,blueMask:g,magic:f}),_=559044176;if(m.magic===_)return;let x=1,b=8;if(e===32)x=0,b=8;else{let w=0;const C=64,y=128;for(;w<10;){const A=w<<1;if(C<<A&e){b=16<<w,x=1;break}if(y<<A&e){b=16<<w,x=0;break}++w}if(w===10)return}a=b,s=b;const p=(x+1)*2;if(p!==4)return m.width=a,m.height=s,m.bitsPerPixel=p,m}decodePvr2(t){const e=t.length,i=4096,n=255,s=16,a=17,r=18,h=19,l=20,u=21,d=22,c=23,g=24,f=25;if(e<Le.pvrHeaderSize||this._info===void 0)return;const m=this._info,_=new D({buffer:t});_.skip(Le.pvrHeaderSize);let x=m.numTex;if(x<1&&(x=m.flags&i?6:1),x!==1||m.width*m.height*m.bitsPerPixel/8>e-Le.pvrHeaderSize)return;switch(m.flags&n){case s:{const p=new tt({width:m.width,height:m.height,numChannels:4});for(const w of p){const C=_.read(),y=_.read(),A=(C&15)<<4,B=C&240,z=(y&15)<<4,U=y&240;w.r=U,w.g=z,w.b=B,w.a=A}return p}case a:{const p=new tt({width:m.width,height:m.height,numChannels:4});for(const w of p){const C=_.readUint16(),y=(C&63488)>>8,A=(C&1984)>>3,B=(C&62)<<2,z=C&1?255:0;w.r=y,w.g=A,w.b=B,w.a=z}return p}case r:{const p=new tt({width:m.width,height:m.height,numChannels:4});for(const w of p)w.r=_.read(),w.g=_.read(),w.b=_.read(),w.a=_.read();return p}case h:{const p=new tt({width:m.width,height:m.height});for(const w of p){const C=_.readUint16(),y=(C&31)<<3,A=(C&2016)>>3,B=(C&63488)>>8;w.r=B,w.g=A,w.b=y}return p}case l:{const p=new tt({width:m.width,height:m.height});for(const w of p){const C=_.readUint16(),y=(C&31)<<3,A=(C&992)>>2,B=(C&31744)>>7;w.r=y,w.g=A,w.b=B}return p}case u:{const p=new tt({width:m.width,height:m.height});for(const w of p)w.r=_.read(),w.g=_.read(),w.b=_.read();return p}case d:{const p=new tt({width:m.width,height:m.height,numChannels:1});for(const w of p){const C=_.read();w.r=C}return p}case c:{const p=new tt({width:m.width,height:m.height,numChannels:4});for(const w of p){const C=_.read(),y=_.read();w.r=y,w.g=y,w.b=y,w.a=C}return p}case g:return;case f:return m.alphaMask===0?this.decodeRgb4bpp(m.width,m.height,_.toUint8Array()):this.decodeRgba4bpp(m.width,m.height,_.toUint8Array())}}decodePvr3(t){if(this._info instanceof Pn)return;const e=2,i=3,n=new D({buffer:t});n.skip(Le.pvrHeaderSize);const s=this._info;if(n.skip(s.metadataSize),s.order[0]===0)switch(s.format){case e:return this.decodeRgb4bpp(s.width,s.height,n.toUint8Array());case i:return this.decodeRgba4bpp(s.width,s.height,n.toUint8Array())}}countBits(t){let e=t;return e=e-(e>>1&1431655765)&4294967295,e=(e&858993459)+(e>>2&858993459)&4294967295,e=e+(e>>4)&4294967295,e&=252645135,e=(e*16843009&4294967295)>>24,e}decodeRgb4bpp(t,e,i){const n=new tt({width:t,height:e}),s=Math.trunc(t/4),a=s-1,r=new gt(i),h=new gt(i),l=new gt(i),u=new gt(i),d=new gt(i),c=gt.bilinearFactors,g=gt.weights;for(let f=0,m=0;f<s;++f,m+=4)for(let _=0,x=0;_<s;++_,x+=4){r.setBlock(_,f);let b=r.modulationData;const p=r.usePunchthroughAlpha?4:0;let w=0;for(let C=0;C<4;++C){const y=C<2?-1:0,A=f+y&a,B=A+1&a;for(let z=0;z<4;++z){const U=z<2?-1:0,P=_+U&a,L=P+1&a;h.setBlock(P,A),l.setBlock(L,A),u.setBlock(P,B),d.setBlock(L,B);const V=h.getColorRgbA().mul(c[w][0]).add(l.getColorRgbA().mul(c[w][1]).add(u.getColorRgbA().mul(c[w][2]).add(d.getColorRgbA().mul(c[w][3])))),T=h.getColorRgbB().mul(c[w][0]).add(l.getColorRgbB().mul(c[w][1]).add(u.getColorRgbB().mul(c[w][2]).add(d.getColorRgbB().mul(c[w][3])))),H=g[p+b&3],Y=V.r*H[0]+T.r*H[1]>>7,j=V.g*H[0]+T.g*H[1]>>7,ut=V.b*H[0]+T.b*H[1]>>7;n.setPixelRgb(z+x,C+m,Y,j,ut),b>>=2,w++}}}return n}decodeRgba4bpp(t,e,i){const n=new tt({width:t,height:e,numChannels:4}),s=Math.trunc(t/4),a=s-1,r=new gt(i),h=new gt(i),l=new gt(i),u=new gt(i),d=new gt(i),c=gt.bilinearFactors,g=gt.weights;for(let f=0,m=0;f<s;++f,m+=4)for(let _=0,x=0;_<s;++_,x+=4){r.setBlock(_,f);let b=r.modulationData;const p=r.usePunchthroughAlpha?4:0;let w=0;for(let C=0;C<4;++C){const y=C<2?-1:0,A=f+y&a,B=A+1&a;for(let z=0;z<4;++z){const U=z<2?-1:0,P=_+U&a,L=P+1&a;h.setBlock(P,A),l.setBlock(L,A),u.setBlock(P,B),d.setBlock(L,B);const V=h.getColorRgbaA().mul(c[w][0]).add(l.getColorRgbaA().mul(c[w][1]).add(u.getColorRgbaA().mul(c[w][2]).add(d.getColorRgbaA().mul(c[w][3])))),T=h.getColorRgbaB().mul(c[w][0]).add(l.getColorRgbaB().mul(c[w][1]).add(u.getColorRgbaB().mul(c[w][2]).add(d.getColorRgbaB().mul(c[w][3])))),H=g[p+b&3],Y=V.r*H[0]+T.r*H[1]>>7,j=V.g*H[0]+T.g*H[1]>>7,ut=V.b*H[0]+T.b*H[1]>>7,ct=V.a*H[2]+T.a*H[3]>>7;n.setPixelRgba(z+x,C+m,Y,j,ut,ct),b>>=2,w++}}}return n}isValidFile(t){return this.startDecode(t)!==void 0}startDecode(t){if(this.countBits(t.length)===1){const e=this.decodeApplePvrtcHeader(t);if(e!==void 0)return this._data=t,this._info=e}{const e=this.decodePvr3Header(t);if(e!==void 0)return this._data=t,this._info=e}{const e=this.decodePvr2Header(t);if(e!==void 0)return this._data=t,this._info=e}}decode(t){var e;if(this.startDecode(t.bytes)!==void 0)return this.decodeFrame((e=t.frameIndex)!==null&&e!==void 0?e:0)}decodeFrame(t){if(!(this._info===void 0||this._data===void 0)){if(this._info instanceof Xn)return this.decodeRgba4bpp(this._info.width,this._info.height,this._data);if(this._info instanceof jn)return this.decodePvr2(this._data);if(this._info instanceof Pn)return this.decodePvr3(this._data)}}}Le.pvrHeaderSize=52;var Zn;(function(o){o[o.topLeft=0]="topLeft",o[o.topCenter=1]="topCenter",o[o.topRight=2]="topRight",o[o.centerLeft=3]="centerLeft",o[o.center=4]="center",o[o.centerRight=5]="centerRight",o[o.bottomLeft=6]="bottomLeft",o[o.bottomCenter=7]="bottomCenter",o[o.bottomRight=8]="bottomRight"})(Zn||(Zn={}));var Kn;(function(o){o[o.horizontal=0]="horizontal",o[o.vertical=1]="vertical",o[o.both=2]="both"})(Kn||(Kn={}));var Qn;(function(o){o[o.top=1]="top",o[o.bottom=2]="bottom",o[o.left=4]="left",o[o.right=8]="right",o[o.all=15]="all"})(Qn||(Qn={}));var Jn;(function(o){o[o.transparent=0]="transparent",o[o.topLeftColor=1]="topLeftColor",o[o.bottomRightColor=2]="bottomRightColor"})(Jn||(Jn={}));function Ra(o){const t=o instanceof Uint8Array?o:new Uint8Array(o),e=new cs;if(e.isValidFile(t))return e;const i=new De;if(i.isValidFile(t))return i;const n=new et;if(n.isValidFile(t))return n;const s=new xa;if(s.isValidFile(t))return s;const a=new Ke;if(a.isValidFile(t))return a;const r=new Ba;if(r.isValidFile(t))return r;const h=new is;if(h.isValidFile(t))return h;const l=new Qs;if(l.isValidFile(t))return l;const u=new In;if(u.isValidFile(t))return u;const d=new Le;if(d.isValidFile(t))return d;const c=new ba;if(c.isValidFile(t))return c}function Ia(o){const t=Ra(o.data);if(t===void 0)return;const e=new Uint8Array(o.data);return o.largest===!0&&t instanceof In?t.decodeImageLargest(e):t.decode({bytes:e,frameIndex:o.frameIndex})}function Na(o){var t,e,i;const n=(t=o.skipExif)!==null&&t!==void 0?t:!1,s=(e=o.quality)!==null&&e!==void 0?e:100,a=(i=o.chroma)!==null&&i!==void 0?i:Ri.yuv444;return new nt(s).encode({image:o.image,chroma:a,skipExif:n})}function Da(o){var t,e,i;const n=(t=o.singleFrame)!==null&&t!==void 0?t:!1,s=(e=o.level)!==null&&e!==void 0?e:6,a=(i=o.filter)!==null&&i!==void 0?i:Dt.paeth;return new vt({filter:a,level:s}).encode({image:o.image,singleFrame:n})}function La(o){return new Js().encode({image:o.image})}function Fa(o){var t,e,i,n,s;const a=(t=o.singleFrame)!==null&&t!==void 0?t:!1,r=(e=o.repeat)!==null&&e!==void 0?e:0,h=(i=o.samplingFactor)!==null&&i!==void 0?i:10,l=(n=o.dither)!==null&&n!==void 0?n:wi.floydSteinberg,u=(s=o.ditherSerpentine)!==null&&s!==void 0?s:!1;return new bt({repeat:r,samplingFactor:h,dither:l,ditherSerpentine:u}).encode({image:o.image,singleFrame:a})}function Ta(o){var t,e;const i=(t=o.singleFrame)!==null&&t!==void 0?t:!1,n=(e=o.skipExif)!==null&&e!==void 0?e:!1;return new sa().encode({image:o.image,singleFrame:i,skipExif:n})}function Va(o){return new ps().encode({image:o.image})}function Oa(o){const t=new Uint8Array(o.data),e=new In;return o.largest===!0?e.decodeImageLargest(t):e.decode({bytes:t,frameIndex:o.frameIndex})}function Ha(o){var t;const e=(t=o.singleFrame)!==null&&t!==void 0?t:!1;return new ls().encode({image:o.image,singleFrame:e})}function qa(o){return new ls().encodeImages(o.images)}function Ea(o){return new mn().encode({image:o.image})}export{_t as B,G as D,me as E,Kn as F,Pi as I,W as L,tt as M,K as P,Ki as R,Jn as T,Qn as a,k as b,Zn as c,Xe as d,Ia as e,qa as f,Oa as g,Da as h,Na as i,Va as j,Fa as k,Ha as l,La as m,Ea as n,Ta as o};
