import{d as $,a0 as U,r as _,E as I,o as H,c as D,k as i,w as g,l,m as f,a7 as N,x as P,af as R}from"./index-0c1fde36.js";import{B as h}from"./index-a6f01dde.js";import{u as V}from"./index-fdbe2ce9.js";import{n as v}from"./index-19e2bc48.js";import{_ as C}from"./TextareaCopyable-59231e95.js";import{_ as j}from"./Divider-5fc425b0.js";import{_ as F}from"./Space-7fc52151.js";import"./string_decoder-8ac4312e.js";import"./index-649b5bab.js";import"./inherits_browser-6f38ab1b.js";import"./index-0397ab6f.js";import"./index-892bd980.js";import"./browser-703720a1.js";import"./hash-f152040d.js";import"./base64-ae7cf34b.js";import"./downloadBase64-508288e2.js";import"./index-6fddb70d.js";import"./index-cfd4d427.js";import"./Copy-ef9ec73c.js";import"./Scrollbar-54724e22.js";import"./get-slot-1efb97e5.js";/**
 * @license MIT
 * @copyright Copyright (c) 2014 Michał Budzyński (@michalbe)
 * @see https://github.com/michalbe/binascii
 * @see https://docs.python.org/2/library/binascii.html
 */function L(a){let t="";for(let e=0,r=a.length;e<r;e++){const o=("00"+a.charCodeAt(e).toString(16)).slice(-2);t+=o}return t}function O(a){let t="";for(var e=0,r=a.length;e<r;e+=2)t+=String.fromCharCode(parseInt(a.slice(e,e+2),16));return t}function T(a,t){if(t>256)throw new Error("can't pad blocks larger 256 bytes");const e=t-a%t;return h.alloc(e,h.from([e]))}function G(a,t){let e=a.length;const r=a[e-1];if(r>t)return a;for(let n=e-r;n<e;n++)if(a[n]!==r)return a;return a.subarray(0,e-r)}const W=V.promisify(v.pbkdf2),S="$ANSIBLE_VAULT",k="AES256",A="aes-256-ctr",K="sha256",b=Symbol();class B{constructor({password:t}){this[b]=t}_checkHeader(t){if(!t)return!1;const[e,r,n,o=!0]=t.split(";");return e===S&&/^1\.[12]$/.test(r)&&n===k?o:!1}_hmac(t,e){const r=v.createHmac(K,t);return r.update(e),r.digest()}async _derivedKey(t){if(!this[b])throw new Error("No password");const e=await W(this[b],t,1e4,80,K);return this._deriveKey(e)}_derivedKeySync(t){if(!this[b])throw new Error("No password");const e=v.pbkdf2Sync(this[b],t,1e4,80,K);return this._deriveKey(e)}_deriveKey(t){const e=t.subarray(0,32),r=t.subarray(32,64),n=t.subarray(64,80);return{key:e,hmacKey:r,iv:n}}async encrypt(t,e){const r=v.randomBytes(32),n=await this._derivedKey(r);return this._cipher(t,e,r,n)}encryptSync(t,e){const r=v.randomBytes(32),n=this._derivedKeySync(r);return this._cipher(t,e,r,n)}_cipher(t,e,r,n){const{key:o,hmacKey:p,iv:u}=n,d=v.createCipheriv(A,o,u),c=h.concat([h.from(t,"utf-8"),T(h.from(t,"utf-8").length,16)]),s=h.concat([d.update(c),d.final()]),m=this._hmac(p,s),x=[r,m,s].map(w=>w.toString("hex")).join(`
`);return this._pack(e,x)}_decipher(t,e){const{hmac:r,ciphertext:n}=t,{key:o,hmacKey:p,iv:u}=e,d=this._hmac(p,n);if(h.compare(d,r)!==0)throw new Error("Integrity check failed");const c=v.createDecipheriv(A,o,u);return G(h.concat([c.update(n),c.final()]),16).toString()}_pack(t,e){return(t?`${S};1.2;${k};${t}
`:`${S};1.1;${k}
`)+L(e).match(/.{1,80}/g).join(`
`)}_unpack(t,e){const[r,...n]=t.split(/\r?\n/),o=this._checkHeader(r);if(!o)throw new Error("Bad vault header");if(e&&e!==o)return;const[p,u,d]=O(n.join("")).split(/\r?\n/).map(c=>h.from(c,"hex"));if(!p||!u||!d)throw new Error("Invalid vault");return{salt:p,hmac:u,ciphertext:d}}async decrypt(t,e){const r=this._unpack(t,e);if(!r)return;const{salt:n}=r,o=await this._derivedKey(n);return this._decipher(r,o)}decryptSync(t,e){const r=this._unpack(t,e);if(!r)return;const{salt:n}=r,o=this._derivedKeySync(n);return this._decipher(r,o)}}const yt=$({__name:"ansible-vault-crypt-decrypt",setup(a){const{t}=U(),e=_(""),r=_(""),n=_(""),o=I(async()=>{try{return await new B({password:r.value}).encrypt(e.value,n.value)}catch(c){return c.toString()}}),p=_(""),u=_(""),d=I(async()=>{try{return await new B({password:u.value}).decrypt(p.value?.replace(/\r(?!\n)/,`
`),void 0)??""}catch(c){return c.toString()}});return(c,s)=>{const m=P,x=F,w=j,E=R;return H(),D(N,null,[i(E,{title:l(t)("tools.ansible-vault-crypt-decrypt.texts.title-encrypt-ansible-vault-secret")},{default:g(()=>[i(m,{value:l(e),"onUpdate:value":s[0]||(s[0]=y=>f(e)?e.value=y:null),placeholder:l(t)("tools.ansible-vault-crypt-decrypt.texts.placeholder-put-your-string-to-encrypt"),label:l(t)("tools.ansible-vault-crypt-decrypt.texts.label-string-to-encrypt"),"raw-text":"","mb-5":""},null,8,["value","placeholder","label"]),i(x,null,{default:g(()=>[i(m,{value:l(r),"onUpdate:value":s[1]||(s[1]=y=>f(r)?r.value=y:null),placeholder:l(t)("tools.ansible-vault-crypt-decrypt.texts.placeholder-encryption-password"),label:l(t)("tools.ansible-vault-crypt-decrypt.texts.label-encryption-password"),"raw-text":"","mb-5":""},null,8,["value","placeholder","label"]),i(m,{value:l(n),"onUpdate:value":s[2]||(s[2]=y=>f(n)?n.value=y:null),placeholder:l(t)("tools.ansible-vault-crypt-decrypt.texts.placeholder-encryption-id"),label:l(t)("tools.ansible-vault-crypt-decrypt.texts.label-encryption-id"),"raw-text":"","mb-5":""},null,8,["value","placeholder","label"])]),_:1}),i(w),i(C,{label:l(t)("tools.ansible-vault-crypt-decrypt.texts.label-encrypted-string"),value:l(o),multiline:"",readonly:"",rows:"5","mb-5":""},null,8,["label","value"])]),_:1},8,["title"]),i(E,{title:l(t)("tools.ansible-vault-crypt-decrypt.texts.title-decrypt-ansible-vault-secret")},{default:g(()=>[i(m,{value:l(p),"onUpdate:value":s[3]||(s[3]=y=>f(p)?p.value=y:null),placeholder:l(t)("tools.ansible-vault-crypt-decrypt.texts.placeholder-put-your-encrypted-string-here"),label:l(t)("tools.ansible-vault-crypt-decrypt.texts.label-string-to-decrypt"),"raw-text":"",multiline:"","mb-5":"",rows:"5"},null,8,["value","placeholder","label"]),i(m,{value:l(u),"onUpdate:value":s[4]||(s[4]=y=>f(u)?u.value=y:null),placeholder:l(t)("tools.ansible-vault-crypt-decrypt.texts.placeholder-decryption-password"),label:l(t)("tools.ansible-vault-crypt-decrypt.texts.label-decryption-password"),"raw-text":"","mb-5":""},null,8,["value","placeholder","label"]),i(w),i(C,{label:l(t)("tools.ansible-vault-crypt-decrypt.texts.label-decrypted-string"),value:l(d),multiline:"",readonly:"",rows:"5","mb-5":""},null,8,["label","value"])]),_:1},8,["title"])],64)}}});export{yt as default};
