import{c as h,i as B}from"./style-ynO7IsM1.js";import"./version-BXrBJCm5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-C6L5gDe0.js";import{a as f,f as y,r as b,e as I,b as E,h as u,P as L,d as P}from"./main-CdZmBCMR.js";import"./mobileMenu-BoMunYmR.js";const n={file:null,pdfDoc:null,viewerIframe:null,viewerReady:!1,blobUrl:null};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",v):v();function v(){h({icons:B});const e=document.getElementById("file-input"),t=document.getElementById("drop-zone"),o=document.getElementById("process-btn");e&&e.addEventListener("change",F),t&&(t.addEventListener("dragover",a=>{a.preventDefault(),t.classList.add("bg-gray-700")}),t.addEventListener("dragleave",()=>{t.classList.remove("bg-gray-700")}),t.addEventListener("drop",a=>{a.preventDefault(),t.classList.remove("bg-gray-700");const i=a.dataTransfer?.files;i&&i.length>0&&D(i[0])}),e?.addEventListener("click",()=>{e&&(e.value="")})),o&&o.addEventListener("click",U),document.getElementById("back-to-tools")?.addEventListener("click",()=>{S(),window.location.href="/itools/"})}function F(e){const t=e.target;t.files&&t.files.length>0&&D(t.files[0])}function D(e){if(e.type!=="application/pdf"&&!e.name.toLowerCase().endsWith(".pdf")){f("Invalid File","Please select a PDF file.");return}n.file=e,x(),C()}async function x(){const e=document.getElementById("file-display-area");if(!e||!n.file)return;e.innerHTML="";const t=document.createElement("div");t.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg";const o=document.createElement("div");o.className="flex flex-col flex-1 min-w-0";const a=document.createElement("div");a.className="truncate font-medium text-gray-200 text-sm mb-1",a.textContent=n.file.name;const i=document.createElement("div");i.className="text-xs text-gray-400",i.textContent=`${y(n.file.size)} • Loading pages...`,o.append(a,i);const l=document.createElement("button");l.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",l.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',l.onclick=()=>{n.file=null,n.pdfDoc=null,e.innerHTML="",document.getElementById("signature-editor")?.classList.add("hidden")},t.append(o,l),e.appendChild(t),h({icons:B});try{const d=await b(n.file),r=await I({data:d}).promise;i.textContent=`${y(n.file.size)} • ${r.numPages} pages`}catch(d){console.error("Error loading PDF:",d)}}async function C(){const e=document.getElementById("signature-editor");e&&e.classList.remove("hidden"),E("Loading PDF viewer...");const t=document.getElementById("canvas-container-sign");if(!t){console.error("Sign tool canvas container not found"),u();return}if(!n.file){console.error("No file loaded for signing"),u();return}t.textContent="";const o=document.createElement("iframe");o.style.width="100%",o.style.height="100%",o.style.border="none",t.appendChild(o),n.viewerIframe=o;const a=await b(n.file),i=new Blob([a],{type:"application/pdf"});n.blobUrl=URL.createObjectURL(i);try{const r=localStorage.getItem("pdfjs.preferences"),s=r?JSON.parse(r):{};delete s.annotationEditorMode;const m={...s,enableSignatureEditor:!0,enablePermissions:!1};localStorage.setItem("pdfjs.preferences",JSON.stringify(m))}catch{}const l=new URL("/itools/pdfjs-viewer/viewer.html",window.location.origin),d=new URLSearchParams({file:n.blobUrl});o.src=`${l.toString()}?${d.toString()}`,o.onload=()=>{u(),n.viewerReady=!0;try{const s=o.contentWindow;if(s&&s.PDFViewerApplication){const m=s.PDFViewerApplication,c=s.document;m.eventBus?._on("annotationeditoruimanager",()=>{c.getElementById("editorModeButtons")?.classList.remove("hidden"),c.getElementById("editorSignature")?.removeAttribute("hidden");const g=c.getElementById("editorSignatureButton");g&&(g.disabled=!1),c.getElementById("editorStamp")?.removeAttribute("hidden");const p=c.getElementById("editorStampButton");p&&(p.disabled=!1);try{c.getElementById("editorHighlightButton")?.click()}catch{}})}}catch(s){console.error("Could not initialize PDF.js viewer for signing:",s)}const r=document.getElementById("process-btn");r&&(r.style.display="")}}async function U(){if(!n.viewerReady||!n.viewerIframe){f("Viewer not ready","Please wait for the PDF viewer to load.");return}try{const e=n.viewerIframe.contentWindow;if(!e||!e.PDFViewerApplication){f("Viewer not ready","The PDF viewer is still initializing.");return}const t=e.PDFViewerApplication;if(document.getElementById("flatten-signature-toggle")?.checked){E("Flattening and saving PDF...");const i=await t.pdfDocument.saveDocument(t.pdfDocument.annotationStorage),l=new Uint8Array(i),d=await L.load(l);d.getForm().flatten();const r=await d.save(),s=new Blob([r],{type:"application/pdf"});P(s,`signed_flattened_${n.file?.name||"document.pdf"}`),u(),f("Success","Signed PDF saved successfully!","success",()=>{w()})}else t.eventBus?.dispatch("download",{source:t}),f("Success","Signed PDF downloaded successfully!","success",()=>{w()})}catch(e){console.error("Failed to export the signed PDF:",e),u(),f("Export failed","Could not export the signed PDF. Please try again.")}}function w(){S(),n.file=null,n.viewerIframe=null,n.viewerReady=!1;const e=document.getElementById("signature-editor");e&&e.classList.add("hidden");const t=document.getElementById("canvas-container-sign");t&&(t.textContent="");const o=document.getElementById("file-display-area");o&&(o.innerHTML="");const a=document.getElementById("process-btn");a&&(a.style.display="none");const i=document.getElementById("flatten-signature-toggle");i&&(i.checked=!1)}function S(){n.blobUrl&&(URL.revokeObjectURL(n.blobUrl),n.blobUrl=null)}
