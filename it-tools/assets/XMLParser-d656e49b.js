const L=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",B=L+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",Y="["+L+"]["+B+"]*",X=new RegExp("^"+Y+"$");function j(n,t){const e=[];let i=t.exec(n);for(;i;){const r=[];r.startIndex=t.lastIndex-i[0].length;const s=i.length;for(let f=0;f<s;f++)r.push(i[f]);e.push(r),i=t.exec(n)}return e}const O=function(n){const t=X.exec(n);return!(t===null||typeof t>"u")};function Z(n){return typeof n<"u"}const W={allowBooleanAttributes:!1,unpairedTags:[]};function m(n,t){t=Object.assign({},W,t);const e=[];let i=!1,r=!1;n[0]==="\uFEFF"&&(n=n.substr(1));for(let s=0;s<n.length;s++)if(n[s]==="<"&&n[s+1]==="?"){if(s+=2,s=k(n,s),s.err)return s}else if(n[s]==="<"){let f=s;if(s++,n[s]==="!"){s=$(n,s);continue}else{let l=!1;n[s]==="/"&&(l=!0,s++);let o="";for(;s<n.length&&n[s]!==">"&&n[s]!==" "&&n[s]!=="	"&&n[s]!==`
`&&n[s]!=="\r";s++)o+=n[s];if(o=o.trim(),o[o.length-1]==="/"&&(o=o.substring(0,o.length-1),s--),!x(o)){let d;return o.trim().length===0?d="Invalid space after '<'.":d="Tag '"+o+"' is an invalid name.",h("InvalidTag",d,p(n,s))}const u=G(n,s);if(u===!1)return h("InvalidAttr","Attributes for '"+o+"' have open quote.",p(n,s));let c=u.value;if(s=u.index,c[c.length-1]==="/"){const d=s-c.length;c=c.substring(0,c.length-1);const g=R(c,t);if(g===!0)i=!0;else return h(g.err.code,g.err.msg,p(n,d+g.err.line))}else if(l)if(u.tagClosed){if(c.trim().length>0)return h("InvalidTag","Closing tag '"+o+"' can't have attributes or invalid starting.",p(n,f));if(e.length===0)return h("InvalidTag","Closing tag '"+o+"' has not been opened.",p(n,f));{const d=e.pop();if(o!==d.tagName){let g=p(n,d.tagStartPos);return h("InvalidTag","Expected closing tag '"+d.tagName+"' (opened in line "+g.line+", col "+g.col+") instead of closing tag '"+o+"'.",p(n,f))}e.length==0&&(r=!0)}}else return h("InvalidTag","Closing tag '"+o+"' doesn't have proper closing.",p(n,s));else{const d=R(c,t);if(d!==!0)return h(d.err.code,d.err.msg,p(n,s-c.length+d.err.line));if(r===!0)return h("InvalidXml","Multiple possible root nodes found.",p(n,s));t.unpairedTags.indexOf(o)!==-1||e.push({tagName:o,tagStartPos:f}),i=!0}for(s++;s<n.length;s++)if(n[s]==="<")if(n[s+1]==="!"){s++,s=$(n,s);continue}else if(n[s+1]==="?"){if(s=k(n,++s),s.err)return s}else break;else if(n[s]==="&"){const d=z(n,s);if(d==-1)return h("InvalidChar","char '&' is not expected.",p(n,s));s=d}else if(r===!0&&!_(n[s]))return h("InvalidXml","Extra text at the end",p(n,s));n[s]==="<"&&s--}}else{if(_(n[s]))continue;return h("InvalidChar","char '"+n[s]+"' is not expected.",p(n,s))}if(i){if(e.length==1)return h("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",p(n,e[0].tagStartPos));if(e.length>0)return h("InvalidXml","Invalid '"+JSON.stringify(e.map(s=>s.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return h("InvalidXml","Start tag expected.",1);return!0}function _(n){return n===" "||n==="	"||n===`
`||n==="\r"}function k(n,t){const e=t;for(;t<n.length;t++)if(n[t]=="?"||n[t]==" "){const i=n.substr(e,t-e);if(t>5&&i==="xml")return h("InvalidXml","XML declaration allowed only at the start of the document.",p(n,t));if(n[t]=="?"&&n[t+1]==">"){t++;break}else continue}return t}function $(n,t){if(n.length>t+5&&n[t+1]==="-"&&n[t+2]==="-"){for(t+=3;t<n.length;t++)if(n[t]==="-"&&n[t+1]==="-"&&n[t+2]===">"){t+=2;break}}else if(n.length>t+8&&n[t+1]==="D"&&n[t+2]==="O"&&n[t+3]==="C"&&n[t+4]==="T"&&n[t+5]==="Y"&&n[t+6]==="P"&&n[t+7]==="E"){let e=1;for(t+=8;t<n.length;t++)if(n[t]==="<")e++;else if(n[t]===">"&&(e--,e===0))break}else if(n.length>t+9&&n[t+1]==="["&&n[t+2]==="C"&&n[t+3]==="D"&&n[t+4]==="A"&&n[t+5]==="T"&&n[t+6]==="A"&&n[t+7]==="["){for(t+=8;t<n.length;t++)if(n[t]==="]"&&n[t+1]==="]"&&n[t+2]===">"){t+=2;break}}return t}const q='"',Q="'";function G(n,t){let e="",i="",r=!1;for(;t<n.length;t++){if(n[t]===q||n[t]===Q)i===""?i=n[t]:i!==n[t]||(i="");else if(n[t]===">"&&i===""){r=!0;break}e+=n[t]}return i!==""?!1:{value:e,index:t,tagClosed:r}}const K=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function R(n,t){const e=j(n,K),i={};for(let r=0;r<e.length;r++){if(e[r][1].length===0)return h("InvalidAttr","Attribute '"+e[r][2]+"' has no space in starting.",I(e[r]));if(e[r][3]!==void 0&&e[r][4]===void 0)return h("InvalidAttr","Attribute '"+e[r][2]+"' is without value.",I(e[r]));if(e[r][3]===void 0&&!t.allowBooleanAttributes)return h("InvalidAttr","boolean attribute '"+e[r][2]+"' is not allowed.",I(e[r]));const s=e[r][2];if(!H(s))return h("InvalidAttr","Attribute '"+s+"' is an invalid name.",I(e[r]));if(!i.hasOwnProperty(s))i[s]=1;else return h("InvalidAttr","Attribute '"+s+"' is repeated.",I(e[r]))}return!0}function J(n,t){let e=/\d/;for(n[t]==="x"&&(t++,e=/[\da-fA-F]/);t<n.length;t++){if(n[t]===";")return t;if(!n[t].match(e))break}return-1}function z(n,t){if(t++,n[t]===";")return-1;if(n[t]==="#")return t++,J(n,t);let e=0;for(;t<n.length;t++,e++)if(!(n[t].match(/\w/)&&e<20)){if(n[t]===";")break;return-1}return t}function h(n,t,e){return{err:{code:n,msg:t,line:e.line||e,col:e.col}}}function H(n){return O(n)}function x(n){return O(n)}function p(n,t){const e=n.substring(0,t).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function I(n){return n.startIndex+n[1].length}const D={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(n,t){return t},attributeValueProcessor:function(n,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(n,t,e){return n},captureMetaData:!1},ee=function(n){return Object.assign({},D,n)};let A;typeof Symbol!="function"?A="@@xmlMetadata":A=Symbol("XML Node Metadata");class b{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t,e){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child}),e!==void 0&&(this.child[this.child.length-1][A]={startIndex:e})}static getMetaDataSymbol(){return A}}class te{constructor(t){this.suppressValidationErr=!t}readDocType(t,e){const i={};if(t[e+3]==="O"&&t[e+4]==="C"&&t[e+5]==="T"&&t[e+6]==="Y"&&t[e+7]==="P"&&t[e+8]==="E"){e=e+9;let r=1,s=!1,f=!1,l="";for(;e<t.length;e++)if(t[e]==="<"&&!f){if(s&&N(t,"!ENTITY",e)){e+=7;let o,u;[o,u,e]=this.readEntityExp(t,e+1,this.suppressValidationErr),u.indexOf("&")===-1&&(i[o]={regx:RegExp(`&${o};`,"g"),val:u})}else if(s&&N(t,"!ELEMENT",e)){e+=8;const{index:o}=this.readElementExp(t,e+1);e=o}else if(s&&N(t,"!ATTLIST",e))e+=8;else if(s&&N(t,"!NOTATION",e)){e+=9;const{index:o}=this.readNotationExp(t,e+1,this.suppressValidationErr);e=o}else if(N(t,"!--",e))f=!0;else throw new Error("Invalid DOCTYPE");r++,l=""}else if(t[e]===">"){if(f?t[e-1]==="-"&&t[e-2]==="-"&&(f=!1,r--):r--,r===0)break}else t[e]==="["?s=!0:l+=t[e];if(r!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:i,i:e}}readEntityExp(t,e){e=E(t,e);let i="";for(;e<t.length&&!/\s/.test(t[e])&&t[e]!=='"'&&t[e]!=="'";)i+=t[e],e++;if(y(i),e=E(t,e),!this.suppressValidationErr){if(t.substring(e,e+6).toUpperCase()==="SYSTEM")throw new Error("External entities are not supported");if(t[e]==="%")throw new Error("Parameter entities are not supported")}let r="";return[e,r]=this.readIdentifierVal(t,e,"entity"),e--,[i,r,e]}readNotationExp(t,e){e=E(t,e);let i="";for(;e<t.length&&!/\s/.test(t[e]);)i+=t[e],e++;!this.suppressValidationErr&&y(i),e=E(t,e);const r=t.substring(e,e+6).toUpperCase();if(!this.suppressValidationErr&&r!=="SYSTEM"&&r!=="PUBLIC")throw new Error(`Expected SYSTEM or PUBLIC, found "${r}"`);e+=r.length,e=E(t,e);let s=null,f=null;if(r==="PUBLIC")[e,s]=this.readIdentifierVal(t,e,"publicIdentifier"),e=E(t,e),(t[e]==='"'||t[e]==="'")&&([e,f]=this.readIdentifierVal(t,e,"systemIdentifier"));else if(r==="SYSTEM"&&([e,f]=this.readIdentifierVal(t,e,"systemIdentifier"),!this.suppressValidationErr&&!f))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:i,publicIdentifier:s,systemIdentifier:f,index:--e}}readIdentifierVal(t,e,i){let r="";const s=t[e];if(s!=='"'&&s!=="'")throw new Error(`Expected quoted string, found "${s}"`);for(e++;e<t.length&&t[e]!==s;)r+=t[e],e++;if(t[e]!==s)throw new Error(`Unterminated ${i} value`);return e++,[e,r]}readElementExp(t,e){e=E(t,e);let i="";for(;e<t.length&&!/\s/.test(t[e]);)i+=t[e],e++;if(!this.suppressValidationErr&&!O(i))throw new Error(`Invalid element name: "${i}"`);e=E(t,e);let r="";if(t[e]==="E"&&N(t,"MPTY",e))e+=4;else if(t[e]==="A"&&N(t,"NY",e))e+=2;else if(t[e]==="("){for(e++;e<t.length&&t[e]!==")";)r+=t[e],e++;if(t[e]!==")")throw new Error("Unterminated content model")}else if(!this.suppressValidationErr)throw new Error(`Invalid Element Expression, found "${t[e]}"`);return{elementName:i,contentModel:r.trim(),index:e}}readAttlistExp(t,e){e=E(t,e);let i="";for(;e<t.length&&!/\s/.test(t[e]);)i+=t[e],e++;y(i),e=E(t,e);let r="";for(;e<t.length&&!/\s/.test(t[e]);)r+=t[e],e++;if(!y(r))throw new Error(`Invalid attribute name: "${r}"`);e=E(t,e);let s="";if(t.substring(e,e+8).toUpperCase()==="NOTATION"){if(s="NOTATION",e+=8,e=E(t,e),t[e]!=="(")throw new Error(`Expected '(', found "${t[e]}"`);e++;let l=[];for(;e<t.length&&t[e]!==")";){let o="";for(;e<t.length&&t[e]!=="|"&&t[e]!==")";)o+=t[e],e++;if(o=o.trim(),!y(o))throw new Error(`Invalid notation name: "${o}"`);l.push(o),t[e]==="|"&&(e++,e=E(t,e))}if(t[e]!==")")throw new Error("Unterminated list of notations");e++,s+=" ("+l.join("|")+")"}else{for(;e<t.length&&!/\s/.test(t[e]);)s+=t[e],e++;const l=["CDATA","ID","IDREF","IDREFS","ENTITY","ENTITIES","NMTOKEN","NMTOKENS"];if(!this.suppressValidationErr&&!l.includes(s.toUpperCase()))throw new Error(`Invalid attribute type: "${s}"`)}e=E(t,e);let f="";return t.substring(e,e+8).toUpperCase()==="#REQUIRED"?(f="#REQUIRED",e+=8):t.substring(e,e+7).toUpperCase()==="#IMPLIED"?(f="#IMPLIED",e+=7):[e,f]=this.readIdentifierVal(t,e,"ATTLIST"),{elementName:i,attributeName:r,attributeType:s,defaultValue:f,index:e}}}const E=(n,t)=>{for(;t<n.length&&/\s/.test(n[t]);)t++;return t};function N(n,t,e){for(let i=0;i<t.length;i++)if(t[i]!==n[e+i+1])return!1;return!0}function y(n){if(O(n))return n;throw new Error(`Invalid entity name ${n}`)}const ne=/^[-+]?0x[a-fA-F0-9]+$/,se=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,re={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function ie(n,t={}){if(t=Object.assign({},re,t),!n||typeof n!="string")return n;let e=n.trim();if(t.skipLike!==void 0&&t.skipLike.test(e))return n;if(n==="0")return 0;if(t.hex&&ne.test(e))return le(e,16);if(e.search(/.+[eE].+/)!==-1)return fe(n,e,t);{const i=se.exec(e);if(i){const r=i[1]||"",s=i[2];let f=ue(i[3]);const l=r?n[s.length+1]===".":n[s.length]===".";if(!t.leadingZeros&&(s.length>1||s.length===1&&!l))return n;{const o=Number(e),u=String(o);if(o===0)return o;if(u.search(/[eE]/)!==-1)return t.eNotation?o:n;if(e.indexOf(".")!==-1)return u==="0"||u===f||u===`${r}${f}`?o:n;let c=s?f:e;return s?c===u||r+c===u?o:n:c===u||c===r+u?o:n}}else return n}}const oe=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;function fe(n,t,e){if(!e.eNotation)return n;const i=t.match(oe);if(i){let r=i[1]||"";const s=i[3].indexOf("e")===-1?"E":"e",f=i[2],l=r?n[f.length+1]===s:n[f.length]===s;return f.length>1&&l?n:f.length===1&&(i[3].startsWith(`.${s}`)||i[3][0]===s)?Number(t):e.leadingZeros&&!l?(t=(i[1]||"")+i[3],Number(t)):n}else return n}function ue(n){return n&&n.indexOf(".")!==-1&&(n=n.replace(/0+$/,""),n==="."?n="0":n[0]==="."?n="0"+n:n[n.length-1]==="."&&(n=n.substring(0,n.length-1))),n}function le(n,t){if(parseInt)return parseInt(n,t);if(Number.parseInt)return Number.parseInt(n,t);if(window&&window.parseInt)return window.parseInt(n,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}function de(n){return typeof n=="function"?n:Array.isArray(n)?t=>{for(const e of n)if(typeof e=="string"&&t===e||e instanceof RegExp&&e.test(t))return!0}:()=>!1}class ce{constructor(t){if(this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,i)=>String.fromCodePoint(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,i)=>String.fromCodePoint(Number.parseInt(i,16))}},this.addExternalEntities=he,this.parseXml=Ne,this.parseTextData=ge,this.resolveNameSpace=ae,this.buildAttributesMap=Ee,this.isItStopNode=Ie,this.replaceEntitiesValue=Te,this.readStopNodeData=Ae,this.saveTextToParentTag=we,this.addChild=be,this.ignoreAttributesFn=de(this.options.ignoreAttributes),this.options.stopNodes&&this.options.stopNodes.length>0){this.stopNodesExact=new Set,this.stopNodesWildcard=new Set;for(let e=0;e<this.options.stopNodes.length;e++){const i=this.options.stopNodes[e];typeof i=="string"&&(i.startsWith("*.")?this.stopNodesWildcard.add(i.substring(2)):this.stopNodesExact.add(i))}}}}function he(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:n[i]}}}function ge(n,t,e,i,r,s,f){if(n!==void 0&&(this.options.trimValues&&!i&&(n=n.trim()),n.length>0)){f||(n=this.replaceEntitiesValue(n));const l=this.options.tagValueProcessor(t,n,e,r,s);return l==null?n:typeof l!=typeof n||l!==n?l:this.options.trimValues?V(n,this.options.parseTagValue,this.options.numberParseOptions):n.trim()===n?V(n,this.options.parseTagValue,this.options.numberParseOptions):n}}function ae(n){if(this.options.removeNSPrefix){const t=n.split(":"),e=n.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(n=e+t[1])}return n}const pe=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Ee(n,t){if(this.options.ignoreAttributes!==!0&&typeof n=="string"){const e=j(n,pe),i=e.length,r={};for(let s=0;s<i;s++){const f=this.resolveNameSpace(e[s][1]);if(this.ignoreAttributesFn(f,t))continue;let l=e[s][4],o=this.options.attributeNamePrefix+f;if(f.length)if(this.options.transformAttributeName&&(o=this.options.transformAttributeName(o)),o==="__proto__"&&(o="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const u=this.options.attributeValueProcessor(f,l,t);u==null?r[o]=l:typeof u!=typeof l||u!==l?r[o]=u:r[o]=V(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r[o]=!0)}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){const s={};return s[this.options.attributesGroupName]=r,s}return r}}const Ne=function(n){n=n.replace(/\r\n?/g,`
`);const t=new b("!xml");let e=t,i="",r="";const s=new te(this.options.processEntities);for(let f=0;f<n.length;f++)if(n[f]==="<")if(n[f+1]==="/"){const o=T(n,">",f,"Closing Tag is not closed.");let u=n.substring(f+2,o).trim();if(this.options.removeNSPrefix){const g=u.indexOf(":");g!==-1&&(u=u.substr(g+1))}this.options.transformTagName&&(u=this.options.transformTagName(u)),e&&(i=this.saveTextToParentTag(i,e,r));const c=r.substring(r.lastIndexOf(".")+1);if(u&&this.options.unpairedTags.indexOf(u)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${u}>`);let d=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(d=r.lastIndexOf(".",r.lastIndexOf(".")-1),this.tagsNodeStack.pop()):d=r.lastIndexOf("."),r=r.substring(0,d),e=this.tagsNodeStack.pop(),i="",f=o}else if(n[f+1]==="?"){let o=S(n,f,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,e,r),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const u=new b(o.tagName);u.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(u[":@"]=this.buildAttributesMap(o.tagExp,r)),this.addChild(e,u,r,f)}f=o.closeIndex+1}else if(n.substr(f+1,3)==="!--"){const o=T(n,"-->",f+4,"Comment is not closed.");if(this.options.commentPropName){const u=n.substring(f+4,o-2);i=this.saveTextToParentTag(i,e,r),e.add(this.options.commentPropName,[{[this.options.textNodeName]:u}])}f=o}else if(n.substr(f+1,2)==="!D"){const o=s.readDocType(n,f);this.docTypeEntities=o.entities,f=o.i}else if(n.substr(f+1,2)==="!["){const o=T(n,"]]>",f,"CDATA is not closed.")-2,u=n.substring(f+9,o);i=this.saveTextToParentTag(i,e,r);let c=this.parseTextData(u,e.tagname,r,!0,!1,!0,!0);c==null&&(c=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:u}]):e.add(this.options.textNodeName,c),f=o+2}else{let o=S(n,f,this.options.removeNSPrefix),u=o.tagName;const c=o.rawTagName;let d=o.tagExp,g=o.attrExpPresent,M=o.closeIndex;if(this.options.transformTagName){const a=this.options.transformTagName(u);d===u&&(d=a),u=a}e&&i&&e.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,e,r,!1));const F=e;F&&this.options.unpairedTags.indexOf(F.tagname)!==-1&&(e=this.tagsNodeStack.pop(),r=r.substring(0,r.lastIndexOf("."))),u!==t.tagname&&(r+=r?"."+u:u);const v=f;if(this.isItStopNode(this.stopNodesExact,this.stopNodesWildcard,r,u)){let a="";if(d.length>0&&d.lastIndexOf("/")===d.length-1)u[u.length-1]==="/"?(u=u.substr(0,u.length-1),r=r.substr(0,r.length-1),d=u):d=d.substr(0,d.length-1),f=o.closeIndex;else if(this.options.unpairedTags.indexOf(u)!==-1)f=o.closeIndex;else{const P=this.readStopNodeData(n,c,M+1);if(!P)throw new Error(`Unexpected end of ${c}`);f=P.i,a=P.tagContent}const w=new b(u);u!==d&&g&&(w[":@"]=this.buildAttributesMap(d,r)),a&&(a=this.parseTextData(a,u,r,!0,g,!0,!0)),r=r.substr(0,r.lastIndexOf(".")),w.add(this.options.textNodeName,a),this.addChild(e,w,r,v)}else{if(d.length>0&&d.lastIndexOf("/")===d.length-1){if(u[u.length-1]==="/"?(u=u.substr(0,u.length-1),r=r.substr(0,r.length-1),d=u):d=d.substr(0,d.length-1),this.options.transformTagName){const w=this.options.transformTagName(u);d===u&&(d=w),u=w}const a=new b(u);u!==d&&g&&(a[":@"]=this.buildAttributesMap(d,r)),this.addChild(e,a,r,v),r=r.substr(0,r.lastIndexOf("."))}else{const a=new b(u);this.tagsNodeStack.push(e),u!==d&&g&&(a[":@"]=this.buildAttributesMap(d,r)),this.addChild(e,a,r,v),e=a}i="",f=M}}else i+=n[f];return t.child};function be(n,t,e,i){this.options.captureMetaData||(i=void 0);const r=this.options.updateTag(t.tagname,e,t[":@"]);r===!1||(typeof r=="string"&&(t.tagname=r),n.addChild(t,i))}const Te=function(n){if(this.options.processEntities){for(let t in this.docTypeEntities){const e=this.docTypeEntities[t];n=n.replace(e.regx,e.val)}for(let t in this.lastEntities){const e=this.lastEntities[t];n=n.replace(e.regex,e.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const e=this.htmlEntities[t];n=n.replace(e.regex,e.val)}n=n.replace(this.ampEntity.regex,this.ampEntity.val)}return n};function we(n,t,e,i){return n&&(i===void 0&&(i=t.child.length===0),n=this.parseTextData(n,t.tagname,e,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,i),n!==void 0&&n!==""&&t.add(this.options.textNodeName,n),n=""),n}function Ie(n,t,e,i){return!!(t&&t.has(i)||n&&n.has(e))}function ye(n,t,e=">"){let i,r="";for(let s=t;s<n.length;s++){let f=n[s];if(i)f===i&&(i="");else if(f==='"'||f==="'")i=f;else if(f===e[0])if(e[1]){if(n[s+1]===e[1])return{data:r,index:s}}else return{data:r,index:s};else f==="	"&&(f=" ");r+=f}}function T(n,t,e,i){const r=n.indexOf(t,e);if(r===-1)throw new Error(i);return r+t.length-1}function S(n,t,e,i=">"){const r=ye(n,t+1,i);if(!r)return;let s=r.data;const f=r.index,l=s.search(/\s/);let o=s,u=!0;l!==-1&&(o=s.substring(0,l),s=s.substring(l+1).trimStart());const c=o;if(e){const d=o.indexOf(":");d!==-1&&(o=o.substr(d+1),u=o!==r.data.substr(d+1))}return{tagName:o,tagExp:s,closeIndex:f,attrExpPresent:u,rawTagName:c}}function Ae(n,t,e){const i=e;let r=1;for(;e<n.length;e++)if(n[e]==="<")if(n[e+1]==="/"){const s=T(n,">",e,`${t} is not closed`);if(n.substring(e+2,s).trim()===t&&(r--,r===0))return{tagContent:n.substring(i,e),i:s};e=s}else if(n[e+1]==="?")e=T(n,"?>",e+1,"StopNode is not closed.");else if(n.substr(e+1,3)==="!--")e=T(n,"-->",e+3,"StopNode is not closed.");else if(n.substr(e+1,2)==="![")e=T(n,"]]>",e,"StopNode is not closed.")-2;else{const s=S(n,e,">");s&&((s&&s.tagName)===t&&s.tagExp[s.tagExp.length-1]!=="/"&&r++,e=s.closeIndex)}}function V(n,t,e){if(t&&typeof n=="string"){const i=n.trim();return i==="true"?!0:i==="false"?!1:ie(n,e)}else return Z(n)?n:""}const C=b.getMetaDataSymbol();function Oe(n,t){return U(n,t)}function U(n,t,e){let i;const r={};for(let s=0;s<n.length;s++){const f=n[s],l=ve(f);let o="";if(e===void 0?o=l:o=e+"."+l,l===t.textNodeName)i===void 0?i=f[l]:i+=""+f[l];else{if(l===void 0)continue;if(f[l]){let u=U(f[l],t,o);const c=Ce(u,t);f[C]!==void 0&&(u[C]=f[C]),f[":@"]?Pe(u,f[":@"],o,t):Object.keys(u).length===1&&u[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?u=u[t.textNodeName]:Object.keys(u).length===0&&(t.alwaysCreateTextNode?u[t.textNodeName]="":u=""),r[l]!==void 0&&r.hasOwnProperty(l)?(Array.isArray(r[l])||(r[l]=[r[l]]),r[l].push(u)):t.isArray(l,o,c)?r[l]=[u]:r[l]=u}}}return typeof i=="string"?i.length>0&&(r[t.textNodeName]=i):i!==void 0&&(r[t.textNodeName]=i),r}function ve(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];if(i!==":@")return i}}function Pe(n,t,e,i){if(t){const r=Object.keys(t),s=r.length;for(let f=0;f<s;f++){const l=r[f];i.isArray(l,e+"."+l,!0,!0)?n[l]=[t[l]]:n[l]=t[l]}}}function Ce(n,t){const{textNodeName:e}=t,i=Object.keys(n).length;return!!(i===0||i===1&&(n[e]||typeof n[e]=="boolean"||n[e]===0))}class Se{constructor(t){this.externalEntities={},this.options=ee(t)}parse(t,e){if(typeof t!="string"&&t.toString)t=t.toString();else if(typeof t!="string")throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const s=m(t,e);if(s!==!0)throw Error(`${s.err.msg}:${s.err.line}:${s.err.col}`)}const i=new ce(this.options);i.addExternalEntities(this.externalEntities);const r=i.parseXml(t);return this.options.preserveOrder||r===void 0?r:Oe(r,this.options)}addEntity(t,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=e}static getMetaDataSymbol(){return b.getMetaDataSymbol()}}export{Se as X};
