import{c as b,i as v}from"./style-ynO7IsM1.js";import"./version-BXrBJCm5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-C6L5gDe0.js";import{G as k,a as h,f as L,b as D,P,e as M,h as w,l as N,m as R,w as I,d as T}from"./main-CdZmBCMR.js";import"./mobileMenu-BoMunYmR.js";k.workerSrc=new URL("/itools/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();const n={file:null,pdfDoc:null,pdfJsDoc:null,rotations:[]};function E(){N(),n.file=null,n.pdfDoc=null,n.pdfJsDoc=null,n.rotations=[];const e=document.getElementById("file-display-area");e&&(e.innerHTML="");const t=document.getElementById("tool-options");t&&t.classList.add("hidden");const o=document.getElementById("page-thumbnails");o&&(o.innerHTML="");const r=document.getElementById("file-input");r&&(r.value="");const i=document.getElementById("batch-custom-angle");i&&(i.value="0")}function A(){for(let e=0;e<n.rotations.length;e++){const t=document.getElementById(`page-angle-${e}`);t&&(t.value=n.rotations[e].toString());const o=document.querySelector(`[data-page-index="${e}"]`);if(o){const r=o.querySelector(".thumbnail-wrapper");r&&(r.style.transform=`rotate(${-n.rotations[e]}deg)`)}}}function F(e,t){const o=t-1,r=document.createElement("div");r.className="page-thumbnail relative bg-gray-700 rounded-lg overflow-hidden",r.dataset.pageIndex=o.toString(),r.dataset.pageNumber=t.toString();const i=document.createElement("div");i.className="thumbnail-wrapper flex items-center justify-center p-2 h-36",i.style.transition="transform 0.3s ease";const p=n.rotations[o]||0;i.style.transform=`rotate(${-p}deg)`,e.className="max-w-full max-h-full object-contain",i.appendChild(e);const d=document.createElement("div");d.className="absolute top-1 left-1 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded",d.textContent=`${t}`,r.appendChild(i),r.appendChild(d);const s=document.createElement("div");s.className="flex items-center justify-center gap-1 p-2 bg-gray-800";const a=document.createElement("button");a.className="w-8 h-8 flex items-center justify-center bg-gray-700 hover:bg-gray-600 text-white rounded border border-gray-600 text-sm",a.textContent="-",a.onclick=function(m){m.stopPropagation();const g=document.getElementById(`page-angle-${o}`),f=parseInt(g.value)||0;g.value=(f-1).toString()};const c=document.createElement("input");c.type="number",c.id=`page-angle-${o}`,c.value=n.rotations[o]?.toString()||"0",c.className="w-12 h-8 text-center bg-gray-700 border border-gray-600 text-white rounded text-xs";const u=document.createElement("button");u.className="w-8 h-8 flex items-center justify-center bg-gray-700 hover:bg-gray-600 text-white rounded border border-gray-600 text-sm",u.textContent="+",u.onclick=function(m){m.stopPropagation();const g=document.getElementById(`page-angle-${o}`),f=parseInt(g.value)||0;g.value=(f+1).toString()};const l=document.createElement("button");return l.className="w-8 h-8 flex items-center justify-center bg-gray-700 hover:bg-gray-600 text-white rounded border border-gray-600",l.innerHTML='<i data-lucide="rotate-cw" class="w-4 h-4"></i>',l.onclick=function(m){m.stopPropagation();const g=document.getElementById(`page-angle-${o}`),f=parseInt(g.value)||0;n.rotations[o]=f;const y=r.querySelector(".thumbnail-wrapper");y&&(y.style.transform=`rotate(${-f}deg)`)},s.append(a,c,u,l),r.appendChild(s),setTimeout(function(){b({icons:v})},0),r}async function j(){const e=document.getElementById("page-thumbnails");!e||!n.pdfJsDoc||(e.innerHTML="",await R(n.pdfJsDoc,e,F,{batchSize:8,useLazyLoading:!0,lazyLoadMargin:"200px",eagerLoadBatches:2,onBatchComplete:function(){b({icons:v})}}),b({icons:v}))}async function z(){const e=document.getElementById("file-display-area"),t=document.getElementById("tool-options");if(e)if(e.innerHTML="",n.file){const o=document.createElement("div");o.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const r=document.createElement("div");r.className="flex flex-col overflow-hidden";const i=document.createElement("div");i.className="truncate font-medium text-gray-200 text-sm mb-1",i.textContent=n.file.name;const p=document.createElement("div");p.className="text-xs text-gray-400",p.textContent=`${L(n.file.size)} • Loading...`,r.append(i,p);const d=document.createElement("button");d.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",d.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',d.onclick=function(){E()},o.append(r,d),e.appendChild(o),b({icons:v});try{D("Loading PDF...");const s=await n.file.arrayBuffer();n.pdfDoc=await P.load(s.slice(0),{ignoreEncryption:!0,throwOnInvalidObject:!1}),n.pdfJsDoc=await M({data:s.slice(0)}).promise;const a=n.pdfDoc.getPageCount();n.rotations=new Array(a).fill(0),p.textContent=`${L(n.file.size)} • ${a} pages`,await j(),w(),t&&t.classList.remove("hidden")}catch(s){console.error("Error loading PDF:",s),w(),h("Error","Failed to load PDF file."),E()}}else t&&t.classList.add("hidden")}async function H(){if(!n.pdfDoc||!n.file){h("Error","Please upload a PDF first.");return}D("Applying rotations...");try{const e=n.pdfDoc.getPageCount(),t=await P.create();for(let i=0;i<e;i++){const p=n.rotations[i]||0,d=n.pdfDoc.getPage(i),s=d.getRotation().angle,a=s+p;if(console.log(`Page ${i}: rotation=${p}, currentRotation=${s}, totalRotation=${a}, applying=${-a}`),a%90===0){const[c]=await t.copyPages(n.pdfDoc,[i]);c.setRotation(I(a)),t.addPage(c)}else{const c=await t.embedPage(d),{width:u,height:l}=c.scale(1),m=a*Math.PI/180,g=Math.abs(Math.cos(m)),f=Math.abs(Math.sin(m)),y=u*g+l*f,x=u*f+l*g,C=t.addPage([y,x]),S=y/2-(u/2*Math.cos(m)-l/2*Math.sin(m)),$=x/2-(u/2*Math.sin(m)+l/2*Math.cos(m));C.drawPage(c,{x:S,y:$,width:u,height:l,rotate:I(a)})}}const o=await t.save(),r=n.file.name.replace(/\.pdf$/i,"");T(new Blob([new Uint8Array(o)],{type:"application/pdf"}),`${r}_rotated.pdf`),h("Success","Rotations applied successfully!","success",function(){E()})}catch(e){console.error(e),h("Error","Could not apply rotations.")}finally{w()}}function B(e){if(e&&e.length>0){const t=e[0];(t.type==="application/pdf"||t.name.toLowerCase().endsWith(".pdf"))&&(n.file=t,z())}}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("file-input"),t=document.getElementById("drop-zone"),o=document.getElementById("process-btn"),r=document.getElementById("back-to-tools"),i=document.getElementById("batch-decrement"),p=document.getElementById("batch-increment"),d=document.getElementById("batch-apply"),s=document.getElementById("batch-custom-angle");r&&r.addEventListener("click",function(){window.location.href="/itools/"}),i&&s&&i.addEventListener("click",function(){const a=parseInt(s.value)||0;s.value=(a-1).toString()}),p&&s&&p.addEventListener("click",function(){const a=parseInt(s.value)||0;s.value=(a+1).toString()}),d&&s&&d.addEventListener("click",function(){const a=parseInt(s.value)||0;for(let c=0;c<n.rotations.length;c++)n.rotations[c]=a;A()}),e&&t&&(e.addEventListener("change",function(a){B(a.target.files)}),t.addEventListener("dragover",function(a){a.preventDefault(),t.classList.add("bg-gray-700")}),t.addEventListener("dragleave",function(a){a.preventDefault(),t.classList.remove("bg-gray-700")}),t.addEventListener("drop",function(a){a.preventDefault(),t.classList.remove("bg-gray-700");const c=a.dataTransfer?.files;if(c&&c.length>0){const u=Array.from(c).filter(function(l){return l.type==="application/pdf"||l.name.toLowerCase().endsWith(".pdf")});if(u.length>0){const l=new DataTransfer;l.items.add(u[0]),B(l.files)}}}),e.addEventListener("click",function(){e.value=""})),o&&o.addEventListener("click",H)});
