const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-eEAMQJTJ.js","assets/main-CdZmBCMR.js","assets/style-ynO7IsM1.js","assets/style-BjgAlZWF.css","assets/_commonjs-dynamic-modules-TDtrdbi3.js"])))=>i.map(i=>d[i]);
import{c as J,i as U}from"./style-ynO7IsM1.js";import"./version-BXrBJCm5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-C6L5gDe0.js";import{G as Q,s as a,a as C,h as $,b as z,r as q,f as x,d as A,_ as V,n as W,o as Z,e as K,P as X}from"./main-CdZmBCMR.js";import"./mobileMenu-BoMunYmR.js";Q.workerSrc=new URL("/itools/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();const N={light:{images:{quality:90,dpiTarget:150,dpiThreshold:200},scrub:{metadata:!1,thumbnails:!0},subsetFonts:!0},balanced:{images:{quality:75,dpiTarget:96,dpiThreshold:150},scrub:{metadata:!0,thumbnails:!0},subsetFonts:!0},aggressive:{images:{quality:50,dpiTarget:72,dpiThreshold:100},scrub:{metadata:!0,thumbnails:!0,xmlMetadata:!0},subsetFonts:!0},extreme:{images:{quality:30,dpiTarget:60,dpiThreshold:96},scrub:{metadata:!0,thumbnails:!0,xmlMetadata:!0},subsetFonts:!0}},j={light:{scale:2,quality:.85},balanced:{scale:1.5,quality:.65},aggressive:{scale:1.2,quality:.45},extreme:{scale:1,quality:.25}};async function G(h,f,d){const y=new W(Z("pymupdf"));await y.load();const m=N[f]||N.balanced,w=d?.dpiTarget??m.images.dpiTarget,T=d?.dpiThreshold??m.images.dpiThreshold,i=Math.max(T,w+10),r={images:{enabled:!0,quality:d?.imageQuality??m.images.quality,dpiTarget:w,dpiThreshold:i,convertToGray:d?.convertToGrayscale??!1},scrub:{metadata:d?.removeMetadata??m.scrub.metadata,thumbnails:d?.removeThumbnails??m.scrub.thumbnails,xmlMetadata:m.scrub.xmlMetadata??!1},subsetFonts:d?.subsetFonts??m.subsetFonts,save:{garbage:4,deflate:!0,clean:!0,useObjstms:!0}};try{return await y.compressPdf(h,r)}catch(p){const B=p?.message||String(p);if(B.includes("PatternType")||B.includes("pattern")){console.warn("[CompressPDF] Pattern error detected, retrying without image rewriting:",B);const v={...r,images:{...r.images,enabled:!1}};return{...await y.compressPdf(h,v),usedFallback:!0}}throw new Error(`PDF compression failed: ${B}`)}}async function R(h,f){const d=await K({data:h}).promise,y=await X.create(),m=j[f]||j.balanced;for(let w=1;w<=d.numPages;w++){const T=await d.getPage(w),i=T.getViewport({scale:m.scale}),r=document.createElement("canvas"),p=r.getContext("2d");r.height=i.height,r.width=i.width,await T.render({canvasContext:p,viewport:i,canvas:r}).promise;const v=await(await new Promise(k=>r.toBlob(P=>k(P),"image/jpeg",m.quality))).arrayBuffer(),L=await y.embedJpg(v);y.addPage([i.width,i.height]).drawImage(L,{x:0,y:0,width:i.width,height:i.height})}return await y.save()}document.addEventListener("DOMContentLoaded",()=>{const h=document.getElementById("file-input"),f=document.getElementById("drop-zone"),d=document.getElementById("compress-options"),y=document.getElementById("add-more-btn"),m=document.getElementById("clear-files-btn"),w=document.getElementById("process-btn"),T=document.getElementById("back-to-tools"),i=document.getElementById("compression-algorithm"),r=document.getElementById("condense-info"),p=document.getElementById("photon-info"),B=document.getElementById("toggle-custom-settings"),v=document.getElementById("custom-settings-panel"),L=document.getElementById("custom-settings-chevron");let S=!1;T&&T.addEventListener("click",()=>{window.location.href="/itools/"}),i&&r&&p&&i.addEventListener("change",()=>{i.value==="condense"?(r.classList.remove("hidden"),p.classList.add("hidden")):(r.classList.add("hidden"),p.classList.remove("hidden"))}),B&&v&&L&&B.addEventListener("click",()=>{v.classList.toggle("hidden"),L.style.transform=v.classList.contains("hidden")?"rotate(0deg)":"rotate(180deg)",v.classList.contains("hidden")||(S=!0)});const k=async()=>{if(d)if(a.files.length>0){const e=document.getElementById("file-display-area");if(e){e.innerHTML="";for(let c=0;c<a.files.length;c++){const g=a.files[c],o=document.createElement("div");o.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const t=document.createElement("div");t.className="flex flex-col overflow-hidden";const l=document.createElement("div");l.className="truncate font-medium text-gray-200 text-sm mb-1",l.textContent=g.name;const n=document.createElement("div");n.className="text-xs text-gray-400",n.textContent=x(g.size),t.append(l,n);const s=document.createElement("button");s.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",s.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',s.onclick=()=>{a.files=a.files.filter((F,b)=>b!==c),k()},o.append(t,s),e.appendChild(o)}J({icons:U})}d.classList.remove("hidden")}else{d.classList.add("hidden");const e=document.getElementById("file-display-area");e&&(e.innerHTML="")}},P=()=>{a.files=[],a.pdfDoc=null;const e=document.getElementById("compression-level");e&&(e.value="balanced"),i&&(i.value="condense"),S=!1,v&&v.classList.add("hidden"),L&&(L.style.transform="rotate(0deg)");const c=document.getElementById("image-quality"),g=document.getElementById("dpi-target"),o=document.getElementById("dpi-threshold"),t=document.getElementById("remove-metadata"),l=document.getElementById("subset-fonts"),n=document.getElementById("convert-to-grayscale"),s=document.getElementById("remove-thumbnails");c&&(c.value="75"),g&&(g.value="96"),o&&(o.value="150"),t&&(t.checked=!0),l&&(l.checked=!0),n&&(n.checked=!1),s&&(s.checked=!0),r&&r.classList.remove("hidden"),p&&p.classList.add("hidden"),k()},H=async()=>{const e=document.getElementById("compression-level").value,c=document.getElementById("compression-algorithm").value,g=document.getElementById("convert-to-grayscale")?.checked??!1;let o;if(S){const t=parseInt(document.getElementById("image-quality")?.value)||75,l=parseInt(document.getElementById("dpi-target")?.value)||96,n=parseInt(document.getElementById("dpi-threshold")?.value)||150,s=document.getElementById("remove-metadata")?.checked??!0,F=document.getElementById("subset-fonts")?.checked??!0,b=document.getElementById("remove-thumbnails")?.checked??!0;o={imageQuality:t,dpiTarget:l,dpiThreshold:n,removeMetadata:s,subsetFonts:F,convertToGrayscale:g,removeThumbnails:b}}else o=g?{convertToGrayscale:g}:void 0;try{if(a.files.length===0){C("No Files","Please select at least one PDF file."),$();return}if(a.files.length===1){const t=a.files[0];let l,n,s;if(c==="condense"){z("Running Condense compression...");const u=await G(t,e,o);l=u.blob,n=u.compressedSize,s="Condense",u.usedFallback&&(s+=" (without image optimization due to unsupported patterns)")}else{z("Running Photon compression...");const u=await q(t),E=await R(u,e),M=E.buffer.slice(E.byteOffset,E.byteOffset+E.byteLength);l=new Blob([M],{type:"application/pdf"}),n=E.length,s="Photon"}const F=x(t.size),b=x(n),D=t.size-n,I=D>0?(D/t.size*100).toFixed(1):0;A(l,t.name.replace(/\.pdf$/i,"")+"_compressed.pdf"),$(),D>0?C("Compression Complete",`Method: ${s}. File size reduced from ${F} to ${b} (Saved ${I}%).`,"success",()=>P()):C("Compression Finished",`Method: ${s}. Could not reduce file size further. Original: ${F}, New: ${b}.`,"warning",()=>P())}else{z("Compressing multiple PDFs...");const t=(await V(async()=>{const{default:I}=await import("./jszip.min-eEAMQJTJ.js").then(u=>u.j);return{default:I}},__vite__mapDeps([0,1,2,3,4]))).default,l=new t;let n=0,s=0;for(let I=0;I<a.files.length;I++){const u=a.files[I];z(`Compressing ${I+1}/${a.files.length}: ${u.name}...`),n+=u.size;let E;if(c==="condense"){const _=await G(u,e,o);E=new Uint8Array(await _.blob.arrayBuffer())}else{const _=await q(u);E=await R(_,e)}s+=E.length;const M=u.name.replace(/\.pdf$/i,"");l.file(`${M}_compressed.pdf`,E)}const F=await l.generateAsync({type:"blob"}),b=n-s,D=b>0?(b/n*100).toFixed(1):0;A(F,"compressed-pdfs.zip"),$(),b>0?C("Compression Complete",`Compressed ${a.files.length} PDF(s). Total size reduced from ${x(n)} to ${x(s)} (Saved ${D}%).`,"success",()=>P()):C("Compression Finished",`Compressed ${a.files.length} PDF(s). Total size: ${x(s)}.`,"info",()=>P())}}catch(t){$(),console.error("[CompressPDF] Error:",t),C("Error",`An error occurred during compression. Error: ${t.message}`)}},O=e=>{e&&e.length>0&&(a.files=[...a.files,...Array.from(e)],k())};h&&f&&(h.addEventListener("change",e=>{O(e.target.files)}),f.addEventListener("dragover",e=>{e.preventDefault(),f.classList.add("bg-gray-700")}),f.addEventListener("dragleave",e=>{e.preventDefault(),f.classList.remove("bg-gray-700")}),f.addEventListener("drop",e=>{e.preventDefault(),f.classList.remove("bg-gray-700");const c=e.dataTransfer?.files;if(c&&c.length>0){const g=Array.from(c).filter(o=>o.type==="application/pdf");if(g.length>0){const o=new DataTransfer;g.forEach(t=>o.items.add(t)),O(o.files)}}}),h.addEventListener("click",()=>{h.value=""})),y&&y.addEventListener("click",()=>{h.click()}),m&&m.addEventListener("click",()=>{P()}),w&&w.addEventListener("click",H)});
