import{d as P,a0 as j,r as t,o as d,c as q,a as i,k as _,l as e,j as x,w as y,a6 as C,G as g,ad as w,aW as D,ag as E,af as U}from"./index-0c1fde36.js";import{_ as V}from"./InputCopyable.vue_vue_type_script_setup_true_lang-294ac243.js";import{g as $}from"./base64-ae7cf34b.js";import{q as A}from"./qpdf-45a7a22a.js";import{u as S}from"./downloadBase64-508288e2.js";import{_ as I}from"./Spin-885f2a22.js";import"./index-a6f01dde.js";import"./index-6fddb70d.js";import"./index-cfd4d427.js";const M={style:{flex:"0 0 100%"}},O={"mx-auto":"","max-w-600px":""},W={"mt-3":"",flex:"","justify-center":""},Y=P({__name:"pdf-unlock",setup(z){const{t:p}=j(),a=t("idle"),h=t(null),m=t(""),u=t(""),c=t([]),k=t("pdf"),{download:B}=S({source:m,filename:u,extension:k}),v=t("");async function b(o){h.value=o;const s=await o.arrayBuffer();u.value=`decrypted_${o.name}`,a.value="processing";try{const n=await F(s,["--decrypt","--warning-exit-0","--verbose","in.pdf","out.pdf"],0);m.value=`data:application/pdf;base64,${$.fromUint8Array(n)}`,a.value="done",B()}catch{a.value="error"}}async function F(o,s,n){v.value=s.join(" "),c.value=[];const r=await A({print(l){c.value.push(l)},printErr(l){c.value.push(l)}});r.FS.writeFile("in.pdf",new Uint8Array(o));const f=r.callMain(s);if(n!==f)throw new Error("Process run failed");return r.FS.readFile("out.pdf")}return(o,s)=>{const n=D,r=E,f=I,l=V,N=U;return d(),q("div",null,[i("div",M,[i("div",O,[_(n,{title:e(p)("tools.pdf-unlock.texts.title-drag-and-drop-a-pdf-file-here-or-click-to-select-a-file"),accept:".pdf",onFileUpload:b},null,8,["title"])])]),i("div",W,[e(a)==="error"?(d(),x(r,{key:0,type:"error"},{default:y(()=>[C(" An error occured processing "+g(e(u)),1)]),_:1})):w("",!0),e(a)==="processing"?(d(),x(f,{key:1,size:"small"})):w("",!0)]),_(N,{title:e(p)("tools.pdf-unlock.texts.title-logs")},{default:y(()=>[_(l,{label:e(p)("tools.pdf-unlock.texts.label-qpdf"),value:e(v),"mb-1":""},null,8,["label","value"]),i("pre",null,g(e(c).join(`
`)),1)]),_:1},8,["title"])])}}});export{Y as default};
