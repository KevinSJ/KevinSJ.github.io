import{c as K,i as tt}from"./style-ynO7IsM1.js";import"./version-BXrBJCm5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-C6L5gDe0.js";import{a as L,b as et,P as it,r as rt,d as nt,h as st,f as at}from"./main-CdZmBCMR.js";import{d as ot}from"./browser-QlFDU36Z.js";import"./mobileMenu-BoMunYmR.js";const U={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},Y={};for(const r in U)Y[U[r]]=Number(r);const lt=Object.freeze(Object.defineProperty({__proto__:null,tagsById:U,tagsByName:Y},Symbol.toStringTag,{value:"Module"})),_={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},J={};for(const r in _)J[_[r]]=Number(r);const ht=Object.freeze(Object.defineProperty({__proto__:null,tagsById:_,tagsByName:J},Symbol.toStringTag,{value:"Module"})),k={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},X={};for(const r in k)X[k[r]]=Number(r);const ct=Object.freeze(Object.defineProperty({__proto__:null,tagsById:k,tagsByName:X},Symbol.toStringTag,{value:"Module"}));function R(r,t="utf8"){return new TextDecoder(t).decode(r)}const ft=new TextEncoder;function ut(r){return ft.encode(r)}const dt=1024*8,gt=(()=>{const r=new Uint8Array(4),t=new Uint32Array(r.buffer);return!((t[0]=1)&r[0])})(),M={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class E{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(t=dt,e={}){let i=!1;typeof t=="number"?t=new ArrayBuffer(t):(i=!0,this.lastWrittenByte=t.byteLength);const s=e.offset?e.offset>>>0:0,n=t.byteLength-s;let o=s;(ArrayBuffer.isView(t)||t instanceof E)&&(t.byteLength!==t.buffer.byteLength&&(o=t.byteOffset+s),t=t.buffer),i?this.lastWrittenByte=n:this.lastWrittenByte=0,this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,n),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const i=(this.offset+t)*2,s=new Uint8Array(i);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=i,this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const i=M[e].BYTES_PER_ELEMENT*t,s=this.byteOffset+this.offset,n=this.buffer.slice(s,s+i);if(this.littleEndian===gt&&e!=="uint8"&&e!=="int8"){const a=new Uint8Array(this.buffer.slice(s,s+i));a.reverse();const h=new M[e](a.buffer);return this.offset+=i,h.reverse(),h}const o=new M[e](n);return this.offset+=i,o}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let i=0;i<t;i++)e+=this.readChar();return e}readUtf8(t=1){return R(this.readBytes(t))}decodeText(t=1,e="utf8"){return R(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(ut(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function xt(r){if(r.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=r.rowsPerStrip*r.width*r.samplesPerPixel*(r.bitsPerSample/8);return new Array(r.stripOffsets.length).fill(t)}function mt(r,t,e){let i=0;for(;i<r.length;){for(let s=e;s<t*e;s+=e)for(let n=0;n<e;n++)r[i+s+n]=r[i+s+n]+r[i+s-(e-n)]&255;i+=t*e}}function pt(r,t,e){let i=0;for(;i<r.length;){for(let s=e;s<t*e;s+=e)for(let n=0;n<e;n++)r[i+s+n]=r[i+s+n]+r[i+s-(e-n)]&65535;i+=t*e}}const N={standard:ct,exif:lt,gps:ht};class Z{kind;data;fields;exif;gps;_hasMap;_map;constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(N[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=N[this.kind].tagsById;for(const e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e));this._hasMap=!0}return this._map}}const q=new Map([[1,[1,W]],[2,[1,St]],[3,[2,wt]],[4,[4,Pt]],[5,[8,It]],[6,[1,Bt]],[7,[1,W]],[8,[2,Dt]],[9,[4,Lt]],[10,[8,Ct]],[11,[4,Et]],[12,[8,Tt]]]);function yt(r,t){const e=q.get(r);if(!e)throw new Error(`type not found: ${r}`);return e[0]*t}function bt(r,t,e){const i=q.get(t);if(!i)throw new Error(`type not found: ${t}`);return i[1](r,e)}function W(r,t){if(t===1)return r.readUint8();const e=new Uint8Array(t);for(let i=0;i<t;i++)e[i]=r.readUint8();return e}function St(r,t){const e=[];let i="";for(let s=0;s<t;s++){const n=String.fromCharCode(r.readUint8());n==="\0"?(e.push(i),i=""):i+=n}return e.length===1?e[0]:e}function wt(r,t){if(t===1)return r.readUint16();const e=new Uint16Array(t);for(let i=0;i<t;i++)e[i]=r.readUint16();return e}function Pt(r,t){if(t===1)return r.readUint32();const e=new Uint32Array(t);for(let i=0;i<t;i++)e[i]=r.readUint32();return e}function It(r,t){if(t===1)return r.readUint32()/r.readUint32();const e=new Array(t);for(let i=0;i<t;i++)e[i]=r.readUint32()/r.readUint32();return e}function Bt(r,t){if(t===1)return r.readInt8();const e=new Int8Array(t);for(let i=0;i<t;i++)e[i]=r.readInt8();return e}function Dt(r,t){if(t===1)return r.readInt16();const e=new Int16Array(t);for(let i=0;i<t;i++)e[i]=r.readInt16();return e}function Lt(r,t){if(t===1)return r.readInt32();const e=new Int32Array(t);for(let i=0;i<t;i++)e[i]=r.readInt32();return e}function Ct(r,t){if(t===1)return r.readInt32()/r.readInt32();const e=new Array(t);for(let i=0;i<t;i++)e[i]=r.readInt32()/r.readInt32();return e}function Et(r,t){if(t===1)return r.readFloat32();const e=new Float32Array(t);for(let i=0;i<t;i++)e[i]=r.readFloat32();return e}function Tt(r,t){if(t===1)return r.readFloat64();const e=new Float64Array(t);for(let i=0;i<t;i++)e[i]=r.readFloat64();return e}const Ft=256,V=257,z=258,H=9;let P=[];function At(){if(P.length===0){for(let t=0;t<256;t++)P.push([t]);const r=[];for(let t=256;t<4096;t++)P.push(r)}}const vt=[511,1023,2047,4095],Mt=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class Ut{stripArray;nextData=0;nextBits=0;bytePointer=0;tableLength=z;currentBitLength=H;outData;constructor(t){this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new E(t.byteLength),this.initializeTable()}decode(){let t=0,e=0;for(;(t=this.getNextCode())!==V;)if(t===Ft){if(this.initializeTable(),t=this.getNextCode(),t===V)break;this.writeString(this.stringFromCode(t)),e=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(e).concat(this.stringFromCode(t)[0])),e=t;else{const s=this.stringFromCode(e).concat(this.stringFromCode(e)[0]);this.writeString(s),this.addStringToTable(s),e=t}const i=this.outData.toArray();return new DataView(i.buffer,i.byteOffset,i.byteLength)}initializeTable(){At(),this.tableLength=z,this.currentBitLength=H}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return P[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(P[this.tableLength++]=t,P.length>4096)throw P=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===Mt[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&vt[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function _t(r){return new Ut(r).decode()}const kt=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class $ extends Z{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){const t=new Date,e=kt.exec(this.dateTime);if(e===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(e[1]),Number(e[2])-1,Number(e[3])),t.setHours(Number(e[4]),Number(e[5]),Number(e[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return I(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return I(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")||2**32-1}get stripByteCounts(){return I(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||2**this.bitsPerSample-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return I(this.get("SampleFormat")||1)[0]}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,e=this.get("ColorMap");if(!e)return;if(e.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const i=[];for(let s=0;s<t;s++)i.push([e[s],e[s+t],e[s+2*t]]);return i}get tileWidth(){return this.get("TileWidth")}get tileHeight(){return this.get("TileLength")}get tileOffsets(){return I(this.get("TileOffsets"))}get tileByteCounts(){return I(this.get("TileByteCounts"))}get tiled(){return this.tileWidth!==void 0&&this.tileHeight!==void 0&&this.tileOffsets!==void 0&&this.tileByteCounts!==void 0}}function I(r){return typeof r=="number"?[r]:r}function Ot(r){const t=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),e=ot(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}const Gt={ignoreImageData:!1};class C extends E{_nextIFD;constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),t===2)return!0;if(t===1)return!1;throw p("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw p("ifdCount",t)}decode(t={}){const{pages:e}=t;Rt(e);const i=e?Math.max(...e):1/0;t={...Gt,...t};const s=[];this.decodeHeader();let n=0;for(;this._nextIFD;){if(e){if(e.includes(n)?s.push(this.decodeIFD(t,!0)):this.decodeIFD({ignoreImageData:!0},!0),n===i)break}else s.push(this.decodeIFD(t,!0));n++}if(n<i&&i!==1/0)throw new RangeError(`Index ${i} is out of bounds. The stack only contains ${n} images.`);return s}decodeHeader(){const t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${t.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,e){this.seek(this._nextIFD);let i;if(e)i=new $;else{if(!t.kind)throw new Error("kind is missing");i=new Z(t.kind)}const s=this.readUint16();for(let n=0;n<s;n++)this.decodeIFDEntry(i);if(!t.ignoreImageData){if(!(i instanceof $))throw new Error("must be a tiff ifd");this.decodeImageData(i)}return this._nextIFD=this.readUint32(),i}decodeIFDEntry(t){const e=this.offset,i=this.readUint16(),s=this.readUint16(),n=this.readUint32();if(s<1||s>12){this.skip(4);return}yt(s,n)>4&&this.seek(this.readUint32());const a=bt(this,s,n);if(t.fields.set(i,a),i===34665||i===34853){const h=this.offset;let l="exif";i===34665?l="exif":i===34853&&(l="gps"),this._nextIFD=a,t[l]=this.decodeIFD({kind:l,ignoreImageData:!0},!1),this.offset=h}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;if(e&&e!==1)throw p("orientation",e);switch(t.type){case 0:case 1:case 2:case 3:t.tiled?this.readTileData(t):this.readStripData(t);break;default:throw p("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),t.bitsPerSample===1&&this.split1BitData(t),t.type===0){const s=2**t.bitsPerSample-1;for(let n=0;n<t.data.length;n++)t.data[n]=s-t.data[n]}}split1BitData(t){const{imageWidth:e,imageLength:i,samplesPerPixel:s}=t,n=new Uint8Array(i*e*s),o=Math.ceil(e*s/8);let a=0;for(let h=0;h<i;h++){const l=h*o;for(let c=0;c<e*s;c++){const d=l+Math.floor(c/8),g=7-c%8,m=t.data[d]>>g&1;n[a++]=m}}t.data=n}static uncompress(t,e=1){switch(e){case 1:return t;case 5:return _t(t);case 8:case 32946:return Ot(t);case 2:throw p("Compression","CCITT Group 3");case 32773:throw p("Compression","PackBits");default:throw p("Compression",e)}}createSampleReader(t,e,i){if(e===8||e===1)return(s,n)=>s.getUint8(n);if(e===16)return(s,n)=>s.getUint16(2*n,i);if(e===32&&t===3)return(s,n)=>s.getFloat32(4*n,i);if(e===64&&t===3)return(s,n)=>s.getFloat64(8*n,i);throw p("bitDepth",e)}readStripData(t){const e=t.width,i=t.height,s=t.bitsPerSample!==1?e*t.samplesPerPixel*i:Math.ceil(e*t.samplesPerPixel/8)*i,n=t.stripOffsets,o=t.stripByteCounts||xt(t),a=this.isLittleEndian(),h=t.bitsPerSample!==1?e*t.samplesPerPixel*t.rowsPerStrip:Math.ceil(e*t.samplesPerPixel/8)*t.rowsPerStrip,l=this.createSampleReader(t.sampleFormat,t.bitsPerSample,a),c=j(s,t.bitsPerSample,t.sampleFormat);let d=0;for(let g=0;g<n.length;g++){const m=new DataView(this.buffer,this.byteOffset+n[g],o[g]),f=C.uncompress(m,t.compression),x=Math.min(h,s-d);for(let u=0;u<x;++u){const T=l(f,u);c[d+u]=T}d+=x}t.data=c}readTileData(t){if(!t.tileWidth||!t.tileHeight)return;const e=t.width,i=t.height,s=t.bitsPerSample!==1?e*i*t.samplesPerPixel:Math.ceil(e*t.samplesPerPixel/8)*i,n=t.tileWidth,o=t.tileHeight,a=Math.ceil(e/n),h=Math.ceil(i/o),l=t.tileOffsets,c=t.tileByteCounts,d=this.isLittleEndian(),g=this.createSampleReader(t.sampleFormat,t.bitsPerSample,d),m=j(s,t.bitsPerSample,t.sampleFormat);for(let f=0;f<a;++f)for(let x=0;x<h;++x){const u=x*a+f,T=new DataView(this.buffer,this.byteOffset+l[u],c[u]),G=C.uncompress(T,t.compression);if(t.bitsPerSample===1){const S=Math.ceil(e/8),w=Math.ceil(n/8);for(let b=0;b<o&&x*o+b<i;b++){const B=x*o+b,F=b*w,A=B*S+Math.floor(f*n/8),v=Math.min(w,S-Math.floor(f*n/8));for(let D=0;D<v;D++)m[A+D]=g(G,F+D)}}else for(let S=0;S<o;S++)for(let w=0;w<n;w++){const b=f*n+w,B=x*o+S;if(b>=e||B>=i)continue;const F=S*n+w,A=g(G,F),v=(B*e+b)*t.samplesPerPixel;m[v]=A}}t.data=m}applyPredictor(t){const e=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:{if(e===8)mt(t.data,t.width,t.components);else if(e===16)pt(t.data,t.width,t.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${e}`);break}default:throw new Error(`invalid predictor: ${t.predictor}`)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:e,components:i,maxSampleValue:s}=t;for(let n=0;n<e.length;n+=i){const o=e[n+i-1];for(let a=0;a<i-1;a++)e[n+a]=Math.round(e[n+a]*s/o)}}}}function j(r,t,e){if(t===8||t===1)return new Uint8Array(r);if(t===16)return new Uint16Array(r);if(t===32&&e===3)return new Float32Array(r);if(t===64&&e===3)return new Float64Array(r);throw p("bit depth / sample format",`${t} / ${e}`)}function p(r,t){return new Error(`Unsupported ${r}: ${t}`)}function Rt(r){if(r){for(const t of r)if(t<0||!Number.isInteger(t))throw new RangeError(`Index ${t} is invalid. Must be a positive integer.`)}}function Nt(r,t){return new C(r).decode(t)}let y=[];const O=()=>{const r=document.getElementById("file-display-area"),t=document.getElementById("file-controls"),e=document.getElementById("process-btn");!r||!t||!e||(r.innerHTML="",y.length>0?(t.classList.remove("hidden"),e.classList.remove("hidden"),y.forEach((i,s)=>{const n=document.createElement("div");n.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const o=document.createElement("div");o.className="flex items-center gap-2 overflow-hidden";const a=document.createElement("span");a.className="truncate font-medium text-gray-200",a.textContent=i.name;const h=document.createElement("span");h.className="flex-shrink-0 text-gray-400 text-xs",h.textContent=`(${at(i.size)})`,o.append(a,h);const l=document.createElement("button");l.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",l.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',l.onclick=()=>{y=y.filter((c,d)=>d!==s),O()},n.append(o,l),r.appendChild(n)}),K({icons:tt})):(t.classList.add("hidden"),e.classList.add("hidden")))},Q=()=>{y=[],O()};async function Wt(){if(y.length===0){L("No Files","Please select at least one TIFF file.");return}et("Converting TIFF to PDF...");try{const r=await it.create();for(const e of y){const i=await rt(e),s=Nt(i);for(const n of s){const o=n.width,a=n.height,h=n.data,l=document.createElement("canvas");l.width=o,l.height=a;const c=l.getContext("2d");if(!c)continue;const d=c.createImageData(o,a);for(let u=0;u<h.length;u++)d.data[u]=h[u];c.putImageData(d,0,0);const g=await new Promise(u=>l.toBlob(u,"image/png"));if(!g)continue;const m=await g.arrayBuffer(),f=await r.embedPng(m);r.addPage([f.width,f.height]).drawImage(f,{x:0,y:0,width:f.width,height:f.height})}}const t=await r.save();nt(new Blob([new Uint8Array(t)],{type:"application/pdf"}),"from_tiff.pdf"),L("Success","PDF created successfully!","success",()=>{Q()})}catch(r){console.error(r),L("Error","Failed to convert TIFF to PDF. One of the files may be invalid.")}finally{st()}}document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("file-input"),t=document.getElementById("drop-zone"),e=document.getElementById("add-more-btn"),i=document.getElementById("clear-files-btn"),s=document.getElementById("process-btn"),n=document.getElementById("back-to-tools");n&&n.addEventListener("click",()=>{window.location.href="/itools/"});const o=a=>{if(!a||a.length===0)return;const h=Array.from(a).filter(l=>l.type==="image/tiff"||l.name.toLowerCase().endsWith(".tiff")||l.name.toLowerCase().endsWith(".tif"));h.length<a.length&&L("Invalid Files","Some files were skipped. Only TIFF files are allowed."),h.length>0&&(y=[...y,...h],O())};r&&t&&(r.addEventListener("change",a=>{o(a.target.files)}),t.addEventListener("dragover",a=>{a.preventDefault(),t.classList.add("bg-gray-700")}),t.addEventListener("dragleave",a=>{a.preventDefault(),t.classList.remove("bg-gray-700")}),t.addEventListener("drop",a=>{a.preventDefault(),t.classList.remove("bg-gray-700"),o(a.dataTransfer?.files??null)}),r.addEventListener("click",()=>{r.value=""})),e&&e.addEventListener("click",()=>{r?.click()}),i&&i.addEventListener("click",()=>{Q()}),s&&s.addEventListener("click",Wt)});
