import{i as St,g as z,a as zt}from"./index-8270f3b5.js";import{dC as Ct,dD as jt,dE as Gt,dF as H,dG as Ut,dH as st}from"./index-0c1fde36.js";import{g as It,e as Ht}from"./index-3812cd3f.js";const Qt=/\n/g;function Wt(e){const t=[...e.matchAll(Qt)].map(n=>n.index||0);t.unshift(-1);const i=Q(t,0,t.length);return n=>wt(i,n)}function Q(e,t,i){if(i-t==1)return{offset:e[t],index:t+1};const n=Math.ceil((t+i)/2),s=Q(e,t,n),a=Q(e,n,i);return{offset:s.offset,low:s,high:a}}function wt(e,t){return function(i){return Object.prototype.hasOwnProperty.call(i,"index")}(e)?{line:e.index,column:t-e.offset}:wt(e.high.offset<t?e.high:e.low,t)}function Nt(e,t="",i={}){const n=typeof t!="string"?t:i,s=typeof t=="string"?t:"",a=e.map(Zt),o=!!n.lineNumbers;return function(u,l=0){const d=o?Wt(u):()=>({line:0,column:0});let m=l;const y=[];t:for(;m<u.length;){let B=!1;for(const p of a){p.regex.lastIndex=m;const T=p.regex.exec(u);if(T&&T[0].length>0){if(!p.discard){const $=d(m),Ft=typeof p.replace=="string"?T[0].replace(new RegExp(p.regex.source,p.regex.flags),p.replace):T[0];y.push({state:s,name:p.name,text:Ft,offset:m,len:T[0].length,line:$.line,column:$.column})}if(m=p.regex.lastIndex,B=!0,p.push){const $=p.push(u,m);y.push(...$.tokens),m=$.offset}if(p.pop)break t;break}}if(!B)break}return{tokens:y,offset:m,complete:u.length<=m}}}function Zt(e,t){return{...e,regex:Kt(e,t)}}function Kt(e,t){if(e.name.length===0)throw new Error(`Rule #${t} has empty name, which is not allowed.`);if(function(i){return Object.prototype.hasOwnProperty.call(i,"regex")}(e))return function(i){if(i.global)throw new Error(`Regular expression /${i.source}/${i.flags} contains the global flag, which is not allowed.`);return i.sticky?i:new RegExp(i.source,i.flags+"y")}(e.regex);if(function(i){return Object.prototype.hasOwnProperty.call(i,"str")}(e)){if(e.str.length===0)throw new Error(`Rule #${t} ("${e.name}") has empty "str" property, which is not allowed.`);return new RegExp(rt(e.str),"y")}return new RegExp(rt(e.name),"y")}function rt(e){return e.replace(/[-[\]{}()*+!<=:?./\\^$|#\s,]/g,"\\$&")}function N(e,t){return(i,n)=>{let s=n,a;return n<i.tokens.length?(a=e(i.tokens[n],i,n),a!==void 0&&s++):t?.(i,n),a===void 0?{matched:!1}:{matched:!0,position:s,value:a}}}function K(e,t){return e.matched?{matched:!0,position:e.position,value:t(e.value,e.position)}:e}function C(e,t){return e.matched?t(e):e}function x(e,t){return(i,n)=>K(e(i,n),(s,a)=>t(s,i,n,a))}function j(e,t){return(i,n)=>{const s=e(i,n);return s.matched?s:{matched:!0,position:n,value:t}}}function G(...e){return(t,i)=>{for(const n of e){const s=n(t,i);if(s.matched)return s}return{matched:!1}}}function A(e,t){return(i,n)=>{const s=e(i,n);return s.matched?s:t(i,n)}}function Xt(e,t){return(i,n)=>{const s=[];let a=!0;do{const o=e(i,n);o.matched&&t(o.value,s.length+1,i,n,o.position)?(s.push(o.value),n=o.position):a=!1}while(a);return{matched:!0,position:n,value:s}}}function X(e){return Xt(e,()=>!0)}function Jt(e){return g(e,X(e),(t,i)=>[t,...i])}function g(e,t,i){return(n,s)=>C(e(n,s),a=>K(t(n,a.position),(o,u)=>i(a.value,o,n,s,u)))}function Yt(e,t){return g(e,t,i=>i)}function at(e,t){return g(e,t,(i,n)=>n)}function J(e,t,i,n){return(s,a)=>C(e(s,a),o=>C(t(s,o.position),u=>K(i(s,u.position),(l,d)=>n(o.value,u.value,l,s,a,d))))}function Tt(e,t,i){return J(e,t,i,(n,s)=>s)}function te(...e){return(t,i)=>{const n=[];let s=i;for(const a of e){const o=a(t,s);if(o.matched)n.push(o.value),s=o.position;else return{matched:!1}}return{matched:!0,position:s,value:n}}}function ee(...e){return ie(te(...e))}function ie(e){return x(e,t=>t.flatMap(i=>i))}function ne(e,t){return(i,n)=>{let s=!0,a=e,o=n;do{const u=t(a,i,o)(i,o);u.matched?(a=u.value,o=u.position):s=!1}while(s);return{matched:!0,position:o,value:a}}}function se(e,t,i){return ne(e,n=>x(t,(s,a,o,u)=>i(n,s,a,o,u)))}function re(e,t,i){return ae(e,n=>se(n,g(t,i,(s,a)=>[s,a]),(s,[a,o])=>a(s,o)))}function ae(e,t){return(i,n)=>C(e(i,n),s=>t(s.value,i,n,s.position)(i,s.position))}const oe="(?:[ \\t\\r\\n\\f]*)",Et="(?:\\n|\\r\\n|\\r|\\f)",U="[^\\x00-\\x7F]",D="(?:\\\\[0-9a-f]{1,6}(?:\\r\\n|[ \\n\\r\\t\\f])?)",P="(?:\\\\[^\\n\\r\\f0-9a-f])",ce=`(?:[_a-z]|${U}|${D}|${P})`,At=`(?:[_a-z0-9-]|${U}|${D}|${P})`,ue=`(?:${At}+)`,he=`(?:[-]?${ce}${At}*)`,le=`'([^\\n\\r\\f\\\\']|\\\\${Et}|${U}|${D}|${P})*'`,fe=`"([^\\n\\r\\f\\\\"]|\\\\${Et}|${U}|${D}|${P})*"`,me=Nt([{name:"ws",regex:new RegExp(oe)},{name:"hash",regex:new RegExp(`#${ue}`,"i")},{name:"ident",regex:new RegExp(he,"i")},{name:"str1",regex:new RegExp(le,"i")},{name:"str2",regex:new RegExp(fe,"i")},{name:"*"},{name:"."},{name:","},{name:"["},{name:"]"},{name:"="},{name:">"},{name:"|"},{name:"+"},{name:"~"},{name:"^"},{name:"$"}]),de=Nt([{name:"unicode",regex:new RegExp(D,"i")},{name:"escape",regex:new RegExp(P,"i")},{name:"any",regex:new RegExp("[\\s\\S]","i")}]);function vt([e,t,i],[n,s,a]){return[e+n,t+s,i+a]}function pe(e){return e.reduce(vt,[0,0,0])}const ge=N(e=>e.name==="unicode"?String.fromCodePoint(parseInt(e.text.slice(1),16)):void 0),be=N(e=>e.name==="escape"?e.text.slice(1):void 0),xe=N(e=>e.name==="any"?e.text:void 0),ye=x(X(G(ge,be,xe)),e=>e.join(""));function Y(e){const t=de(e);return ye({tokens:t.tokens,options:void 0},0).value}function f(e){return N(t=>t.name===e?!0:void 0)}const tt=N(e=>e.name==="ws"?null:void 0),W=j(tt,null);function V(e){return Tt(W,e,W)}const L=N(e=>e.name==="ident"?Y(e.text):void 0),Se=N(e=>e.name==="hash"?Y(e.text.slice(1)):void 0),Ie=N(e=>e.name.startsWith("str")?Y(e.text.slice(1,-1)):void 0),_t=Yt(j(L,""),f("|")),et=A(g(_t,L,(e,t)=>({name:t,namespace:e})),x(L,e=>({name:e,namespace:null}))),we=A(g(_t,f("*"),e=>({type:"universal",namespace:e,specificity:[0,0,0]})),x(f("*"),()=>({type:"universal",namespace:null,specificity:[0,0,0]}))),Ne=x(et,({name:e,namespace:t})=>({type:"tag",name:e,namespace:t,specificity:[0,0,1]})),Te=g(f("."),L,(e,t)=>({type:"class",name:t,specificity:[0,1,0]})),Ee=x(Se,e=>({type:"id",name:e,specificity:[1,0,0]})),ot=N(e=>{if(e.name==="ident"){if(e.text==="i"||e.text==="I")return"i";if(e.text==="s"||e.text==="S")return"s"}}),Ae=A(g(Ie,j(at(W,ot),null),(e,t)=>({value:e,modifier:t})),g(L,j(at(tt,ot),null),(e,t)=>({value:e,modifier:t}))),ve=G(x(f("="),()=>"="),g(f("~"),f("="),()=>"~="),g(f("|"),f("="),()=>"|="),g(f("^"),f("="),()=>"^="),g(f("$"),f("="),()=>"$="),g(f("*"),f("="),()=>"*=")),_e=J(f("["),V(et),f("]"),(e,{name:t,namespace:i})=>({type:"attrPresence",name:t,namespace:i,specificity:[0,1,0]})),ke=Tt(f("["),J(V(et),ve,V(Ae),({name:e,namespace:t},i,{value:n,modifier:s})=>({type:"attrValue",name:e,namespace:t,matcher:i,value:n,modifier:s,specificity:[0,1,0]})),f("]")),qe=A(_e,ke),Be=A(we,Ne),ct=G(Ee,Te,qe),ut=x(A(ee(Be,X(ct)),Jt(ct)),e=>({type:"compound",list:e,specificity:pe(e.map(t=>t.specificity))})),$e=G(x(f(">"),()=>">"),x(f("+"),()=>"+"),x(f("~"),()=>"~"),g(f("|"),f("|"),()=>"||")),Ve=A(V($e),x(tt,()=>" ")),Le=re(ut,x(Ve,e=>(t,i)=>({type:"compound",list:[...i.list,{type:"combinator",combinator:e,left:t,specificity:t.specificity}],specificity:vt(t.specificity,i.specificity)})),ut);function De(e,t){if(!(typeof t=="string"||t instanceof String))throw new Error("Expected a selector string. Actual input is not a string!");const i=me(t);if(!i.complete)throw new Error(`The input "${t}" was only partially tokenized, stopped at offset ${i.offset}!
`+ht(t,i.offset));const n=V(e)({tokens:i.tokens,options:void 0},0);if(!n.matched)throw new Error(`No match for "${t}" input!`);if(n.position<i.tokens.length){const s=i.tokens[n.position];throw new Error(`The input "${t}" was only partially parsed, stopped at offset ${s.offset}!
`+ht(t,s.offset,s.len))}return n.value}function ht(e,t,i=1){return`${e.replace(/(\t)|(\r)|(\n)/g,(n,s,a)=>s?"␉":a?"␍":"␊")}
${"".padEnd(t)}${"^".repeat(i)}`}function Pe(e){return De(Le,e)}function I(e){if(!e.type)throw new Error("This is not an AST node.");switch(e.type){case"universal":return O(e.namespace)+"*";case"tag":return O(e.namespace)+_(e.name);case"class":return"."+_(e.name);case"id":return"#"+_(e.name);case"attrPresence":return`[${O(e.namespace)}${_(e.name)}]`;case"attrValue":return`[${O(e.namespace)}${_(e.name)}${e.matcher}"${Oe(e.value)}"${e.modifier?e.modifier:""}]`;case"combinator":return I(e.left)+e.combinator;case"compound":return e.list.reduce((t,i)=>i.type==="combinator"?I(i)+t:t+I(i),"");case"list":return e.list.map(I).join(",")}}function O(e){return e||e===""?_(e)+"|":""}function M(e){return`\\${e.codePointAt(0).toString(16)} `}function _(e){return e.replace(/(^[0-9])|(^-[0-9])|(^-$)|([-0-9a-zA-Z_]|[^\x00-\x7F])|(\x00)|([\x01-\x1f]|\x7f)|([\s\S])/g,(t,i,n,s,a,o,u,l)=>i?M(i):n?"-"+M(n.slice(1)):s?"\\-":a||(o?"�":u?M(u):"\\"+l))}function Oe(e){return e.replace(/(")|(\\)|(\x00)|([\x01-\x1f]|\x7f)/g,(t,i,n,s,a)=>i?'\\"':n?"\\\\":s?"�":M(a))}function F(e){if(!e.type)throw new Error("This is not an AST node.");switch(e.type){case"compound":{e.list.forEach(F),e.list.sort((t,i)=>qt(lt(t),lt(i)));break}case"combinator":{F(e.left);break}case"list":{e.list.forEach(F),e.list.sort((t,i)=>I(t)<I(i)?-1:1);break}}return e}function lt(e){switch(e.type){case"universal":return[1];case"tag":return[1];case"id":return[2];case"class":return[3,e.name];case"attrPresence":return[4,I(e)];case"attrValue":return[5,I(e)];case"combinator":return[15,I(e)]}}function kt(e,t){return qt(e,t)}function qt(e,t){if(!Array.isArray(e)||!Array.isArray(t))throw new Error("Arguments must be arrays.");const i=e.length<t.length?e.length:t.length;for(let n=0;n<i;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return e.length-t.length}var Re=Object.freeze({__proto__:null}),Me=Object.freeze({__proto__:null});const Fe=e=>`▽
`+E(e,Z),Z=[["├─","│ "],["└─","  "]],ze=[["┠─","┃ "],["┖─","  "]],ft=[["╟─","║ "],["╙─","  "]];function E(e,t=ze){return je(t,e.map(i=>Ce(i)))}function Ce(e){switch(e.type){case"terminal":{const t=e.valueContainer;return`◁ #${t.index} ${JSON.stringify(t.specificity)} ${t.value}`}case"tagName":return`◻ Tag name
${E(e.variants,ft)}`;case"attrValue":return`▣ Attr value: ${e.name}
${E(e.matchers,ft)}`;case"attrPresence":return`◨ Attr presence: ${e.name}
${E(e.cont)}`;case"pushElement":return`◉ Push element: ${e.combinator}
${E(e.cont,Z)}`;case"popElement":return`◌ Pop element
${E(e.cont,Z)}`;case"variant":return`◇ = ${e.value}
${E(e.cont)}`;case"matcher":return`◈ ${e.matcher} "${e.value}"${e.modifier||""}
${E(e.cont)}`}}function je(e,t){return t.map((i,n,{length:s})=>Ge(e,i,n===s-1)).join(`
`)}function Ge(e,t,i=!0){const n=e[i?1:0];return n[0]+t.split(`
`).join(`
`+n[1])}var Ue=Object.freeze({__proto__:null,treeify:Fe});class He{constructor(t){this.branches=k(Qe(t))}build(t){return t(this.branches)}}function Qe(e){const t=e.length,i=new Array(t);for(let n=0;n<t;n++){const[s,a]=e[n],o=We(Pe(s));i[n]={ast:o,terminal:{type:"terminal",valueContainer:{index:n,value:a,specificity:o.specificity}}}}return i}function We(e){return Bt(e),F(e),e}function Bt(e){const t=[];e.list.forEach(i=>{switch(i.type){case"class":t.push({matcher:"~=",modifier:null,name:"class",namespace:null,specificity:i.specificity,type:"attrValue",value:i.name});break;case"id":t.push({matcher:"=",modifier:null,name:"id",namespace:null,specificity:i.specificity,type:"attrValue",value:i.name});break;case"combinator":Bt(i.left),t.push(i);break;case"universal":break;default:t.push(i);break}}),e.list=t}function k(e){const t=[];for(;e.length;){const i=Lt(e,o=>!0,$t),{matches:n,nonmatches:s,empty:a}=Ke(e,i);e=s,n.length&&t.push(Xe(i,n)),a.length&&t.push(...Ze(a))}return t}function Ze(e){const t=[];for(const i of e){const n=i.terminal;if(n.type==="terminal")t.push(n);else{const{matches:s,rest:a}=ii(n.cont,o=>o.type==="terminal");s.forEach(o=>t.push(o)),a.length&&(n.cont=a,t.push(n))}}return t}function Ke(e,t){const i=[],n=[],s=[];for(const a of e){const o=a.ast.list;o.length?(o.some(l=>$t(l)===t)?i:n).push(a):s.push(a)}return{matches:i,nonmatches:n,empty:s}}function $t(e){switch(e.type){case"attrPresence":return`attrPresence ${e.name}`;case"attrValue":return`attrValue ${e.name}`;case"combinator":return`combinator ${e.combinator}`;default:return e.type}}function Xe(e,t){if(e==="tag")return Je(t);if(e.startsWith("attrValue "))return ti(e.substring(10),t);if(e.startsWith("attrPresence "))return Ye(e.substring(13),t);if(e==="combinator >")return mt(">",t);if(e==="combinator +")return mt("+",t);throw new Error(`Unsupported selector kind: ${e}`)}function Je(e){const t=it(e,n=>n.type==="tag",n=>n.name);return{type:"tagName",variants:Object.entries(t).map(([n,s])=>({type:"variant",value:n,cont:k(s.items)}))}}function Ye(e,t){for(const i of t)Vt(i,n=>n.type==="attrPresence"&&n.name===e);return{type:"attrPresence",name:e,cont:k(t)}}function ti(e,t){const i=it(t,s=>s.type==="attrValue"&&s.name===e,s=>`${s.matcher} ${s.modifier||""} ${s.value}`),n=[];for(const s of Object.values(i)){const a=s.oneSimpleSelector,o=ei(a),u=k(s.items);n.push({type:"matcher",matcher:a.matcher,modifier:a.modifier,value:a.value,predicate:o,cont:u})}return{type:"attrValue",name:e,matchers:n}}function ei(e){if(e.modifier==="i"){const t=e.value.toLowerCase();switch(e.matcher){case"=":return i=>t===i.toLowerCase();case"~=":return i=>i.toLowerCase().split(/[ \t]+/).includes(t);case"^=":return i=>i.toLowerCase().startsWith(t);case"$=":return i=>i.toLowerCase().endsWith(t);case"*=":return i=>i.toLowerCase().includes(t);case"|=":return i=>{const n=i.toLowerCase();return t===n||n.startsWith(t)&&n[t.length]==="-"}}}else{const t=e.value;switch(e.matcher){case"=":return i=>t===i;case"~=":return i=>i.split(/[ \t]+/).includes(t);case"^=":return i=>i.startsWith(t);case"$=":return i=>i.endsWith(t);case"*=":return i=>i.includes(t);case"|=":return i=>t===i||i.startsWith(t)&&i[t.length]==="-"}}}function mt(e,t){const i=it(t,s=>s.type==="combinator"&&s.combinator===e,s=>I(s.left)),n=[];for(const s of Object.values(i)){const a=k(s.items),o=s.oneSimpleSelector.left;n.push({ast:o,terminal:{type:"popElement",cont:a}})}return{type:"pushElement",combinator:e,cont:k(n)}}function it(e,t,i){const n={};for(;e.length;){const s=Lt(e,t,i),a=m=>t(m)&&i(m)===s,o=m=>m.ast.list.some(a),{matches:u,rest:l}=ni(e,o);let d=null;for(const m of u){const y=Vt(m,a);d||(d=y)}if(d==null)throw new Error("No simple selector is found.");n[s]={oneSimpleSelector:d,items:u},e=l}return n}function Vt(e,t){const i=e.ast.list,n=new Array(i.length);let s=-1;for(let o=i.length;o-- >0;)t(i[o])&&(n[o]=!0,s=o);if(s==-1)throw new Error("Couldn't find the required simple selector.");const a=i[s];return e.ast.list=i.filter((o,u)=>!n[u]),a}function Lt(e,t,i){const n={};for(const o of e){const u={};for(const l of o.ast.list.filter(t))u[i(l)]=!0;for(const l of Object.keys(u))n[l]?n[l]++:n[l]=1}let s="",a=0;for(const o of Object.entries(n))o[1]>a&&(s=o[0],a=o[1]);return s}function ii(e,t){const i=[],n=[];for(const s of e)t(s)?i.push(s):n.push(s);return{matches:i,rest:n}}function ni(e,t){const i=[],n=[];for(const s of e)t(s)?i.push(s):n.push(s);return{matches:i,rest:n}}class Dt{constructor(t){this.f=t}pickAll(t){return this.f(t)}pick1(t,i=!1){const n=this.f(t),s=n.length;if(s===0)return null;if(s===1)return n[0].value;const a=i?si:ri;let o=n[0];for(let u=1;u<s;u++){const l=n[u];a(o,l)&&(o=l)}return o.value}}function si(e,t){const i=kt(t.specificity,e.specificity);return i>0||i===0&&t.index<e.index}function ri(e,t){const i=kt(t.specificity,e.specificity);return i>0||i===0&&t.index>e.index}const Ei=Object.freeze(Object.defineProperty({__proto__:null,Ast:Re,DecisionTree:He,Picker:Dt,Treeify:Ue,Types:Me},Symbol.toStringTag,{value:"Module"}));function ai(e){return new Dt(q(e))}function q(e){const t=e.map(oi);return(i,...n)=>t.flatMap(s=>s(i,...n))}function oi(e){switch(e.type){case"terminal":{const t=[e.valueContainer];return(i,...n)=>t}case"tagName":return ci(e);case"attrValue":return hi(e);case"attrPresence":return ui(e);case"pushElement":return li(e);case"popElement":return mi(e)}}function ci(e){const t={};for(const i of e.variants)t[i.value]=q(i.cont);return(i,...n)=>{const s=t[i.name];return s?s(i,...n):[]}}function ui(e){const t=e.name,i=q(e.cont);return(n,...s)=>Object.prototype.hasOwnProperty.call(n.attribs,t)?i(n,...s):[]}function hi(e){const t=[];for(const n of e.matchers){const s=n.predicate,a=q(n.cont);t.push((o,u,...l)=>s(o)?a(u,...l):[])}const i=e.name;return(n,...s)=>{const a=n.attribs[i];return a||a===""?t.flatMap(o=>o(a,n,...s)):[]}}function li(e){const t=q(e.cont),i=e.combinator==="+"?Pt:fi;return(n,...s)=>{const a=i(n);return a===null?[]:t(a,n,...s)}}const Pt=e=>{const t=e.prev;return t===null?null:St(t)?t:Pt(t)},fi=e=>{const t=e.parent;return t&&St(t)?t:null};function mi(e){const t=q(e.cont);return(i,n,...s)=>t(n,...s)}const Ai=Object.freeze(Object.defineProperty({__proto__:null,hp2Builder:ai},Symbol.toStringTag,{value:"Module"}));var c;(function(e){e[e.Tab=9]="Tab",e[e.NewLine=10]="NewLine",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.Number=35]="Number",e[e.Amp=38]="Amp",e[e.SingleQuote=39]="SingleQuote",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dash=45]="Dash",e[e.Slash=47]="Slash",e[e.Zero=48]="Zero",e[e.Nine=57]="Nine",e[e.Semi=59]="Semi",e[e.Lt=60]="Lt",e[e.Eq=61]="Eq",e[e.Gt=62]="Gt",e[e.Questionmark=63]="Questionmark",e[e.UpperA=65]="UpperA",e[e.LowerA=97]="LowerA",e[e.UpperF=70]="UpperF",e[e.LowerF=102]="LowerF",e[e.UpperZ=90]="UpperZ",e[e.LowerZ=122]="LowerZ",e[e.LowerX=120]="LowerX",e[e.OpeningSquareBracket=91]="OpeningSquareBracket"})(c||(c={}));var r;(function(e){e[e.Text=1]="Text",e[e.BeforeTagName=2]="BeforeTagName",e[e.InTagName=3]="InTagName",e[e.InSelfClosingTag=4]="InSelfClosingTag",e[e.BeforeClosingTagName=5]="BeforeClosingTagName",e[e.InClosingTagName=6]="InClosingTagName",e[e.AfterClosingTagName=7]="AfterClosingTagName",e[e.BeforeAttributeName=8]="BeforeAttributeName",e[e.InAttributeName=9]="InAttributeName",e[e.AfterAttributeName=10]="AfterAttributeName",e[e.BeforeAttributeValue=11]="BeforeAttributeValue",e[e.InAttributeValueDq=12]="InAttributeValueDq",e[e.InAttributeValueSq=13]="InAttributeValueSq",e[e.InAttributeValueNq=14]="InAttributeValueNq",e[e.BeforeDeclaration=15]="BeforeDeclaration",e[e.InDeclaration=16]="InDeclaration",e[e.InProcessingInstruction=17]="InProcessingInstruction",e[e.BeforeComment=18]="BeforeComment",e[e.CDATASequence=19]="CDATASequence",e[e.InSpecialComment=20]="InSpecialComment",e[e.InCommentLike=21]="InCommentLike",e[e.BeforeSpecialS=22]="BeforeSpecialS",e[e.SpecialStartSequence=23]="SpecialStartSequence",e[e.InSpecialTag=24]="InSpecialTag",e[e.BeforeEntity=25]="BeforeEntity",e[e.BeforeNumericEntity=26]="BeforeNumericEntity",e[e.InNamedEntity=27]="InNamedEntity",e[e.InNumericEntity=28]="InNumericEntity",e[e.InHexEntity=29]="InHexEntity"})(r||(r={}));function w(e){return e===c.Space||e===c.NewLine||e===c.Tab||e===c.FormFeed||e===c.CarriageReturn}function R(e){return e===c.Slash||e===c.Gt||w(e)}function dt(e){return e>=c.Zero&&e<=c.Nine}function di(e){return e>=c.LowerA&&e<=c.LowerZ||e>=c.UpperA&&e<=c.UpperZ}function pi(e){return e>=c.UpperA&&e<=c.UpperF||e>=c.LowerA&&e<=c.LowerF}var S;(function(e){e[e.NoValue=0]="NoValue",e[e.Unquoted=1]="Unquoted",e[e.Single=2]="Single",e[e.Double=3]="Double"})(S||(S={}));const b={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])};class Ot{constructor({xmlMode:t=!1,decodeEntities:i=!0},n){this.cbs=n,this.state=r.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=r.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=t,this.decodeEntities=i,this.entityTrie=t?Ct:jt}reset(){this.state=r.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=r.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(t){this.offset+=this.buffer.length,this.buffer=t,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}getIndex(){return this.index}getSectionStart(){return this.sectionStart}stateText(t){t===c.Lt||!this.decodeEntities&&this.fastForwardTo(c.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=r.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&t===c.Amp&&(this.state=r.BeforeEntity)}stateSpecialStartSequence(t){const i=this.sequenceIndex===this.currentSequence.length;if(!(i?R(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!i){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=r.InTagName,this.stateInTagName(t)}stateInSpecialTag(t){if(this.sequenceIndex===this.currentSequence.length){if(t===c.Gt||w(t)){const i=this.index-this.currentSequence.length;if(this.sectionStart<i){const n=this.index;this.index=i,this.cbs.ontext(this.sectionStart,i),this.index=n}this.isSpecial=!1,this.sectionStart=i+2,this.stateInClosingTagName(t);return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===b.TitleEnd?this.decodeEntities&&t===c.Amp&&(this.state=r.BeforeEntity):this.fastForwardTo(c.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(t===c.Lt)}stateCDATASequence(t){t===b.Cdata[this.sequenceIndex]?++this.sequenceIndex===b.Cdata.length&&(this.state=r.InCommentLike,this.currentSequence=b.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=r.InDeclaration,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===t)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===b.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=r.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(t){return this.xmlMode?!R(t):di(t)}startSpecial(t,i){this.isSpecial=!0,this.currentSequence=t,this.sequenceIndex=i,this.state=r.SpecialStartSequence}stateBeforeTagName(t){if(t===c.ExclamationMark)this.state=r.BeforeDeclaration,this.sectionStart=this.index+1;else if(t===c.Questionmark)this.state=r.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(t)){const i=t|32;this.sectionStart=this.index,!this.xmlMode&&i===b.TitleEnd[2]?this.startSpecial(b.TitleEnd,3):this.state=!this.xmlMode&&i===b.ScriptEnd[2]?r.BeforeSpecialS:r.InTagName}else t===c.Slash?this.state=r.BeforeClosingTagName:(this.state=r.Text,this.stateText(t))}stateInTagName(t){R(t)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=r.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateBeforeClosingTagName(t){w(t)||(t===c.Gt?this.state=r.Text:(this.state=this.isTagStartChar(t)?r.InClosingTagName:r.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(t){(t===c.Gt||w(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=r.AfterClosingTagName,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){(t===c.Gt||this.fastForwardTo(c.Gt))&&(this.state=r.Text,this.baseState=r.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(t){t===c.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=r.InSpecialTag,this.sequenceIndex=0):this.state=r.Text,this.baseState=this.state,this.sectionStart=this.index+1):t===c.Slash?this.state=r.InSelfClosingTag:w(t)||(this.state=r.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===c.Gt?(this.cbs.onselfclosingtag(this.index),this.state=r.Text,this.baseState=r.Text,this.sectionStart=this.index+1,this.isSpecial=!1):w(t)||(this.state=r.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateInAttributeName(t){(t===c.Eq||R(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=r.AfterAttributeName,this.stateAfterAttributeName(t))}stateAfterAttributeName(t){t===c.Eq?this.state=r.BeforeAttributeValue:t===c.Slash||t===c.Gt?(this.cbs.onattribend(S.NoValue,this.index),this.state=r.BeforeAttributeName,this.stateBeforeAttributeName(t)):w(t)||(this.cbs.onattribend(S.NoValue,this.index),this.state=r.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(t){t===c.DoubleQuote?(this.state=r.InAttributeValueDq,this.sectionStart=this.index+1):t===c.SingleQuote?(this.state=r.InAttributeValueSq,this.sectionStart=this.index+1):w(t)||(this.sectionStart=this.index,this.state=r.InAttributeValueNq,this.stateInAttributeValueNoQuotes(t))}handleInAttributeValue(t,i){t===i||!this.decodeEntities&&this.fastForwardTo(i)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(i===c.DoubleQuote?S.Double:S.Single,this.index),this.state=r.BeforeAttributeName):this.decodeEntities&&t===c.Amp&&(this.baseState=this.state,this.state=r.BeforeEntity)}stateInAttributeValueDoubleQuotes(t){this.handleInAttributeValue(t,c.DoubleQuote)}stateInAttributeValueSingleQuotes(t){this.handleInAttributeValue(t,c.SingleQuote)}stateInAttributeValueNoQuotes(t){w(t)||t===c.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(S.Unquoted,this.index),this.state=r.BeforeAttributeName,this.stateBeforeAttributeName(t)):this.decodeEntities&&t===c.Amp&&(this.baseState=this.state,this.state=r.BeforeEntity)}stateBeforeDeclaration(t){t===c.OpeningSquareBracket?(this.state=r.CDATASequence,this.sequenceIndex=0):this.state=t===c.Dash?r.BeforeComment:r.InDeclaration}stateInDeclaration(t){(t===c.Gt||this.fastForwardTo(c.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=r.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===c.Gt||this.fastForwardTo(c.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=r.Text,this.sectionStart=this.index+1)}stateBeforeComment(t){t===c.Dash?(this.state=r.InCommentLike,this.currentSequence=b.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=r.InDeclaration}stateInSpecialComment(t){(t===c.Gt||this.fastForwardTo(c.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=r.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){const i=t|32;i===b.ScriptEnd[3]?this.startSpecial(b.ScriptEnd,4):i===b.StyleEnd[3]?this.startSpecial(b.StyleEnd,4):(this.state=r.InTagName,this.stateInTagName(t))}stateBeforeEntity(t){this.entityExcess=1,this.entityResult=0,t===c.Number?this.state=r.BeforeNumericEntity:t===c.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=r.InNamedEntity,this.stateInNamedEntity(t))}stateInNamedEntity(t){if(this.entityExcess+=1,this.trieIndex=Gt(this.entityTrie,this.trieCurrent,this.trieIndex+1,t),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];const i=this.trieCurrent&H.VALUE_LENGTH;if(i){const n=(i>>14)-1;if(!this.allowLegacyEntity()&&t!==c.Semi)this.trieIndex+=n;else{const s=this.index-this.entityExcess+1;s>this.sectionStart&&this.emitPartial(this.sectionStart,s),this.entityResult=this.trieIndex,this.trieIndex+=n,this.entityExcess=0,this.sectionStart=this.index+1,n===0&&this.emitNamedEntity()}}}emitNamedEntity(){if(this.state=this.baseState,this.entityResult===0)return;switch((this.entityTrie[this.entityResult]&H.VALUE_LENGTH)>>14){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~H.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}stateBeforeNumericEntity(t){(t|32)===c.LowerX?(this.entityExcess++,this.state=r.InHexEntity):(this.state=r.InNumericEntity,this.stateInNumericEntity(t))}emitNumericEntity(t){const i=this.index-this.entityExcess-1;i+2+ +(this.state===r.InHexEntity)!==this.index&&(i>this.sectionStart&&this.emitPartial(this.sectionStart,i),this.sectionStart=this.index+Number(t),this.emitCodePoint(Ut(this.entityResult))),this.state=this.baseState}stateInNumericEntity(t){t===c.Semi?this.emitNumericEntity(!0):dt(t)?(this.entityResult=this.entityResult*10+(t-c.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}stateInHexEntity(t){t===c.Semi?this.emitNumericEntity(!0):dt(t)?(this.entityResult=this.entityResult*16+(t-c.Zero),this.entityExcess++):pi(t)?(this.entityResult=this.entityResult*16+((t|32)-c.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}allowLegacyEntity(){return!this.xmlMode&&(this.baseState===r.Text||this.baseState===r.InSpecialTag)}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===r.Text||this.state===r.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===r.InAttributeValueDq||this.state===r.InAttributeValueSq||this.state===r.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const t=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case r.Text:{this.stateText(t);break}case r.SpecialStartSequence:{this.stateSpecialStartSequence(t);break}case r.InSpecialTag:{this.stateInSpecialTag(t);break}case r.CDATASequence:{this.stateCDATASequence(t);break}case r.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(t);break}case r.InAttributeName:{this.stateInAttributeName(t);break}case r.InCommentLike:{this.stateInCommentLike(t);break}case r.InSpecialComment:{this.stateInSpecialComment(t);break}case r.BeforeAttributeName:{this.stateBeforeAttributeName(t);break}case r.InTagName:{this.stateInTagName(t);break}case r.InClosingTagName:{this.stateInClosingTagName(t);break}case r.BeforeTagName:{this.stateBeforeTagName(t);break}case r.AfterAttributeName:{this.stateAfterAttributeName(t);break}case r.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(t);break}case r.BeforeAttributeValue:{this.stateBeforeAttributeValue(t);break}case r.BeforeClosingTagName:{this.stateBeforeClosingTagName(t);break}case r.AfterClosingTagName:{this.stateAfterClosingTagName(t);break}case r.BeforeSpecialS:{this.stateBeforeSpecialS(t);break}case r.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(t);break}case r.InSelfClosingTag:{this.stateInSelfClosingTag(t);break}case r.InDeclaration:{this.stateInDeclaration(t);break}case r.BeforeDeclaration:{this.stateBeforeDeclaration(t);break}case r.BeforeComment:{this.stateBeforeComment(t);break}case r.InProcessingInstruction:{this.stateInProcessingInstruction(t);break}case r.InNamedEntity:{this.stateInNamedEntity(t);break}case r.BeforeEntity:{this.stateBeforeEntity(t);break}case r.InHexEntity:{this.stateInHexEntity(t);break}case r.InNumericEntity:{this.stateInNumericEntity(t);break}default:this.stateBeforeNumericEntity(t)}this.index++}this.cleanup()}finish(){this.state===r.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length+this.offset;this.state===r.InCommentLike?this.currentSequence===b.CdataEnd?this.cbs.oncdata(this.sectionStart,t,0):this.cbs.oncomment(this.sectionStart,t,0):this.state===r.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===r.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===r.InTagName||this.state===r.BeforeAttributeName||this.state===r.BeforeAttributeValue||this.state===r.AfterAttributeName||this.state===r.InAttributeName||this.state===r.InAttributeValueSq||this.state===r.InAttributeValueDq||this.state===r.InAttributeValueNq||this.state===r.InClosingTagName||this.cbs.ontext(this.sectionStart,t)}emitPartial(t,i){this.baseState!==r.Text&&this.baseState!==r.InSpecialTag?this.cbs.onattribdata(t,i):this.cbs.ontext(t,i)}emitCodePoint(t){this.baseState!==r.Text&&this.baseState!==r.InSpecialTag?this.cbs.onattribentity(t):this.cbs.ontextentity(t)}}const v=new Set(["input","option","optgroup","select","button","datalist","textarea"]),h=new Set(["p"]),pt=new Set(["thead","tbody"]),gt=new Set(["dd","dt"]),bt=new Set(["rt","rp"]),gi=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",h],["h1",h],["h2",h],["h3",h],["h4",h],["h5",h],["h6",h],["select",v],["input",v],["output",v],["button",v],["datalist",v],["textarea",v],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",gt],["dt",gt],["address",h],["article",h],["aside",h],["blockquote",h],["details",h],["div",h],["dl",h],["fieldset",h],["figcaption",h],["figure",h],["footer",h],["form",h],["header",h],["hr",h],["main",h],["nav",h],["ol",h],["pre",h],["section",h],["table",h],["ul",h],["rt",bt],["rp",bt],["tbody",pt],["tfoot",pt]]),bi=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),xt=new Set(["math","svg"]),yt=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),xi=/\s|\//;class nt{constructor(t,i={}){var n,s,a,o,u;this.options=i,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=t??{},this.lowerCaseTagNames=(n=i.lowerCaseTags)!==null&&n!==void 0?n:!i.xmlMode,this.lowerCaseAttributeNames=(s=i.lowerCaseAttributeNames)!==null&&s!==void 0?s:!i.xmlMode,this.tokenizer=new((a=i.Tokenizer)!==null&&a!==void 0?a:Ot)(this.options,this),(u=(o=this.cbs).onparserinit)===null||u===void 0||u.call(o,this)}ontext(t,i){var n,s;const a=this.getSlice(t,i);this.endIndex=i-1,(s=(n=this.cbs).ontext)===null||s===void 0||s.call(n,a),this.startIndex=i}ontextentity(t){var i,n;const s=this.tokenizer.getSectionStart();this.endIndex=s-1,(n=(i=this.cbs).ontext)===null||n===void 0||n.call(i,st(t)),this.startIndex=s}isVoidElement(t){return!this.options.xmlMode&&bi.has(t)}onopentagname(t,i){this.endIndex=i;let n=this.getSlice(t,i);this.lowerCaseTagNames&&(n=n.toLowerCase()),this.emitOpenTag(n)}emitOpenTag(t){var i,n,s,a;this.openTagStart=this.startIndex,this.tagname=t;const o=!this.options.xmlMode&&gi.get(t);if(o)for(;this.stack.length>0&&o.has(this.stack[this.stack.length-1]);){const u=this.stack.pop();(n=(i=this.cbs).onclosetag)===null||n===void 0||n.call(i,u,!0)}this.isVoidElement(t)||(this.stack.push(t),xt.has(t)?this.foreignContext.push(!0):yt.has(t)&&this.foreignContext.push(!1)),(a=(s=this.cbs).onopentagname)===null||a===void 0||a.call(s,t),this.cbs.onopentag&&(this.attribs={})}endOpenTag(t){var i,n;this.startIndex=this.openTagStart,this.attribs&&((n=(i=this.cbs).onopentag)===null||n===void 0||n.call(i,this.tagname,this.attribs,t),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(t){this.endIndex=t,this.endOpenTag(!1),this.startIndex=t+1}onclosetag(t,i){var n,s,a,o,u,l;this.endIndex=i;let d=this.getSlice(t,i);if(this.lowerCaseTagNames&&(d=d.toLowerCase()),(xt.has(d)||yt.has(d))&&this.foreignContext.pop(),this.isVoidElement(d))!this.options.xmlMode&&d==="br"&&((s=(n=this.cbs).onopentagname)===null||s===void 0||s.call(n,"br"),(o=(a=this.cbs).onopentag)===null||o===void 0||o.call(a,"br",{},!0),(l=(u=this.cbs).onclosetag)===null||l===void 0||l.call(u,"br",!1));else{const m=this.stack.lastIndexOf(d);if(m!==-1)if(this.cbs.onclosetag){let y=this.stack.length-m;for(;y--;)this.cbs.onclosetag(this.stack.pop(),y!==0)}else this.stack.length=m;else!this.options.xmlMode&&d==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=i+1}onselfclosingtag(t){this.endIndex=t,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=t+1):this.onopentagend(t)}closeCurrentTag(t){var i,n;const s=this.tagname;this.endOpenTag(t),this.stack[this.stack.length-1]===s&&((n=(i=this.cbs).onclosetag)===null||n===void 0||n.call(i,s,!t),this.stack.pop())}onattribname(t,i){this.startIndex=t;const n=this.getSlice(t,i);this.attribname=this.lowerCaseAttributeNames?n.toLowerCase():n}onattribdata(t,i){this.attribvalue+=this.getSlice(t,i)}onattribentity(t){this.attribvalue+=st(t)}onattribend(t,i){var n,s;this.endIndex=i,(s=(n=this.cbs).onattribute)===null||s===void 0||s.call(n,this.attribname,this.attribvalue,t===S.Double?'"':t===S.Single?"'":t===S.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(t){const i=t.search(xi);let n=i<0?t:t.substr(0,i);return this.lowerCaseTagNames&&(n=n.toLowerCase()),n}ondeclaration(t,i){this.endIndex=i;const n=this.getSlice(t,i);if(this.cbs.onprocessinginstruction){const s=this.getInstructionName(n);this.cbs.onprocessinginstruction(`!${s}`,`!${n}`)}this.startIndex=i+1}onprocessinginstruction(t,i){this.endIndex=i;const n=this.getSlice(t,i);if(this.cbs.onprocessinginstruction){const s=this.getInstructionName(n);this.cbs.onprocessinginstruction(`?${s}`,`?${n}`)}this.startIndex=i+1}oncomment(t,i,n){var s,a,o,u;this.endIndex=i,(a=(s=this.cbs).oncomment)===null||a===void 0||a.call(s,this.getSlice(t,i-n)),(u=(o=this.cbs).oncommentend)===null||u===void 0||u.call(o),this.startIndex=i+1}oncdata(t,i,n){var s,a,o,u,l,d,m,y,B,p;this.endIndex=i;const T=this.getSlice(t,i-n);this.options.xmlMode||this.options.recognizeCDATA?((a=(s=this.cbs).oncdatastart)===null||a===void 0||a.call(s),(u=(o=this.cbs).ontext)===null||u===void 0||u.call(o,T),(d=(l=this.cbs).oncdataend)===null||d===void 0||d.call(l)):((y=(m=this.cbs).oncomment)===null||y===void 0||y.call(m,`[CDATA[${T}]]`),(p=(B=this.cbs).oncommentend)===null||p===void 0||p.call(B)),this.startIndex=i+1}onend(){var t,i;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let n=this.stack.length;n>0;this.cbs.onclosetag(this.stack[--n],!0));}(i=(t=this.cbs).onend)===null||i===void 0||i.call(t)}reset(){var t,i,n,s;(i=(t=this.cbs).onreset)===null||i===void 0||i.call(t),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(s=(n=this.cbs).onparserinit)===null||s===void 0||s.call(n,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(t){this.reset(),this.end(t)}getSlice(t,i){for(;t-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let n=this.buffers[0].slice(t-this.bufferOffset,i-this.bufferOffset);for(;i-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),n+=this.buffers[0].slice(0,i-this.bufferOffset);return n}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(t){var i,n;if(this.ended){(n=(i=this.cbs).onerror)===null||n===void 0||n.call(i,new Error(".write() after done!"));return}this.buffers.push(t),this.tokenizer.running&&(this.tokenizer.write(t),this.writeIndex++)}end(t){var i,n;if(this.ended){(n=(i=this.cbs).onerror)===null||n===void 0||n.call(i,new Error(".end() after done!"));return}t&&this.write(t),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(t){this.write(t)}done(t){this.end(t)}}function Rt(e,t){const i=new z(void 0,t);return new nt(i,t).end(e),i.root}function Mt(e,t){return Rt(e,t).children}function yi(e,t,i){const n=new z(e,t,i);return new nt(n,t)}const Si={xmlMode:!0};function Ii(e,t=Si){return It(Mt(e,t))}const vi=Object.freeze(Object.defineProperty({__proto__:null,DefaultHandler:z,DomHandler:z,DomUtils:Ht,ElementType:zt,Parser:nt,Tokenizer:Ot,createDomStream:yi,getFeed:It,parseDOM:Mt,parseDocument:Rt,parseFeed:Ii},Symbol.toStringTag,{value:"Module"}));export{He as D,Ai as a,vi as e,ai as h,Rt as p,Ei as s};
