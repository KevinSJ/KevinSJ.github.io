import{c as $,i as z}from"./style-ynO7IsM1.js";import"./version-BXrBJCm5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-C6L5gDe0.js";import{P as J,a as F,x as e,d as O,f as j}from"./main-CdZmBCMR.js";import"./mobileMenu-BoMunYmR.js";const v={file:null,pdfDoc:null};function K(s){const r=s.getInfoDict();r.keys().forEach(i=>{r.delete(i)}),s.setTitle(""),s.setAuthor(""),s.setSubject(""),s.setKeywords([]),s.setCreator(""),s.setProducer("");try{const i=s.catalog.dict;i.has(e.of("Metadata"))&&i.delete(e.of("Metadata"))}catch(i){console.warn("Could not remove XMP metadata:",i.message)}try{const i=s.context;i.trailerInfo&&delete i.trailerInfo.ID}catch(i){console.warn("Could not remove document IDs:",i.message)}try{const i=s.catalog.dict;i.has(e.of("PieceInfo"))&&i.delete(e.of("PieceInfo"))}catch(i){console.warn("Could not remove PieceInfo:",i.message)}}function H(s){const r=s.getPages();for(const t of r)try{t.node.delete(e.of("Annots"))}catch(i){console.warn("Could not remove annotations from page:",i.message)}}function G(s){s.getForm().flatten()}function b(){v.file=null,v.pdfDoc=null;const s=document.getElementById("file-display-area");s&&(s.innerHTML="");const r=document.getElementById("tool-options");r&&r.classList.add("hidden");const t=document.getElementById("file-input");t&&(t.value="")}async function U(){const s=document.getElementById("file-display-area"),r=document.getElementById("tool-options");if(s)if(s.innerHTML="",v.file){const t=document.createElement("div");t.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const i=document.createElement("div");i.className="flex flex-col overflow-hidden";const g=document.createElement("div");g.className="truncate font-medium text-gray-200 text-sm mb-1",g.textContent=v.file.name;const k=document.createElement("div");k.className="text-xs text-gray-400",k.textContent=j(v.file.size),i.append(g,k);const D=document.createElement("button");D.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",D.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',D.onclick=function(){b()},t.append(i,D),s.appendChild(t),$({icons:z}),r&&r.classList.remove("hidden")}else r&&r.classList.add("hidden")}async function R(s){if(s&&s.length>0){const r=s[0];if(r.type==="application/pdf"||r.name.toLowerCase().endsWith(".pdf")){v.file=r;try{const t=await r.arrayBuffer();v.pdfDoc=await J.load(t),U()}catch(t){console.error("Error loading PDF:",t),F("Error","Failed to load PDF file.")}}}}async function W(){if(!v.pdfDoc){F("Error","No PDF document loaded.");return}const s=document.getElementById("loader-modal"),r=document.getElementById("loader-text");s&&s.classList.remove("hidden"),r&&(r.textContent="Sanitizing PDF...");try{const t=v.pdfDoc,i=document.getElementById("flatten-forms").checked,g=document.getElementById("remove-metadata").checked,k=document.getElementById("remove-annotations").checked,D=document.getElementById("remove-javascript").checked,P=document.getElementById("remove-embedded-files").checked,S=document.getElementById("remove-layers").checked,B=document.getElementById("remove-links").checked,L=document.getElementById("remove-structure-tree").checked,T=document.getElementById("remove-markinfo").checked,M=document.getElementById("remove-fonts").checked;let c=!1;if(i)try{G(t),c=!0}catch(o){console.warn(`Could not flatten forms: ${o.message}`);try{const a=t.catalog.dict;a.has(e.of("AcroForm"))&&(a.delete(e.of("AcroForm")),c=!0)}catch(a){console.warn("Could not remove AcroForm:",a.message)}}if(g&&(K(t),c=!0),k&&(H(t),c=!0),D)try{t.javaScripts&&t.javaScripts.length>0&&(t.javaScripts=[],c=!0);const o=t.catalog.dict,a=o.get(e.of("Names"));if(a)try{const n=t.context.lookup(a);n.has(e.of("JavaScript"))&&(n.delete(e.of("JavaScript")),c=!0)}catch(n){console.warn("Could not access Names/JavaScript:",n.message)}o.has(e.of("OpenAction"))&&(o.delete(e.of("OpenAction")),c=!0),o.has(e.of("AA"))&&(o.delete(e.of("AA")),c=!0);const u=t.getPages();for(const n of u)try{const f=n.node;f.has(e.of("AA"))&&(f.delete(e.of("AA")),c=!0);const l=f.Annots()?.asArray()||[];for(const p of l)try{const d=t.context.lookup(p);if(d.has(e.of("A"))){const h=d.get(e.of("A"));try{t.context.lookup(h).get(e.of("S"))?.toString().substring(1)==="JavaScript"&&(d.delete(e.of("A")),c=!0)}catch(m){console.warn("Could not read action:",m.message)}}d.has(e.of("AA"))&&(d.delete(e.of("AA")),c=!0)}catch(d){console.warn("Could not process annotation for JS:",d.message)}}catch(f){console.warn("Could not remove page actions:",f.message)}try{const n=o.get(e.of("AcroForm"));if(n){const l=t.context.lookup(n).get(e.of("Fields"));if(l){const d=t.context.lookup(l).asArray();for(const h of d)try{const m=t.context.lookup(h);m.has(e.of("A"))&&(m.delete(e.of("A")),c=!0),m.has(e.of("AA"))&&(m.delete(e.of("AA")),c=!0)}catch(m){console.warn("Could not process field for JS:",m.message)}}}}catch(n){console.warn("Could not process form fields for JS:",n.message)}}catch(o){console.warn(`Could not remove JavaScript: ${o.message}`)}if(P)try{const o=t.catalog.dict,a=o.get(e.of("Names"));if(a)try{const n=t.context.lookup(a);n.has(e.of("EmbeddedFiles"))&&(n.delete(e.of("EmbeddedFiles")),c=!0)}catch(n){console.warn("Could not access Names/EmbeddedFiles:",n.message)}o.has(e.of("EmbeddedFiles"))&&(o.delete(e.of("EmbeddedFiles")),c=!0);const u=t.getPages();for(const n of u)try{const f=n.node.Annots()?.asArray()||[],l=[];for(const p of f)try{t.context.lookup(p).get(e.of("Subtype"))?.toString().substring(1)!=="FileAttachment"?l.push(p):c=!0}catch{l.push(p)}if(l.length!==f.length)if(l.length>0){const p=t.context.obj(l);n.node.set(e.of("Annots"),p)}else n.node.delete(e.of("Annots"))}catch(f){console.warn(`Could not process page for attachments: ${f.message}`)}t.embeddedFiles&&t.embeddedFiles.length>0&&(t.embeddedFiles=[],c=!0),o.has(e.of("Collection"))&&(o.delete(e.of("Collection")),c=!0)}catch(o){console.warn(`Could not remove embedded files: ${o.message}`)}if(S)try{const o=t.catalog.dict;o.has(e.of("OCProperties"))&&(o.delete(e.of("OCProperties")),c=!0);const a=t.getPages();for(const u of a)try{const n=u.node;n.has(e.of("OCProperties"))&&(n.delete(e.of("OCProperties")),c=!0);const f=n.get(e.of("Resources"));if(f)try{const l=t.context.lookup(f);l.has(e.of("Properties"))&&(l.delete(e.of("Properties")),c=!0)}catch(l){console.warn("Could not access Resources:",l.message)}}catch(n){console.warn("Could not remove page layers:",n.message)}}catch(o){console.warn(`Could not remove layers: ${o.message}`)}if(B)try{const o=t.getPages();for(let a=0;a<o.length;a++)try{const n=o[a].node,f=n.get(e.of("Annots"));if(!f)continue;const p=t.context.lookup(f).asArray();if(p.length===0)continue;const d=[];let h=0;for(const m of p)try{const y=t.context.lookup(m),C=y.get(e.of("Subtype"))?.toString().substring(1);let A=!1;if(C==="Link")A=!0,h++;else{const w=y.get(e.of("A"));if(w)try{const x=t.context.lookup(w).get(e.of("S"))?.toString().substring(1);(x==="URI"||x==="Launch"||x==="GoTo"||x==="GoToR")&&(A=!0,h++)}catch(E){console.warn("Could not read action:",E.message)}y.get(e.of("Dest"))&&!A&&(A=!0,h++)}A||d.push(m)}catch(y){console.warn("Could not process annotation:",y.message),d.push(m)}if(h>0){if(d.length>0){const m=t.context.obj(d);n.set(e.of("Annots"),m)}else n.delete(e.of("Annots"));c=!0}}catch(u){console.warn(`Could not process page ${a+1} for links: ${u.message}`)}try{const a=t.catalog.dict,u=a.get(e.of("Names"));if(u)try{const n=t.context.lookup(u);n.has(e.of("Dests"))&&(n.delete(e.of("Dests")),c=!0)}catch(n){console.warn("Could not access Names/Dests:",n.message)}a.has(e.of("Dests"))&&(a.delete(e.of("Dests")),c=!0)}catch(a){console.warn("Could not remove named destinations:",a.message)}}catch(o){console.warn(`Could not remove links: ${o.message}`)}if(L)try{const o=t.catalog.dict;o.has(e.of("StructTreeRoot"))&&(o.delete(e.of("StructTreeRoot")),c=!0);const a=t.getPages();for(const u of a)try{const n=u.node;n.has(e.of("StructParents"))&&(n.delete(e.of("StructParents")),c=!0)}catch(n){console.warn("Could not remove page StructParents:",n.message)}o.has(e.of("ParentTree"))&&(o.delete(e.of("ParentTree")),c=!0)}catch(o){console.warn(`Could not remove structure tree: ${o.message}`)}if(T)try{const o=t.catalog.dict;o.has(e.of("MarkInfo"))&&(o.delete(e.of("MarkInfo")),c=!0),o.has(e.of("Marked"))&&(o.delete(e.of("Marked")),c=!0)}catch(o){console.warn(`Could not remove MarkInfo: ${o.message}`)}if(M)try{const o=t.getPages();for(let a=0;a<o.length;a++)try{const f=o[a].node.get(e.of("Resources"));if(f)try{const l=t.context.lookup(f);if(l.has(e.of("Font"))){const p=l.get(e.of("Font"));try{const d=t.context.lookup(p),h=d.keys();for(const m of h)try{const y=d.get(m),C=t.context.lookup(y);if(C.has(e.of("FontDescriptor"))){const A=C.get(e.of("FontDescriptor")),w=t.context.lookup(A),I=["FontFile","FontFile2","FontFile3"];for(const E of I)w.has(e.of(E))&&(w.delete(e.of(E)),c=!0)}}catch(y){console.warn(`Could not process font ${m}:`,y.message)}}catch(d){console.warn("Could not access font dictionary:",d.message)}}}catch(l){console.warn("Could not access Resources for fonts:",l.message)}}catch(u){console.warn(`Could not remove fonts from page ${a+1}:`,u.message)}t.fonts&&t.fonts.length>0&&(t.fonts=[],c=!0)}catch(o){console.warn(`Could not remove fonts: ${o.message}`)}if(!c){F("No Changes","No items were selected for removal or none were found in the PDF."),s&&s.classList.add("hidden");return}const N=await t.save();O(new Blob([N],{type:"application/pdf"}),"sanitized.pdf"),F("Success","PDF has been sanitized and downloaded.","success",()=>{b()})}catch(t){console.error("Sanitization Error:",t),F("Error",`An error occurred during sanitization: ${t.message}`)}finally{s&&s.classList.add("hidden")}}document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("file-input"),r=document.getElementById("drop-zone"),t=document.getElementById("process-btn"),i=document.getElementById("back-to-tools");i&&i.addEventListener("click",function(){window.location.href="/itools/"}),s&&r&&(s.addEventListener("change",function(g){R(g.target.files)}),r.addEventListener("dragover",function(g){g.preventDefault(),r.classList.add("bg-gray-700")}),r.addEventListener("dragleave",function(g){g.preventDefault(),r.classList.remove("bg-gray-700")}),r.addEventListener("drop",function(g){g.preventDefault(),r.classList.remove("bg-gray-700"),R(g.dataTransfer?.files)}),s.addEventListener("click",function(){s.value=""})),t&&t.addEventListener("click",W)});
