import{p as b}from"./index-0c1fde36.js";import{r as j}from"./index-649b5bab.js";import{s as p,u as x}from"./index-fdbe2ce9.js";import{B as ii}from"./index-a6f01dde.js";import{r as q}from"./assert-53be9de1.js";import{c as ei,z as ni,d as ti,i as ri}from"./constants-dc8a8387.js";var ai={},$={};(function(e){var f=q(),O=ni,t=ti,E=ri,y=ei;for(var S in y)e[S]=y[S];e.NONE=0,e.DEFLATE=1,e.INFLATE=2,e.GZIP=3,e.GUNZIP=4,e.DEFLATERAW=5,e.INFLATERAW=6,e.UNZIP=7;var M=31,z=139;function u(a){if(typeof a!="number"||a<e.DEFLATE||a>e.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=a,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}u.prototype.close=function(){if(this.write_in_progress){this.pending_close=!0;return}this.pending_close=!1,f(this.init_done,"close before init"),f(this.mode<=e.UNZIP),this.mode===e.DEFLATE||this.mode===e.GZIP||this.mode===e.DEFLATERAW?t.deflateEnd(this.strm):(this.mode===e.INFLATE||this.mode===e.GUNZIP||this.mode===e.INFLATERAW||this.mode===e.UNZIP)&&E.inflateEnd(this.strm),this.mode=e.NONE,this.dictionary=null},u.prototype.write=function(a,s,d,c,m,v,L){return this._write(!0,a,s,d,c,m,v,L)},u.prototype.writeSync=function(a,s,d,c,m,v,L){return this._write(!1,a,s,d,c,m,v,L)},u.prototype._write=function(a,s,d,c,m,v,L,N){if(f.equal(arguments.length,8),f(this.init_done,"write before init"),f(this.mode!==e.NONE,"already finalized"),f.equal(!1,this.write_in_progress,"write already in progress"),f.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,f.equal(!1,s===void 0,"must provide flush value"),this.write_in_progress=!0,s!==e.Z_NO_FLUSH&&s!==e.Z_PARTIAL_FLUSH&&s!==e.Z_SYNC_FLUSH&&s!==e.Z_FULL_FLUSH&&s!==e.Z_FINISH&&s!==e.Z_BLOCK)throw new Error("Invalid flush value");if(d==null&&(d=ii.alloc(0),m=0,c=0),this.strm.avail_in=m,this.strm.input=d,this.strm.next_in=c,this.strm.avail_out=N,this.strm.output=v,this.strm.next_out=L,this.flush=s,!a)return this._process(),this._checkError()?this._afterSync():void 0;var I=this;return b.nextTick(function(){I._process(),I._after()}),this},u.prototype._afterSync=function(){var a=this.strm.avail_out,s=this.strm.avail_in;return this.write_in_progress=!1,[s,a]},u.prototype._process=function(){var a=null;switch(this.mode){case e.DEFLATE:case e.GZIP:case e.DEFLATERAW:this.err=t.deflate(this.strm,this.flush);break;case e.UNZIP:switch(this.strm.avail_in>0&&(a=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(a===null)break;if(this.strm.input[a]===M){if(this.gzip_id_bytes_read=1,a++,this.strm.avail_in===1)break}else{this.mode=e.INFLATE;break}case 1:if(a===null)break;this.strm.input[a]===z?(this.gzip_id_bytes_read=2,this.mode=e.GUNZIP):this.mode=e.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case e.INFLATE:case e.GUNZIP:case e.INFLATERAW:for(this.err=E.inflate(this.strm,this.flush),this.err===e.Z_NEED_DICT&&this.dictionary&&(this.err=E.inflateSetDictionary(this.strm,this.dictionary),this.err===e.Z_OK?this.err=E.inflate(this.strm,this.flush):this.err===e.Z_DATA_ERROR&&(this.err=e.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===e.GUNZIP&&this.err===e.Z_STREAM_END&&this.strm.next_in[0]!==0;)this.reset(),this.err=E.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},u.prototype._checkError=function(){switch(this.err){case e.Z_OK:case e.Z_BUF_ERROR:if(this.strm.avail_out!==0&&this.flush===e.Z_FINISH)return this._error("unexpected end of file"),!1;break;case e.Z_STREAM_END:break;case e.Z_NEED_DICT:return this.dictionary==null?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},u.prototype._after=function(){if(this._checkError()){var a=this.strm.avail_out,s=this.strm.avail_in;this.write_in_progress=!1,this.callback(s,a),this.pending_close&&this.close()}},u.prototype._error=function(a){this.strm.msg&&(a=this.strm.msg),this.onerror(a,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},u.prototype.init=function(a,s,d,c,m){f(arguments.length===4||arguments.length===5,"init(windowBits, level, memLevel, strategy, [dictionary])"),f(a>=8&&a<=15,"invalid windowBits"),f(s>=-1&&s<=9,"invalid compression level"),f(d>=1&&d<=9,"invalid memlevel"),f(c===e.Z_FILTERED||c===e.Z_HUFFMAN_ONLY||c===e.Z_RLE||c===e.Z_FIXED||c===e.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(s,a,d,c,m),this._setDictionary()},u.prototype.params=function(){throw new Error("deflateParams Not supported")},u.prototype.reset=function(){this._reset(),this._setDictionary()},u.prototype._init=function(a,s,d,c,m){switch(this.level=a,this.windowBits=s,this.memLevel=d,this.strategy=c,this.flush=e.Z_NO_FLUSH,this.err=e.Z_OK,(this.mode===e.GZIP||this.mode===e.GUNZIP)&&(this.windowBits+=16),this.mode===e.UNZIP&&(this.windowBits+=32),(this.mode===e.DEFLATERAW||this.mode===e.INFLATERAW)&&(this.windowBits=-1*this.windowBits),this.strm=new O,this.mode){case e.DEFLATE:case e.GZIP:case e.DEFLATERAW:this.err=t.deflateInit2(this.strm,this.level,e.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case e.INFLATE:case e.GUNZIP:case e.INFLATERAW:case e.UNZIP:this.err=E.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==e.Z_OK&&this._error("Init error"),this.dictionary=m,this.write_in_progress=!1,this.init_done=!0},u.prototype._setDictionary=function(){if(this.dictionary!=null){switch(this.err=e.Z_OK,this.mode){case e.DEFLATE:case e.DEFLATERAW:this.err=t.deflateSetDictionary(this.strm,this.dictionary);break}this.err!==e.Z_OK&&this._error("Failed to set dictionary")}},u.prototype._reset=function(){switch(this.err=e.Z_OK,this.mode){case e.DEFLATE:case e.DEFLATERAW:case e.GZIP:this.err=t.deflateReset(this.strm);break;case e.INFLATE:case e.INFLATERAW:case e.GUNZIP:this.err=E.inflateReset(this.strm);break}this.err!==e.Z_OK&&this._error("Failed to reset stream")},e.Zlib=u})($);(function(e){var f=j.Buffer,O=p.Transform,t=$,E=x,y=q().ok,S=j.kMaxLength,M="Cannot create final Buffer. It would be larger than 0x"+S.toString(16)+" bytes";t.Z_MIN_WINDOWBITS=8,t.Z_MAX_WINDOWBITS=15,t.Z_DEFAULT_WINDOWBITS=15,t.Z_MIN_CHUNK=64,t.Z_MAX_CHUNK=1/0,t.Z_DEFAULT_CHUNK=16*1024,t.Z_MIN_MEMLEVEL=1,t.Z_MAX_MEMLEVEL=9,t.Z_DEFAULT_MEMLEVEL=8,t.Z_MIN_LEVEL=-1,t.Z_MAX_LEVEL=9,t.Z_DEFAULT_LEVEL=t.Z_DEFAULT_COMPRESSION;for(var z=Object.keys(t),u=0;u<z.length;u++){var a=z[u];a.match(/^Z/)&&Object.defineProperty(e,a,{enumerable:!0,value:t[a],writable:!1})}for(var s={Z_OK:t.Z_OK,Z_STREAM_END:t.Z_STREAM_END,Z_NEED_DICT:t.Z_NEED_DICT,Z_ERRNO:t.Z_ERRNO,Z_STREAM_ERROR:t.Z_STREAM_ERROR,Z_DATA_ERROR:t.Z_DATA_ERROR,Z_MEM_ERROR:t.Z_MEM_ERROR,Z_BUF_ERROR:t.Z_BUF_ERROR,Z_VERSION_ERROR:t.Z_VERSION_ERROR},d=Object.keys(s),c=0;c<d.length;c++){var m=d[c];s[s[m]]=m}Object.defineProperty(e,"codes",{enumerable:!0,value:Object.freeze(s),writable:!1}),e.Deflate=N,e.Inflate=I,e.Gzip=R,e.Gunzip=A,e.DeflateRaw=T,e.InflateRaw=D,e.Unzip=g,e.createDeflate=function(i){return new N(i)},e.createInflate=function(i){return new I(i)},e.createDeflateRaw=function(i){return new T(i)},e.createInflateRaw=function(i){return new D(i)},e.createGzip=function(i){return new R(i)},e.createGunzip=function(i){return new A(i)},e.createUnzip=function(i){return new g(i)},e.deflate=function(i,n,r){return typeof n=="function"&&(r=n,n={}),v(new N(n),i,r)},e.deflateSync=function(i,n){return L(new N(n),i)},e.gzip=function(i,n,r){return typeof n=="function"&&(r=n,n={}),v(new R(n),i,r)},e.gzipSync=function(i,n){return L(new R(n),i)},e.deflateRaw=function(i,n,r){return typeof n=="function"&&(r=n,n={}),v(new T(n),i,r)},e.deflateRawSync=function(i,n){return L(new T(n),i)},e.unzip=function(i,n,r){return typeof n=="function"&&(r=n,n={}),v(new g(n),i,r)},e.unzipSync=function(i,n){return L(new g(n),i)},e.inflate=function(i,n,r){return typeof n=="function"&&(r=n,n={}),v(new I(n),i,r)},e.inflateSync=function(i,n){return L(new I(n),i)},e.gunzip=function(i,n,r){return typeof n=="function"&&(r=n,n={}),v(new A(n),i,r)},e.gunzipSync=function(i,n){return L(new A(n),i)},e.inflateRaw=function(i,n,r){return typeof n=="function"&&(r=n,n={}),v(new D(n),i,r)},e.inflateRawSync=function(i,n){return L(new D(n),i)};function v(i,n,r){var h=[],o=0;i.on("error",l),i.on("end",F),i.end(n),Z();function Z(){for(var w;(w=i.read())!==null;)h.push(w),o+=w.length;i.once("readable",Z)}function l(w){i.removeListener("end",F),i.removeListener("readable",Z),r(w)}function F(){var w,U=null;o>=S?U=new RangeError(M):w=f.concat(h,o),h=[],i.close(),r(U,w)}}function L(i,n){if(typeof n=="string"&&(n=f.from(n)),!f.isBuffer(n))throw new TypeError("Not a string or buffer");var r=i._finishFlushFlag;return i._processChunk(n,r)}function N(i){if(!(this instanceof N))return new N(i);_.call(this,i,t.DEFLATE)}function I(i){if(!(this instanceof I))return new I(i);_.call(this,i,t.INFLATE)}function R(i){if(!(this instanceof R))return new R(i);_.call(this,i,t.GZIP)}function A(i){if(!(this instanceof A))return new A(i);_.call(this,i,t.GUNZIP)}function T(i){if(!(this instanceof T))return new T(i);_.call(this,i,t.DEFLATERAW)}function D(i){if(!(this instanceof D))return new D(i);_.call(this,i,t.INFLATERAW)}function g(i){if(!(this instanceof g))return new g(i);_.call(this,i,t.UNZIP)}function K(i){return i===t.Z_NO_FLUSH||i===t.Z_PARTIAL_FLUSH||i===t.Z_SYNC_FLUSH||i===t.Z_FULL_FLUSH||i===t.Z_FINISH||i===t.Z_BLOCK}function _(i,n){var r=this;if(this._opts=i=i||{},this._chunkSize=i.chunkSize||e.Z_DEFAULT_CHUNK,O.call(this,i),i.flush&&!K(i.flush))throw new Error("Invalid flush flag: "+i.flush);if(i.finishFlush&&!K(i.finishFlush))throw new Error("Invalid flush flag: "+i.finishFlush);if(this._flushFlag=i.flush||t.Z_NO_FLUSH,this._finishFlushFlag=typeof i.finishFlush<"u"?i.finishFlush:t.Z_FINISH,i.chunkSize&&(i.chunkSize<e.Z_MIN_CHUNK||i.chunkSize>e.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+i.chunkSize);if(i.windowBits&&(i.windowBits<e.Z_MIN_WINDOWBITS||i.windowBits>e.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+i.windowBits);if(i.level&&(i.level<e.Z_MIN_LEVEL||i.level>e.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+i.level);if(i.memLevel&&(i.memLevel<e.Z_MIN_MEMLEVEL||i.memLevel>e.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+i.memLevel);if(i.strategy&&i.strategy!=e.Z_FILTERED&&i.strategy!=e.Z_HUFFMAN_ONLY&&i.strategy!=e.Z_RLE&&i.strategy!=e.Z_FIXED&&i.strategy!=e.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+i.strategy);if(i.dictionary&&!f.isBuffer(i.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new t.Zlib(n);var h=this;this._hadError=!1,this._handle.onerror=function(l,F){B(h),h._hadError=!0;var w=new Error(l);w.errno=F,w.code=e.codes[F],h.emit("error",w)};var o=e.Z_DEFAULT_COMPRESSION;typeof i.level=="number"&&(o=i.level);var Z=e.Z_DEFAULT_STRATEGY;typeof i.strategy=="number"&&(Z=i.strategy),this._handle.init(i.windowBits||e.Z_DEFAULT_WINDOWBITS,o,i.memLevel||e.Z_DEFAULT_MEMLEVEL,Z,i.dictionary),this._buffer=f.allocUnsafe(this._chunkSize),this._offset=0,this._level=o,this._strategy=Z,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!r._handle},configurable:!0,enumerable:!0})}E.inherits(_,O),_.prototype.params=function(i,n,r){if(i<e.Z_MIN_LEVEL||i>e.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+i);if(n!=e.Z_FILTERED&&n!=e.Z_HUFFMAN_ONLY&&n!=e.Z_RLE&&n!=e.Z_FIXED&&n!=e.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+n);if(this._level!==i||this._strategy!==n){var h=this;this.flush(t.Z_SYNC_FLUSH,function(){y(h._handle,"zlib binding closed"),h._handle.params(i,n),h._hadError||(h._level=i,h._strategy=n,r&&r())})}else b.nextTick(r)},_.prototype.reset=function(){return y(this._handle,"zlib binding closed"),this._handle.reset()},_.prototype._flush=function(i){this._transform(f.alloc(0),"",i)},_.prototype.flush=function(i,n){var r=this,h=this._writableState;(typeof i=="function"||i===void 0&&!n)&&(n=i,i=t.Z_FULL_FLUSH),h.ended?n&&b.nextTick(n):h.ending?n&&this.once("end",n):h.needDrain?n&&this.once("drain",function(){return r.flush(i,n)}):(this._flushFlag=i,this.write(f.alloc(0),"",n))},_.prototype.close=function(i){B(this,i),b.nextTick(J,this)};function B(i,n){n&&b.nextTick(n),i._handle&&(i._handle.close(),i._handle=null)}function J(i){i.emit("close")}_.prototype._transform=function(i,n,r){var h,o=this._writableState,Z=o.ending||o.ended,l=Z&&(!i||o.length===i.length);if(i!==null&&!f.isBuffer(i))return r(new Error("invalid input"));if(!this._handle)return r(new Error("zlib binding closed"));l?h=this._finishFlushFlag:(h=this._flushFlag,i.length>=o.length&&(this._flushFlag=this._opts.flush||t.Z_NO_FLUSH)),this._processChunk(i,h,r)},_.prototype._processChunk=function(i,n,r){var h=i&&i.length,o=this._chunkSize-this._offset,Z=0,l=this,F=typeof r=="function";if(!F){var w=[],U=0,V;this.on("error",function(P){V=P}),y(this._handle,"zlib binding closed");do var X=this._handle.writeSync(n,i,Z,h,this._buffer,this._offset,o);while(!this._hadError&&H(X[0],X[1]));if(this._hadError)throw V;if(U>=S)throw B(this),new RangeError(M);var Q=f.concat(w,U);return B(this),Q}y(this._handle,"zlib binding closed");var k=this._handle.write(n,i,Z,h,this._buffer,this._offset,o);k.buffer=i,k.callback=H;function H(P,W){if(this&&(this.buffer=null,this.callback=null),!l._hadError){var G=o-W;if(y(G>=0,"have should not go down"),G>0){var C=l._buffer.slice(l._offset,l._offset+G);l._offset+=G,F?l.push(C):(w.push(C),U+=C.length)}if((W===0||l._offset>=l._chunkSize)&&(o=l._chunkSize,l._offset=0,l._buffer=f.allocUnsafe(l._chunkSize)),W===0){if(Z+=h-P,h=P,!F)return!0;var Y=l._handle.write(n,i,Z,h,l._buffer,l._offset,l._chunkSize);Y.callback=H,Y.buffer=i;return}if(!F)return!1;r()}}},E.inherits(N,_),E.inherits(I,_),E.inherits(R,_),E.inherits(A,_),E.inherits(T,_),E.inherits(D,_),E.inherits(g,_)})(ai);export{ai as l};
