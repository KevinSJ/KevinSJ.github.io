import{d as Y,a0 as Z,r as I,i as ee,R as te,E as ae,o as w,j as W,w as J,k as T,l as u,m as H,a as v,c as k,a8 as M,a7 as N,ad as S,a6 as B,G as g,aX as re,x as oe,ae as ne,ag as ie,af as se,bq as le}from"./index-0c1fde36.js";import{h as ce}from"./hex-array-fe7b0a26.js";import{g as D}from"./base64-ae7cf34b.js";import{g as de,c as ue,s as pe,a as fe,i as C,J as d,d as P,b as E,e as ye,v as me,f as he,h as G,j as we,k as z,l as be,m as A,n as _e,o as Q,p as b,q as R,r as ge,t as $,u as q,w as ve,x as ke}from"./jwt-parser.service-5aa748f6.js";import{i as xe}from"./boolean-c7e7c785.js";import{w as Je}from"./defaults-4d6daddf.js";import{_ as Se}from"./Table-4b7ecda9.js";import{N as We}from"./Alert-a9fb131b.js";import"./index-a6f01dde.js";const Te=(e,a)=>{if(a!==void 0&&(!Array.isArray(a)||a.some(r=>typeof r!="string")))throw new TypeError(`"${e}" option must be an array of strings`);if(a)return new Set(a)},Ae=Te,Ie=async(e,a,r,t)=>{const p=await de(e,a,"verify");ue(e,p);const f=pe(e,p.algorithm);try{return await fe.subtle.verify(f,p,r,t)}catch{return!1}},He=Ie;async function Ne(e,a,r){if(!C(e))throw new d("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new d('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new d("JWS Protected Header incorrect type");if(e.payload===void 0)throw new d("JWS Payload missing");if(typeof e.signature!="string")throw new d("JWS Signature missing or incorrect type");if(e.header!==void 0&&!C(e.header))throw new d("JWS Unprotected Header incorrect type");let t={};if(e.protected)try{const x=P(e.protected);t=JSON.parse(E.decode(x))}catch{throw new d("JWS Protected Header is invalid")}if(!ye(t,e.header))throw new d("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const p={...t,...e.header},f=me(d,new Map([["b64",!0]]),r?.crit,t,p);let l=!0;if(f.has("b64")&&(l=t.b64,typeof l!="boolean"))throw new d('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=p;if(typeof o!="string"||!o)throw new d('JWS "alg" (Algorithm) Header Parameter missing or invalid');const y=r&&Ae("algorithms",r.algorithms);if(y&&!y.has(o))throw new he('"alg" (Algorithm) Header Parameter value not allowed');if(l){if(typeof e.payload!="string")throw new d("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new d("JWS Payload must be a string or an Uint8Array instance");let m=!1;typeof a=="function"?(a=await a(t,e),m=!0,G(o,a,"verify"),we(a)&&(a=await z(a,o))):G(o,a,"verify");const i=be(A.encode(e.protected??""),A.encode("."),typeof e.payload=="string"?A.encode(e.payload):e.payload);let n;try{n=P(e.signature)}catch{throw new d("Failed to base64url decode the signature")}if(!await He(o,a,n,i))throw new _e;let s;if(l)try{s=P(e.payload)}catch{throw new d("Failed to base64url decode the payload")}else typeof e.payload=="string"?s=A.encode(e.payload):s=e.payload;const c={payload:s};return e.protected!==void 0&&(c.protectedHeader=t),e.header!==void 0&&(c.unprotectedHeader=e.header),m?{...c,key:a}:c}async function Pe(e,a,r){if(e instanceof Uint8Array&&(e=E.decode(e)),typeof e!="string")throw new d("Compact JWS must be a string or Uint8Array");const{0:t,1:p,2:f,length:l}=e.split(".");if(l!==3)throw new d("Invalid Compact JWS");const o=await Ne({payload:p,protected:t,signature:f},a,r),y={payload:o.payload,protectedHeader:o.protectedHeader};return typeof a=="function"?{...y,key:o.key}:y}const L=e=>e.toLowerCase().replace(/^application\//,""),Ke=(e,a)=>typeof e=="string"?a.includes(e):Array.isArray(e)?a.some(Set.prototype.has.bind(new Set(e))):!1,Ce=(e,a,r={})=>{let t;try{t=JSON.parse(E.decode(a))}catch{}if(!C(t))throw new Q("JWT Claims Set must be a top-level JSON object");const{typ:p}=r;if(p&&(typeof e.typ!="string"||L(e.typ)!==L(p)))throw new b('unexpected "typ" JWT header value',t,"typ","check_failed");const{requiredClaims:f=[],issuer:l,subject:o,audience:y,maxTokenAge:m}=r,i=[...f];m!==void 0&&i.push("iat"),y!==void 0&&i.push("aud"),o!==void 0&&i.push("sub"),l!==void 0&&i.push("iss");for(const c of new Set(i.reverse()))if(!(c in t))throw new b(`missing required "${c}" claim`,t,c,"missing");if(l&&!(Array.isArray(l)?l:[l]).includes(t.iss))throw new b('unexpected "iss" claim value',t,"iss","check_failed");if(o&&t.sub!==o)throw new b('unexpected "sub" claim value',t,"sub","check_failed");if(y&&!Ke(t.aud,typeof y=="string"?[y]:y))throw new b('unexpected "aud" claim value',t,"aud","check_failed");let n;switch(typeof r.clockTolerance){case"string":n=R(r.clockTolerance);break;case"number":n=r.clockTolerance;break;case"undefined":n=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:h}=r,s=ge(h||new Date);if((t.iat!==void 0||m)&&typeof t.iat!="number")throw new b('"iat" claim must be a number',t,"iat","invalid");if(t.nbf!==void 0){if(typeof t.nbf!="number")throw new b('"nbf" claim must be a number',t,"nbf","invalid");if(t.nbf>s+n)throw new b('"nbf" claim timestamp check failed',t,"nbf","check_failed")}if(t.exp!==void 0){if(typeof t.exp!="number")throw new b('"exp" claim must be a number',t,"exp","invalid");if(t.exp<=s-n)throw new $('"exp" claim timestamp check failed',t,"exp","check_failed")}if(m){const c=s-t.iat,x=typeof m=="number"?m:R(m);if(c-n>x)throw new $('"iat" claim timestamp check failed (too far in the past)',t,"iat","check_failed");if(c<0-n)throw new b('"iat" claim timestamp check failed (it should be in the past)',t,"iat","check_failed")}return t};async function K(e,a,r){const t=await Pe(e,a,r);if(t.protectedHeader.crit?.includes("b64")&&t.protectedHeader.b64===!1)throw new Q("JWTs MUST NOT use unencoded payload");const f={payload:Ce(t.protectedHeader,t.payload,r),protectedHeader:t.protectedHeader};return typeof a=="function"?{...f,key:t.key}:f}const Ee={colspan:"2",class:"table-header"},Ve={class:"claims"},Ue={"font-bold":""},Oe={key:0,"ml-2":"","op-70":""},je={key:0,"ml-2":"","op-70":""},Fe=Y({__name:"jwt-parser",setup(e){const{t:a}=Z(),r=I("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"),t=ee(()=>Je(()=>q({jwt:r.value}),{header:[],payload:[]})),p=[{key:"header",title:"Header"},{key:"payload",title:"Payload"}],f=te({source:r,rules:[{validator:i=>i.length>0&&xe(()=>q({jwt:r.value})),message:a("tools.jwt-parser.texts.message-invalid-jwt")}]}),l=I(""),o=I("text"),y=[{label:a("tools.jwt-parser.texts.label-jwk"),value:"jwk"},{label:a("tools.jwt-parser.texts.label-pub-key"),value:"key"},{label:a("tools.jwt-parser.texts.label-secret-raw-text"),value:"text"},{label:a("tools.jwt-parser.texts.label-secret-hex-array"),value:"hex"},{label:a("tools.jwt-parser.texts.label-secret-base64"),value:"base64"}],m=ae(async()=>{const i=l.value?.trim();if(!i)return{error:"No secret or key provided"};const n=r.value?.trim();if(!n)return{error:"No JWT token provided"};try{const h=ve({jwt:n})||"unk";if(o.value==="jwk"||i.startsWith("{")){const s=re.parse(i),c=await z(s,h);await K(n,c)}else if(o.value==="key"||i.includes("-----BEGIN PUBLIC KEY-----")){const s=await ke(i,h);await K(n,s)}else{let s;try{switch(o.value){case"text":s=new TextEncoder().encode(i);break;case"hex":s=ce.fromString(i);break;case"base64":if(!D.isValid(i))throw new Error(a("tools.jwt-generator.texts.invalid-base64-string"));s=D.toUint8Array(i);break}}catch(c){throw new Error(a("tools.jwt-generator.texts.cannot-parse-secret-as-encoding",[i,o.value,c]))}await K(n,s)}return{error:""}}catch(h){return{error:a("tools.jwt-parser.texts.key-or-secret-or-verification-error-e-tostring",[h.toString()])}}});return(i,n)=>{const h=oe,s=Se,c=ne,x=ie,X=We,V=se;return w(),W(V,null,{default:J(()=>[T(h,{value:u(r),"onUpdate:value":n[0]||(n[0]=_=>H(r)?r.value=_:null),label:u(a)("tools.jwt-parser.texts.label-jwt-to-decode"),validation:u(f),placeholder:u(a)("tools.jwt-parser.texts.placeholder-put-your-token-here"),rows:"5",multiline:"","raw-text":"",autofocus:"","mb-3":""},null,8,["value","label","validation","placeholder"]),u(f).isValid?(w(),W(s,{key:0},{default:J(()=>[v("tbody",null,[(w(),k(N,null,M(p,_=>(w(),k(N,{key:_.key},[v("th",Ee,g(_.title),1),(w(!0),k(N,null,M(u(t)[_.key],({claim:U,claimDescription:O,friendlyValue:j,value:F})=>(w(),k("tr",{key:U+F},[v("td",Ve,[v("span",Ue,g(U),1),O?(w(),k("span",Oe," ("+g(O)+") ",1)):S("",!0)]),v("td",null,[v("span",null,g(F),1),j?(w(),k("span",je," ("+g(j)+") ",1)):S("",!0)])]))),128))],64))),64))])]),_:1})):S("",!0),T(V,{title:u(a)("tools.jwt-parser.texts.title-signature-validation")},{default:J(()=>[T(c,{value:u(o),"onUpdate:value":n[1]||(n[1]=_=>H(o)?o.value=_:null),"label-placement":"left",label:u(a)("tools.jwt-parser.texts.label-secret-encoding"),options:y,"mb-2":""},null,8,["value","label"]),T(h,{value:u(l),"onUpdate:value":n[2]||(n[2]=_=>H(l)?l.value=_:null),label:u(a)("tools.jwt-parser.texts.label-secret-or-public-key-spki-or-jwk"),placeholder:u(a)("tools.jwt-parser.texts.placeholder-put-your-secret-or-public-key-here"),rows:"5",multiline:"","raw-text":"",autofocus:"","mb-3":""},null,8,["value","label","placeholder"]),u(m)?.error?(w(),W(x,{key:0},{default:J(()=>[B(g(u(m).error),1)]),_:1})):S("",!0),u(m)?.error?S("",!0):(w(),W(X,{key:1,type:"success"},{default:J(()=>[B(g(u(a)("tools.jwt-parser.texts.tag-signature-verified")),1)]),_:1}))]),_:1},8,["title"])]),_:1})}}});const Qe=le(Fe,[["__scopeId","data-v-527c96ee"]]);export{Qe as default};
