import{c as B,i as I}from"./style-CNx3HTbi.js";import"./version-D4ympJL5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-ODFatrFN.js";import{f as F,r as S,e as D}from"./main-Dqs2Ohqn.js";import{i as R}from"./shortcuts-init-C3Q6CKFj.js";import"./mobileMenu-BoMunYmR.js";let h=null,l=null,v=!1,c=null;const g=document.getElementById("pdfFile"),u=document.getElementById("fileList"),i=document.getElementById("stamp-viewer-container"),w=document.getElementById("viewer-card"),f=document.getElementById("save-stamped-btn"),E=document.getElementById("back-to-tools"),m=document.getElementById("tool-uploader"),C=document.getElementById("stamp-username");function L(){h=null,c&&(URL.revokeObjectURL(c),c=null),l&&i&&l.parentElement===i&&i.removeChild(l),l=null,v=!1,w&&w.classList.add("hidden"),f&&f.classList.add("hidden"),i&&(i.style.height="",i.style.aspectRatio="");const t=localStorage.getItem("fullWidthMode")!=="false";m&&!t&&(m.classList.remove("max-w-6xl"),m.classList.add("max-w-2xl")),x(),g&&(g.value="")}function x(){if(!h){u.classList.add("hidden"),u.innerHTML="";return}u.classList.remove("hidden"),u.innerHTML="";const t=localStorage.getItem("fullWidthMode")!=="false";m&&!t&&(m.classList.remove("max-w-2xl"),m.classList.add("max-w-6xl"));const e=document.createElement("div");e.className="bg-gray-700 p-3 rounded-lg border border-gray-600 hover:border-indigo-500 transition-colors";const n=document.createElement("div");n.className="flex items-center justify-between";const o=document.createElement("div");o.className="flex-1 min-w-0";const s=document.createElement("p");s.className="truncate font-medium text-white",s.textContent=h.name;const a=document.createElement("p");a.className="text-gray-400 text-sm",a.textContent=F(h.size),o.append(s,a);const r=document.createElement("button");r.className="text-red-400 hover:text-red-300 p-2 flex-shrink-0 ml-2",r.title="Remove file",r.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',r.onclick=p=>{p.stopPropagation(),L()},n.append(o,r),e.appendChild(n),u.appendChild(e),B({icons:I})}async function k(t){if(i)try{const e=await t.arrayBuffer(),a=(await(await D({data:e}).promise).getPage(1)).getViewport({scale:1}),r=a.width/(a.height+50);i.style.height="auto",i.style.aspectRatio=`${r}`}catch(e){console.error("Error adjusting viewer height:",e),i.style.height="70vh"}}async function U(t){if(!i)return;w&&w.classList.remove("hidden"),l&&l.parentElement===i&&i.removeChild(l),c&&(URL.revokeObjectURL(c),c=null),l=null,v=!1,await k(t);const e=await S(t),n=new Blob([e],{type:"application/pdf"});c=URL.createObjectURL(n);try{const p=localStorage.getItem("pdfjs.preferences"),y=p?JSON.parse(p):{};delete y.annotationEditorMode;const P={...y,enablePermissions:!1};localStorage.setItem("pdfjs.preferences",JSON.stringify(P))}catch{}const o=document.createElement("iframe");o.className="w-full h-full border-0",o.allowFullscreen=!0;const s=new URL("/bentopdf/pdfjs-annotation-viewer/web/viewer.html",window.location.origin),a=C?.value?.trim()||"",r=a?`#ae_username=${encodeURIComponent(a)}`:"";o.src=`${s.toString()}?file=${encodeURIComponent(c)}${r}`,o.addEventListener("load",()=>{j(o)}),i.appendChild(o),l=o}function j(t){try{const e=t.contentWindow,n=e?.document;if(!e||!n)return;(async()=>{try{const s=e.PDFViewerApplication;s?.initializedPromise&&await s.initializedPromise;const a=s?.eventBus;a&&typeof a._on=="function"&&a._on("annotationeditoruimanager",()=>{try{n.getElementById("editorStampButton")?.click()}catch{}});const r=n.querySelector(".PdfjsAnnotationExtension");r&&r.classList.add("PdfjsAnnotationExtension_Comment_hidden"),v=!0}catch(s){console.error("Failed to initialize annotation viewer for Add Stamps:",s)}})()}catch(e){console.error("Error wiring Add Stamps viewer:",e)}}async function b(t){h=t,x(),f&&f.classList.remove("hidden"),await U(t)}g&&g.addEventListener("change",async t=>{const e=t.target;if(e.files&&e.files.length>0){const n=e.files[0];await b(n)}});const d=document.getElementById("drop-zone");d&&(d.addEventListener("dragover",t=>{t.preventDefault(),d.classList.add("border-indigo-500")}),d.addEventListener("dragleave",()=>{d.classList.remove("border-indigo-500")}),d.addEventListener("drop",async t=>{t.preventDefault(),d.classList.remove("border-indigo-500");const e=t.dataTransfer?.files[0];e&&e.type==="application/pdf"&&await b(e)}));f&&f.addEventListener("click",()=>{if(!l){alert("Viewer not ready. Please upload a PDF and wait for it to finish loading.");return}try{const e=l.contentWindow?.pdfjsAnnotationExtensionInstance;if(e&&typeof e.exportPdf=="function"){const n=e.exportPdf();n&&typeof n.then=="function"&&n.then(()=>{setTimeout(()=>L(),500)}).catch(o=>{console.error("Error while exporting stamped PDF via annotation extension:",o)});return}alert("Could not access the stamped-PDF exporter. Please use the Export → PDF button in the viewer toolbar as a fallback.")}catch(t){console.error("Failed to trigger stamped PDF export:",t),alert("Could not export the stamped PDF. Please use the Export → PDF button in the viewer toolbar as a fallback.")}});E&&E.addEventListener("click",()=>{window.location.href="/bentopdf/"});R();
