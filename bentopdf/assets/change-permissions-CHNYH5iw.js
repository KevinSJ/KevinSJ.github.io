import{c as S,i as b}from"./style-CYUbkObH.js";import"./version-BHeJdyYx.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-Q5E4PlzL.js";import{a as m,i as A,r as k,d as C,f as M}from"./main-DWubsKaN.js";import"./mobileMenu-BoMunYmR.js";const f={file:null};function E(){f.file=null;const n=document.getElementById("file-display-area");n&&(n.innerHTML="");const e=document.getElementById("tool-options");e&&e.classList.add("hidden");const c=document.getElementById("file-input");c&&(c.value="");const a=document.getElementById("current-password");a&&(a.value="");const t=document.getElementById("new-user-password");t&&(t.value="");const o=document.getElementById("new-owner-password");o&&(o.value="")}async function O(){const n=document.getElementById("file-display-area"),e=document.getElementById("tool-options");if(n)if(n.innerHTML="",f.file){const c=document.createElement("div");c.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const a=document.createElement("div");a.className="flex flex-col overflow-hidden";const t=document.createElement("div");t.className="truncate font-medium text-gray-200 text-sm mb-1",t.textContent=f.file.name;const o=document.createElement("div");o.className="text-xs text-gray-400",o.textContent=M(f.file.size),a.append(t,o);const s=document.createElement("button");s.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",s.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',s.onclick=function(){E()},c.append(a,s),n.appendChild(c),S({icons:b}),e&&e.classList.remove("hidden")}else e&&e.classList.add("hidden")}function h(n){if(n&&n.length>0){const e=n[0];(e.type==="application/pdf"||e.name.toLowerCase().endsWith(".pdf"))&&(f.file=e,O())}}async function R(){if(!f.file){m("No File","Please upload a PDF file first.");return}const n=document.getElementById("current-password")?.value||"",e=document.getElementById("new-user-password")?.value||"",c=document.getElementById("new-owner-password")?.value||"",a="/input.pdf",t="/output.pdf";let o;const s=document.getElementById("loader-modal"),r=document.getElementById("loader-text");try{s&&s.classList.remove("hidden"),r&&(r.textContent="Initializing..."),o=await A(),r&&(r.textContent="Reading PDF...");const d=await k(f.file),I=new Uint8Array(d);o.FS.writeFile(a,I),r&&(r.textContent="Processing PDF permissions...");const i=[a];n&&i.push("--password="+n);const w=e||c;if(w){const u=e,l=c;i.push("--encrypt",u,l,"256");const P=document.getElementById("allow-printing")?.checked,B=document.getElementById("allow-copying")?.checked,y=document.getElementById("allow-modifying")?.checked,F=document.getElementById("allow-annotating")?.checked,x=document.getElementById("allow-filling-forms")?.checked,D=document.getElementById("allow-document-assembly")?.checked,L=document.getElementById("allow-page-extraction")?.checked;l?(y||i.push("--modify=none"),B||i.push("--extract=n"),P||i.push("--print=none"),F||i.push("--annotate=n"),D||i.push("--assemble=n"),x||i.push("--form=n"),L||i.push("--extract=n"),y||i.push("--modify-other=n")):u&&i.push("--allow-insecure")}else i.push("--decrypt");i.push("--",t);try{o.callMain(i)}catch(u){console.error("qpdf execution error:",u);const l=u.message||"";throw l.includes("invalid password")||l.includes("incorrect password")||l.includes("password")?new Error("INVALID_PASSWORD"):l.includes("encrypted")||l.includes("password required")?new Error("PASSWORD_REQUIRED"):new Error("Processing failed: "+l||"Unknown error")}r&&(r.textContent="Preparing download...");const p=o.FS.readFile(t,{encoding:"binary"});if(!p||p.length===0)throw new Error("Processing resulted in an empty file.");const v=new Blob([p],{type:"application/pdf"});C(v,`permissions-changed-${f.file.name}`),s&&s.classList.add("hidden");let g="PDF permissions changed successfully!";w||(g="PDF decrypted successfully! All encryption and restrictions removed."),m("Success",g,"success",()=>{E()})}catch(d){console.error("Error during PDF permission change:",d),s&&s.classList.add("hidden"),d.message==="INVALID_PASSWORD"?m("Incorrect Password","The current password you entered is incorrect. Please try again."):d.message==="PASSWORD_REQUIRED"?m("Password Required","This PDF is password-protected. Please enter the current password to proceed."):m("Processing Failed",`An error occurred: ${d.message||"The PDF might be corrupted or password protected."}`)}finally{try{if(o?.FS){try{o.FS.unlink(a)}catch{}try{o.FS.unlink(t)}catch{}}}catch(d){console.warn("Failed to cleanup WASM FS:",d)}}}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("file-input"),e=document.getElementById("drop-zone"),c=document.getElementById("process-btn"),a=document.getElementById("back-to-tools");a&&a.addEventListener("click",function(){window.location.href="/bentopdf/"}),n&&e&&(n.addEventListener("change",function(t){h(t.target.files)}),e.addEventListener("dragover",function(t){t.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",function(t){t.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",function(t){t.preventDefault(),e.classList.remove("bg-gray-700");const o=t.dataTransfer?.files;if(o&&o.length>0){const s=Array.from(o).filter(function(r){return r.type==="application/pdf"||r.name.toLowerCase().endsWith(".pdf")});if(s.length>0){const r=new DataTransfer;r.items.add(s[0]),h(r.files)}}}),n.addEventListener("click",function(){n.value=""})),c&&c.addEventListener("click",R)});
