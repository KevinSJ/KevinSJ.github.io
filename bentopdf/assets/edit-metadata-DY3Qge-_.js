import{c as x,i as L}from"./style-CNx3HTbi.js";import"./version-D4ympJL5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-ODFatrFN.js";import{a as g,f as h,b as S,P,h as D,x as w,B as T,d as K}from"./main-Dqs2Ohqn.js";import"./mobileMenu-BoMunYmR.js";const e={file:null,pdfDoc:null};function v(){e.file=null,e.pdfDoc=null;const t=document.getElementById("file-display-area");t&&(t.innerHTML="");const n=document.getElementById("tool-options");n&&n.classList.add("hidden");const r=document.getElementById("file-input");r&&(r.value=""),["meta-title","meta-author","meta-subject","meta-keywords","meta-creator","meta-producer","meta-creation-date","meta-mod-date"].forEach(function(o){const a=document.getElementById(o);a&&(a.value="")});const c=document.getElementById("custom-fields-container");c&&(c.innerHTML="")}function B(t){if(!t)return"";try{const n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0"),c=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return`${n}-${r}-${d}T${c}:${o}`}catch{return""}}function C(t="",n=""){const r=document.getElementById("custom-fields-container");if(!r)return;const d=document.createElement("div");d.className="flex flex-col gap-2";const c=document.createElement("input");c.type="text",c.placeholder="Key (e.g., Department)",c.value=t,c.className="custom-meta-key w-full bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 p-2.5";const o=document.createElement("input");o.type="text",o.placeholder="Value (e.g., Marketing)",o.value=n,o.className="custom-meta-value w-full bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 p-2.5";const a=document.createElement("button");a.type="button",a.className="text-red-400 hover:text-red-300 p-2 self-center",a.innerHTML='<i data-lucide="trash-2" class="w-5 h-5"></i>',a.onclick=function(){d.remove()},d.append(c,o,a),r.appendChild(d),x({icons:L})}function j(){if(!e.pdfDoc)return;const t=document.getElementById("meta-title"),n=document.getElementById("meta-author"),r=document.getElementById("meta-subject"),d=document.getElementById("meta-keywords"),c=document.getElementById("meta-creator"),o=document.getElementById("meta-producer"),a=document.getElementById("meta-creation-date"),i=document.getElementById("meta-mod-date");t&&(t.value=e.pdfDoc.getTitle()||""),n&&(n.value=e.pdfDoc.getAuthor()||""),r&&(r.value=e.pdfDoc.getSubject()||""),d&&(d.value=e.pdfDoc.getKeywords()||""),c&&(c.value=e.pdfDoc.getCreator()||""),o&&(o.value=e.pdfDoc.getProducer()||""),a&&(a.value=B(e.pdfDoc.getCreationDate())),i&&(i.value=B(e.pdfDoc.getModificationDate()));const s=document.getElementById("custom-fields-container");s&&(s.innerHTML="");try{const u=e.pdfDoc.getInfoDict(),y=new Set(["Title","Author","Subject","Keywords","Creator","Producer","CreationDate","ModDate"]);u.keys().map(function(m){return m.asString().substring(1)}).forEach(function(m){if(!y.has(m)){const l=u.lookup(m);let p="";l&&typeof l.decodeText=="function"?p=l.decodeText():l&&typeof l.asString=="function"?p=l.asString():l&&(p=String(l)),C(m,p)}})}catch(u){console.warn("Could not read custom metadata fields:",u)}}async function A(){const t=document.getElementById("file-display-area"),n=document.getElementById("tool-options");if(t)if(t.innerHTML="",e.file){const r=document.createElement("div");r.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const d=document.createElement("div");d.className="flex flex-col overflow-hidden";const c=document.createElement("div");c.className="truncate font-medium text-gray-200 text-sm mb-1",c.textContent=e.file.name;const o=document.createElement("div");o.className="text-xs text-gray-400",o.textContent=`${h(e.file.size)} • Loading...`,d.append(c,o);const a=document.createElement("button");a.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",a.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',a.onclick=function(){v()},r.append(d,a),t.appendChild(r),x({icons:L});try{S("Loading PDF...");const i=await e.file.arrayBuffer();e.pdfDoc=await P.load(i,{ignoreEncryption:!0,throwOnInvalidObject:!1}),D();const s=e.pdfDoc.getPageCount();o.textContent=`${h(e.file.size)} • ${s} pages`,j(),n&&n.classList.remove("hidden")}catch(i){console.error("Error loading PDF:",i),D(),g("Error","Failed to load PDF file."),v()}}else n&&n.classList.add("hidden")}async function N(){if(!e.pdfDoc||!e.file){g("Error","Please upload a PDF first.");return}S("Updating metadata...");try{const t=document.getElementById("meta-title"),n=document.getElementById("meta-author"),r=document.getElementById("meta-subject"),d=document.getElementById("meta-keywords"),c=document.getElementById("meta-creator"),o=document.getElementById("meta-producer"),a=document.getElementById("meta-creation-date"),i=document.getElementById("meta-mod-date");e.pdfDoc.setTitle(t.value),e.pdfDoc.setAuthor(n.value),e.pdfDoc.setSubject(r.value),e.pdfDoc.setCreator(c.value),e.pdfDoc.setProducer(o.value);const s=d.value;e.pdfDoc.setKeywords(s.split(",").map(function(f){return f.trim()}).filter(Boolean)),a.value&&e.pdfDoc.setCreationDate(new Date(a.value)),i.value?e.pdfDoc.setModificationDate(new Date(i.value)):e.pdfDoc.setModificationDate(new Date);const u=e.pdfDoc.getInfoDict(),y=new Set(["Title","Author","Subject","Keywords","Creator","Producer","CreationDate","ModDate"]);u.keys().map(function(f){return f.asString().substring(1)}).forEach(function(f){y.has(f)||u.delete(w.of(f))});const m=document.querySelectorAll(".custom-meta-key"),l=document.querySelectorAll(".custom-meta-value");m.forEach(function(f,M){const E=f.value.trim(),I=l[M].value.trim();E&&I&&u.set(w.of(E),T.of(I))});const p=await e.pdfDoc.save(),F=e.file.name.replace(/\.pdf$/i,"");K(new Blob([new Uint8Array(p)],{type:"application/pdf"}),`${F}_metadata-edited.pdf`),g("Success","Metadata updated successfully!","success",function(){v()})}catch(t){console.error(t),g("Error","Could not update metadata. Please check that date formats are correct.")}finally{D()}}function b(t){if(t&&t.length>0){const n=t[0];(n.type==="application/pdf"||n.name.toLowerCase().endsWith(".pdf"))&&(e.file=n,A())}}document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("file-input"),n=document.getElementById("drop-zone"),r=document.getElementById("process-btn"),d=document.getElementById("back-to-tools"),c=document.getElementById("add-custom-field");d&&d.addEventListener("click",function(){window.location.href="/bentopdf/"}),c&&c.addEventListener("click",function(){C()}),t&&n&&(t.addEventListener("change",function(o){b(o.target.files)}),n.addEventListener("dragover",function(o){o.preventDefault(),n.classList.add("bg-gray-700")}),n.addEventListener("dragleave",function(o){o.preventDefault(),n.classList.remove("bg-gray-700")}),n.addEventListener("drop",function(o){o.preventDefault(),n.classList.remove("bg-gray-700");const a=o.dataTransfer?.files;if(a&&a.length>0){const i=Array.from(a).filter(function(s){return s.type==="application/pdf"||s.name.toLowerCase().endsWith(".pdf")});if(i.length>0){const s=new DataTransfer;s.items.add(i[0]),b(s.files)}}}),t.addEventListener("click",function(){t.value=""})),r&&r.addEventListener("click",N)});
