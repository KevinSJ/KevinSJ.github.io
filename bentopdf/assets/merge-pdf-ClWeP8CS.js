import{c as C,i as T}from"./style-CYUbkObH.js";import"./version-BHeJdyYx.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-Q5E4PlzL.js";import{G as H,s as d,b as N,a as y,h as b,d as A,r as z,e as R,k as S,l as j,m as O}from"./main-DWubsKaN.js";import"./mobileMenu-BoMunYmR.js";H.workerSrc=new URL("/bentopdf/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();const n={pdfDocs:{},pdfBytes:{},activeMode:"file",sortableInstances:{},isRendering:!1,cachedThumbnails:null,lastFileHash:null,mergeSuccess:!1},M=new Worker("/bentopdf/workers/merge.worker.js");function U(){const e=document.getElementById("file-list");e&&(n.sortableInstances.fileList&&n.sortableInstances.fileList.destroy(),n.sortableInstances.fileList=S.create(e,{handle:".drag-handle",animation:150,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",onStart:function(r){r.item.style.opacity="0.5"},onEnd:function(r){r.item.style.opacity="1"}}))}function k(){const e=document.getElementById("page-merge-preview");e&&(n.sortableInstances.pageThumbnails&&n.sortableInstances.pageThumbnails.destroy(),n.sortableInstances.pageThumbnails=S.create(e,{animation:150,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",onStart:function(r){r.item.style.opacity="0.5"},onEnd:function(r){r.item.style.opacity="1"}}))}function Z(){return d.files.map(e=>`${e.name}-${e.size}-${e.lastModified}`).join("|")}async function D(){const e=document.getElementById("page-merge-preview");if(!e)return;const r=Z();if(!(r!==n.lastFileHash)&&n.cachedThumbnails!==null&&e.firstChild){k();return}if(n.isRendering)return;n.isRendering=!0,e.textContent="",j();let m=0;for(const a of d.files){const l=n.pdfDocs[a.name];l&&(m+=l.numPages)}try{let a=0;const l=(o,t,s)=>{const i=document.createElement("div");i.className="page-thumbnail relative cursor-move flex flex-col items-center gap-1 p-2 border-2 border-gray-600 hover:border-indigo-500 rounded-lg bg-gray-700 transition-colors",i.dataset.fileName=s||"",i.dataset.pageIndex=(t-1).toString();const g=document.createElement("div");g.className="relative";const f=document.createElement("img");f.src=o.toDataURL(),f.className="rounded-md shadow-md max-w-full h-auto";const p=document.createElement("div");p.className="absolute top-1 left-1 bg-indigo-600 text-white text-xs px-2 py-1 rounded-md font-semibold shadow-lg",p.textContent=t.toString(),g.append(f,p);const u=document.createElement("p");u.className="text-xs text-gray-400 truncate w-full text-center";const h=s?`${s} (page ${t})`:`Page ${t}`;return u.title=h,u.textContent=s?`${s.substring(0,10)}... (p${t})`:`Page ${t}`,i.append(g,u),i};for(const o of d.files){const t=n.pdfDocs[o.name];if(!t)continue;await O(t,e,(i,g)=>l(i,g,o.name),{batchSize:8,useLazyLoading:!0,lazyLoadMargin:"300px",onProgress:(i,g)=>{a++,N("Rendering page previews...")},onBatchComplete:()=>{C({icons:T})}})}n.cachedThumbnails=!0,n.lastFileHash=r,k()}catch(a){console.error("Error rendering page thumbnails:",a),y("Error","Failed to render page thumbnails")}finally{b(),n.isRendering=!1}}const x=async()=>{const e=document.getElementById("file-controls"),r=document.getElementById("merge-options");if(d.files.length>0)e&&e.classList.remove("hidden"),r&&r.classList.remove("hidden"),await J();else{e&&e.classList.add("hidden"),r&&r.classList.add("hidden");const c=document.getElementById("file-list");c&&(c.innerHTML="")}},_=async()=>{d.files=[],d.pdfDoc=null,n.pdfDocs={},n.pdfBytes={},n.activeMode="file",n.cachedThumbnails=null,n.lastFileHash=null,n.mergeSuccess=!1;const e=document.getElementById("file-list");e&&(e.innerHTML="");const r=document.getElementById("page-merge-preview");r&&(r.innerHTML="");const c=document.getElementById("file-mode-btn"),m=document.getElementById("page-mode-btn"),a=document.getElementById("file-mode-panel"),l=document.getElementById("page-mode-panel");c&&m&&a&&l&&(c.classList.add("bg-indigo-600","text-white"),c.classList.remove("bg-gray-700","text-gray-300"),m.classList.remove("bg-indigo-600","text-white"),m.classList.add("bg-gray-700","text-gray-300"),a.classList.remove("hidden"),l.classList.add("hidden")),await x()};async function G(){N("Merging PDFs...");try{const e=[],r=[],c=new Set;if(n.activeMode==="file"){const a=document.getElementById("file-list");if(!a)throw new Error("File list not found");const l=Array.from(a.children).map(o=>d.files.find(t=>t.name===o.dataset.fileName)).filter(Boolean);for(const o of l){if(!o)continue;const t=o.name.replace(/[^a-zA-Z0-9]/g,"_"),s=document.getElementById(`range-${t}`);c.add(o.name),s&&s.value.trim()?e.push({fileName:o.name,rangeType:"specific",rangeString:s.value.trim()}):e.push({fileName:o.name,rangeType:"all"})}}else{const a=document.getElementById("page-merge-preview");if(!a)throw new Error("Page container not found");const l=Array.from(a.children),o=[];for(const t of l){const s=t,i=s.dataset.fileName,g=parseInt(s.dataset.pageIndex||"",10);i&&!isNaN(g)&&(c.add(i),o.push({fileName:i,pageIndex:g}))}for(let t=0;t<o.length;t++){const s=o[t];let i=s.pageIndex;for(;t+1<o.length&&o[t+1].fileName===s.fileName&&o[t+1].pageIndex===i+1;)i++,t++;i===s.pageIndex?e.push({fileName:s.fileName,rangeType:"single",pageIndex:s.pageIndex}):e.push({fileName:s.fileName,rangeType:"range",startPage:s.pageIndex+1,endPage:i+1})}}if(e.length===0){y("Error","No files or pages selected to merge."),b();return}for(const a of c){const l=n.pdfBytes[a];l&&r.push({name:a,data:l})}const m={command:"merge",files:r,jobs:e};M.postMessage(m,r.map(a=>a.data)),M.onmessage=a=>{if(b(),a.data.status==="success"){const l=new Blob([a.data.pdfBytes],{type:"application/pdf"});A(l,"merged.pdf"),n.mergeSuccess=!0,y("Success","PDFs merged successfully!","success",async()=>{await _()})}else console.error("Worker merge error:",a.data.message),y("Error",a.data.message||"Failed to merge PDFs.")},M.onerror=a=>{b(),console.error("Worker error:",a),y("Error","An unexpected error occurred in the merge worker.")}}catch(e){console.error("Merge error:",e),y("Error","Failed to merge PDFs. Please check that all files are valid and not password-protected."),b()}}async function J(){document.getElementById("merge-options")?.classList.remove("hidden");const e=document.getElementById("process-btn");e&&(e.disabled=!1);const r=n.activeMode==="page";N("Loading PDF documents...");try{n.pdfDocs={},n.pdfBytes={};for(const i of d.files){const g=await z(i);n.pdfBytes[i.name]=g;const f=g.slice(0),p=await R({data:f}).promise;n.pdfDocs[i.name]=p}}catch(i){console.error("Error loading PDFs:",i),y("Error","Failed to load one or more PDF files");return}finally{b()}const c=document.getElementById("file-mode-btn"),m=document.getElementById("page-mode-btn"),a=document.getElementById("file-mode-panel"),l=document.getElementById("page-mode-panel"),o=document.getElementById("file-list");if(!c||!m||!a||!l||!o)return;o.textContent="",d.files.forEach((i,g)=>{const f=n.pdfDocs[i.name],p=f?f.numPages:"N/A",u=i.name.replace(/[^a-zA-Z0-9]/g,"_"),h=document.createElement("li");h.className="bg-gray-700 p-3 rounded-lg border border-gray-600 hover:border-indigo-500 transition-colors",h.dataset.fileName=i.name;const B=document.createElement("div");B.className="flex items-center justify-between";const E=document.createElement("span");E.className="truncate font-medium text-white flex-1 mr-2",E.title=i.name,E.textContent=i.name;const I=document.createElement("div");I.className="drag-handle cursor-move text-gray-400 hover:text-white p-1 rounded transition-colors",I.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="5" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="19" r="1"/></svg>',B.append(E,I);const P=document.createElement("div");P.className="mt-2 flex items-center gap-2";const F=document.createElement("div");F.className="flex-1";const w=document.createElement("label");w.htmlFor=`range-${u}`,w.className="text-xs text-gray-400",w.textContent=`Pages (e.g., 1-3, 5) - Total: ${p}`;const v=document.createElement("input");v.type="text",v.id=`range-${u}`,v.className="w-full bg-gray-800 border border-gray-600 text-white rounded-md p-2 text-sm mt-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-colors",v.placeholder="Leave blank for all pages",F.append(w,v);const L=document.createElement("button");L.className="text-red-400 hover:text-red-300 p-2 flex-shrink-0 self-end",L.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',L.title="Remove file",L.onclick=W=>{W.stopPropagation(),d.files=d.files.filter((q,$)=>$!==g),x()},P.append(F,L),h.append(B,P),o.appendChild(h)}),C({icons:T}),U();const t=c.cloneNode(!0),s=m.cloneNode(!0);c.replaceWith(t),m.replaceWith(s),t.addEventListener("click",()=>{n.activeMode!=="file"&&(n.activeMode="file",a.classList.remove("hidden"),l.classList.add("hidden"),t.classList.add("bg-indigo-600","text-white"),t.classList.remove("bg-gray-700","text-gray-300"),s.classList.remove("bg-indigo-600","text-white"),s.classList.add("bg-gray-700","text-gray-300"))}),s.addEventListener("click",async()=>{n.activeMode!=="page"&&(n.activeMode="page",a.classList.add("hidden"),l.classList.remove("hidden"),s.classList.add("bg-indigo-600","text-white"),s.classList.remove("bg-gray-700","text-gray-300"),t.classList.remove("bg-indigo-600","text-white"),t.classList.add("bg-gray-700","text-gray-300"),await D())}),r?(n.activeMode="page",a.classList.add("hidden"),l.classList.remove("hidden"),s.classList.add("bg-indigo-600","text-white"),s.classList.remove("bg-gray-700","text-gray-300"),t.classList.remove("bg-indigo-600","text-white"),t.classList.add("bg-gray-700","text-gray-300"),await D()):(t.classList.add("bg-indigo-600","text-white"),s.classList.add("bg-gray-700","text-gray-300"))}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("file-input"),r=document.getElementById("drop-zone"),c=document.getElementById("process-btn");document.getElementById("file-controls");const m=document.getElementById("add-more-btn"),a=document.getElementById("clear-files-btn"),l=document.getElementById("back-to-tools");document.getElementById("merge-options"),l&&l.addEventListener("click",()=>{window.location.href="/bentopdf/"}),e&&r&&(e.addEventListener("change",async o=>{const t=o.target.files;t&&t.length>0&&(d.files=[...d.files,...Array.from(t)],await x())}),r.addEventListener("dragover",o=>{o.preventDefault(),r.classList.add("bg-gray-700")}),r.addEventListener("dragleave",o=>{o.preventDefault(),r.classList.remove("bg-gray-700")}),r.addEventListener("drop",async o=>{o.preventDefault(),r.classList.remove("bg-gray-700");const t=o.dataTransfer?.files;if(t&&t.length>0){const s=Array.from(t).filter(i=>i.type==="application/pdf"||i.name.toLowerCase().endsWith(".pdf"));s.length>0&&(d.files=[...d.files,...s],await x())}}),e.addEventListener("click",()=>{e.value=""})),m&&m.addEventListener("click",()=>{e.value="",e.click()}),a&&a.addEventListener("click",async()=>{d.files=[],await x()}),c&&c.addEventListener("click",async()=>{await G()})});
