import{i as h,r as g,s,a as o,b as l,h as c,d}from"./main-Dqs2Ohqn.js";import{J as y}from"./jszip.min-DMkQATzN.js";async function w(a){const t="/input.pdf",e="/repaired_form.pdf";let r;try{r=await h();const n=await g(a),f=new Uint8Array(n);r.FS.writeFile(t,f);const u=[t,"--decrypt",e];try{r.callMain(u)}catch(i){console.warn(`QPDF execution warning for ${a.name}:`,i)}let p=null;try{p=r.FS.readFile(e,{encoding:"binary"})}catch(i){console.warn(`Failed to read output for ${a.name}:`,i)}try{try{r.FS.unlink(t)}catch(i){console.warn(i)}try{r.FS.unlink(e)}catch(i){console.warn(i)}}catch(i){console.warn("Cleanup error:",i)}return p}catch(n){return console.error(`Error repairing ${a.name}:`,n),null}}async function P(){if(s.files.length===0){o("No Files","Please select one or more PDF files.");return}const a=[],t=[];try{l("Initializing repair engine...");for(let e=0;e<s.files.length;e++){const r=s.files[e];l(`Repairing ${r.name} (${e+1}/${s.files.length})...`);const n=await w(r);n&&n.length>0?a.push({name:`repaired-${r.name}`,data:n}):t.push(r.name)}if(c(),a.length===0){o("Repair Failed","Unable to repair any of the uploaded PDF files.");return}if(t.length>0){const e=t.join(", ");o("Partial Success",`Repaired ${a.length} file(s). Failed to repair: ${e}`)}if(a.length===1){const e=a[0],r=new Blob([e.data],{type:"application/pdf"});d(r,e.name)}else{l("Creating ZIP archive...");const e=new y;a.forEach(n=>{e.file(n.name,n.data)});const r=await e.generateAsync({type:"blob"});d(r,"repaired_pdfs.zip"),c()}t.length===0&&o("Success","All files repaired successfully!")}catch(e){console.error("Critical error during repair:",e),c(),o("Error","An unexpected error occurred during the repair process.")}}export{w as a,P as r};
