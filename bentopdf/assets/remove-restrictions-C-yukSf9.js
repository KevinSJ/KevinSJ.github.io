import{c as g,i as h}from"./style-CNx3HTbi.js";import"./version-D4ympJL5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-ODFatrFN.js";import{a as u,i as v,r as w,d as E,f as F}from"./main-Dqs2Ohqn.js";import"./mobileMenu-BoMunYmR.js";const s={file:null};function m(){s.file=null;const n=document.getElementById("file-display-area");n&&(n.innerHTML="");const e=document.getElementById("tool-options");e&&e.classList.add("hidden");const a=document.getElementById("file-input");a&&(a.value="");const i=document.getElementById("owner-password-remove");i&&(i.value="")}async function L(){const n=document.getElementById("file-display-area"),e=document.getElementById("tool-options");if(n)if(n.innerHTML="",s.file){const a=document.createElement("div");a.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const i=document.createElement("div");i.className="flex flex-col overflow-hidden";const t=document.createElement("div");t.className="truncate font-medium text-gray-200 text-sm mb-1",t.textContent=s.file.name;const r=document.createElement("div");r.className="text-xs text-gray-400",r.textContent=F(s.file.size),i.append(t,r);const o=document.createElement("button");o.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",o.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',o.onclick=function(){m()},a.append(i,o),n.appendChild(a),g({icons:h}),e&&e.classList.remove("hidden")}else e&&e.classList.add("hidden")}function p(n){if(n&&n.length>0){const e=n[0];(e.type==="application/pdf"||e.name.toLowerCase().endsWith(".pdf"))&&(s.file=e,L())}}async function x(){if(!s.file){u("No File","Please upload a PDF file first.");return}const n=document.getElementById("owner-password-remove")?.value||"",e="/input.pdf",a="/output.pdf";let i;const t=document.getElementById("loader-modal"),r=document.getElementById("loader-text");try{t&&t.classList.remove("hidden"),r&&(r.textContent="Initializing..."),i=await v(),r&&(r.textContent="Reading PDF...");const o=await w(s.file),l=new Uint8Array(o);i.FS.writeFile(e,l),r&&(r.textContent="Removing restrictions...");const c=[e];n&&c.push(`--password=${n}`),c.push("--decrypt","--remove-restrictions","--",a);try{i.callMain(c)}catch(d){throw console.error("qpdf execution error:",d),d.message?.includes("password")||d.message?.includes("encrypt")?new Error("Failed to remove restrictions. The PDF may require the correct owner password."):new Error("Failed to remove restrictions: "+(d.message||"Unknown error"))}r&&(r.textContent="Preparing download...");const f=i.FS.readFile(a,{encoding:"binary"});if(!f||f.length===0)throw new Error("Operation resulted in an empty file.");const y=new Blob([f],{type:"application/pdf"});E(y,`unrestricted-${s.file.name}`),t&&t.classList.add("hidden"),u("Success","PDF restrictions removed successfully! The file is now fully editable and printable.","success",()=>{m()})}catch(o){console.error("Error during restriction removal:",o),t&&t.classList.add("hidden"),u("Operation Failed",`An error occurred: ${o.message||"The PDF might be corrupted or password-protected."}`)}finally{try{if(i?.FS){try{i.FS.unlink(e)}catch(o){console.warn("Failed to unlink input file:",o)}try{i.FS.unlink(a)}catch(o){console.warn("Failed to unlink output file:",o)}}}catch(o){console.warn("Failed to cleanup WASM FS:",o)}}}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("file-input"),e=document.getElementById("drop-zone"),a=document.getElementById("process-btn"),i=document.getElementById("back-to-tools");i&&i.addEventListener("click",function(){window.location.href="/bentopdf/"}),n&&e&&(n.addEventListener("change",function(t){p(t.target.files)}),e.addEventListener("dragover",function(t){t.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",function(t){t.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",function(t){t.preventDefault(),e.classList.remove("bg-gray-700");const r=t.dataTransfer?.files;if(r&&r.length>0){const o=Array.from(r).filter(function(l){return l.type==="application/pdf"||l.name.toLowerCase().endsWith(".pdf")});if(o.length>0){const l=new DataTransfer;l.items.add(o[0]),p(l.files)}}}),n.addEventListener("click",function(){n.value=""})),a&&a.addEventListener("click",x)});
