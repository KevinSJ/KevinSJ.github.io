import{c as Be,i as Se}from"./style-D1FQfXNQ.js";import"./version-Dw8ZKLCV.js";import"./simple-mode-footer-D78rH_WB.js";import{G as tt,P as ze,t as ot,q as W,u as I,T as he,w as B,A as P,d as nt,I as it,c as at,y as U}from"./main-Da82M_MD.js";import{i as rt}from"./shortcuts-init-DIblBrQY.js";import"./mobileMenu-BoMunYmR.js";tt.workerSrc=new URL("/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();let T=[],Y=null,Q=0;const ge=new Set,ee=new Set;let O=null,le=0,de=0,$=[],A=0,V=null,st=null,Ee={width:612,height:792},He=1.333,ne={x:0,y:0},ie=1.333,te=!1,h=null,j=null,ke=0,Fe=0,J=0,X=0,Ie=0,$e=0,q=null;const L=document.getElementById("pdfCanvas"),Te=document.getElementById("propertiesPanel"),lt=document.getElementById("fieldCount"),Me=document.getElementById("upload-area"),Ae=document.getElementById("tool-container"),oe=document.getElementById("dropZone"),dt=document.getElementById("pdfFileInput"),ct=document.getElementById("blankPdfBtn");document.getElementById("pdfUploadInput");const Ue=document.getElementById("pageSizeSelector"),Le=document.getElementById("pageSizeSelect"),We=document.getElementById("customDimensionsInput"),pt=document.getElementById("customWidth"),gt=document.getElementById("customHeight"),ut=document.getElementById("confirmBlankBtn"),mt=document.getElementById("pageIndicator"),Ge=document.getElementById("prevPageBtn"),Ye=document.getElementById("nextPageBtn"),yt=document.getElementById("addPageBtn"),ft=document.getElementById("resetBtn"),bt=document.getElementById("downloadBtn");document.getElementById("back-to-tools");const xe=document.getElementById("gotoPageInput"),ve=document.getElementById("gotoPageBtn"),D=document.getElementById("gridVInput"),R=document.getElementById("gridHInput"),N=document.getElementById("toggleGridBtn"),Ve=document.getElementById("enableGridCheckbox");let ce=2,pe=2,z=!1,_=!0;if(D&&R){D.value="2",R.value="2";const e=()=>{let n=parseInt(D.value)||2,l=parseInt(R.value)||2;n<2&&(n=2,D.value="2"),l<2&&(l=2,R.value="2"),n>14&&(n=14,D.value="14"),l>14&&(l=14,R.value="14"),ce=n,pe=l,z&&_&&re()};D.addEventListener("input",e),R.addEventListener("input",e)}Ve&&Ve.addEventListener("change",e=>{_=e.target.checked,_?(D&&(D.disabled=!1),R&&(R.disabled=!1),N&&(N.disabled=!1),z&&re()):(se(),D&&(D.disabled=!0),R&&(R.disabled=!0),N&&(N.disabled=!0))});N&&N.addEventListener("click",()=>{z=!z,z?(N.classList.add("bg-indigo-600"),N.classList.remove("bg-gray-600"),_&&re()):(N.classList.remove("bg-indigo-600"),N.classList.add("bg-gray-600"),se())});function re(){const e=document.getElementById("pdfGrid");e&&e.remove();const n=document.createElement("div");if(n.id="pdfGrid",n.className="absolute inset-0 pointer-events-none",n.style.zIndex="1",ce>0){const l=L.offsetWidth/ce;for(let o=0;o<=ce;o++){const i=document.createElement("div");i.className="absolute top-0 bottom-0 border-l-2 border-indigo-500 opacity-60",i.style.left=o*l+"px",n.appendChild(i)}}if(pe>0){const l=L.offsetHeight/pe;for(let o=0;o<=pe;o++){const i=document.createElement("div");i.className="absolute left-0 right-0 border-t-2 border-indigo-500 opacity-60",i.style.top=o*l+"px",n.appendChild(i)}}L.insertBefore(n,L.firstChild)}function se(){const e=document.getElementById("pdfGrid");e&&e.remove()}ve&&xe&&(ve.addEventListener("click",()=>{const e=parseInt(xe.value);!isNaN(e)&&e>=1&&e<=$.length?(A=e-1,Re(),be()):alert(`Please enter a valid page number between 1 and ${$.length}`)}),xe.addEventListener("keydown",e=>{e.key==="Enter"&&ve.click()}));const ue=document.querySelectorAll(".tool-item");ue.forEach(e=>{e.addEventListener("dragstart",i=>{if(i instanceof DragEvent&&i.dataTransfer){i.dataTransfer.effectAllowed="copy";const s=e.dataset.type||"text";i.dataTransfer.setData("text/plain",s),_&&re()}}),e.addEventListener("dragend",()=>{!z&&_&&se()}),e.addEventListener("click",()=>{const i=e.dataset.type||"text";q===i?(q=null,e.classList.remove("ring-2","ring-indigo-400","bg-indigo-600"),L.style.cursor="default"):(q&&ue.forEach(s=>s.classList.remove("ring-2","ring-indigo-400","bg-indigo-600")),q=i,e.classList.add("ring-2","ring-indigo-400","bg-indigo-600"),L.style.cursor="crosshair")});let n=0,l=0,o=!1;e.addEventListener("touchstart",i=>{const s=i.touches[0];n=s.clientX,l=s.clientY,o=!1}),e.addEventListener("touchmove",i=>{i.preventDefault();const s=i.touches[0],b=Math.abs(s.clientX-n),c=Math.abs(s.clientY-l);(b>10||c>10)&&(o=!0)}),e.addEventListener("touchend",i=>{if(i.preventDefault(),!o){e.click();return}const s=i.changedTouches[0],b=L.getBoundingClientRect();if(s.clientX>=b.left&&s.clientX<=b.right&&s.clientY>=b.top&&s.clientY<=b.bottom){const c=s.clientX-b.left-75,u=s.clientY-b.top-15,t=e.dataset.type||"text";Pe(t,c,u)}})});L.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")});L.addEventListener("drop",e=>{e.preventDefault(),z||se();const n=L.getBoundingClientRect(),l=e.clientX-n.left-75,o=e.clientY-n.top-15,i=e.dataTransfer?.getData("text/plain")||"text";Pe(i,l,o)});L.addEventListener("click",e=>{if(q){const n=L.getBoundingClientRect(),l=e.clientX-n.left-75,o=e.clientY-n.top-15;Pe(q,l,o),ue.forEach(i=>i.classList.remove("ring-2","ring-indigo-400","bg-indigo-600")),q=null,L.style.cursor="default";return}e.target===L&&ye()});function Pe(e,n,l){Q++;const o={id:`field_${Q}`,type:e,x:Math.max(0,Math.min(n,666)),y:Math.max(0,Math.min(l,1026)),width:e==="checkbox"||e==="radio"?30:150,height:30,name:`${e.charAt(0).toUpperCase()+e.slice(1)}_${Q}`,defaultValue:"",fontSize:12,alignment:"left",textColor:"#000000",required:!1,readOnly:!1,tooltip:"",combCells:0,maxLength:0,options:e==="dropdown"||e==="optionlist"?["Option 1","Option 2","Option 3"]:void 0,checked:e==="radio"||e==="checkbox"?!1:void 0,exportValue:e==="radio"||e==="checkbox"?"Yes":void 0,groupName:e==="radio"?"RadioGroup1":void 0,label:e==="button"?"Button":e==="image"?"Click to Upload Image":void 0,action:e==="button"?"none":void 0,jsScript:e==="button"?'app.alert("Hello World!");':void 0,visibilityAction:e==="button"?"toggle":void 0,dateFormat:e==="date"?"mm/dd/yyyy":void 0,pageIndex:A,multiline:e==="text"?!1:void 0,borderColor:"#000000",hideBorder:!1};T.push(o),ae(o),De()}function ae(e){const n=document.getElementById(e.id);n&&n.remove();const l=document.createElement("div");l.id=e.id,l.className="absolute cursor-move group",l.style.left=e.x+"px",l.style.top=e.y+"px",l.style.width=e.width+"px",l.style.overflow="visible",l.style.zIndex="10";const o=document.createElement("div");o.className="field-label absolute left-0 w-full text-xs font-semibold pointer-events-none select-none opacity-0 group-hover:opacity-100 transition-opacity",o.style.bottom="100%",o.style.marginBottom="4px",o.style.color="#374151",o.style.fontSize="11px",o.style.lineHeight="1",o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",o.textContent=e.name;const i=document.createElement("div");i.className="field-container relative border-2 border-indigo-200 group-hover:border-dashed group-hover:border-indigo-300 bg-indigo-50/30 rounded transition-all",i.style.width="100%",i.style.height=e.height+"px";const s=document.createElement("div");if(s.className="field-content w-full h-full flex items-center justify-center overflow-hidden",e.type==="text")s.className="field-text w-full h-full flex items-center px-2 text-sm overflow-hidden",s.style.fontSize=e.fontSize+"px",s.style.textAlign=e.alignment,s.style.justifyContent=e.alignment==="left"?"flex-start":e.alignment==="right"?"flex-end":"center",s.style.color=e.textColor,s.style.whiteSpace=e.multiline?"pre-wrap":"nowrap",s.style.textOverflow="ellipsis",s.style.alignItems=e.multiline?"flex-start":"center",s.textContent=e.defaultValue,e.combCells>0&&(s.style.backgroundImage=`repeating-linear-gradient(90deg, transparent, transparent calc((100% / ${e.combCells}) - 1px), #e5e7eb calc((100% / ${e.combCells}) - 1px), #e5e7eb calc(100% / ${e.combCells}))`,s.style.fontFamily="monospace",s.style.letterSpacing=`calc(${e.width/e.combCells}px - 1ch)`,s.style.paddingLeft=`calc((${e.width/e.combCells}px - 1ch) / 2)`,s.style.overflow="hidden",s.style.textAlign="left",s.style.justifyContent="flex-start");else if(e.type==="checkbox")s.innerHTML=e.checked?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full p-1"><polyline points="20 6 9 17 4 12"></polyline></svg>':"";else if(e.type==="radio")i.classList.add("rounded-full"),s.innerHTML=e.checked?'<div class="w-3/4 h-3/4 bg-black rounded-full"></div>':"";else if(e.type==="dropdown"){s.className="w-full h-full flex items-center px-2 text-sm text-black",s.style.backgroundColor="#e6f0ff";let c="Select...";e.defaultValue&&e.options&&e.options.includes(e.defaultValue)?c=e.defaultValue:e.options&&e.options.length>0&&(c=e.options[0]),s.textContent=c;const u=document.createElement("div");u.className="absolute right-1 top-1/2 -translate-y-1/2",u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="m6 9 6 6 6-6"/></svg>',i.appendChild(u)}else if(e.type==="optionlist")if(s.className="w-full h-full flex flex-col text-sm bg-white overflow-hidden border border-gray-300",e.options&&e.options.length>0)e.options.forEach((c,u)=>{const t=document.createElement("div");t.className="px-1 w-full truncate",t.textContent=c,(e.defaultValue?e.defaultValue===c:u===0)?t.className+=" bg-blue-600 text-white":t.className+=" text-black",s.appendChild(t)});else{const c=document.createElement("div");c.className="px-1 w-full text-black italic",c.textContent="Item 1",s.appendChild(c)}else e.type==="button"?(s.className="field-content w-full h-full flex items-center justify-center bg-gray-200 text-sm font-semibold",s.style.color=e.textColor||"#000000",s.textContent=e.label||"Button"):e.type==="signature"?(s.className="w-full h-full flex items-center justify-center bg-gray-50 text-gray-400",s.innerHTML='<div class="flex flex-col items-center"><i data-lucide="pen-tool" class="w-6 h-6 mb-1"></i><span class="text-[10px]">Sign Here</span></div>',setTimeout(()=>window.lucide?.createIcons(),0)):e.type==="date"?(s.className="w-full h-full flex items-center justify-center bg-white text-gray-600 border border-gray-300",s.innerHTML=`<div class="flex items-center gap-2 px-2"><i data-lucide="calendar" class="w-4 h-4"></i><span class="text-sm date-format-text">${e.dateFormat||"mm/dd/yyyy"}</span></div>`,setTimeout(()=>window.lucide?.createIcons(),0)):e.type==="image"&&(s.className="w-full h-full flex items-center justify-center bg-gray-100 text-gray-500 border border-gray-300",s.innerHTML=`<div class="flex flex-col items-center text-center p-1"><i data-lucide="image" class="w-6 h-6 mb-1"></i><span class="text-[10px] leading-tight">${e.label||"Click to Upload Image"}</span></div>`,setTimeout(()=>window.lucide?.createIcons(),0));i.appendChild(s),l.appendChild(o),l.appendChild(i),l.addEventListener("click",c=>{c.stopPropagation(),we(e)}),l.addEventListener("mousedown",c=>{if(c.target.classList.contains("resize-handle"))return;O=l;const u=L.getBoundingClientRect();le=c.clientX-u.left-e.x,de=c.clientY-u.top-e.y,we(e),_&&re(),c.preventDefault()}),l.addEventListener("touchstart",c=>{if(c.target.classList.contains("resize-handle"))return;const u=c.touches[0],t=L.getBoundingClientRect();le=u.clientX-t.left-e.x,de=u.clientY-t.top-e.y,we(e)},{passive:!0}),l.addEventListener("touchmove",c=>{c.preventDefault();const u=c.touches[0],t=L.getBoundingClientRect();let k=u.clientX-t.left-le,r=u.clientY-t.top-de;k=Math.max(0,Math.min(k,t.width-l.offsetWidth)),r=Math.max(0,Math.min(r,t.height-l.offsetHeight)),l.style.left=k+"px",l.style.top=r+"px",e.x=k,e.y=r}),l.addEventListener("touchend",()=>{}),["nw","ne","sw","se","n","s","e","w"].forEach(c=>{const u=document.createElement("div");u.className=`absolute w-2.5 h-2.5 bg-white border border-indigo-600 z-10 cursor-${c}-resize resize-handle hidden`;const t={nw:"top-0 left-0 -translate-x-1/2 -translate-y-1/2",ne:"top-0 right-0 translate-x-1/2 -translate-y-1/2",sw:"bottom-0 left-0 -translate-x-1/2 translate-y-1/2",se:"bottom-0 right-0 translate-x-1/2 translate-y-1/2",n:"top-0 left-1/2 -translate-x-1/2 -translate-y-1/2",s:"bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2",e:"top-1/2 right-0 translate-x-1/2 -translate-y-1/2",w:"top-1/2 left-0 -translate-x-1/2 -translate-y-1/2"};u.className+=` ${t[c]}`,u.dataset.position=c,u.addEventListener("mousedown",k=>{k.stopPropagation(),je(k,e,c)}),u.addEventListener("touchstart",k=>{k.stopPropagation(),k.preventDefault();const r=k.touches[0],m={clientX:r.clientX,clientY:r.clientY,preventDefault:()=>{}};je(m,e,c)}),i.appendChild(u)}),L.appendChild(l)}function je(e,n,l){te=!0,h=n,j=l,ke=e.clientX,Fe=e.clientY,J=n.width,X=n.height,Ie=n.x,$e=n.y,e.preventDefault()}document.addEventListener("mousemove",e=>{if(O&&!te){const n=L.getBoundingClientRect();let l=e.clientX-n.left-le,o=e.clientY-n.top-de;l=Math.max(0,Math.min(l,n.width-O.offsetWidth)),o=Math.max(0,Math.min(o,n.height-O.offsetHeight)),O.style.left=l+"px",O.style.top=o+"px";const i=T.find(s=>s.id===O.id);i&&(i.x=l,i.y=o)}else if(te&&h){const n=e.clientX-ke,l=e.clientY-Fe,o=document.getElementById(h.id);if(j.includes("e")&&(h.width=Math.max(50,J+n)),j.includes("w")){const i=Math.max(50,J-n),s=J-i;h.width=i,h.x=Ie+s}if(j.includes("s")&&(h.height=Math.max(20,X+l)),j.includes("n")){const i=Math.max(20,X-l),s=X-i;h.height=i,h.y=$e+s}if(o){const i=o.querySelector(".field-container");if(o.style.width=h.width+"px",o.style.left=h.x+"px",o.style.top=h.y+"px",i&&(i.style.height=h.height+"px"),h.combCells>0){const s=o.querySelector(".field-text");s&&(s.style.letterSpacing=`calc(${h.width/h.combCells}px - 1ch)`,s.style.paddingLeft=`calc((${h.width/h.combCells}px - 1ch) / 2)`)}}}});document.addEventListener("mouseup",()=>{O=null,te=!1,h=null,z||se()});document.addEventListener("touchmove",e=>{const n=e.touches[0];if(te&&h){const l=n.clientX-ke,o=n.clientY-Fe,i=document.getElementById(h.id);if(j.includes("e")&&(h.width=Math.max(50,J+l)),j.includes("w")){const s=Math.max(50,J-l),b=J-s;h.width=s,h.x=Ie+b}if(j.includes("s")&&(h.height=Math.max(20,X+o)),j.includes("n")){const s=Math.max(20,X-o),b=X-s;h.height=s,h.y=$e+b}if(i){const s=i.querySelector(".field-container");if(i.style.width=h.width+"px",i.style.left=h.x+"px",i.style.top=h.y+"px",s&&(s.style.height=h.height+"px"),h.combCells>0){const b=i.querySelector(".field-text");b&&(b.style.letterSpacing=`calc(${h.width/h.combCells}px - 1ch)`,b.style.paddingLeft=`calc((${h.width/h.combCells}px - 1ch) / 2)`)}}}},{passive:!1});document.addEventListener("touchend",()=>{te=!1,h=null});function we(e){ye(),Y=e;const n=document.getElementById(e.id);if(n){const l=n.querySelector(".field-container"),o=n.querySelector(".field-label"),i=n.querySelectorAll(".resize-handle");l&&(l.classList.remove("border-indigo-200","group-hover:border-dashed","group-hover:border-indigo-300"),l.classList.add("border-dashed","border-indigo-500","bg-indigo-50")),o&&(o.classList.remove("opacity-0","group-hover:opacity-100"),o.classList.add("opacity-100")),i.forEach(s=>{s.classList.remove("hidden")})}ht(e)}function ye(){if(Y){const e=document.getElementById(Y.id);if(e){const n=e.querySelector(".field-container"),l=e.querySelector(".field-label"),o=e.querySelectorAll(".resize-handle");n&&(n.classList.remove("border-dashed","border-indigo-500","bg-indigo-50"),n.classList.add("border-indigo-200","group-hover:border-dashed","group-hover:border-indigo-300")),l&&(l.classList.remove("opacity-100"),l.classList.add("opacity-0","group-hover:opacity-100")),o.forEach(i=>{i.classList.add("hidden")})}Y=null}xt()}function ht(e){let n="";if(e.type==="text")n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Value</label>
            <input type="text" id="propValue" value="${e.defaultValue}" ${e.combCells>0?`maxlength="${e.combCells}"`:e.maxLength>0?`maxlength="${e.maxLength}"`:""} class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Max Length (0 for unlimited)</label>
            <input type="number" id="propMaxLength" value="${e.maxLength}" min="0" ${e.combCells>0?"disabled":""} class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Divide into boxes (0 to disable)</label>
            <input type="number" id="propComb" value="${e.combCells}" min="0" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Font Size</label>
            <input type="number" id="propFontSize" value="${e.fontSize}" min="8" max="72" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Text Color</label>
            <input type="color" id="propTextColor" value="${e.textColor}" class="w-full border border-gray-500 rounded px-2 py-1 h-10">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Alignment</label>
            <select id="propAlignment" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
            <option value="left" ${e.alignment==="left"?"selected":""}>Left</option>
            <option value="center" ${e.alignment==="center"?"selected":""}>Center</option>
            <option value="right" ${e.alignment==="right"?"selected":""}>Right</option>
            </select>
        </div>
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded mt-2">
            <label for="propMultiline" class="text-xs font-semibold text-gray-300">Multi-line</label>
            <button id="propMultilineBtn" class="w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none ${e.multiline?"bg-indigo-600":"bg-gray-500"} relative">
                <span class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 ${e.multiline?"translate-x-6":"translate-x-0"}"></span>
            </button>
        </div>
        `;else if(e.type==="checkbox")n=`
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded">
            <label for="propChecked" class="text-xs font-semibold text-gray-300">Checked State</label>
            <button id="propCheckedBtn" class="w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none ${e.checked?"bg-indigo-600":"bg-gray-500"} relative">
                <span class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 ${e.checked?"translate-x-6":"translate-x-0"}"></span>
            </button>
        </div>
        `;else if(e.type==="radio")n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Group Name (Must be same for group)</label>
            <input type="text" id="propGroupName" value="${e.groupName}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Export Value</label>
            <input type="text" id="propExportValue" value="${e.exportValue}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded mt-2">
            <label for="propChecked" class="text-xs font-semibold text-gray-300">Checked State</label>
            <button id="propCheckedBtn" class="w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none ${e.checked?"bg-indigo-600":"bg-gray-500"} relative">
                <span class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 ${e.checked?"translate-x-6":"translate-x-0"}"></span>
            </button>
        </div>
        `;else if(e.type==="dropdown"||e.type==="optionlist")n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Options (One per line or comma separated)</label>
            <textarea id="propOptions" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500 h-24">${e.options?.join(`
`)}</textarea>
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Selected Option</label>
            <select id="propSelectedOption" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                <option value="">None</option>
                ${e.options?.map(r=>`<option value="${r}" ${e.defaultValue===r?"selected":""}>${r}</option>`).join("")}
            </select>
        </div>
        <div class="text-xs text-gray-400 italic mt-2">
            To actually fill or change the options, use our PDF Form Filler tool.
        </div>
        `;else if(e.type==="button")n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Label</label>
            <input type="text" id="propLabel" value="${e.label}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Action</label>
            <select id="propAction" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                <option value="none" ${e.action==="none"?"selected":""}>None</option>
                <option value="reset" ${e.action==="reset"?"selected":""}>Reset Form</option>
                <option value="print" ${e.action==="print"?"selected":""}>Print Form</option>
                <option value="url" ${e.action==="url"?"selected":""}>Open URL</option>
                <option value="js" ${e.action==="js"?"selected":""}>Run Javascript</option>
                <option value="showHide" ${e.action==="showHide"?"selected":""}>Show/Hide Field</option>
            </select>
        </div>
        <div id="propUrlContainer" class="${e.action==="url"?"":"hidden"}">
            <label class="block text-xs font-semibold text-gray-300 mb-1">URL</label>
            <input type="text" id="propActionUrl" value="${e.actionUrl||""}" placeholder="https://example.com" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div id="propJsContainer" class="${e.action==="js"?"":"hidden"}">
            <label class="block text-xs font-semibold text-gray-300 mb-1">Javascript Code</label>
            <textarea id="propJsScript" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500 h-24 font-mono">${e.jsScript||""}</textarea>
        </div>
        <div id="propShowHideContainer" class="${e.action==="showHide"?"":"hidden"}">
            <div class="mb-2">
                <label class="block text-xs font-semibold text-gray-300 mb-1">Target Field</label>
                <select id="propTargetField" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">Select a field...</option>
                    ${T.filter(r=>r.id!==e.id).map(r=>`<option value="${r.name}" ${e.targetFieldName===r.name?"selected":""}>${r.name} (${r.type})</option>`).join("")}
                </select>
            </div>
            <div>
                <label class="block text-xs font-semibold text-gray-300 mb-1">Visibility</label>
                <select id="propVisibilityAction" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="show" ${e.visibilityAction==="show"?"selected":""}>Show</option>
                    <option value="hide" ${e.visibilityAction==="hide"?"selected":""}>Hide</option>
                    <option value="toggle" ${e.visibilityAction==="toggle"?"selected":""}>Toggle</option>
                </select>
            </div>
        </div>
        `;else if(e.type==="signature")n=`
        <div class="text-xs text-gray-400 italic mb-2">
            Signature fields are AcroForm signature fields and would only be visible in an advanced PDF viewer.
        </div>
        `;else if(e.type==="date"){const r=["m/d","m/d/yy","m/d/yyyy","mm/dd/yy","mm/dd/yyyy","mm/yy","mm/yyyy","d-mmm","d-mmm-yy","d-mmm-yyyy","dd-mmm-yy","dd-mmm-yyyy","yy-mm-dd","yyyy-mm-dd","mmm-yy","mmm-yyyy","mmm d, yyyy","mmmm-yy","mmmm-yyyy","mmmm d, yyyy","dd/mm/yy","dd/mm/yyyy","yyyy/mm/dd","dd.mm.yy","dd.mm.yyyy","m/d/yy h:MM tt","m/d/yyyy h:MM tt","m/d/yy HH:MM","m/d/yyyy HH:MM","yyyy-mm","yyyy"],m=!r.includes(e.dateFormat||"mm/dd/yyyy");n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Date Format</label>
            <select id="propDateFormat" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                ${r.map(y=>`<option value="${y}" ${e.dateFormat===y?"selected":""}>${y}</option>`).join("")}
                <option value="custom" ${m?"selected":""}>Custom</option>
            </select>
        </div>
        <div id="customFormatContainer" class="${m?"":"hidden"} mt-2">
            <label class="block text-xs font-semibold text-gray-300 mb-1">Custom Format</label>
            <input type="text" id="propCustomFormat" value="${m?e.dateFormat:""}" placeholder="e.g. dd/mm/yyyy HH:MM:ss" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div class="mt-3 p-2 bg-gray-700 rounded">
            <span class="text-xs text-gray-400">Example of current format:</span>
            <span id="dateFormatExample" class="text-sm text-white font-medium ml-2"></span>
        </div>
        <div class="bg-blue-900/30 border border-blue-700/50 rounded p-2 mt-2">
            <p class="text-xs text-blue-200">
                <i data-lucide="info" class="w-4 h-4 flex-shrink-0 mt-0.5"></i>
                <span><strong>Browser Note:</strong> Firefox and Chrome may show their native date picker format during selection. The correct format will apply when you finish entering the date.</span>
            </p>
        </div>
        `}else e.type==="image"&&(n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Label / Prompt</label>
            <input type="text" id="propLabel" value="${e.label}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div class="text-xs text-gray-400 italic mt-2">
            Clicking this field in the PDF will open a file picker to upload an image.
        </div>
        `);Te.innerHTML=`
    <div class="space-y-3">
      <div>
        <label class="block text-xs font-semibold text-gray-300 mb-1">Field Name ${e.type==="radio"?"(Group Name)":""}</label>
        <input type="text" id="propName" value="${e.name}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        <div id="nameError" class="hidden text-red-400 text-xs mt-1"></div>
      </div>
      ${e.type==="radio"&&(ee.size>0||T.some(r=>r.type==="radio"&&r.id!==e.id))?`
      <div>
        <label class="block text-xs font-semibold text-gray-300 mb-1">Existing Radio Groups</label>
        <select id="existingGroups" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
          <option value="">-- Select existing group --</option>
          ${Array.from(ee).map(r=>`<option value="${r}">${r}</option>`).join("")}
          ${Array.from(new Set(T.filter(r=>r.type==="radio"&&r.id!==e.id).map(r=>r.name))).map(r=>ee.has(r)?"":`<option value="${r}">${r}</option>`).join("")}
        </select>
        <p class="text-xs text-gray-400 mt-1">Select to add this button to an existing group</p>
      </div>
      `:""}
      ${n}
      <div>
        <label class="block text-xs font-semibold text-gray-300 mb-1">Tooltip / Help Text</label>
        <input type="text" id="propTooltip" value="${e.tooltip}" placeholder="Description for screen readers" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="propRequired" ${e.required?"checked":""} class="mr-2">
        <label for="propRequired" class="text-xs font-semibold text-gray-300">Required</label>
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="propReadOnly" ${e.readOnly?"checked":""} class="mr-2">
        <label for="propReadOnly" class="text-xs font-semibold text-gray-300">Read Only</label>
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-300 mb-1">Border Color</label>
        <input type="color" id="propBorderColor" value="${e.borderColor||"#000000"}" class="w-full border border-gray-500 rounded px-2 py-1 h-10">
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="propHideBorder" ${e.hideBorder?"checked":""} class="mr-2">
        <label for="propHideBorder" class="text-xs font-semibold text-gray-300">Hide Border</label>
      </div>
      <button id="deleteBtn" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition text-sm font-semibold">
        Delete Field
      </button>
    </div>
  `;const l=document.getElementById("propName"),o=document.getElementById("nameError"),i=document.getElementById("propTooltip"),s=document.getElementById("propRequired"),b=document.getElementById("propReadOnly"),c=document.getElementById("deleteBtn"),u=r=>{if(!r)return o.textContent="Field name cannot be empty",o.classList.remove("hidden"),l.classList.add("border-red-500"),!1;if(e.type==="radio")return o.classList.add("hidden"),l.classList.remove("border-red-500"),!0;const m=T.some(v=>v.id!==e.id&&v.name===r),y=ge.has(r);return m||y?(o.textContent=`Field name "${r}" already exists in this ${y?"PDF":"form"}. Please try using a unique name.`,o.classList.remove("hidden"),l.classList.add("border-red-500"),!1):(o.classList.add("hidden"),l.classList.remove("border-red-500"),!0)};if(l.addEventListener("input",r=>{const m=r.target.value.trim();u(m)}),l.addEventListener("change",r=>{const m=r.target.value.trim();if(!u(m)){r.target.value=e.name;return}e.name=m;const y=document.getElementById(e.id);if(y){const v=y.querySelector(".field-label");v&&(v.textContent=e.name)}}),i.addEventListener("input",r=>{e.tooltip=r.target.value}),e.type==="radio"){const r=document.getElementById("existingGroups");r&&r.addEventListener("change",m=>{const y=m.target.value;if(y){l.value=y,e.name=y,u(y);const v=document.getElementById(e.id);if(v){const S=v.querySelector(".field-label");S&&(S.textContent=e.name)}}})}s.addEventListener("change",r=>{e.required=r.target.checked}),b.addEventListener("change",r=>{e.readOnly=r.target.checked});const t=document.getElementById("propBorderColor"),k=document.getElementById("propHideBorder");if(t.addEventListener("input",r=>{e.borderColor=r.target.value}),k.addEventListener("change",r=>{e.hideBorder=r.target.checked}),c.addEventListener("click",()=>{Je(e)}),e.type==="text"){const r=document.getElementById("propValue"),m=document.getElementById("propMaxLength"),y=document.getElementById("propComb"),v=document.getElementById("propFontSize"),S=document.getElementById("propTextColor"),E=document.getElementById("propAlignment");r.addEventListener("input",p=>{e.defaultValue=p.target.value;const g=document.getElementById(e.id);if(g){const d=g.querySelector(".field-text");d&&(d.textContent=e.defaultValue)}}),m.addEventListener("input",p=>{const g=parseInt(p.target.value);if(e.maxLength=isNaN(g)?0:Math.max(0,g),e.maxLength>0){if(r.maxLength=e.maxLength,e.defaultValue.length>e.maxLength){e.defaultValue=e.defaultValue.substring(0,e.maxLength),r.value=e.defaultValue;const d=document.getElementById(e.id);if(d){const a=d.querySelector(".field-text");a&&(a.textContent=e.defaultValue)}}}else r.removeAttribute("maxLength")}),y.addEventListener("input",p=>{const g=parseInt(p.target.value);e.combCells=isNaN(g)?0:Math.max(0,g),e.combCells>0?(r.maxLength=e.combCells,m.value=e.combCells.toString(),m.disabled=!0,e.maxLength=e.combCells,e.defaultValue.length>e.combCells&&(e.defaultValue=e.defaultValue.substring(0,e.combCells),r.value=e.defaultValue)):(m.disabled=!1,r.removeAttribute("maxLength"),e.maxLength>0&&(r.maxLength=e.maxLength));const d=document.getElementById(e.id);if(d){const a=d.querySelector(".field-text");a&&(a.textContent=e.defaultValue,e.combCells>0?(a.style.backgroundImage=`repeating-linear-gradient(90deg, transparent, transparent calc((100% / ${e.combCells}) - 1px), #e5e7eb calc((100% / ${e.combCells}) - 1px), #e5e7eb calc(100% / ${e.combCells}))`,a.style.fontFamily="monospace",a.style.letterSpacing=`calc(${e.width/e.combCells}px - 1ch)`,a.style.paddingLeft=`calc((${e.width/e.combCells}px - 1ch) / 2)`,a.style.overflow="hidden",a.style.textAlign="left",a.style.justifyContent="flex-start"):(a.style.backgroundImage="none",a.style.fontFamily="inherit",a.style.letterSpacing="normal",a.style.textAlign=e.alignment,a.style.justifyContent=e.alignment==="left"?"flex-start":e.alignment==="right"?"flex-end":"center"))}}),v.addEventListener("input",p=>{e.fontSize=parseInt(p.target.value);const g=document.getElementById(e.id);if(g){const d=g.querySelector(".field-text");d&&(d.style.fontSize=e.fontSize+"px")}}),S.addEventListener("input",p=>{e.textColor=p.target.value;const g=document.getElementById(e.id);if(g){const d=g.querySelector(".field-text");d&&(d.style.color=e.textColor)}}),E.addEventListener("change",p=>{e.alignment=p.target.value;const g=document.getElementById(e.id);if(g){const d=g.querySelector(".field-text");d&&(d.style.textAlign=e.alignment,d.style.justifyContent=e.alignment==="left"?"flex-start":e.alignment==="right"?"flex-end":"center")}});const x=document.getElementById("propMultilineBtn");x&&x.addEventListener("click",()=>{e.multiline=!e.multiline;const p=x.querySelector("span");e.multiline?(x.classList.remove("bg-gray-500"),x.classList.add("bg-indigo-600"),p?.classList.remove("translate-x-0"),p?.classList.add("translate-x-6")):(x.classList.remove("bg-indigo-600"),x.classList.add("bg-gray-500"),p?.classList.remove("translate-x-6"),p?.classList.add("translate-x-0"));const g=document.getElementById(e.id);if(g){const d=g.querySelector(".field-text");d&&(e.multiline?(d.style.whiteSpace="pre-wrap",d.style.alignItems="flex-start",d.style.overflow="hidden"):(d.style.whiteSpace="nowrap",d.style.alignItems="center",d.style.overflow="hidden"))}})}else if(e.type==="checkbox"||e.type==="radio"){const r=document.getElementById("propCheckedBtn");if(r.addEventListener("click",()=>{e.checked=!e.checked;const m=r.querySelector("span");e.checked?(r.classList.remove("bg-gray-500"),r.classList.add("bg-indigo-600"),m?.classList.remove("translate-x-0"),m?.classList.add("translate-x-6")):(r.classList.remove("bg-indigo-600"),r.classList.add("bg-gray-500"),m?.classList.remove("translate-x-6"),m?.classList.add("translate-x-0"));const y=document.getElementById(e.id);if(y){const v=y.querySelector(".field-content");v&&(e.type==="checkbox"?v.innerHTML=e.checked?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full p-1"><polyline points="20 6 9 17 4 12"></polyline></svg>':"":v.innerHTML=e.checked?'<div class="w-3/4 h-3/4 bg-black rounded-full"></div>':"")}}),e.type==="radio"){const m=document.getElementById("propGroupName"),y=document.getElementById("propExportValue");m.addEventListener("input",v=>{e.groupName=v.target.value}),y.addEventListener("input",v=>{e.exportValue=v.target.value})}}else if(e.type==="dropdown"||e.type==="optionlist")document.getElementById("propOptions").addEventListener("input",y=>{const v=y.target.value;e.options=v.split(/[\n,]/).map(E=>E.trim()).filter(E=>E.length>0);const S=document.getElementById("propSelectedOption");if(S){const E=e.defaultValue;S.innerHTML='<option value="">None</option>'+e.options?.map(x=>`<option value="${x}" ${E===x?"selected":""}>${x}</option>`).join(""),E&&e.options&&!e.options.includes(E)&&(e.defaultValue="",S.value="")}ae(e)}),document.getElementById("propSelectedOption").addEventListener("change",y=>{e.defaultValue=y.target.value,ae(e)});else if(e.type==="button"){document.getElementById("propLabel").addEventListener("input",d=>{e.label=d.target.value;const a=document.getElementById(e.id);if(a){const f=a.querySelector(".field-content");f&&(f.textContent=e.label||"Button")}});const m=document.getElementById("propAction"),y=document.getElementById("propUrlContainer"),v=document.getElementById("propJsContainer"),S=document.getElementById("propShowHideContainer");m.addEventListener("change",d=>{e.action=d.target.value,y.classList.add("hidden"),v.classList.add("hidden"),S.classList.add("hidden"),e.action==="url"?y.classList.remove("hidden"):e.action==="js"?v.classList.remove("hidden"):e.action==="showHide"&&S.classList.remove("hidden")}),document.getElementById("propActionUrl").addEventListener("input",d=>{e.actionUrl=d.target.value});const x=document.getElementById("propJsScript");x&&x.addEventListener("input",d=>{e.jsScript=d.target.value});const p=document.getElementById("propTargetField");p&&p.addEventListener("change",d=>{e.targetFieldName=d.target.value});const g=document.getElementById("propVisibilityAction");g&&g.addEventListener("change",d=>{e.visibilityAction=d.target.value})}else if(e.type!=="signature")if(e.type==="date"){const r=document.getElementById("propDateFormat"),m=document.getElementById("customFormatContainer"),y=document.getElementById("propCustomFormat"),v=document.getElementById("dateFormatExample"),S=x=>{const p=new Date,g=p.getDate(),d=g.toString().padStart(2,"0"),a=p.getMonth()+1,f=a.toString().padStart(2,"0"),w=p.getFullYear().toString().slice(-2),C=p.getFullYear().toString(),M=p.getHours()%12||12,F=p.getHours().toString().padStart(2,"0"),H=p.getMinutes().toString().padStart(2,"0"),Ne=p.getHours()>=12?"PM":"AM",_e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Ze=["January","February","March","April","May","June","July","August","September","October","November","December"],Qe=_e[p.getMonth()],et=Ze[p.getMonth()];return x.replace(/mmmm/g,et).replace(/mmm/g,Qe).replace(/mm/g,f).replace(/m/g,a.toString()).replace(/dddd/g,d).replace(/dd/g,d).replace(/d/g,g.toString()).replace(/yyyy/g,C).replace(/yy/g,w).replace(/HH/g,F).replace(/h/g,M.toString()).replace(/MM/g,H).replace(/tt/g,Ne)},E=()=>{v&&(v.textContent=S(e.dateFormat||"mm/dd/yyyy"))};E(),r&&r.addEventListener("change",x=>{const p=x.target.value;p==="custom"?(m?.classList.remove("hidden"),y&&y.value&&(e.dateFormat=y.value)):(m?.classList.add("hidden"),e.dateFormat=p),E();const g=document.getElementById(e.id);if(g){const d=g.querySelector(".date-format-text");d&&(d.textContent=e.dateFormat)}setTimeout(()=>window.lucide?.createIcons(),0)}),y&&y.addEventListener("input",x=>{e.dateFormat=x.target.value||"mm/dd/yyyy",E();const p=document.getElementById(e.id);if(p){const g=p.querySelector(".date-format-text");g&&(g.textContent=e.dateFormat)}})}else e.type==="image"&&document.getElementById("propLabel").addEventListener("input",m=>{e.label=m.target.value,ae(e)})}function xt(){Te.innerHTML='<p class="text-gray-500 text-sm">Select a field to edit properties</p>'}function Je(e){const n=document.getElementById(e.id);n&&n.remove(),T=T.filter(l=>l.id!==e.id),ye(),De()}document.addEventListener("keydown",e=>{e.key==="Delete"&&Y?Je(Y):e.key==="Escape"&&q&&(ue.forEach(n=>n.classList.remove("ring-2","ring-indigo-400","bg-indigo-600")),q=null,L.style.cursor="default")});function De(){lt.textContent=T.length.toString()}bt.addEventListener("click",async()=>{const e=new Map,n=[],l=[];if(T.forEach(o=>{const i=e.get(o.name)||0;e.set(o.name,i+1),ge.has(o.name)&&(o.type==="radio"&&ee.has(o.name)||l.push(o.name))}),e.forEach((o,i)=>{o>1&&(T.filter(c=>c.name===i).every(c=>c.type==="radio")||n.push(i))}),l.length>0){const o=[...new Set(l)].map(i=>`"${i}"`).join(", ");Z("Field Name Conflict",`The following field names already exist in the uploaded PDF: ${o}. Please rename these fields before downloading.`,"error");return}if(n.length>0){const o=n.map(i=>`"${i}"`).join(", ");Z("Duplicate Field Names",`The following field names are used more than once: ${o}. Please rename these fields to use unique names before downloading.`,"error");return}if(T.length===0){alert("Please add at least one field before downloading.");return}if($.length===0){alert("No pages found. Please create a blank PDF or upload one.");return}try{let o;if(V)o=V;else{o=await ze.create();for(const t of $)o.addPage([t.width,t.height])}const i=o.getForm(),s=await o.embedFont(ot.Helvetica);o.setTitle("Fillable Form"),o.setAuthor("BentoPDF"),o.setLanguage("en-US");const b=new Map;for(const t of T){if(!$[t.pageIndex])continue;const r=o.getPage(t.pageIndex),{height:m}=r.getSize(),y=1/ie,v=1/ie,S=t.x-ne.x,E=t.y-ne.y,x=S*y,p=m-E*v-t.height*v,g=t.width*y,d=t.height*v;if(console.log(`Field "${t.name}":`,{screenPos:{x:t.x,y:t.y},adjustedPos:{x:S,y:E},pdfPos:{x,y:p,width:g,height:d},metrics:{offset:ne,scale:ie}}),t.type==="text"){const a=i.createTextField(t.name),f=W(t.textColor),w=W(t.borderColor||"#000000");a.addToPage(r,{x,y:p,width:g,height:d,borderWidth:t.hideBorder?0:1,borderColor:I(w.r,w.g,w.b),backgroundColor:I(1,1,1),textColor:I(f.r,f.g,f.b)}),a.setText(t.defaultValue),a.setFontSize(t.fontSize),t.alignment==="center"?a.setAlignment(he.Center):t.alignment==="right"?a.setAlignment(he.Right):a.setAlignment(he.Left),t.combCells>0?(a.setMaxLength(t.combCells),a.enableCombing()):t.maxLength>0&&a.setMaxLength(t.maxLength),t.multiline?a.enableMultiline():a.disableMultiline(),t.required&&a.enableRequired(),t.readOnly&&a.enableReadOnly(),t.tooltip&&a.acroField.getWidgets().forEach(C=>{C.dict.set(B.of("TU"),P.of(t.tooltip))})}else if(t.type==="checkbox"){const a=i.createCheckBox(t.name),f=W(t.borderColor||"#000000");a.addToPage(r,{x,y:p,width:g,height:d,borderWidth:t.hideBorder?0:1,borderColor:I(f.r,f.g,f.b),backgroundColor:I(1,1,1)}),t.checked&&a.check(),t.required&&a.enableRequired(),t.readOnly&&a.enableReadOnly(),t.tooltip&&a.acroField.getWidgets().forEach(w=>{w.dict.set(B.of("TU"),P.of(t.tooltip))})}else if(t.type==="radio"){const a=t.name;let f;if(b.has(a))f=b.get(a);else{const C=i.getFieldMaybe(a);C?(f=C,b.set(a,f),console.log(`Using existing radio group from PDF: ${a}`)):(f=i.createRadioGroup(a),b.set(a,f),console.log(`Created new radio group: ${a}`))}const w=W(t.borderColor||"#000000");f.addOptionToPage(t.exportValue||"Yes",r,{x,y:p,width:g,height:d,borderWidth:t.hideBorder?0:1,borderColor:I(w.r,w.g,w.b),backgroundColor:I(1,1,1)}),t.checked&&f.select(t.exportValue||"Yes"),t.required&&f.enableRequired(),t.readOnly&&f.enableReadOnly(),t.tooltip&&f.acroField.getWidgets().forEach(C=>{C.dict.set(B.of("TU"),P.of(t.tooltip))})}else if(t.type==="dropdown"){const a=i.createDropdown(t.name),f=W(t.borderColor||"#000000");a.addToPage(r,{x,y:p,width:g,height:d,borderWidth:t.hideBorder?0:1,borderColor:I(f.r,f.g,f.b),backgroundColor:I(1,1,1)}),t.options&&a.setOptions(t.options),t.defaultValue&&t.options?.includes(t.defaultValue)?a.select(t.defaultValue):t.options&&t.options.length>0&&a.select(t.options[0]);const w=W(t.textColor);a.acroField.setFontSize(t.fontSize),a.acroField.setDefaultAppearance(`0 0 0 rg /Helv ${t.fontSize} Tf`),t.required&&a.enableRequired(),t.readOnly&&a.enableReadOnly(),t.tooltip&&a.acroField.getWidgets().forEach(C=>{C.dict.set(B.of("TU"),P.of(t.tooltip))})}else if(t.type==="optionlist"){const a=i.createOptionList(t.name),f=W(t.borderColor||"#000000");a.addToPage(r,{x,y:p,width:g,height:d,borderWidth:t.hideBorder?0:1,borderColor:I(f.r,f.g,f.b),backgroundColor:I(1,1,1)}),t.options&&a.setOptions(t.options),t.defaultValue&&t.options?.includes(t.defaultValue)?a.select(t.defaultValue):t.options&&t.options.length>0&&a.select(t.options[0]);const w=W(t.textColor);a.acroField.setFontSize(t.fontSize),a.acroField.setDefaultAppearance(`0 0 0 rg /Helv ${t.fontSize} Tf`),t.required&&a.enableRequired(),t.readOnly&&a.enableReadOnly(),t.tooltip&&a.acroField.getWidgets().forEach(C=>{C.dict.set(B.of("TU"),P.of(t.tooltip))})}else if(t.type==="button"){const a=i.createButton(t.name),f=W(t.borderColor||"#000000");a.addToPage(t.label||"Button",r,{x,y:p,width:g,height:d,borderWidth:t.hideBorder?0:1,borderColor:I(f.r,f.g,f.b),backgroundColor:I(.8,.8,.8)}),t.action&&t.action!=="none"&&a.acroField.getWidgets().forEach(C=>{let M;if(t.action==="reset")M=o.context.obj({Type:"Action",S:"ResetForm"});else if(t.action==="print")M=o.context.obj({Type:"Action",S:"JavaScript",JS:"print();"});else if(t.action==="url"&&t.actionUrl){let F=t.actionUrl.trim();!F.startsWith("http://")&&!F.startsWith("https://")&&(F="https://"+F);try{F=encodeURI(F)}catch(H){console.warn("Failed to encode URL:",H)}M=o.context.obj({Type:"Action",S:"URI",URI:P.of(F)})}else if(t.action==="js"&&t.jsScript)M=o.context.obj({Type:"Action",S:"JavaScript",JS:t.jsScript});else if(t.action==="showHide"&&t.targetFieldName){const F=t.targetFieldName;let H="";t.visibilityAction==="show"?H=`var f = this.getField("${F}"); if(f) f.display = display.visible;`:t.visibilityAction==="hide"?H=`var f = this.getField("${F}"); if(f) f.display = display.hidden;`:H=`var f = this.getField("${F}"); if(f) f.display = (f.display === display.visible) ? display.hidden : display.visible;`,M=o.context.obj({Type:"Action",S:"JavaScript",JS:H})}M&&C.dict.set(B.of("A"),M)}),t.tooltip&&a.acroField.getWidgets().forEach(w=>{w.dict.set(B.of("TU"),P.of(t.tooltip))})}else if(t.type==="date"){const a=i.createTextField(t.name);a.addToPage(r,{x,y:p,width:g,height:d,borderWidth:1,borderColor:I(0,0,0),backgroundColor:I(1,1,1)});const f=t.dateFormat||"mm/dd/yyyy",w=o.context.obj({Type:"Action",S:"JavaScript",JS:P.of(`AFDate_FormatEx("${f}");`)}),C=o.context.obj({Type:"Action",S:"JavaScript",JS:P.of(`AFDate_KeystrokeEx("${f}");`)}),M=o.context.obj({F:w,K:C});a.acroField.dict.set(B.of("AA"),M),t.required&&a.enableRequired(),t.readOnly&&a.enableReadOnly(),t.tooltip&&a.acroField.getWidgets().forEach(F=>{F.dict.set(B.of("TU"),P.of(t.tooltip))})}else if(t.type==="image"){const a=i.createButton(t.name);a.addToPage(t.label||"Click to Upload Image",r,{x,y:p,width:g,height:d,borderWidth:1,borderColor:I(0,0,0),backgroundColor:I(.9,.9,.9)}),a.acroField.getWidgets().forEach(w=>{const C=o.context.obj({Type:"Action",S:"JavaScript",JS:"event.target.buttonImportIcon();"});w.dict.set(B.of("A"),C);const M=o.context.obj({TP:1,BG:[.9,.9,.9],BC:[0,0,0],IF:{SW:B.of("A"),S:B.of("A"),FB:!0}});w.dict.set(B.of("MK"),M)}),t.tooltip&&a.acroField.getWidgets().forEach(w=>{w.dict.set(B.of("TU"),P.of(t.tooltip))})}else if(t.type==="signature"){const a=o.context,f=a.obj({FT:B.of("Sig"),T:P.of(t.name),Kids:[]}),w=a.register(f),C=a.obj({Type:B.of("Annot"),Subtype:B.of("Widget"),Rect:[x,p,x+g,p+d],F:4,P:r.ref,Parent:w}),M=a.obj({W:1,S:B.of("S")});C.set(B.of("BS"),M),C.set(B.of("BC"),a.obj([0,0,0])),C.set(B.of("BG"),a.obj([.95,.95,.95]));const F=a.register(C);f.get(B.of("Kids")).push(F),r.node.addAnnot(F),i.acroForm.addField(w),t.tooltip&&C.set(B.of("TU"),P.of(t.tooltip))}}i.updateFieldAppearances(s);const c=await o.save(),u=new Blob([new Uint8Array(c)],{type:"application/pdf"});nt(u,"fillable-form.pdf"),Z("Success","Your PDF has been downloaded successfully.","info",()=>{Ce()},"Okay")}catch(o){console.error("Error generating PDF:",o);const i=o.message;if(i.includes("A field already exists with the specified name")){const s=i.match(/A field already exists with the specified name: "(.+?)"/),b=s?s[1]:"unknown";ee.has(b)?console.log(`Adding to existing radio group: ${b}`):Z("Duplicate Field Name",`A field named "${b}" already exists. Please rename this field to use a unique name before downloading.`,"error")}else Z("Error","Error generating PDF: "+i,"error")}});const vt=document.querySelectorAll('[id^="back-to-tools"]');vt.forEach(e=>{e.addEventListener("click",()=>{window.location.href="/"})});function wt(e){let n;switch(e){case"letter":n=U.Letter;break;case"a4":n=U.A4;break;case"a5":n=U.A5;break;case"legal":n=U.Legal;break;case"tabloid":n=U.Tabloid;break;case"a3":n=U.A3;break;case"custom":const l=parseInt(pt.value)||612,o=parseInt(gt.value)||792;return{width:l,height:o};default:n=U.Letter}return{width:n[0],height:n[1]}}function Ce(){T=[],$=[],A=0,V=null,Y=null,L.innerHTML="",Te.innerHTML='<p class="text-gray-500 text-sm">Select a field to edit properties</p>',De(),Me.classList.remove("hidden"),Ae.classList.add("hidden"),Ue.classList.add("hidden"),setTimeout(()=>Be({icons:Se}),100)}function Xe(){$.push({index:$.length,width:Ee.width,height:Ee.height}),be()}function fe(e){e<0||e>=$.length||(A=e,Re(),be(),ye())}async function Re(){const e=$[A];if(!e)return;const n=1.333;He=n;const l=e.width*n,o=e.height*n;if(L.style.width=`${l}px`,L.style.height=`${o}px`,L.innerHTML="",V)try{const i=await V.save(),s=new Blob([i.buffer],{type:"application/pdf"}),b=URL.createObjectURL(s),c=document.createElement("iframe");c.src=`/pdfjs-viewer/viewer.html?file=${encodeURIComponent(b)}#page=${A+1}&toolbar=0`,c.style.width="100%",c.style.height=`${o}px`,c.style.border="none",c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.pointerEvents="none",c.style.opacity="0.8",c.onload=()=>{try{const u=c.contentWindow;if(u&&u.PDFViewerApplication){const t=u.PDFViewerApplication,k=u.document.createElement("style");k.textContent=`
                            * {
                                margin: 0 !important;
                                padding: 0 !important;
                            }
                            html, body {
                                margin: 0 !important;
                                padding: 0 !important;
                                background-color: transparent !important;
                                overflow: hidden !important;
                            }
                            #toolbarContainer {
                                display: none !important;
                            }
                            #mainContainer {
                                top: 0 !important;
                                position: absolute !important;
                                left: 0 !important;
                                margin: 0 !important;
                                padding: 0 !important;
                            }
                            #outerContainer {
                                background-color: transparent !important;
                                margin: 0 !important;
                                padding: 0 !important;
                            }
                            #viewerContainer {
                                top: 0 !important;
                                background-color: transparent !important;
                                overflow: hidden !important;
                                margin: 0 !important;
                                padding: 0 !important;
                            }
                            .toolbar {
                                display: none !important;
                            }
                            .pdfViewer {
                                padding: 0 !important;
                                margin: 0 !important;
                            }
                            .page {
                                margin: 0 !important;
                                padding: 0 !important;
                                border: none !important;
                                box-shadow: none !important;
                            }
                        `,u.document.head.appendChild(k);const r=setInterval(()=>{if(t.pdfViewer&&t.pdfViewer.pagesCount>0){clearInterval(r);const m=u.document.querySelector(".page");if(m){const y=m.getBoundingClientRect(),v=-y.left,S=-y.top;m.style.transform=`translate(${v}px, ${S}px)`,setTimeout(()=>{const E=m.getBoundingClientRect(),x=u.getComputedStyle(m),p=parseFloat(x.borderLeftWidth)||0,g=parseFloat(x.borderTopWidth)||0,d=parseFloat(x.borderRightWidth)||0;ne={x:E.left+p,y:E.top+g},ie=(E.width-p-d)/e.width,console.log(" Calibrated Metrics (force positioned):",{initialPosition:{left:y.left,top:y.top},appliedTransform:{x:v,y:S},finalRect:{left:E.left,top:E.top,width:E.width,height:E.height},computedBorders:{left:p,top:g,right:d},finalOffset:ne,finalScale:ie,pdfDimensions:{width:e.width,height:e.height}})},50)}}},100)}}catch(u){console.error("Error accessing iframe content:",u)}},L.appendChild(c),console.log("Canvas dimensions:",{width:l,height:o,scale:He}),console.log("PDF page dimensions:",{width:e.width,height:e.height})}catch(i){console.error("Error rendering PDF:",i)}T.filter(i=>i.pageIndex===A).forEach(i=>{ae(i)})}function be(){mt.textContent=`Page ${A+1} of ${$.length}`,Ge.disabled=A===0,Ye.disabled=A===$.length-1}oe.addEventListener("dragover",e=>{e.preventDefault(),oe.classList.add("border-indigo-500","bg-gray-600")});oe.addEventListener("dragleave",()=>{oe.classList.remove("border-indigo-500","bg-gray-600")});oe.addEventListener("drop",e=>{e.preventDefault(),oe.classList.remove("border-indigo-500","bg-gray-600");const n=e.dataTransfer?.files;n&&n.length>0&&n[0].type==="application/pdf"&&Ke(n[0])});dt.addEventListener("change",async e=>{const n=e.target.files?.[0];n&&Ke(n)});ct.addEventListener("click",()=>{Ue.classList.remove("hidden")});Le.addEventListener("change",()=>{Le.value==="custom"?We.classList.remove("hidden"):We.classList.add("hidden")});ut.addEventListener("click",()=>{const e=Le.value;Ee=wt(e),Xe(),fe(0),Me.classList.add("hidden"),Ae.classList.remove("hidden"),setTimeout(()=>Be({icons:Se}),100)});async function Ke(e){try{const n=await e.arrayBuffer();V=await ze.load(n),ge.clear();try{V.getForm().getFields().forEach(s=>{const b=s.getName();ge.add(b),s instanceof it&&ee.add(b);const c=b.match(/([a-zA-Z]+)_(\d+)/);if(c){const u=parseInt(c[2]);!isNaN(u)&&u>Q&&(Q=u,console.log("     Updated field counter to:",Q))}})}catch(o){console.log("No form fields found or error reading fields:",o)}st=await at({data:n}).promise;const l=V.getPageCount();$=[];for(let o=0;o<l;o++){const i=V.getPage(o),{width:s,height:b}=i.getSize();$.push({index:o,width:s,height:b,pdfPageData:void 0})}A=0,Re(),be(),Me.classList.add("hidden"),Ae.classList.remove("hidden"),setTimeout(()=>Be({icons:Se}),100)}catch(n){console.error("Error loading PDF:",n),Z("Error","Error loading PDF file. Please try again with a valid PDF.","error")}}Ge.addEventListener("click",()=>{A>0&&fe(A-1)});Ye.addEventListener("click",()=>{A<$.length-1&&fe(A+1)});yt.addEventListener("click",()=>{Xe(),fe($.length-1)});ft.addEventListener("click",()=>{T.length>0||$.length>0?confirm("Are you sure you want to reset? All your work will be lost.")&&Ce():Ce()});const G=document.getElementById("errorModal"),qe=document.getElementById("errorModalTitle"),Oe=document.getElementById("errorModalMessage"),me=document.getElementById("errorModalClose");let K=null;function Z(e,n,l="error",o,i="Close"){!G||!qe||!Oe||!me||(qe.textContent=e,Oe.textContent=n,me.textContent=i,K=o||null,G.classList.remove("hidden"))}me&&me.addEventListener("click",()=>{G?.classList.add("hidden"),K&&(K(),K=null)});G&&G.addEventListener("click",e=>{e.target===G&&(G.classList.add("hidden"),K&&(K(),K=null))});rt();
