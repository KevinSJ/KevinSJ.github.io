import{c as N,i as S}from"./style-CYUbkObH.js";import"./version-BHeJdyYx.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-Q5E4PlzL.js";import{s as r,a as L,b as B,d as I,h as C,f as T,P as $,n as U,o as j}from"./main-DWubsKaN.js";import{J as D}from"./jszip.min-3IPKxw9h.js";import"./mobileMenu-BoMunYmR.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const z=[".cbz",".cbr"],x="CBZ",O=[".jpg",".jpeg",".png",".gif",".bmp",".tiff",".tif",".webp",".avif",".jxl",".heic",".heif"],y={jpeg:[255,216,255],png:[137,80,78,71],gif:[71,73,70],bmp:[66,77],webp:[82,73,70,70]};function E(t,n,i=0){for(let s=0;s<n.length;s++)if(t[i+s]!==n[s])return!1;return!0}function R(t){if(t.length<12)return"unknown";if(E(t,y.jpeg))return"jpeg";if(E(t,y.png))return"png";if(E(t,y.gif))return"gif";if(E(t,y.bmp))return"bmp";if(E(t,y.webp)&&t[8]===87&&t[9]===69&&t[10]===66&&t[11]===80)return"webp";if(t[4]===102&&t[5]===116&&t[6]===121&&t[7]===112){const n=String.fromCharCode(t[8],t[9],t[10],t[11]);if(n==="avif"||n==="avis"||n==="mif1"||n==="miaf")return"avif"}return"unknown"}function F(t){return t.toLowerCase().endsWith(".cbz")}async function M(t,n){return new Promise((i,s)=>{const u=new Blob([t]),o=URL.createObjectURL(u),c=new Image;c.onload=()=>{const m=document.createElement("canvas");m.width=c.width,m.height=c.height;const g=m.getContext("2d");if(!g){URL.revokeObjectURL(o),s(new Error("Failed to get canvas context"));return}g.drawImage(c,0,0),m.toBlob(p=>{URL.revokeObjectURL(o),p?i(p):s(new Error(`Failed to convert ${n} to PNG`))},"image/png")},c.onerror=()=>{URL.revokeObjectURL(o),s(new Error(`Failed to load image: ${n}`))},c.src=o})}async function P(t){const n=await D.loadAsync(t),i=await $.create(),s=Object.keys(n.files).filter(o=>{if(n.files[o].dir)return!1;const c=o.toLowerCase().substring(o.lastIndexOf("."));return O.includes(c)}).sort((o,c)=>o.localeCompare(c,void 0,{numeric:!0,sensitivity:"base"}));for(const o of s){const m=await n.files[o].async("arraybuffer"),g=new Uint8Array(m),p=R(g);let v,b;if(p==="jpeg")v=g,b="jpg";else if(p==="png")v=g,b="png";else{const a=await M(m,o);v=new Uint8Array(await a.arrayBuffer()),b="png"}const e=b==="png"?await i.embedPng(v):await i.embedJpg(v);i.addPage([e.width,e.height]).drawImage(e,{x:0,y:0,width:e.width,height:e.height})}const u=await i.save();return new Blob([u.buffer],{type:"application/pdf"})}async function k(t){const n=new U(j("pymupdf"));return await n.load(),await n.convertToPdf(t,{filetype:"cbz"})}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("file-input"),n=document.getElementById("drop-zone"),i=document.getElementById("process-btn"),s=document.getElementById("file-display-area"),u=document.getElementById("file-controls"),o=document.getElementById("add-more-btn"),c=document.getElementById("clear-files-btn"),m=document.getElementById("back-to-tools");m&&m.addEventListener("click",()=>{window.location.href="/bentopdf/"});const g=async()=>{if(!(!s||!i||!u))if(r.files.length>0){s.innerHTML="";for(let e=0;e<r.files.length;e++){const f=r.files[e],a=document.createElement("div");a.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const l=document.createElement("div");l.className="flex flex-col overflow-hidden";const d=document.createElement("div");d.className="truncate font-medium text-gray-200 text-sm mb-1",d.textContent=f.name;const h=document.createElement("div");h.className="text-xs text-gray-400",h.textContent=T(f.size),l.append(d,h);const w=document.createElement("button");w.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",w.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',w.onclick=()=>{r.files=r.files.filter((_,A)=>A!==e),g()},a.append(l,w),s.appendChild(a)}N({icons:S}),u.classList.remove("hidden"),i.classList.remove("hidden"),i.disabled=!1}else s.innerHTML="",u.classList.add("hidden"),i.classList.add("hidden"),i.disabled=!0},p=()=>{r.files=[],r.pdfDoc=null,g()},v=async()=>{try{if(r.files.length===0){L("No Files",`Please select at least one ${x} file.`);return}if(r.files.length===1){const e=r.files[0];B(`Converting ${e.name}...`);let f;F(e.name)?f=await P(e):f=await k(e);const a=e.name.replace(/\.[^.]+$/,"")+".pdf";I(f,a),C(),L("Conversion Complete",`Successfully converted ${e.name} to PDF.`,"success",()=>p())}else{B("Converting files...");const e=new D;for(let a=0;a<r.files.length;a++){const l=r.files[a];B(`Converting ${a+1}/${r.files.length}: ${l.name}...`);let d;F(l.name)?d=await P(l):d=await k(l);const h=l.name.replace(/\.[^.]+$/,""),w=await d.arrayBuffer();e.file(`${h}.pdf`,w)}const f=await e.generateAsync({type:"blob"});I(f,"comic-converted.zip"),C(),L("Conversion Complete",`Successfully converted ${r.files.length} ${x} file(s) to PDF.`,"success",()=>p())}}catch(e){console.error(`[${x}2PDF] ERROR:`,e),C(),L("Error",`An error occurred during conversion. Error: ${e.message}`)}},b=e=>{e&&e.length>0&&(r.files=[...r.files,...Array.from(e)],g())};t&&n&&(t.addEventListener("change",e=>{b(e.target.files)}),n.addEventListener("dragover",e=>{e.preventDefault(),n.classList.add("bg-gray-700")}),n.addEventListener("dragleave",e=>{e.preventDefault(),n.classList.remove("bg-gray-700")}),n.addEventListener("drop",e=>{e.preventDefault(),n.classList.remove("bg-gray-700");const f=e.dataTransfer?.files;if(f&&f.length>0){const a=Array.from(f).filter(l=>{const d=l.name.toLowerCase();return z.some(h=>d.endsWith(h))});if(a.length>0){const l=new DataTransfer;a.forEach(d=>l.items.add(d)),b(l.files)}}}),t.addEventListener("click",()=>{t.value=""})),o&&o.addEventListener("click",()=>{t.click()}),c&&c.addEventListener("click",()=>{p()}),i&&i.addEventListener("click",v)});
