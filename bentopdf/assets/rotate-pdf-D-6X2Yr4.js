import{c as g,i as y}from"./style-CYUbkObH.js";import"./version-BHeJdyYx.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-Q5E4PlzL.js";import{G as k,a as m,f as E,b as I,P as C,e as R,h,l as T,m as N,w as D,d as A}from"./main-DWubsKaN.js";import"./mobileMenu-BoMunYmR.js";k.workerSrc=new URL("/bentopdf/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();const t={file:null,pdfDoc:null,pdfJsDoc:null,rotations:[]};function b(){T(),t.file=null,t.pdfDoc=null,t.pdfJsDoc=null,t.rotations=[];const n=document.getElementById("file-display-area");n&&(n.innerHTML="");const e=document.getElementById("tool-options");e&&e.classList.add("hidden");const o=document.getElementById("page-thumbnails");o&&(o.innerHTML="");const i=document.getElementById("file-input");i&&(i.value="")}function P(){for(let n=0;n<t.rotations.length;n++){const e=document.querySelector(`[data-page-index="${n}"]`);if(e){const o=e.querySelector(".thumbnail-wrapper");o&&(o.style.transform=`rotate(${t.rotations[n]}deg)`)}}}function F(n,e){const o=e-1,i=document.createElement("div");i.className="page-thumbnail relative bg-gray-700 rounded-lg overflow-hidden",i.dataset.pageIndex=o.toString(),i.dataset.pageNumber=e.toString();const r=document.createElement("div");r.className="thumbnail-wrapper flex items-center justify-center p-2 h-36",r.style.transition="transform 0.3s ease";const d=t.rotations[o]||0;r.style.transform=`rotate(${d}deg)`,n.className="max-w-full max-h-full object-contain",r.appendChild(n);const a=document.createElement("div");a.className="absolute top-1 left-1 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded",a.textContent=`${e}`,i.appendChild(r),i.appendChild(a);const l=document.createElement("div");l.className="flex items-center justify-center gap-2 p-2 bg-gray-800";const s=document.createElement("button");s.className="flex items-center gap-1 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded border border-gray-600 text-xs",s.innerHTML='<i data-lucide="rotate-ccw" class="w-3 h-3"></i>',s.onclick=function(f){f.stopPropagation(),t.rotations[o]=t.rotations[o]-90;const p=i.querySelector(".thumbnail-wrapper");p&&(p.style.transform=`rotate(${t.rotations[o]}deg)`)};const c=document.createElement("button");return c.className="flex items-center gap-1 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded border border-gray-600 text-xs",c.innerHTML='<i data-lucide="rotate-cw" class="w-3 h-3"></i>',c.onclick=function(f){f.stopPropagation(),t.rotations[o]=t.rotations[o]+90;const p=i.querySelector(".thumbnail-wrapper");p&&(p.style.transform=`rotate(${t.rotations[o]}deg)`)},l.append(s,c),i.appendChild(l),setTimeout(function(){g({icons:y})},0),i}async function H(){const n=document.getElementById("page-thumbnails");!n||!t.pdfJsDoc||(n.innerHTML="",await N(t.pdfJsDoc,n,F,{batchSize:8,useLazyLoading:!0,lazyLoadMargin:"200px",eagerLoadBatches:2,onBatchComplete:function(){g({icons:y})}}),g({icons:y}))}async function z(){const n=document.getElementById("file-display-area"),e=document.getElementById("tool-options");if(n)if(n.innerHTML="",t.file){const o=document.createElement("div");o.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const i=document.createElement("div");i.className="flex flex-col overflow-hidden";const r=document.createElement("div");r.className="truncate font-medium text-gray-200 text-sm mb-1",r.textContent=t.file.name;const d=document.createElement("div");d.className="text-xs text-gray-400",d.textContent=`${E(t.file.size)} • Loading...`,i.append(r,d);const a=document.createElement("button");a.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",a.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',a.onclick=function(){b()},o.append(i,a),n.appendChild(o),g({icons:y});try{I("Loading PDF...");const l=await t.file.arrayBuffer();t.pdfDoc=await C.load(l.slice(0),{ignoreEncryption:!0,throwOnInvalidObject:!1}),t.pdfJsDoc=await R({data:l.slice(0)}).promise;const s=t.pdfDoc.getPageCount();t.rotations=new Array(s).fill(0),d.textContent=`${E(t.file.size)} • ${s} pages`,await H(),h(),e&&e.classList.remove("hidden")}catch(l){console.error("Error loading PDF:",l),h(),m("Error","Failed to load PDF file."),b()}}else e&&e.classList.add("hidden")}async function O(){if(!t.pdfDoc||!t.file){m("Error","Please upload a PDF first.");return}I("Applying rotations...");try{const n=t.pdfDoc.getPageCount(),e=await C.create();for(let r=0;r<n;r++){const d=t.rotations[r]||0,a=t.pdfDoc.getPage(r),l=a.getRotation().angle,s=l+d;if(console.log(`Page ${r}: rotation=${d}, currentRotation=${l}, totalRotation=${s}, applying=${-s}`),s%90===0){const[c]=await e.copyPages(t.pdfDoc,[r]);c.setRotation(D(s)),e.addPage(c)}else{const c=await e.embedPage(a),{width:f,height:p}=c.scale(1),u=s*Math.PI/180,w=Math.abs(Math.cos(u)),x=Math.abs(Math.sin(u)),L=f*w+p*x,v=f*x+p*w,M=e.addPage([L,v]),S=L/2-(f/2*Math.cos(u)-p/2*Math.sin(u)),$=v/2-(f/2*Math.sin(u)+p/2*Math.cos(u));M.drawPage(c,{x:S,y:$,width:f,height:p,rotate:D(s)})}}const o=await e.save(),i=t.file.name.replace(/\.pdf$/i,"");A(new Blob([new Uint8Array(o)],{type:"application/pdf"}),`${i}_rotated.pdf`),m("Success","Rotations applied successfully!","success",function(){b()})}catch(n){console.error(n),m("Error","Could not apply rotations.")}finally{h()}}function B(n){if(n&&n.length>0){const e=n[0];(e.type==="application/pdf"||e.name.toLowerCase().endsWith(".pdf"))&&(t.file=e,z())}}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("file-input"),e=document.getElementById("drop-zone"),o=document.getElementById("process-btn"),i=document.getElementById("back-to-tools"),r=document.getElementById("rotate-all-left"),d=document.getElementById("rotate-all-right");i&&i.addEventListener("click",function(){window.location.href="/bentopdf/"}),r&&r.addEventListener("click",function(){for(let a=0;a<t.rotations.length;a++)t.rotations[a]=t.rotations[a]-90;P()}),d&&d.addEventListener("click",function(){for(let a=0;a<t.rotations.length;a++)t.rotations[a]=t.rotations[a]+90;P()}),n&&e&&(n.addEventListener("change",function(a){B(a.target.files)}),e.addEventListener("dragover",function(a){a.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",function(a){a.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",function(a){a.preventDefault(),e.classList.remove("bg-gray-700");const l=a.dataTransfer?.files;if(l&&l.length>0){const s=Array.from(l).filter(function(c){return c.type==="application/pdf"||c.name.toLowerCase().endsWith(".pdf")});if(s.length>0){const c=new DataTransfer;c.items.add(s[0]),B(c.files)}}}),n.addEventListener("click",function(){n.value=""})),o&&o.addEventListener("click",O)});
