import{c as B,i as I}from"./style-D1FQfXNQ.js";import"./version-Dw8ZKLCV.js";import"./simple-mode-footer-D78rH_WB.js";import{h as f,d as w,a as m,f as h,b as p,P as D}from"./main-Da82M_MD.js";import"./mobileMenu-BoMunYmR.js";const y=new Worker("/workers/add-attachments.worker.js"),o={file:null,pdfDoc:null,attachments:[]};function v(){o.file=null,o.pdfDoc=null,o.attachments=[];const t=document.getElementById("file-display-area");t&&(t.innerHTML="");const e=document.getElementById("tool-options");e&&e.classList.add("hidden");const a=document.getElementById("attachment-file-list");a&&(a.innerHTML="");const s=document.getElementById("attachment-files-input");s&&(s.value="");const i=document.getElementById("attachment-level-options");i&&i.classList.add("hidden");const r=document.getElementById("page-range-wrapper");r&&r.classList.add("hidden");const c=document.getElementById("process-btn");c&&c.classList.add("hidden");const l=document.getElementById("file-input");l&&(l.value="");const n=document.querySelector('input[name="attachment-level"][value="document"]');n&&(n.checked=!0)}y.onmessage=function(t){const e=t.data;if(e.status==="success"&&e.modifiedPDF!==void 0){f();const a=o.file?.name.replace(/\.pdf$/i,"")||"document";w(new Blob([new Uint8Array(e.modifiedPDF)],{type:"application/pdf"}),`${a}_with_attachments.pdf`),m("Success",`${o.attachments.length} file(s) attached successfully.`,"success",function(){v()})}else e.status==="error"&&(f(),m("Error",e.message||"Unknown error occurred."))};y.onerror=function(t){f(),console.error("Worker error:",t),m("Error","Worker error occurred. Check console for details.")};async function x(){const t=document.getElementById("file-display-area"),e=document.getElementById("tool-options");if(t)if(t.innerHTML="",o.file){const a=document.createElement("div");a.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const s=document.createElement("div");s.className="flex flex-col overflow-hidden";const i=document.createElement("div");i.className="truncate font-medium text-gray-200 text-sm mb-1",i.textContent=o.file.name;const r=document.createElement("div");r.className="text-xs text-gray-400",r.textContent=`${h(o.file.size)} • Loading...`,s.append(i,r);const c=document.createElement("button");c.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",c.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',c.onclick=function(){v()},a.append(s,c),t.appendChild(a),B({icons:I});try{p("Loading PDF...");const l=await o.file.arrayBuffer();o.pdfDoc=await D.load(l,{ignoreEncryption:!0,throwOnInvalidObject:!1});const n=o.pdfDoc.getPageCount();r.textContent=`${h(o.file.size)} • ${n} pages`;const d=document.getElementById("attachment-total-pages");d&&(d.textContent=n.toString()),f(),e&&e.classList.remove("hidden")}catch(l){console.error("Error loading PDF:",l),f(),m("Error","Failed to load PDF file."),v()}}else e&&e.classList.add("hidden")}function b(){const t=document.getElementById("attachment-file-list"),e=document.getElementById("attachment-level-options"),a=document.getElementById("process-btn");t&&(t.innerHTML="",o.attachments.forEach(function(s){const i=document.createElement("div");i.className="flex justify-between items-center p-2 bg-gray-800 rounded-md text-white";const r=document.createElement("span");r.className="truncate text-sm",r.textContent=s.name;const c=document.createElement("span");c.className="text-xs text-gray-400",c.textContent=h(s.size),i.append(r,c),t.appendChild(i)}),o.attachments.length>0?(e&&e.classList.remove("hidden"),a&&a.classList.remove("hidden")):(e&&e.classList.add("hidden"),a&&a.classList.add("hidden")))}async function k(){if(!o.file||!o.pdfDoc){m("Error","Please upload a PDF first.");return}if(o.attachments.length===0){m("No Files","Please select at least one file to attach.");return}const t=document.querySelector('input[name="attachment-level"]:checked')?.value||"document";let e="";if(t==="page"&&(e=document.getElementById("attachment-page-range")?.value?.trim()||"",!e)){m("Error","Please specify a page range for page-level attachments.");return}p("Embedding files into PDF...");try{const a=await o.file.arrayBuffer(),s=[],i=[];for(let l=0;l<o.attachments.length;l++){const n=o.attachments[l];p(`Reading ${n.name} (${l+1}/${o.attachments.length})...`);const d=await n.arrayBuffer();s.push(d),i.push(n.name)}p("Attaching files to PDF...");const r={command:"add-attachments",pdfBuffer:a,attachmentBuffers:s,attachmentNames:i,attachmentLevel:t,pageRange:e},c=[a,...s];y.postMessage(r,c)}catch(a){console.error("Error attaching files:",a),f(),m("Error",`Failed to attach files: ${a.message}`)}}function E(t){if(t&&t.length>0){const e=t[0];(e.type==="application/pdf"||e.name.toLowerCase().endsWith(".pdf"))&&(o.file=e,x())}}function L(t){t&&t.length>0&&(o.attachments=Array.from(t),b())}document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("file-input"),e=document.getElementById("drop-zone"),a=document.getElementById("attachment-files-input"),s=document.getElementById("attachment-drop-zone"),i=document.getElementById("process-btn"),r=document.getElementById("back-to-tools"),c=document.getElementById("page-range-wrapper");r&&r.addEventListener("click",function(){window.location.href="/"}),t&&e&&(t.addEventListener("change",function(n){E(n.target.files)}),e.addEventListener("dragover",function(n){n.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",function(n){n.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",function(n){n.preventDefault(),e.classList.remove("bg-gray-700");const d=n.dataTransfer?.files;if(d&&d.length>0){const g=Array.from(d).filter(function(u){return u.type==="application/pdf"||u.name.toLowerCase().endsWith(".pdf")});if(g.length>0){const u=new DataTransfer;u.items.add(g[0]),E(u.files)}}}),t.addEventListener("click",function(){t.value=""})),a&&s&&(a.addEventListener("change",function(n){L(n.target.files)}),s.addEventListener("dragover",function(n){n.preventDefault(),s.classList.add("bg-gray-700")}),s.addEventListener("dragleave",function(n){n.preventDefault(),s.classList.remove("bg-gray-700")}),s.addEventListener("drop",function(n){n.preventDefault(),s.classList.remove("bg-gray-700");const d=n.dataTransfer?.files;d&&L(d)}),a.addEventListener("click",function(){a.value=""})),document.querySelectorAll('input[name="attachment-level"]').forEach(function(n){n.addEventListener("change",function(d){d.target.value==="page"&&c?c.classList.remove("hidden"):c&&c.classList.add("hidden")})}),i&&i.addEventListener("click",k)});
