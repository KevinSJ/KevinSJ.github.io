import{c as g,i as w}from"./style-CYUbkObH.js";import"./version-BHeJdyYx.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-Q5E4PlzL.js";import{a as l,i as h,r as E,d as v,f as F}from"./main-DWubsKaN.js";import"./mobileMenu-BoMunYmR.js";const s={file:null};function u(){s.file=null;const o=document.getElementById("file-display-area");o&&(o.innerHTML="");const e=document.getElementById("tool-options");e&&e.classList.add("hidden");const r=document.getElementById("file-input");r&&(r.value="");const i=document.getElementById("password-input");i&&(i.value="")}async function I(){const o=document.getElementById("file-display-area"),e=document.getElementById("tool-options");if(o)if(o.innerHTML="",s.file){const r=document.createElement("div");r.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const i=document.createElement("div");i.className="flex flex-col overflow-hidden";const n=document.createElement("div");n.className="truncate font-medium text-gray-200 text-sm mb-1",n.textContent=s.file.name;const a=document.createElement("div");a.className="text-xs text-gray-400",a.textContent=F(s.file.size),i.append(n,a);const t=document.createElement("button");t.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",t.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',t.onclick=function(){u()},r.append(i,t),o.appendChild(r),g({icons:w}),e&&e.classList.remove("hidden")}else e&&e.classList.add("hidden")}function p(o){if(o&&o.length>0){const e=o[0];(e.type==="application/pdf"||e.name.toLowerCase().endsWith(".pdf"))&&(s.file=e,I())}}async function L(){if(!s.file){l("No File","Please upload a PDF file first.");return}const o=document.getElementById("password-input")?.value;if(!o){l("Input Required","Please enter the PDF password.");return}const e="/input.pdf",r="/output.pdf";let i;const n=document.getElementById("loader-modal"),a=document.getElementById("loader-text");try{n&&n.classList.remove("hidden"),a&&(a.textContent="Initializing decryption..."),i=await h(),a&&(a.textContent="Reading encrypted PDF...");const t=await E(s.file),d=new Uint8Array(t);i.FS.writeFile(e,d),a&&(a.textContent="Decrypting PDF...");const m=[e,"--password="+o,"--decrypt",r];try{i.callMain(m)}catch(c){throw console.error("qpdf execution error:",c),c.message?.includes("invalid password")||c.message?.includes("password")?new Error("INVALID_PASSWORD"):c}a&&(a.textContent="Preparing download...");const f=i.FS.readFile(r,{encoding:"binary"});if(f.length===0)throw new Error("Decryption resulted in an empty file.");const y=new Blob([f],{type:"application/pdf"});v(y,`unlocked-${s.file.name}`),n&&n.classList.add("hidden"),l("Success","PDF decrypted successfully! Your download has started.","success",()=>{u()})}catch(t){console.error("Error during PDF decryption:",t),n&&n.classList.add("hidden"),t.message==="INVALID_PASSWORD"?l("Incorrect Password","The password you entered is incorrect. Please try again."):t.message?.includes("password")?l("Password Error","Unable to decrypt the PDF with the provided password."):l("Decryption Failed",`An error occurred: ${t.message||"The password you entered is wrong or the file is corrupted."}`)}finally{try{if(i?.FS){try{i.FS.unlink(e)}catch(t){console.warn("Failed to unlink input file:",t)}try{i.FS.unlink(r)}catch(t){console.warn("Failed to unlink output file:",t)}}}catch(t){console.warn("Failed to cleanup WASM FS:",t)}}}document.addEventListener("DOMContentLoaded",function(){const o=document.getElementById("file-input"),e=document.getElementById("drop-zone"),r=document.getElementById("process-btn"),i=document.getElementById("back-to-tools");i&&i.addEventListener("click",function(){window.location.href="/bentopdf/"}),o&&e&&(o.addEventListener("change",function(n){p(n.target.files)}),e.addEventListener("dragover",function(n){n.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",function(n){n.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",function(n){n.preventDefault(),e.classList.remove("bg-gray-700");const a=n.dataTransfer?.files;if(a&&a.length>0){const t=Array.from(a).filter(function(d){return d.type==="application/pdf"||d.name.toLowerCase().endsWith(".pdf")});if(t.length>0){const d=new DataTransfer;d.items.add(t[0]),p(d.files)}}}),o.addEventListener("click",function(){o.value=""})),r&&r.addEventListener("click",L)});
