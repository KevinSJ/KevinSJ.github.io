import{c as K,i as N}from"./style-CNx3HTbi.js";import"./version-D4ympJL5.js";import"./full-width-DliZ98Ur.js";import"./simple-mode-footer-ODFatrFN.js";import{G as X,e as Z,q as R,a as x,b as U,P as $,z as M,d as Q,h as L,f as _}from"./main-Dqs2Ohqn.js";import"./mobileMenu-BoMunYmR.js";X.workerSrc=new URL("/bentopdf/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();const t={file:null,pdfJsDoc:null,pdfBytes:null,pageSnapshots:{},currentPage:1};function ee(){t.file=null,t.pdfJsDoc=null,t.pdfBytes=null,t.pageSnapshots={},t.currentPage=1;const n=document.getElementById("file-display-area");n&&(n.innerHTML="");const e=document.getElementById("tool-options");e&&e.classList.add("hidden");const o=document.getElementById("file-input");o&&(o.value="");const s=document.getElementById("process-btn");s&&(s.disabled=!0);const i=document.getElementById("total-pages");i&&(i.textContent="0")}async function b(n){if(!t.pdfJsDoc)return;t.currentPage=n,U(`Rendering preview for page ${n}...`);const e=document.getElementById("posterize-preview-canvas"),o=e.getContext("2d");if(!o){L();return}if(t.pageSnapshots[n])e.width=t.pageSnapshots[n].width,e.height=t.pageSnapshots[n].height,o.putImageData(t.pageSnapshots[n],0,0);else{const s=await t.pdfJsDoc.getPage(n),i=s.getViewport({scale:1.5});e.width=i.width,e.height=i.height,await s.render({canvasContext:o,viewport:i,canvas:e}).promise,t.pageSnapshots[n]=o.getImageData(0,0,e.width,e.height)}te(),D(),L()}function D(){if(!t.pageSnapshots[t.currentPage]||!t.pdfJsDoc)return;const n=document.getElementById("posterize-preview-canvas"),e=n.getContext("2d");if(!e)return;e.putImageData(t.pageSnapshots[t.currentPage],0,0);const o=document.getElementById("page-range").value;if(R(o,t.pdfJsDoc.numPages).includes(t.currentPage-1)){const i=parseInt(document.getElementById("posterize-rows").value)||1,c=parseInt(document.getElementById("posterize-cols").value)||1;e.strokeStyle="rgba(239, 68, 68, 0.9)",e.lineWidth=2,e.setLineDash([10,5]);const d=n.width/c,l=n.height/i;for(let a=1;a<c;a++)e.beginPath(),e.moveTo(a*d,0),e.lineTo(a*d,n.height),e.stroke();for(let a=1;a<i;a++)e.beginPath(),e.moveTo(0,a*l),e.lineTo(n.width,a*l),e.stroke();e.setLineDash([])}}function te(){if(!t.pdfJsDoc)return;const n=document.getElementById("current-preview-page"),e=document.getElementById("prev-preview-page"),o=document.getElementById("next-preview-page");n&&(n.textContent=t.currentPage.toString()),e&&(e.disabled=t.currentPage<=1),o&&(o.disabled=t.currentPage>=t.pdfJsDoc.numPages)}async function ne(){if(!t.pdfJsDoc||!t.pdfBytes){x("No File","Please upload a PDF file first.");return}U("Posterizing PDF...");try{const n=parseInt(document.getElementById("posterize-rows").value)||1,e=parseInt(document.getElementById("posterize-cols").value)||1,o=document.getElementById("output-page-size").value,s=document.getElementById("output-orientation").value,i=document.querySelector('input[name="scaling-mode"]:checked').value,c=parseFloat(document.getElementById("overlap").value)||0,d=document.getElementById("overlap-units").value,l=document.getElementById("page-range").value;let a=c;d==="in"?a=c*72:d==="mm"&&(a=c*(72/25.4));const p=await $.create(),h=t.pdfJsDoc.numPages,v=R(l,h);if(v.length===0)throw new Error("Invalid page range specified.");const r=document.createElement("canvas"),S=r.getContext("2d");if(!S)throw new Error("Could not create canvas context.");for(const j of v){const C=await t.pdfJsDoc.getPage(Number(j)+1),w=C.getViewport({scale:2});r.width=w.width,r.height=w.height,await C.render({canvasContext:S,viewport:w,canvas:r}).promise;let[g,f]=M[o]||M.A4,P=s;P==="auto"&&(P=w.width>w.height?"landscape":"portrait"),P==="landscape"&&g<f?[g,f]=[f,g]:P==="portrait"&&g>f&&([g,f]=[f,g]);const z=r.width/e,J=r.height/n;for(let u=0;u<n;u++)for(let m=0;m<e;m++){const q=m*z-(m>0?a:0),V=u*J-(u>0?a:0),y=z+(m>0?a:0)+(m<e-1?a:0),E=J+(u>0?a:0)+(u<n-1?a:0),B=document.createElement("canvas");B.width=y,B.height=E;const k=B.getContext("2d");if(k){k.drawImage(r,q,V,y,E,0,0,y,E);const Y=await p.embedPng(B.toDataURL("image/png")),I=p.addPage([g,f]),T=I.getWidth()/y,F=I.getHeight()/E,W=i==="fit"?Math.min(T,F):Math.max(T,F),H=y*W,A=E*W;I.drawImage(Y,{x:(I.getWidth()-H)/2,y:(I.getHeight()-A)/2,width:H,height:A})}}}const G=await p.save();Q(new Blob([new Uint8Array(G)],{type:"application/pdf"}),"posterized.pdf"),x("Success","Your PDF has been posterized.")}catch(n){console.error(n),x("Error",n.message||"Could not posterize the PDF.")}finally{L()}}async function oe(){const n=document.getElementById("file-display-area"),e=document.getElementById("tool-options"),o=document.getElementById("process-btn");if(n)if(n.innerHTML="",t.file){const s=document.createElement("div");s.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const i=document.createElement("div");i.className="flex flex-col overflow-hidden";const c=document.createElement("div");c.className="truncate font-medium text-gray-200 text-sm mb-1",c.textContent=t.file.name;const d=document.createElement("div");d.className="text-xs text-gray-400",d.textContent=_(t.file.size),i.append(c,d);const l=document.createElement("button");l.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",l.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',l.onclick=function(){ee()},s.append(i,l),n.appendChild(s),K({icons:N}),e&&e.classList.remove("hidden"),o&&(o.disabled=!1)}else e&&e.classList.add("hidden")}async function O(n){if(n&&n.length>0){const e=n[0];if(e.type==="application/pdf"||e.name.toLowerCase().endsWith(".pdf")){t.file=e,t.pdfBytes=new Uint8Array(await e.arrayBuffer()),t.pdfJsDoc=await Z({data:t.pdfBytes}).promise,t.pageSnapshots={},t.currentPage=1;const o=document.getElementById("total-pages"),s=document.getElementById("total-preview-pages");o&&t.pdfJsDoc&&(o.textContent=t.pdfJsDoc.numPages.toString()),s&&t.pdfJsDoc&&(s.textContent=t.pdfJsDoc.numPages.toString()),await oe(),await b(1)}}}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("file-input"),e=document.getElementById("drop-zone"),o=document.getElementById("process-btn"),s=document.getElementById("back-to-tools"),i=document.getElementById("prev-preview-page"),c=document.getElementById("next-preview-page"),d=document.getElementById("posterize-rows"),l=document.getElementById("posterize-cols"),a=document.getElementById("page-range");s&&s.addEventListener("click",function(){window.location.href="/bentopdf/"}),n&&e&&(n.addEventListener("change",function(p){O(p.target.files)}),e.addEventListener("dragover",function(p){p.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",function(p){p.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",function(p){p.preventDefault(),e.classList.remove("bg-gray-700");const h=p.dataTransfer?.files;if(h&&h.length>0){const v=Array.from(h).filter(function(r){return r.type==="application/pdf"||r.name.toLowerCase().endsWith(".pdf")});if(v.length>0){const r=new DataTransfer;r.items.add(v[0]),O(r.files)}}}),n.addEventListener("click",function(){n.value=""})),i&&i.addEventListener("click",function(){t.currentPage>1&&b(t.currentPage-1)}),c&&c.addEventListener("click",function(){t.pdfJsDoc&&t.currentPage<t.pdfJsDoc.numPages&&b(t.currentPage+1)}),d&&d.addEventListener("input",D),l&&l.addEventListener("input",D),a&&a.addEventListener("input",D),o&&o.addEventListener("click",ne)});
